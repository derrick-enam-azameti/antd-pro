(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{90829:function(Ot,J,N){"use strict";var le=N(67294),ye=N(83280),g=N(23185),ve=N(4322),V=N(24770),ce=N(89182),ue=function(se,at){var Le={};for(var ut in se)Object.prototype.hasOwnProperty.call(se,ut)&&at.indexOf(ut)<0&&(Le[ut]=se[ut]);if(se!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ht=0,ut=Object.getOwnPropertySymbols(se);Ht<ut.length;Ht++)at.indexOf(ut[Ht])<0&&Object.prototype.propertyIsEnumerable.call(se,ut[Ht])&&(Le[ut[Ht]]=se[ut[Ht]]);return Le},Ne=(0,le.forwardRef)(function(se,at){var Le=se.chartRef,ut=se.style,Ht=ut===void 0?{height:"inherit"}:ut,ur=se.className,Pt=se.loading,Jt=se.loadingTemplate,kt=se.errorTemplate,pt=ue(se,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),gt=(0,g.Z)(ye.TZ,pt),er=gt.chart,q=gt.container;return(0,le.useEffect)(function(){(0,ve.J)(Le,er.current)},[er.current]),(0,le.useImperativeHandle)(at,function(){return{getChart:function(){return er.current}}}),le.createElement(V.Z,{errorTemplate:kt},Pt&&le.createElement(ce.Z,{loadingTemplate:Jt,theme:se.theme}),le.createElement("div",{className:ur,style:Ht,ref:q}))});J.Z=Ne},93343:function(Ot,J,N){"use strict";var le=N(67294),ye=N(83280),g=N(23185),ve=N(4322),V=N(24770),ce=N(89182),ue=function(se,at){var Le={};for(var ut in se)Object.prototype.hasOwnProperty.call(se,ut)&&at.indexOf(ut)<0&&(Le[ut]=se[ut]);if(se!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ht=0,ut=Object.getOwnPropertySymbols(se);Ht<ut.length;Ht++)at.indexOf(ut[Ht])<0&&Object.prototype.propertyIsEnumerable.call(se,ut[Ht])&&(Le[ut[Ht]]=se[ut[Ht]]);return Le},Ne=(0,le.forwardRef)(function(se,at){var Le=se.chartRef,ut=se.style,Ht=ut===void 0?{height:"inherit"}:ut,ur=se.className,Pt=se.loading,Jt=se.loadingTemplate,kt=se.errorTemplate,pt=ue(se,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),gt=(0,g.Z)(ye.m,pt),er=gt.chart,q=gt.container;return(0,le.useEffect)(function(){(0,ve.J)(Le,er.current)},[er.current]),(0,le.useImperativeHandle)(at,function(){return{getChart:function(){return er.current}}}),le.createElement(V.Z,{errorTemplate:kt},Pt&&le.createElement(ce.Z,{loadingTemplate:Jt,theme:se.theme}),le.createElement("div",{className:ur,style:Ht,ref:q}))});J.Z=Ne},64335:function(Ot,J,N){"use strict";var le=N(67294),ye=(0,le.createContext)({});J.Z=ye},21349:function(Ot,J,N){"use strict";var le=N(84305),ye=N(75901),g=N(94184),ve=N.n(g),V=N(67294),ce=N(64335),ue=N(53645),Ne=N.n(ue),se=function(Le){var ut=(0,V.useContext)(ce.Z),Ht=Le.children,ur=Le.contentWidth,Pt=Le.className,Jt=Le.style,kt=(0,V.useContext)(ye.ZP.ConfigContext),pt=kt.getPrefixCls,gt=Le.prefixCls||pt("pro"),er=ur||ut.contentWidth,q="".concat(gt,"-grid-content");return V.createElement("div",{className:ve()(q,Pt,{wide:er==="Fixed"}),style:Jt},V.createElement("div",{className:"".concat(gt,"-grid-content-children")},Ht))};J.Z=se},66213:function(Ot,J,N){"use strict";N.d(J,{Z:function(){return g}});var le=N(77608);function ye(ve,V){for(;!Object.prototype.hasOwnProperty.call(ve,V)&&(ve=(0,le.Z)(ve),ve!==null););return ve}function g(){return typeof Reflect!="undefined"&&Reflect.get?g=Reflect.get.bind():g=function(V,ce,ue){var Ne=ye(V,ce);if(!!Ne){var se=Object.getOwnPropertyDescriptor(Ne,ce);return se.get?se.get.call(arguments.length<3?V:ue):se.value}},g.apply(this,arguments)}},31795:function(Ot,J,N){var le=N(75752);Ot.exports.geometry=ye,Ot.exports.ring=ve;function ye(ce){var ue=0,Ne;switch(ce.type){case"Polygon":return g(ce.coordinates);case"MultiPolygon":for(Ne=0;Ne<ce.coordinates.length;Ne++)ue+=g(ce.coordinates[Ne]);return ue;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ne=0;Ne<ce.geometries.length;Ne++)ue+=ye(ce.geometries[Ne]);return ue}}function g(ce){var ue=0;if(ce&&ce.length>0){ue+=Math.abs(ve(ce[0]));for(var Ne=1;Ne<ce.length;Ne++)ue-=Math.abs(ve(ce[Ne]))}return ue}function ve(ce){var ue,Ne,se,at,Le,ut,Ht,ur=0,Pt=ce.length;if(Pt>2){for(Ht=0;Ht<Pt;Ht++)Ht===Pt-2?(at=Pt-2,Le=Pt-1,ut=0):Ht===Pt-1?(at=Pt-1,Le=0,ut=1):(at=Ht,Le=Ht+1,ut=Ht+2),ue=ce[at],Ne=ce[Le],se=ce[ut],ur+=(V(se[0])-V(ue[0]))*Math.sin(V(Ne[1]));ur=ur*le.RADIUS*le.RADIUS/2}return ur}function V(ce){return ce*Math.PI/180}},38163:function(Ot,J,N){var le=N(31795);Ot.exports=ye;function ye(Ne,se){switch(Ne&&Ne.type||null){case"FeatureCollection":return Ne.features=Ne.features.map(g(ye,se)),Ne;case"GeometryCollection":return Ne.geometries=Ne.geometries.map(g(ye,se)),Ne;case"Feature":return Ne.geometry=ye(Ne.geometry,se),Ne;case"Polygon":case"MultiPolygon":return ve(Ne,se);default:return Ne}}function g(Ne,se){return function(at){return Ne(at,se)}}function ve(Ne,se){return Ne.type==="Polygon"?Ne.coordinates=V(Ne.coordinates,se):Ne.type==="MultiPolygon"&&(Ne.coordinates=Ne.coordinates.map(g(V,se))),Ne}function V(Ne,se){se=!!se,Ne[0]=ce(Ne[0],se);for(var at=1;at<Ne.length;at++)Ne[at]=ce(Ne[at],!se);return Ne}function ce(Ne,se){return ue(Ne)===se?Ne:Ne.reverse()}function ue(Ne){return le.ring(Ne)>=0}},70499:function(Ot){Ot.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(Ot){Ot.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},15492:function(Ot,J,N){"use strict";N.r(J),N.d(J,{default:function(){return y4}});var le={};N.r(le),N.d(le,{add:function(){return ah},adjoint:function(){return Se},clone:function(){return Co},copy:function(){return zl},create:function(){return Zi},determinant:function(){return ie},equals:function(){return Uh},exactEquals:function(){return Kc},frob:function(){return Ec},fromQuat:function(){return pn},fromQuat2:function(){return rn},fromRotation:function(){return vt},fromRotationTranslation:function(){return Br},fromRotationTranslationScale:function(){return bn},fromRotationTranslationScaleOrigin:function(){return yn},fromScaling:function(){return Ce},fromTranslation:function(){return Ve},fromValues:function(){return we},fromXRotation:function(){return Tt},fromYRotation:function(){return dr},fromZRotation:function(){return zr},frustum:function(){return $n},getRotation:function(){return cn},getScaling:function(){return En},getTranslation:function(){return Fr},identity:function(){return At},invert:function(){return Oi},lookAt:function(){return Tu},mul:function(){return id},multiply:function(){return Ze},multiplyScalar:function(){return es},multiplyScalarAndAdd:function(){return xp},ortho:function(){return Rs},orthoNO:function(){return fl},orthoZO:function(){return hl},perspective:function(){return Jo},perspectiveFromFieldOfView:function(){return fa},perspectiveNO:function(){return ma},perspectiveZO:function(){return Da},rotate:function(){return $e},rotateX:function(){return Fe},rotateY:function(){return st},rotateZ:function(){return _e},scale:function(){return Rt},set:function(){return jt},str:function(){return Mu},sub:function(){return jd},subtract:function(){return Zd},targetTo:function(){return _p},translate:function(){return ft},transpose:function(){return hn}});var ye=N(58024),g=N(91894),ve=N(13062),V=N(71230),ce=N(89032),ue=N(15746),Ne=N(95300),se=N(7277),at=N(25377),Le=N(67294),ut=N(83280),Ht=N(23185),ur=N(4322),Pt=N(24770),Jt=N(89182),kt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},pt=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,f=e.loading,v=e.loadingTemplate,m=e.errorTemplate,x=kt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Ht.Z)(ut.aC,x),A=C.chart,O=C.container;return(0,Le.useEffect)(function(){(0,ur.J)(r,A.current)},[A.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return A.current}}}),Le.createElement(Pt.Z,{errorTemplate:m},f&&Le.createElement(Jt.Z,{loadingTemplate:v,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:O}))}),gt=pt,er=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},q=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,f=e.loading,v=e.loadingTemplate,m=e.errorTemplate,x=er(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Ht.Z)(ut.kB,x),A=C.chart,O=C.container;return(0,Le.useEffect)(function(){(0,ur.J)(r,A.current)},[A.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return A.current}}}),Le.createElement(Pt.Z,{errorTemplate:m},f&&Le.createElement(Jt.Z,{loadingTemplate:v,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:O}))}),Qt=q,xt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},rt=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,f=e.loading,v=e.loadingTemplate,m=e.errorTemplate,x=xt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Ht.Z)(ut.Kj,x),A=C.chart,O=C.container;return(0,Le.useEffect)(function(){(0,ur.J)(r,A.current)},[A.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return A.current}}}),Le.createElement(Pt.Z,{errorTemplate:m},f&&Le.createElement(Jt.Z,{loadingTemplate:v,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:O}))}),wt=rt,et=N(90829),$t=N(21349),Sr=N(92077),kr=N.n(Sr),en=N(2824),Te=N(3182),qe=N(69610),ke=N(54941),Mt=N(81306),yt=N(19809),Zt=N(94043),qt=N.n(Zt),Cr=(0,Le.createContext)({});function qn(){return(0,Le.useContext)(Cr)}var fn={},Hi={},Zn=function(i){return Hi[i]},Hn=function(i,r){Hi[i]=r},pi=function(i){return fn[i]},Kn=function(i,r){fn[i]=r},ui={},ra={},Ri=34,bi=10,Ni=13;function aa(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Ei(e,i){var r=aa(e);return function(n,a){return i(r(n),a,e)}}function _a(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function An(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function _i(e){return e<0?"-"+An(-e,6):e>9999?"+"+An(e,6):An(e,4)}function Bi(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":_i(e.getUTCFullYear(),4)+"-"+An(e.getUTCMonth()+1,2)+"-"+An(e.getUTCDate(),2)+(a?"T"+An(i,2)+":"+An(r,2)+":"+An(n,2)+"."+An(a,3)+"Z":n?"T"+An(i,2)+":"+An(r,2)+":"+An(n,2)+"Z":r||i?"T"+An(i,2)+":"+An(r,2)+"Z":"")}function Wi(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(A,O){var D,Z,X=a(A,function(te,Ee){if(D)return D(te,Ee-1);Z=te,D=O?Ei(te,O):aa(te)});return X.columns=Z||[],X}function a(A,O){var D=[],Z=A.length,X=0,te=0,Ee,Ue=Z<=0,Qe=!1;A.charCodeAt(Z-1)===bi&&--Z,A.charCodeAt(Z-1)===Ni&&--Z;function ct(){if(Ue)return ra;if(Qe)return Qe=!1,ui;var bt,Kt=X,lr;if(A.charCodeAt(Kt)===Ri){for(;X++<Z&&A.charCodeAt(X)!==Ri||A.charCodeAt(++X)===Ri;);return(bt=X)>=Z?Ue=!0:(lr=A.charCodeAt(X++))===bi?Qe=!0:lr===Ni&&(Qe=!0,A.charCodeAt(X)===bi&&++X),A.slice(Kt+1,bt-1).replace(/""/g,'"')}for(;X<Z;){if((lr=A.charCodeAt(bt=X++))===bi)Qe=!0;else if(lr===Ni)Qe=!0,A.charCodeAt(X)===bi&&++X;else if(lr!==r)continue;return A.slice(Kt,bt)}return Ue=!0,A.slice(Kt,Z)}for(;(Ee=ct())!==ra;){for(var St=[];Ee!==ui&&Ee!==ra;)St.push(Ee),Ee=ct();O&&(St=O(St,te++))==null||D.push(St)}return D}function s(A,O){return A.map(function(D){return O.map(function(Z){return C(D[Z])}).join(e)})}function f(A,O){return O==null&&(O=_a(A)),[O.map(C).join(e)].concat(s(A,O)).join(`
`)}function v(A,O){return O==null&&(O=_a(A)),s(A,O).join(`
`)}function m(A){return A.map(x).join(`
`)}function x(A){return A.map(C).join(e)}function C(A){return A==null?"":A instanceof Date?Bi(A):i.test(A+="")?'"'+A.replace(/"/g,'""')+'"':A}return{parse:n,parseRows:a,format:f,formatBody:v,formatRows:m,formatRow:x,formatValue:C}}var za=Wi(","),de=za.parse,Nn=za.parseRows,Ua=za.format,ls=za.formatBody,Vt=za.formatRows,or=za.formatRow,wr=za.formatValue,I=N(96156),ir=N(85061),Dn=N(38163),li=N.n(Dn);function Wn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wi(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,f=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(m,x){var C=[];if(r&&n&&(C=[parseFloat(m[r]),parseFloat(m[n])]),r&&n&&a&&s){var A=[parseFloat(m[r]),parseFloat(m[n])],O=[parseFloat(m[a]),parseFloat(m[s])];C=[A,O]}if(f){var D="Polygon";Array.isArray(f[0])||(D="Point"),Array.isArray(f[0])&&!Array.isArray(f[0][0])&&(D="LineString");var Z={type:D,coordinates:(0,ir.Z)(m[f])};li()(Z,!0),C=Z.coordinates}var X=nn(nn({},m),{},{_id:x,coordinates:C});v.push(X)}),{dataArray:v}):{dataArray:[]}}var Ti=[{lng1:100,lat1:30,lng2:130,lat2:30}],Wa={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function cs(e,i){var r=de(e);return wi(r,i)}var ha=63710088e-1,wa={centimeters:ha*100,centimetres:ha*100,degrees:ha/111325,feet:ha*3.28084,inches:ha*39.37,kilometers:ha/1e3,kilometres:ha/1e3,meters:ha,metres:ha,miles:ha/1609.344,millimeters:ha*1e3,millimetres:ha*1e3,nauticalmiles:ha/1852,radians:1,yards:ha*1.0936},Ea={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ha,yards:1.0936133},G={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function $(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function re(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ge(i).geometry;case"LineString":return he(i).geometry;case"Polygon":return Ge(i).geometry;case"MultiPoint":return Bt(i).geometry;case"MultiLineString":return vr(i).geometry;case"MultiPolygon":return Ut(i).geometry;default:throw new Error(e+" is invalid")}}function ge(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!$i(e[0])||!$i(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return $(n,i,r)}function Pe(e,i,r){return r===void 0&&(r={}),_t(e.map(function(n){return ge(n,i)}),r)}function Ge(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return $(v,i,r)}function ot(e,i,r){return r===void 0&&(r={}),_t(e.map(function(n){return Ge(n,i)}),r)}function he(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return $(n,i,r)}function De(e,i,r){return r===void 0&&(r={}),_t(e.map(function(n){return he(n,i)}),r)}function _t(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function vr(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return $(n,i,r)}function Bt(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return $(n,i,r)}function Ut(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return $(n,i,r)}function gr(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return $(n,i,r)}function _n(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function ln(e,i){i===void 0&&(i="kilometers");var r=wa[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Lt(e,i){i===void 0&&(i="kilometers");var r=wa[i];if(!r)throw new Error(i+" units is invalid");return e/r}function sn(e,i){return Hr(Lt(e,i))}function Zr(e){var i=e%360;return i<0&&(i+=360),i}function Hr(e){var i=e%(2*Math.PI);return i*180/Math.PI}function oi(e){var i=e%360;return i*Math.PI/180}function tn(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ln(Lt(e,i),r)}function Si(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=G[i];if(!n)throw new Error("invalid original units");var a=G[r];if(!a)throw new Error("invalid final units");return e/n*a}function $i(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function yi(e){return!!e&&e.constructor===Object}function Mi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!$i(i))throw new Error("bbox must only contain numbers")})}function xi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ti(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Vi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ta(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ta(e[0]);throw new Error("coordinates must only contain numbers")}function na(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Pi(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function zi(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Ra(e){return e.type==="Feature"?e.geometry:e}function ou(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Sa(e,i,r){if(e!==null)for(var n,a,s,f,v,m,x,C=0,A=0,O,D=e.type,Z=D==="FeatureCollection",X=D==="Feature",te=Z?e.features.length:1,Ee=0;Ee<te;Ee++){x=Z?e.features[Ee].geometry:X?e.geometry:e,O=x?x.type==="GeometryCollection":!1,v=O?x.geometries.length:1;for(var Ue=0;Ue<v;Ue++){var Qe=0,ct=0;if(f=O?x.geometries[Ue]:x,f!==null){m=f.coordinates;var St=f.type;switch(C=r&&(St==="Polygon"||St==="MultiPolygon")?1:0,St){case null:break;case"Point":if(i(m,A,Ee,Qe,ct)===!1)return!1;A++,Qe++;break;case"LineString":case"MultiPoint":for(n=0;n<m.length;n++){if(i(m[n],A,Ee,Qe,ct)===!1)return!1;A++,St==="MultiPoint"&&Qe++}St==="LineString"&&Qe++;break;case"Polygon":case"MultiLineString":for(n=0;n<m.length;n++){for(a=0;a<m[n].length-C;a++){if(i(m[n][a],A,Ee,Qe,ct)===!1)return!1;A++}St==="MultiLineString"&&Qe++,St==="Polygon"&&ct++}St==="Polygon"&&Qe++;break;case"MultiPolygon":for(n=0;n<m.length;n++){for(ct=0,a=0;a<m[n].length;a++){for(s=0;s<m[n][a].length-C;s++){if(i(m[n][a][s],A,Ee,Qe,ct)===!1)return!1;A++}ct++}Qe++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(Sa(f.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ca(e,i,r,n){var a=r;return Sa(e,function(s,f,v,m,x){f===0&&r===void 0?a=s:a=i(a,s,f,v,m,x)},n),a}function Es(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function fs(e,i,r){var n=r;return Es(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Ji(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Xu(e,i,r){var n=r;return Ji(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function fo(e){var i=[];return Sa(e,function(r){i.push(r)}),i}function La(e,i){var r,n,a,s,f,v,m,x,C,A,O=0,D=e.type==="FeatureCollection",Z=e.type==="Feature",X=D?e.features.length:1;for(r=0;r<X;r++){for(v=D?e.features[r].geometry:Z?e.geometry:e,x=D?e.features[r].properties:Z?e.properties:{},C=D?e.features[r].bbox:Z?e.bbox:void 0,A=D?e.features[r].id:Z?e.id:void 0,m=v?v.type==="GeometryCollection":!1,f=m?v.geometries.length:1,a=0;a<f;a++){if(s=m?v.geometries[a]:v,s===null){if(i(null,O,x,C,A)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,O,x,C,A)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],O,x,C,A)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function $a(e,i,r){var n=r;return La(e,function(a,s,f,v,m){s===0&&r===void 0?n=a:n=i(n,a,s,f,v,m)}),n}function Xi(e,i){La(e,function(r,n,a,s,f){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i($(r,a,{bbox:s,id:f}),n,0)===!1?!1:void 0}var m;switch(v){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],A={type:m,coordinates:C};if(i($(A,a),n,x)===!1)return!1}})}function Ho(e,i,r){var n=r;return Xi(e,function(a,s,f){s===0&&f===0&&r===void 0?n=a:n=i(n,a,s,f)}),n}function Wo(e,i){Xi(e,function(r,n,a){var s=0;if(!!r.geometry){var f=r.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var v,m=0,x=0,C=0;if(Sa(r,function(A,O,D,Z,X){if(v===void 0||n>m||Z>x||X>C){v=A,m=n,x=Z,C=X,s=0;return}var te=lineString([v,A],r.properties);if(i(te,n,a,X,s)===!1)return!1;s++,v=A})===!1)return!1}}})}function Yu(e,i,r){var n=r,a=!1;return Wo(e,function(s,f,v,m,x){a===!1&&r===void 0?n=s:n=i(n,s,f,v,m,x),a=!0}),n}function go(e,i){if(!e)throw new Error("geojson is required");Xi(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,f=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<f.length;v++)if(i(lineString(f[v],r.properties),n,a,v)===!1)return!1;break}}})}function Xo(e,i,r){var n=r;return go(e,function(a,s,f,v){s===0&&r===void 0?n=a:n=i(n,a,s,f,v)}),n}function pa(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var m=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=m.length+s-1),lineString([m[s],m[s+1]],f,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s-1),lineString([m[a][s],m[a][s+1]],f,i);case"MultiLineString":return n<0&&(n=m.length+n),s<0&&(s=m[n].length+s-1),lineString([m[n][s],m[n][s+1]],f,i);case"MultiPolygon":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),s<0&&(s=m[n][a].length-s-1),lineString([m[n][a][s],m[n][a][s+1]],f,i)}throw new Error("geojson is invalid")}function ho(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var m=v.coordinates;switch(v.type){case"Point":return point(m,f,i);case"MultiPoint":return n<0&&(n=m.length+n),point(m[n],f,i);case"LineString":return s<0&&(s=m.length+s),point(m[s],f,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s),point(m[a][s],f,i);case"MultiLineString":return n<0&&(n=m.length+n),s<0&&(s=m[n].length+s),point(m[n][s],f,i);case"MultiPolygon":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),s<0&&(s=m[n][a].length-s),point(m[n][a][s],f,i)}throw new Error("geojson is invalid")}function Yo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qa(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yo(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function su(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var f=s.geometry;return s!=null&&f&&f.type&&f.coordinates&&f.coordinates.length>0}),li()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return Xi(e,function(s,f){var v=Vi(s),m=f,x=Qa(Qa({},s.properties),{},{coordinates:v,_id:m});r.push(x)}),{dataArray:r,featureKeys:n}}function Lc(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function Ds(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var Q=N(28481),be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Je(e){this.message=e}Je.prototype=new Error,Je.prototype.name="InvalidCharacterError";function Ft(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Je("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,f=0;s=i.charAt(f++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=be.indexOf(s);return r}function Lr(e){e=String(e);for(var i,r,n,a,s="",f=0,v=e.length%3;f<e.length;){if((r=e.charCodeAt(f++))>255||(n=e.charCodeAt(f++))>255||(a=e.charCodeAt(f++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=be.charAt(i>>18&63)+be.charAt(i>>12&63)+be.charAt(i>>6&63)+be.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var lt=N(6610),Ct=N(5991),Ja=function(){function e(i,r){(0,lt.Z)(this,e),this.buffers=i,this.type=r}return(0,Ct.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Yi;typeof window=="undefined"?Yi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Yi=window;var Za=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,qo=Za?my.getSystemInfoSync().pixelRatio:Yi.devicePixelRatio,Yr=N(10379),jr=N(46070),It=N(77608),Fo=(0,Ct.Z)(function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"cancelBubble",void 0),(0,I.Z)(this,"cancelable",void 0),(0,I.Z)(this,"target",void 0),(0,I.Z)(this,"currentTarget",void 0),(0,I.Z)(this,"preventDefault",void 0),(0,I.Z)(this,"stopPropagation",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),ae=N(63349);function Xs(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=uu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function uu(e,i){if(!!e){if(typeof e=="string")return hs(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hs(e,i)}}function hs(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ia=new WeakMap,po=function(){function e(){(0,lt.Z)(this,e),ia.set(this,{})}return(0,Ct.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=ia.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),ia.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=ia.get(this);if(s){var f=s[r];if(f&&f.length>0){for(var v=f.length;v--;v>0)if(f[v]===n){f.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=ia.get(this)[r.type];if(n){var a=Xs(n),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function oc(e){var i=kc();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function kc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qu=function(e){(0,Yr.Z)(r,e);var i=oc(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,ae.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Ct.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(f){return f===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(po);function Dc(e){var i=jl();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function jl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ku=function(e){(0,Yr.Z)(r,e);var i=Dc(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,ae.Z)(n),"className",void 0),(0,I.Z)((0,ae.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Ct.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(qu),lu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,$u,_,T,F;if(lu){var R=my.getSystemInfoSync();$u=R.screenWidth,_=R.screenHeight,T=R.windowWidth,F=R.windowHeight}else{var K=Yi.innerWidth,xe=Yi.innerHeight;$u=K,_=xe,T=K,F=xe}var We={width:$u,height:_,availWidth:T,availHeight:F,availLeft:0,availTop:0},dt=We.availWidth,mt=We.availHeight,fr={style:[]};function br(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return fr}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return fr}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Pn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:dt+"px",height:mt+"px",margin:"0px",padding:"0px"})}function ci(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=dt,e.clientHeight=mt),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ei(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=dt,e.offsetHeight=mt)}function Gi(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=dt,e.scrollHeight=mt)}function ua(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Aa(e){var i=Ui();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Ui(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Po(){}var Ss=function(e){(0,Yr.Z)(r,e);var i=Aa(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,ae.Z)(n),"className",void 0),(0,I.Z)((0,ae.Z)(n),"children",void 0),(0,I.Z)((0,ae.Z)(n),"focus",void 0),(0,I.Z)((0,ae.Z)(n),"blur",void 0),(0,I.Z)((0,ae.Z)(n),"insertBefore",void 0),(0,I.Z)((0,ae.Z)(n),"appendChild",void 0),(0,I.Z)((0,ae.Z)(n),"removeChild",void 0),(0,I.Z)((0,ae.Z)(n),"remove",void 0),(0,I.Z)((0,ae.Z)(n),"innerHTML",void 0),(0,I.Z)((0,ae.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=Po,n.blur=Po,n.insertBefore=Po,n.appendChild=Po,n.removeChild=Po,n.remove=Po,n.innerHTML="",n.tagName=a.toUpperCase(),br((0,ae.Z)(n),s),Pn((0,ae.Z)(n)),ua((0,ae.Z)(n)),ci((0,ae.Z)(n)),ei((0,ae.Z)(n)),Gi((0,ae.Z)(n)),n}return(0,Ct.Z)(r)}(Ku);function xl(e){var i=rf();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qu=function(e){(0,Yr.Z)(r,e);var i=xl(r);function r(n){return(0,lt.Z)(this,r),i.call(this,n)}return(0,Ct.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Ss);function Fc(e){var i=Iu();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Iu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _u=function(e){(0,Yr.Z)(r,e);var i=Fc(r);function r(){return(0,lt.Z)(this,r),i.call(this,"video")}return(0,Ct.Z)(r)}(Qu),yo={},la={};function bh(e,i){yo=e,yo.id=i,"tagName"in yo||(yo.tagName="CANVAS"),yo.type="canvas",Mixin.parentNode(yo),Mixin.style(yo),Mixin.classList(yo),Mixin.clientRegion(yo),Mixin.offsetRegion(yo),yo.focus=function(){},yo.blur=function(){}}function Eh(e,i){var r=1024,n=1024;la={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in la||(la.tagName="CANVAS"),Mixin.parentNode(la),Mixin.style(la),Mixin.classList(la),Mixin.clientRegion(la),Mixin.offsetRegion(la),la.getContext=function(a){if(a==="2d")return e},la.focus=function(){},la.blur=function(){}}function ao(){return yo}function Vf(){return la}var xu=(0,Ct.Z)(function e(){(0,lt.Z)(this,e);var i=ao(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),br(r),ua(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Fs={href:"",protocol:"",host:""};function Bc(e){var i=bl();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function bl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xa=function(e){(0,Yr.Z)(r,e);var i=Bc(r);function r(){return(0,lt.Z)(this,r),i.call(this,"body",0)}return(0,Ct.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,f){}},{key:"dispatchEvent",value:function(a){}}]),r}(Ss),Vl=function(e){(0,Yr.Z)(r,e);var i=Bc(r);function r(){return(0,lt.Z)(this,r),i.call(this,"html",0)}return(0,Ct.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(Ss),sc={},rs={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Fs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new xu:i==="video"?new _u:new Ss(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){sc[i]||(sc[i]=[]),sc[i].push(r)},removeEventListener:function(i,r){var n=sc[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=sc[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Fo(i)}};rs.documentElement=new Vl,rs.head=new Ss("head"),rs.body=new xa;var Gf=Object,Sh=N(90484),Ch=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"_w",void 0),(0,I.Z)(this,"_h",void 0),(0,I.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,Sh.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Ct.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),nf=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,El,Bo,Ou;if(nf){var Ju=my.getSystemInfoSync();El=Ju.system,Bo=Ju.platform,Ou=Ju.language}else{var No={versions:function(){var e=Yi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Yi.navigator.browserLanguage||Yi.navigator.language).toLowerCase()};No.versions.android?Bo="android":No.versions.trident?Bo="IE":No.versions.presto?Bo="Opera":No.versions.webKit?Bo="webKit":No.versions.gecko?Bo="Firefox":No.versions.mobile?Bo="mobile":No.versions.ios?Bo="ios":No.versions.iPhone?Bo="iPhone":No.versions.iPad?Bo="ipad":No.versions.webApp?Bo="webApp":No.versions.weixin?Bo="weixin":No.versions.qq&&(Bo="qq"),El=Yi.navigator.userAgent,Ou=No.language}var Gl=El.toLowerCase().indexOf("android")!==-1,el=Gl?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ys="Mozilla/5.0 (".concat(el,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Ou),af={platform:Bo,language:Ou,appVersion:"5.0 (".concat(el,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ys},of={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},sf=0,tl=0;function uc(e){var i=Date.now(),r=Math.max(sf+23,i);return tl=setTimeout(function(){e(sf=r)},r-i),tl}function Nc(e){var i=ao();return i.requestAnimationFrame?i.requestAnimationFrame(e):uc(e)}function uf(e){var i=ao();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var zc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,lt.Z)(this,e),(0,I.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Ct.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=Ah(n),f="data:".concat(a,";base64, ");return f+s}}]),e}();function Ah(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return Lr(i)}var Uc={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Sl={};function lf(e){var i=cf();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function cf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ru=new Map,ff=new Map,Hf=new Map,wh={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Hl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function np(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Hl.call(this,"readystatechange",i)}var ns=function(e){(0,Yr.Z)(r,e);var i=lf(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,ae.Z)(n),"onabort",void 0),(0,I.Z)((0,ae.Z)(n),"onerror",void 0),(0,I.Z)((0,ae.Z)(n),"onload",void 0),(0,I.Z)((0,ae.Z)(n),"onloadstart",void 0),(0,I.Z)((0,ae.Z)(n),"onprogress",void 0),(0,I.Z)((0,ae.Z)(n),"ontimeout",void 0),(0,I.Z)((0,ae.Z)(n),"onloadend",void 0),(0,I.Z)((0,ae.Z)(n),"onreadystatechange",void 0),(0,I.Z)((0,ae.Z)(n),"readyState",void 0),(0,I.Z)((0,ae.Z)(n),"response",void 0),(0,I.Z)((0,ae.Z)(n),"responseText",void 0),(0,I.Z)((0,ae.Z)(n),"_responseType",void 0),(0,I.Z)((0,ae.Z)(n),"responseXML",void 0),(0,I.Z)((0,ae.Z)(n),"status",void 0),(0,I.Z)((0,ae.Z)(n),"statusText",void 0),(0,I.Z)((0,ae.Z)(n),"upload",void 0),(0,I.Z)((0,ae.Z)(n),"withCredentials",void 0),(0,I.Z)((0,ae.Z)(n),"timeout",void 0),(0,I.Z)((0,ae.Z)(n),"_url",void 0),(0,I.Z)((0,ae.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Ru.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Ct.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Hf.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=ff.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return ff.get("responseHeader")[a]}},{key:"open",value:function(a,s,f){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var f=Ru.get("requestHeader");f[a]=s,Ru.set("requestHeader",f)}},{key:"addEventListener",value:function(a,s){var f=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||f,s.call(f,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(po);(0,I.Z)(ns,"UNSEND",void 0),(0,I.Z)(ns,"OPENED",void 0),(0,I.Z)(ns,"HEADERS_RECEIVED",void 0),(0,I.Z)(ns,"LOADING",void 0),(0,I.Z)(ns,"DONE",void 0),ns.UNSEND=0,ns.OPENED=1,ns.HEADERS_RECEIVED=2,ns.LOADING=3,ns.DONE=4;function ja(e){var i=lc();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function lc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wl=function(e){(0,Yr.Z)(r,e);var i=ja(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,ae.Z)(a),"touches",void 0),(0,I.Z)((0,ae.Z)(a),"targetTouches",void 0),(0,I.Z)((0,ae.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=ao(),a.currentTarget=ao(),a}return(0,Ct.Z)(r)}(Fo);function cu(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,f=i.clientX,v=f===void 0?0:f,m=i.clientY,x=m===void 0?0:m;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function ki(e){return function(i){var r=new Wl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return cu(n)}),r.touches.forEach(function(n){return cu(n)}),r.targetTouches.forEach(function(n){return cu(n)}),rs.dispatchEvent(r)}}function Ma(e){return function(i){i.type=e,rs.dispatchEvent(i)}}var Bs=ki("touchstart"),hf=ki("touchmove"),Cl=ki("touchend"),pf=Ma("mapCameaParams");function ip(e){var i=ap();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function ap(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zc=function(e){(0,Yr.Z)(r,e);var i=ip(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,ae.Z)(a),"buttons",void 0),(0,I.Z)((0,ae.Z)(a),"which",void 0),(0,I.Z)((0,ae.Z)(a),"pointerId",void 0),(0,I.Z)((0,ae.Z)(a),"bubbles",void 0),(0,I.Z)((0,ae.Z)(a),"button",void 0),(0,I.Z)((0,ae.Z)(a),"width",void 0),(0,I.Z)((0,ae.Z)(a),"height",void 0),(0,I.Z)((0,ae.Z)(a),"pressure",void 0),(0,I.Z)((0,ae.Z)(a),"isPrimary",void 0),(0,I.Z)((0,ae.Z)(a),"pointerType",void 0),(0,I.Z)((0,ae.Z)(a),"altKey",void 0),(0,I.Z)((0,ae.Z)(a),"ctrlKey",void 0),(0,I.Z)((0,ae.Z)(a),"metaKey",void 0),(0,I.Z)((0,ae.Z)(a),"shiftKey",void 0),a.target=ao(),a.currentTarget=ao(),a}return(0,Ct.Z)(r)}(Fo),cc=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],rl=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Io="touch";function fc(e,i,r){for(var n=new Zc(e),a=0;a<cc.length;a++){var s=cc[a];n[s]=i[s]||rl[a]}return n.type=e,n.target=ao(),n.currentTarget=ao(),n.buttons=hc(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=vn(i),n.pointerType=Io,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function hc(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Xa=null;function vn(e){return Xa===e.identifier}function eo(e){Xa===null&&(Xa=e.identifier)}function nl(e){Xa===e.identifier&&(Xa=null)}function il(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?eo(a):(e==="pointerup"||e==="pointercancel")&&nl(a);var s=fc(e,a,i);rs.dispatchEvent(s)}}}var bu=il("pointerdown"),Ns=il("pointermove"),Wf=il("pointerup");function qr(e){var i=df();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function df(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xf=function(e){(0,Yr.Z)(r,e);var i=qr(r);function r(n){return(0,lt.Z)(this,r),i.call(this,n)}return(0,Ct.Z)(r)}(Fo);function Lu(e){return function(i){i.type=e,rs.dispatchEvent(i)}}var Ba=Lu("mousedown"),zs=Lu("mousemove"),vf=Lu("mouseup"),ku=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Is=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),_o=ku||Is,Th={atob:Ft,btoa:Lr,devicePixelRatio:qo,Blob:Ja,document:rs,Element:Ku,Event:Fo,EventTarget:po,HTMLCanvasElement:Gf,HTMLElement:Ss,HTMLMediaElement:Qu,HTMLVideoElement:_u,Image:xu,ImageData:Ch,navigator:af,Node:qu,requestAnimationFrame:Nc,cancelAnimationFrame:uf,screen:We,XMLHttpRequest:ns,performance:of,URL:zc,WebGLRenderingContext:Uc,WebGL2RenderingContext:Sl,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};rs.addEventListener(i,r,n)},removeEventListener:function(i,r,n){rs.removeEventListener(i,r)},dispatchEvent:function(i){rs.dispatchEvent(i)},innerWidth:We.availWidth,innerHeight:We.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},da=_o?Th:Yi,Yf=_o?ns:Yi.XMLHttpRequest,Mh=_o?Fs:Yi.location;function qs(e){var i=e;return typeof e=="string"&&(i=da.document.getElementById(e)),i}function Os(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ii(e){return Os(e).split(/\s+/)}function Eu(e){var i,r,n=da==null||(i=da.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function ca(e,i,r){var n=da.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function oo(e){var i=e.parentNode;i&&i.removeChild(e)}function Us(e,i){if(e.classList!==void 0)for(var r=Ii(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Zs(e,i)){var s=js(e);ps(e,(s?s+" ":"")+i)}}function fu(e,i){e.classList!==void 0?e.classList.remove(i):ps(e,Os((" "+js(e)+" ").replace(" "+i+" "," ")))}function Zs(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=js(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function ps(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function js(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function On(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Cn=Eu(["transform","WebkitTransform"]);function pc(e,i){e.style[Cn]=i}function ds(){if(typeof Event=="function")da.dispatchEvent(new Event("resize"));else{var e=da.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,da,0),da.dispatchEvent(e)}}function Su(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Ko(){var e,i=da.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),f=(0,Q.Z)(s,2),v=f[0],m=f[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var ba=Ko()<1?1:da.devicePixelRatio;function mf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function jc(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function oa(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function ka(e){if(e.length===0)throw new Error("mean requires at least one data point");return oa(e)/e.length}function qf(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var al={min:jc,max:mf,mean:ka,sum:oa,mode:qf};function Ks(e,i){return e.map(function(r){return r[i]})}function Cu(e,i){return al[e](i)}var Oo=N(14665);function ol(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Au=N(51814);function Al(e,i,r){return(0,Au.Z)()?Al=Reflect.construct.bind():Al=function(a,s,f){var v=[null];v.push.apply(v,s);var m=Function.bind.apply(a,v),x=new m;return f&&(0,Oo.Z)(x,f.prototype),x},Al.apply(null,arguments)}function sl(e){var i=typeof Map=="function"?new Map:void 0;return sl=function(n){if(n===null||!ol(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Al(n,arguments,(0,It.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Oo.Z)(a,n)},sl(e)}function dc(e){var i=gf();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function gf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wl=function(e){(0,Yr.Z)(r,e);var i=dc(r);function r(n,a,s){var f;return(0,lt.Z)(this,r),f=i.call(this,n),(0,I.Z)((0,ae.Z)(f),"status",void 0),(0,I.Z)((0,ae.Z)(f),"url",void 0),f.status=a,f.url=s,f.name=f.constructor.name,f.message=n,f}return(0,Ct.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(sl(Error));function Tl(e){var i=new Yf;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var Ph=function(i,r){var n=Tl(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new wl("".concat(n.statusText),n.status,i.url)):r(new wl(n.statusText,n.status,i.url))},n.send(),n},Ml=function(i,r){var n=Tl(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new wl(n.statusText,n.status,i.url))},n.send(),n};function Xl(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var yf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Du=function(i,r){return Ml(i,function(n,a){if(n)r(n);else if(a){var s=new da.Image;s.crossOrigin="anonymous";var f=da.URL||da.webkitURL;s.onload=function(){r(null,s),f.revokeObjectURL(s.src),s.onload=null},s.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var v=new da.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?f.createObjectURL(v):yf}})},Cs=2*Math.PI*6378137/2;function _f(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;vc(i,n)}),i}function vc(e,i){return Array.isArray(i[0])?i.forEach(function(r){vc(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Ih(e,i){return Yl(e,i)}function Yl(e,i){return Array.isArray(e[0])?e.map(function(r){return Yl(r,i)}):i(e)}function l(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=E(e,i);var n=e[0],a=e[1],s=n*Cs/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return f=f*Cs/180,r.enable&&(s=Number(s.toFixed(r.decimal)),f=Number(f.toFixed(r.decimal))),e.length===3?[s,f,e[2]]:[s,f]}function h(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/Cs*180,s=n/Cs*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function c(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function d(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function E(e,i){if(i===!1)return e;var r=c(e[0]),n=d(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function w(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,f=r*a;f=Math.log(Math.tan(Math.PI/4+f/2));var v=.5/Math.PI,m=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+m),f=n*(x*f+a),[Math.floor(s),Math.floor(f)]}function M(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,f=_slicedToArray(e,2),v=f[0],m=f[1];v=(v/s-r)/i,m=(m/s-a)/n,m=(Math.atan(Math.pow(Math.E,m))-Math.PI/4)*2,a=Math.PI/180;var x=m/a,C=v/a;return[C,x]}function L(e,i){var r=85.0511287798,n=Math.PI/180,a=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*a,i*a]}function U(e,i,r){var n=oi(i[1]-e[1]),a=oi(i[0]-e[0]),s=oi(e[1]),f=oi(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return ln(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function Y(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),f=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[f,v]}function oe(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function fe(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function pe(e){return[[e[0],e[1]],[e[2],e[3]]]}function Re(e){var i=Ie(e,[0,0]);return[e[0]/i,e[1]/i]}function Ie(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Xe(e,i){return e[0]*i[0]+e[1]*i[1]}function Ae(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ye(e,i){return Math.acos(Xe(e,i)/(Ae(e)*Ae(i)))*180/Math.PI}function it(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function Et(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var f=e[s],v=e[s+1],m=Ie(f,v);n+=m;var x=[f[0]-v[0],f[1]-v[1]],C=it(r,x);if(s>0){var A=a[s-1].rotation;A-C>360-A+C&&(C=C+360)}a.push({start:f,end:v,dis:m,rotation:C,duration:0})}return a.map(function(O){O.duration=i*(O.dis/n)}),a}}var Xt=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,lt.Z)(this,e),(0,I.Z)(this,"limit",void 0),(0,I.Z)(this,"cache",void 0),(0,I.Z)(this,"destroy",void 0),(0,I.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Ct.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function Nt(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var tr=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,lt.Z)(this,e),(0,I.Z)(this,"duration",16),(0,I.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Ct.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),mr=N(2650);function Dr(e){return typeof e=="string"?!!mr.ZP(e):!1}function sr(e){var i=mr.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Qr(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function Rn(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function kn(e){var i=da.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],f=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var m=(e.positions[v]-s)/(f-s);n.addColorStop(m,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),_o)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var Fn;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Fn||(Fn={}));var Ai={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function un(e,i,r){var n=e.classList;for(var a in Ai)Ai.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Sn(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var Qn={BACK:1029,FRONT:1028};function Xn(e){switch(e){case"GAODE1.x":return Qn.BACK;case"GAODE2.x":return Qn.BACK;case"MAPBOX":return Qn.FRONT;case"SIMPLE":return Qn.FRONT;case"GLOBEL":return Qn.BACK;case"L7MAP":return Qn.FRONT;default:return Qn.FRONT}}function Yn(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function di(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,a=i.z;if(Array.isArray(e)){var s=Math.abs(r+n)%e.length;e=e[s]}return e.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,a.toString()).replace(/\{-y\}/g,(Math.pow(2,a)-n-1).toString())}var jn;(function(e){e.Overlap="overlap",e.Replace="replace"})(jn||(jn={}));var Tn;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Tn||(Tn={}));var qi=N(92137),Ya=N(87757),ni=N.n(Ya);function zo(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),a=Number(e[2]),s=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[r,n],v=[r,s],m=[a,s],x=[a,n];return Ge([[f,x,m,v,f]],i.properties,{bbox:e,id:i.id})}var Va=0,to=1,is=2;function vs(e){e.forEach(function(i){i.properties.state=Va}),e.forEach(function(i){i.isCurrent&&!as(i)&&Vs(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&is)})}function Fu(e){e.forEach(function(r){r.properties.state=Va}),e.forEach(function(r){r.isCurrent&&as(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&is),r.children.length&&(r.isVisible||r.properties.state&to)?r.children.forEach(function(n){n.properties.state=to}):r.isCurrent&&Vs(r)})}function as(e){for(;e;){if(e.isLoaded)return e.properties.state|=is,!0;e=e.parent}return!1}function Vs(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=is:Vs(i)})}var As,Vc=256,Pl=[-Infinity,-Infinity,Infinity,Infinity],Bu=5,ql=(As={},(0,I.Z)(As,jn.Overlap,vs),(0,I.Z)(As,jn.Replace,Fu),As),mc=function(){};function $s(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),a=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,a]}function Il(e,i,r){var n=e/Math.pow(2,r)*360-180,a=Math.PI-2*Math.PI*i/Math.pow(2,r),s=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[n,s]}var wu=function(i,r,n){var a=Il(i,r,n),s=(0,Q.Z)(a,2),f=s[0],v=s[1],m=Il(i+1,r+1,n),x=(0,Q.Z)(m,2),C=x[0],A=x[1];return[f,A,C,v]};function xo(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,a=n===void 0?Infinity:n,s=e.minZoom,f=s===void 0?0:s,v=e.zoomOffset,m=v===void 0?0:v,x=e.extent,C=x===void 0?Pl:x,A=Math.ceil(i)+m;A<f?A=f:A>a&&(A=a);for(var O=(0,Q.Z)(r,4),D=O[0],Z=O[1],X=O[2],te=O[3],Ee=[Math.max(D,C[0]),Math.max(Z,C[1]),Math.min(X,C[2]),Math.min(te,C[3])],Ue=[],Qe=$s(Ee[0],Ee[1],A),ct=(0,Q.Z)(Qe,2),St=ct[0],bt=ct[1],Kt=$s(Ee[2],Ee[3],A),lr=(0,Q.Z)(Kt,2),Mr=lr[0],Xr=lr[1],_r=St;_r<=Mr;_r++)for(var on=Xr;on<=bt;on++)Ue.push({x:_r,y:on,z:A});return Ue}var Nu=function(i,r,n){var a=Math.pow(2,n),s=a-1,f=a,v=i,m=r;return v<0?v=v+f:v>s&&(v=v%f),{warpX:v,warpY:m}},ul=function(){function e(i){(0,lt.Z)(this,e),(0,I.Z)(this,"x",void 0),(0,I.Z)(this,"y",void 0),(0,I.Z)(this,"z",void 0),(0,I.Z)(this,"tileSize",256),(0,I.Z)(this,"isVisible",!1),(0,I.Z)(this,"isCurrent",!1),(0,I.Z)(this,"layer",null),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"parent",null),(0,I.Z)(this,"children",[]),(0,I.Z)(this,"data",null),(0,I.Z)(this,"properties",{}),(0,I.Z)(this,"loadStatus",void 0),(0,I.Z)(this,"abortController",void 0),(0,I.Z)(this,"loadDataId",0);var r=i.x,n=i.y,a=i.z,s=i.tileSize;this.x=r,this.y=n,this.z=a,this.tileSize=s}return(0,Ct.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===Tn.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Tn.Loaded}},{key:"isCancelled",get:function(){return this.loadStatus===Tn.Cancelled}},{key:"isDone",get:function(){return[Tn.Loaded,Tn.Cancelled,Tn.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return wu(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var r=(0,Q.Z)(this.bounds,4),n=r[0],a=r[1],s=r[2],f=r[3],v=[(s-n)/2,(f-a)/2],m=zo(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return m}},{key:"key",get:function(){var r="".concat(this.x,",").concat(this.y,",").concat(this.z);return r}},{key:"loadData",value:function(){var i=(0,qi.Z)(ni().mark(function n(a){var s,f,v,m,x,C,A,O,D,Z,X,te,Ee,Ue,Qe,ct;return ni().wrap(function(bt){for(;;)switch(bt.prev=bt.next){case 0:return s=a.getData,f=a.onLoad,v=a.onError,this.loadDataId++,m=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Tn.Loading,x=null,bt.prev=7,A=this.x,O=this.y,D=this.z,Z=this.bounds,X=this.tileSize,te=Nu(A,O,D),Ee=te.warpX,Ue=te.warpY,Qe=this.abortController.signal,ct={x:Ee,y:Ue,z:D,bounds:Z,tileSize:X,signal:Qe},bt.next=14,s(ct);case 14:x=bt.sent,bt.next=20;break;case 17:bt.prev=17,bt.t0=bt.catch(7),C=bt.t0;case 20:if(m===this.loadDataId){bt.next=22;break}return bt.abrupt("return");case 22:if(!(this.isCancelled&&!x)){bt.next=24;break}return bt.abrupt("return");case 24:if(!(C||!x)){bt.next=28;break}return this.loadStatus=Tn.Failure,v(C,this),bt.abrupt("return");case 28:this.loadStatus=Tn.Loaded,this.data=x,f(this);case 31:case"end":return bt.stop()}},n,this,[[7,17]])}));function r(n){return i.apply(this,arguments)}return r}()},{key:"reloadData",value:function(r){this.isLoading&&this.abortLoad(),this.loadData(r)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Tn.Cancelled,this.abortController.abort())}}]),e}(),$o=N(26729),ea=N.n($o);function Uo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ms(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ms(e,i){if(!!e){if(typeof e=="string")return zu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zu(e,i)}}function zu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function gc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gc(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xf(e){var i=Qs();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yc=function(e){(0,Yr.Z)(r,e);var i=xf(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this),(0,I.Z)((0,ae.Z)(a),"currentTiles",[]),(0,I.Z)((0,ae.Z)(a),"options",void 0),(0,I.Z)((0,ae.Z)(a),"cacheTiles",new Map),(0,I.Z)((0,ae.Z)(a),"lastViewStates",void 0),(0,I.Z)((0,ae.Z)(a),"onTileLoad",function(s){a.emit("tile-loaded",s),a.updateTileVisible()}),(0,I.Z)((0,ae.Z)(a),"onTileError",function(s,f){a.emit("tile-error",{error:s,tile:f}),a.updateTileVisible()}),(0,I.Z)((0,ae.Z)(a),"onTileUnload",function(s){a.emit("tile-unload",s)}),a.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Pl,getTileData:mc,updateStrategy:jn.Overlap},a.updateOptions(n),a}return(0,Ct.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(a){return a.isDone})}},{key:"tiles",get:function(){var a=Array.from(this.cacheTiles.values()).sort(function(s,f){return s.z-f.z});return a}},{key:"updateOptions",value:function(a){var s=a.minZoom===void 0?this.options.minZoom:Math.ceil(a.minZoom),f=a.maxZoom===void 0?this.options.maxZoom:Math.floor(a.maxZoom);this.options=Kl(Kl(Kl({},this.options),a),{},{minZoom:s,maxZoom:f})}},{key:"update",value:function(a,s){var f=this;if(!(this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===s.toString())){this.lastViewStates={zoom:a,latLonBounds:s};var v=!1,m=this.getTileIndices(a,s);this.currentTiles=m.map(function(x){var C=x.x,A=x.y,O=x.z,D=f.getTile(C,A,O);return D||(D=f.createTile(C,A,O),v=!0,D)}),v&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible()}}},{key:"reloadAll",value:function(){var a=Uo(this.cacheTiles),s;try{for(a.s();!(s=a.n()).done;){var f=(0,Q.Z)(s.value,2),v=f[0],m=f[1];this.currentTiles.includes(m)||(this.cacheTiles.delete(v),this.onTileUnload(m)),this.onTileUnload(m),m.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(x){a.e(x)}finally{a.f()}}},{key:"destroy",value:function(){var a=Uo(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.isLoading&&f.abortLoad()}}catch(v){a.e(v)}finally{a.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var a=this.options.updateStrategy,s=new Map,f=Uo(this.cacheTiles.values()),v;try{for(f.s();!(v=f.n()).done;){var m=v.value;s.set(m.key,m.isVisible),m.isCurrent=!1,m.isVisible=!1}}catch(Z){f.e(Z)}finally{f.f()}var x=Uo(this.currentTiles),C;try{for(x.s();!(C=x.n()).done;){var A=C.value;A.isCurrent=!0,A.isVisible=!0}}catch(Z){x.e(Z)}finally{x.f()}var O=Array.from(this.cacheTiles.values());typeof a=="function"?a(O):ql[a](O);var D=Array.from(this.cacheTiles.values()).some(function(Z){return Z.isVisible!==s.get(Z.key)});D&&this.emit("tile-update")}},{key:"getTileIndices",value:function(a,s){var f=this.options,v=f.tileSize,m=f.extent,x=f.zoomOffset,C=Math.floor(this.options.maxZoom),A=Math.ceil(this.options.minZoom),O=xo({maxZoom:C,minZoom:A,zoomOffset:x,tileSize:v,zoom:a,latLonBounds:s,extent:m});return O}},{key:"getTileId",value:function(a,s,f){var v="".concat(a,",").concat(s,",").concat(f);return v}},{key:"getTile",value:function(a,s,f){var v=this.getTileId(a,s,f),m=this.cacheTiles.get(v);return m}},{key:"createTile",value:function(a,s,f){var v=this.getTileId(a,s,f),m=new ul({x:a,y:s,z:f,tileSize:this.options.tileSize});return this.cacheTiles.set(v,m),m.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),m}},{key:"resizeCacheTiles",value:function(){var a=Bu*this.currentTiles.length,s=this.cacheTiles.size>a;if(s){var f=Uo(this.cacheTiles),v;try{for(f.s();!(v=f.n()).done;){var m=(0,Q.Z)(v.value,2),x=m[0],C=m[1];if(!C.isVisible&&!this.currentTiles.includes(C)&&(this.cacheTiles.delete(x),this.onTileUnload(C)),this.cacheTiles.size<=a)break}}catch(A){f.e(A)}finally{f.f()}}}},{key:"rebuildTileTree",value:function(){var a=Uo(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.parent=null,f.children.length=0}}catch(A){a.e(A)}finally{a.f()}var v=Uo(this.cacheTiles.values()),m;try{for(v.s();!(m=v.n()).done;){var x=m.value,C=this.getNearestAncestor(x.x,x.y,x.z);x.parent=C,C!=null&&C.children&&C.children.push(x)}}catch(A){v.e(A)}finally{v.f()}}},{key:"getNearestAncestor",value:function(a,s,f){for(;f>this.options.minZoom;){a=Math.floor(a/2),s=Math.floor(s/2),f=f-1;var v=this.getTile(a,s,f);if(v)return v}return null}}]),r}(ea());function Js(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(f){e instanceof HTMLImageElement?f([e]):Ol(e,function(v){f(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Ol(e,i){var r=e,n=[];if(typeof r=="string")Du({url:r},function(f,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(f){Du({url:f},function(v,m){s++,n.push(m),s===a&&i(n)})})}return Js}function Gc(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,f=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:f,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}function hu(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hu(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hu(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Hc={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Kf=function(){var e=(0,qi.Z)(ni().mark(function i(r,n){var a;return ni().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=di(r,n),f.abrupt("return",new Promise(function(v,m){Du({url:a},function(x,C){x?m(x):v(C)})}));case 2:case"end":return f.stop()}},i)}));return function(r,n){return e.apply(this,arguments)}}();function Oh(e,i){var r=function(s){return Kf(e,s)},n=bo(bo(bo({},Hc),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n}}var $f=N(30236),op=N.n($f),sp=N(47037),ws=N.n(sp),bf=N(23560),Rl=N.n(bf),qp=N(50361),pu=N.n(qp),_c=N(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Kp(e,i,r,n){function a(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function v(C){try{x(n.next(C))}catch(A){f(A)}}function m(C){try{x(n.throw(C))}catch(A){f(A)}}function x(C){C.done?s(C.value):a(C.value).then(v,m)}x((n=n.apply(e,i||[])).next())})}function kd(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(x){return function(C){return m([x,C])}}function m(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Ef(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){f={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function up(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Ef(arguments[i]));return e}function os(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ss(e,i){return i={exports:{}},e(i,i.exports),i.exports}var Qf=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});os(Qf);var Rh=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});os(Rh);var Sf=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof _c=="object"&&typeof _c.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(m){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return m.apply(void 0,x)})}}var f;r?f=setImmediate:n?f=_c.nextTick:f=a,i.default=s(f)});os(Sf);var Jf=Sf.fallback,Iv=Sf.wrap,Zo=Sf.hasSetImmediate,lp=Sf.hasNextTick,cp=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Rh),n=a(Sf);function a(m){return m&&m.__esModule?m:{default:m}}function s(m){return(0,du.isAsync)(m)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var A=x.pop(),O=m.apply(this,x);return f(O,A)}:(0,r.default)(function(x,C){var A;try{A=m.apply(this,x)}catch(O){return C(O)}if(A&&typeof A.then=="function")return f(A,C);C(null,A)})}function f(m,x){return m.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(m,x,C){try{m(x,C)}catch(A){(0,n.default)(function(O){throw O},A)}}e.exports=i.default});os(cp);var du=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(cp);function n(m){return m&&m.__esModule?m:{default:m}}function a(m){return m[Symbol.toStringTag]==="AsyncFunction"}function s(m){return m[Symbol.toStringTag]==="AsyncGenerator"}function f(m){return typeof m[Symbol.asyncIterator]=="function"}function v(m){if(typeof m!="function")throw new Error("expected a function");return a(m)?(0,r.default)(m):m}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=f});os(du);var fp=du.isAsyncIterable,Lh=du.isAsyncGenerator,hp=du.isAsync,Ll=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var f=this,v=[],m=arguments.length;m--;)v[m]=arguments[m];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(A){for(var O=[],D=arguments.length-1;D-- >0;)O[D]=arguments[D+1];if(A)return C(A);x(O.length>1?O:O[0])},n.apply(f,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});os(Ll);var kl=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Qf),n=s(du),a=s(Ll);function s(f){return f&&f.__esModule?f:{default:f}}i.default=(0,a.default)(function(f,v,m){var x=(0,r.default)(v)?[]:{};f(v,function(C,A,O){(0,n.default)(C)(function(D){for(var Z,X=[],te=arguments.length-1;te-- >0;)X[te]=arguments[te+1];X.length<2&&(Z=X,X=Z[0]),x[A]=X,O(D)})},function(C){return m(C,x)})},3),e.exports=i.default});os(kl);var $l=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});os($l);var Cf=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});os(Cf);var eh=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=m;var r=a(Qf),n=a(Cf);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,A=x.length;return function(){return++C<A?{value:x[C],key:C}:null}}function f(x){var C=-1;return function(){var O=x.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(x){var C=x?Object.keys(x):[],A=-1,O=C.length;return function(){var Z=C[++A];return A<O?{value:x[Z],key:Z}:null}}function m(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?f(C):v(x)}e.exports=i.default});os(eh);var ll=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var f=n;n=null,f.apply(this,a)}}e.exports=i.default});os(ll);var Wc=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});os(Wc);var Af=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Wc);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,f,v,m){var x=!1,C=!1,A=!1,O=0,D=0;function Z(){O>=f||A||x||(A=!0,s.next().then(function(Ee){var Ue=Ee.value,Qe=Ee.done;if(!(C||x)){if(A=!1,Qe){x=!0,O<=0&&m(null);return}O++,v(Ue,D,X),D++,Z()}}).catch(te))}function X(Ee,Ue){if(O-=1,!C){if(Ee)return te(Ee);if(Ee===!1){x=!0,C=!0;return}if(Ue===r.default||x&&O<=0)return x=!0,m(null);Z()}}function te(Ee){C||(A=!1,x=!0,m(Ee))}Z()}e.exports=i.default});os(Af);var th=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v($l),n=v(eh),a=v(ll),s=v(Af),f=v(Wc);function v(m){return m&&m.__esModule?m:{default:m}}i.default=function(m){return function(x,C,A){if(A=(0,r.default)(A),m<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return A(null);if((0,du.isAsyncGenerator)(x))return(0,s.default)(x,m,C,A);if((0,du.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),m,C,A);var O=(0,n.default)(x),D=!1,Z=!1,X=0,te=!1;function Ee(Qe,ct){if(!Z)if(X-=1,Qe)D=!0,A(Qe);else if(Qe===!1)D=!0,Z=!0;else{if(ct===f.default||D&&X<=0)return D=!0,A(null);te||Ue()}}function Ue(){for(te=!0;X<m&&!D;){var Qe=O();if(Qe===null){D=!0,X<=0&&A(null);return}X+=1,C(Qe.value,Qe.key,(0,a.default)(Ee))}te=!1}Ue()}},e.exports=i.default});os(th);var xc=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(th),n=s(du),a=s(Ll);function s(v){return v&&v.__esModule?v:{default:v}}function f(v,m,x,C){return(0,r.default)(m)(v,(0,n.default)(x),C)}i.default=(0,a.default)(f,4),e.exports=i.default});os(xc);var Xc=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(xc),n=a(Ll);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v,m){return(0,r.default)(f,1,v,m)}i.default=(0,n.default)(s,3),e.exports=i.default});os(Xc);var eu=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(kl),n=a(Xc);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,r.default)(n.default,f,v)}e.exports=i.default}),wf=os(eu),vu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,wf(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,up(n.args)),a(null,i)})},e}(),Tf=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(Qf),n=x(Wc),a=x(xc),s=x($l),f=x(ll),v=x(du),m=x(Ll);function x(D){return D&&D.__esModule?D:{default:D}}function C(D,Z,X){X=(0,s.default)(X);var te=0,Ee=0,Ue=D.length,Qe=!1;Ue===0&&X(null);function ct(St,bt){St===!1&&(Qe=!0),Qe!==!0&&(St?X(St):(++Ee===Ue||bt===n.default)&&X(null))}for(;te<Ue;te++)Z(D[te],te,(0,f.default)(ct))}function A(D,Z,X){return(0,a.default)(D,Infinity,Z,X)}function O(D,Z,X){var te=(0,r.default)(D)?C:A;return te(D,(0,v.default)(Z),X)}i.default=(0,m.default)(O,3),e.exports=i.default});os(Tf);var rh=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Tf),n=a(kl);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,n.default)(r.default,f,v)}e.exports=i.default}),kh=os(rh),Dl=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return kh(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return Kp(n,void 0,void 0,function(){return kd(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Yc=ss(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=f($l),n=f(ll),a=f(du),s=f(Ll);function f(m){return m&&m.__esModule?m:{default:m}}function v(m,x){if(x=(0,r.default)(x),!Array.isArray(m))return x(new Error("First argument to waterfall must be an array of functions"));if(!m.length)return x();var C=0;function A(D){var Z=(0,a.default)(m[C++]);Z.apply(void 0,D.concat([(0,n.default)(O)]))}function O(D){for(var Z=[],X=arguments.length-1;X-- >0;)Z[X]=arguments[X+1];if(D!==!1){if(D||C===m.length)return x.apply(void 0,[D].concat(Z));A(Z)}}A([])}i.default=(0,s.default)(v),e.exports=i.default}),$p=os(Yc),Dh=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return $p(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),Fh=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return wf(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),Dd=N(69848),Qp=N.n(Dd);function mu(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function pp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mu(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mu(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nh(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,f=i.minZoom,v=f===void 0?0:f,m=i.zoom,x=m===void 0?2:m;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=Mf(C),e}var A=new(Qp())({radius:n,minZoom:v,maxZoom:s}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(D){return{type:"Feature",geometry:{type:"Point",coordinates:D.coordinates},properties:pp({},D)}}),A.load(O.features),A}function Mf(e){return e.map(function(i,r){return pp({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function cl(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Jp(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function ed(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Fl(e){if(e.length===0)throw new Error("mean requires at least one data point");return ed(e)/e.length}var Pf={min:Jp,max:cl,mean:Fl,sum:ed};function qc(e,i){return e.map(function(r){return r[i]*1})}function Ql(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function If(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ql(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ql(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dp(e){var i=Bh();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Bh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function vp(e,i){if(Array.isArray(i))return i}var va=function(e){(0,Yr.Z)(r,e);var i=dp(r);function r(n,a){var s;return(0,lt.Z)(this,r),s=i.call(this),(0,I.Z)((0,ae.Z)(s),"data",void 0),(0,I.Z)((0,ae.Z)(s),"center",void 0),(0,I.Z)((0,ae.Z)(s),"extent",void 0),(0,I.Z)((0,ae.Z)(s),"hooks",{init:new vu}),(0,I.Z)((0,ae.Z)(s),"parser",{type:"geojson"}),(0,I.Z)((0,ae.Z)(s),"transforms",[]),(0,I.Z)((0,ae.Z)(s),"cluster",!1),(0,I.Z)((0,ae.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,ae.Z)(s),"tileset",void 0),(0,I.Z)((0,ae.Z)(s),"mapService",void 0),(0,I.Z)((0,ae.Z)(s),"invalidExtent",!1),(0,I.Z)((0,ae.Z)(s),"dataArrayChanged",!1),(0,I.Z)((0,ae.Z)(s),"originData",void 0),(0,I.Z)((0,ae.Z)(s),"rawData",void 0),(0,I.Z)((0,ae.Z)(s),"cfg",{}),(0,I.Z)((0,ae.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Ct.Z)(r,[{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,f=this.clusterOptions,v=f.method,m=v===void 0?"sum":v,x=f.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(A){A.id||(A.properties.point_count=1)}),(x||Rl()(m))&&(C=C.map(function(A){var O=A.id;if(O){var D=s.clusterIndex.getLeaves(O,Infinity),Z=D.map(function(Ee){return Ee.properties}),X;if(ws()(m)&&x){var te=qc(Z,x);X=Pf[m](te)}Rl()(m)&&(X=m(Z)),A.properties.stat=X}else A.properties.point_count=1;return A})),this.data=Zn("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,f=s===void 0?"geojson":s;if(f==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",m=pu()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});m.properties=x}return m}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(f){return f._id===a?If(If({},f),s):f}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var f=this.data.dataArray.find(function(v){return v[a]===s});return f==null?void 0:f._id}},{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"destroy",value:function(){var a;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(a=this.tileset)===null||a===void 0||a.destroy()}},{key:"initCfg",value:function(a){this.cfg=op()(this.cfg,a,vp);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=If(If({},this.clusterOptions),s.clusterOptions)))}},{key:"init",value:function(){this.hooks.init.call(this)}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson",f=Zn(s);this.data=f(this.originData,a),this.extent=_f(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(a){this.center=[(a[0]+a[2])/2,(a[1]+a[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var a=this.data.tilesetOptions;if(!!a){if(this.tileset)return this.tileset.updateOptions(a),this.tileset;var s=new yc(If({},a));return s}}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(f){var v=f.type,m=pi(v)(a.data,f);Object.assign(a.data,m)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=nh(this.data,a)}}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=oe(pe(this.extent),a)),s[0].concat(s[1])}}]),r}($o.EventEmitter);function bc(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Eo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=tu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function tu(e,i){if(!!e){if(typeof e=="string")return mp(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mp(e,i)}}function mp(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Nh=6378e3;function Fd(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*Nh)*(256<<20)/2,f=Bd(r,a),v=f.gridHash,m=f.gridOffset,x=Ud(v,m,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function Bd(e,i){var r=Infinity,n=-Infinity,a,s=Eo(e),f;try{for(s.s();!(f=s.n()).done;){var v=f.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(Qe){s.e(Qe)}finally{s.f()}var m=(r+n)/2,x=Nd(i,m);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},A=Eo(e),O;try{for(A.s();!(O=A.n()).done;){var D=O.value,Z=D.coordinates[1],X=D.coordinates[0];if(Number.isFinite(Z)&&Number.isFinite(X)){var te=Math.floor((Z+90)/x.yOffset),Ee=Math.floor((X+180)/x.xOffset),Ue="".concat(te,"-").concat(Ee);C[Ue]=C[Ue]||{count:0,points:[]},C[Ue].count+=1,C[Ue].points.push(D)}}}catch(Qe){A.e(Qe)}finally{A.f()}return{gridHash:C,gridOffset:x}}function Nd(e,i){var r=gp(e),n=zd(i,e);return{yOffset:r,xOffset:n}}function gp(e){return e/Nh*(180/Math.PI)}function zd(e,i){return i/Nh*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Ud(e,i,r){return Object.keys(e).reduce(function(n,a,s){var f=a.split("-"),v=parseInt(f[0],10),m=parseInt(f[1],10),x={};if(r.field&&r.method){var C=Ks(e[a].points,r.field);x[r.method]=al[r.method](C)}return Object.assign(x,{_id:s,coordinates:w([-180+i.xOffset*(m+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var Bl=Math.PI/3,td=[0,Bl,2*Bl,3*Bl,4*Bl,5*Bl];function rd(e){return e[0]}function ih(e){return e[1]}function Pa(){var e=0,i=0,r=1,n=1,a=rd,s=ih,f,v,m;function x(A){var O={},D=[],Z,X=A.length;for(Z=0;Z<X;++Z)if(!(isNaN(Ee=+a.call(null,te=A[Z],Z,A))||isNaN(Ue=+s.call(null,te,Z,A)))){var te,Ee,Ue,Qe=Math.round(Ue=Ue/m),ct=Math.round(Ee=Ee/v-(Qe&1)/2),St=Ue-Qe;if(Math.abs(St)*3>1){var bt=Ee-ct,Kt=ct+(Ee<ct?-1:1)/2,lr=Qe+(Ue<Qe?-1:1),Mr=Ee-Kt,Xr=Ue-lr;bt*bt+St*St>Mr*Mr+Xr*Xr&&(ct=Kt+(Qe&1?1:-1)/2,Qe=lr)}var _r=ct+"-"+Qe,on=O[_r];on?on.push(te):(D.push(on=O[_r]=[te]),on.x=(ct+(Qe&1)/2)*v,on.y=Qe*m)}return D}function C(A){var O=0,D=0;return td.map(function(Z){var X=Math.sin(Z)*A,te=-Math.cos(Z)*A,Ee=X-O,Ue=te-D;return O=X,D=te,[Ee,Ue]})}return x.hexagon=function(A){return"m"+C(A==null?f:+A).join("l")+"z"},x.centers=function(){for(var A=[],O=Math.round(i/m),D=Math.round(e/v),Z=O*m;Z<n+f;Z+=m,++O)for(var X=D*v+(O&1)*v/2;X<r+v/2;X+=v)A.push([X,Z]);return A},x.mesh=function(){var A=C(f).slice(0,4).join("l");return x.centers().map(function(O){return"M"+O+"m"+A}).join("")},x.x=function(A){return arguments.length?(a=A,x):a},x.y=function(A){return arguments.length?(s=A,x):s},x.radius=function(A){return arguments.length?(f=+A,v=f*2*Math.sin(Bl),m=f*1.5,x):f},x.size=function(A){return arguments.length?(e=i=0,r=+A[0],n=+A[1],x):[r-e,n-i]},x.extent=function(A){return arguments.length?(e=+A[0][0],i=+A[0][1],r=+A[1][0],n=+A[1][1],x):[[e,i],[r,n]]},x.radius(1)}function zh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Of=6378e3;function yp(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,f=s===void 0?"sum":s,v=a/(2*Math.PI*Of)*(256<<20)/2,m=r.map(function(O){var D=w(O.coordinates),Z=(0,Q.Z)(D,2),X=Z[0],te=Z[1];return Nl(Nl({},O),{},{coordinates:[X,te]})}),x=Pa().radius(v).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),C=x(m),A={dataArray:C.map(function(O,D){var Z;if(i.field&&f){var X=Ks(O,i.field);O[f]=al[f](X)}return Z={},(0,I.Z)(Z,i.method,O[f]),(0,I.Z)(Z,"count",O.length),(0,I.Z)(Z,"rawData",O),(0,I.Z)(Z,"coordinates",[O.x,O.y]),(0,I.Z)(Z,"_id",D),Z}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return A}function nd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function B(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?nd(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function me(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(f){s[f[r]]=f}),e.dataArray=e.dataArray.map(function(f){var v=f[n];return B(B({},f),s[v])}),e}function ze(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Hn("rasterTile",Oh),Hn("geojson",su),Hn("image",Js),Hn("csv",cs),Hn("json",wi),Hn("raster",Gc),Kn("cluster",nh),Kn("filter",bc),Kn("join",me),Kn("map",ze),Kn("grid",Fd),Kn("hexagon",yp);var zt=Ti,cr=Wa,Dt=va,nr=N(28660),nt=N(86700),yr=N(84879),Be={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Pr=N(31745),Ir=N.n(Pr);function Ur(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Er(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ur(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ur(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tr(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ht(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ht(e,i){if(!!e){if(typeof e=="string")return Wt(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wt(e,i)}}function Wt(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var xr=30;function Nr(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,f=e.mapping,v=f===void 0?{}:f,m=e.xOffset,x=m===void 0?0:m,C=e.yOffset,A=C===void 0?0:C,O=0,D=x;Array.from(i).forEach(function(X,te){if(!v[X]){var Ee=r(X,te);D+xr>s&&(D=0,O++),v[X]={x:D,y:A+O*xr,width:xr,height:xr,advance:Ee},D+=xr}});var Z=n+a*2;return{mapping:v,xOffset:D,yOffset:A+O*Z,canvasHeight:Kr(A+(O+1)*Z)}}function pr(e,i,r){var n=0,a=0,s=0,f=[],v={},m=Tr(e),x;try{for(m.s();!(x=m.n()).done;){var C=x.value;if(!v[C.id]){var A=C.size;n+A+i>r&&(Or(v,f,a),n=0,a=s+a+i,s=0,f=[]),f.push({icon:C,xOffset:n}),n=n+A+i,s=Math.max(s,A)}}}catch(D){m.e(D)}finally{m.f()}f.length>0&&Or(v,f,a);var O=Kr(s+a+i);return{mapping:v,canvasHeight:O}}function Or(e,i,r){var n=Tr(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,f=s.icon,v=s.xOffset;e[f.id]=Er(Er({},f),{},{x:v,y:r,image:f.image,width:f.width,height:f.height})}}catch(m){n.e(m)}finally{n.f()}}function Kr(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Bn,rr;function ar(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xn(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function xn(e,i){if(!!e){if(typeof e=="string")return Vr(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vr(e,i)}}function Vr(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Ar(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ar(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ar(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Jr=Ga(),vi="sans-serif",ii="normal",Wr=24,an=3,Jn=.25,fi=8,Di=1024,ro=1,no=1,Fi=3,gs=null;function Ga(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function jo(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function vo(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Qo=(Bn=(0,nt.b2)(),Bn(rr=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"fontAtlas",void 0),(0,I.Z)(this,"iconFontMap",void 0),(0,I.Z)(this,"iconFontGlyphs",{}),(0,I.Z)(this,"fontOptions",void 0),(0,I.Z)(this,"key",void 0),(0,I.Z)(this,"cache",new Xt(Fi))}return(0,Ct.Z)(e,[{key:"scale",get:function(){return no}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:vi,fontWeight:ii,characterSet:Jr,fontSize:Wr,buffer:an,sdf:!0,cutoff:Jn,radius:fi,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Gr(Gr({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,f=s.fontFamily,v=s.fontWeight,m=s.fontSize,x=s.buffer,C=s.sdf,A=s.radius,O=s.cutoff,D=s.iconfont,Z=a&&a.data;Z||(Z=da.document.createElement("canvas"),Z.width=Di);var X=Z.getContext("2d");jo(X,f,m,v);var te=Nr(Gr({getFontWidth:function(Ps){return X.measureText(Ps).width},fontHeight:m*no,buffer:x,characterSet:n,maxCanvasWidth:Di},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Ee=te.mapping,Ue=te.canvasHeight,Qe=te.xOffset,ct=te.yOffset,St=X.getImageData(0,0,Z.width,Z.height);if(Z.height=Ue,X.putImageData(St,0,0),jo(X,f,m,v),C){var bt=new(Ir())(m,x,A,O,f,v),Kt=X.getImageData(0,0,bt.size,bt.size),lr=ar(n),Mr;try{for(lr.s();!(Mr=lr.n()).done;){var Xr=Mr.value;if(D){var _r=String.fromCharCode(parseInt(Xr.replace("&#x","").replace(";",""),16)),on=bt.draw(_r);vo(on,Kt)}else vo(bt.draw(Xr),Kt);X.putImageData(Kt,Ee[Xr].x,Ee[Xr].y)}}catch(Mo){lr.e(Mo)}finally{lr.f()}}else{var Ln=ar(n),Un;try{for(Ln.s();!(Un=Ln.n()).done;){var Fa=Un.value;X.fillText(Fa,Ee[Fa].x,Ee[Fa].y+m*ro)}}catch(Mo){Ln.e(Mo)}finally{Ln.f()}}return{xOffset:Qe,yOffset:ct,mapping:Ee,data:Z,width:Z.width,height:Z.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,f,v,m,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],f=a.mapping,v=new Set(Object.keys(f)),m=new Set(n);return m.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||rr),Ro,us;function so(e){var i=mi();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function mi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vo=3,Qi=1024,So=64,ri=(Ro=(0,nt.b2)(),Ro(us=function(e){(0,Yr.Z)(r,e);var i=so(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"canvasHeight",128),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"canvas",void 0),(0,I.Z)((0,ae.Z)(n),"iconData",void 0),(0,I.Z)((0,ae.Z)(n),"iconMap",void 0),(0,I.Z)((0,ae.Z)(n),"ctx",void 0),(0,I.Z)((0,ae.Z)(n),"loadingImageCount",0),n}return(0,Ct.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=da.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var f=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:So}),this.updateIconMap(),this.loadImage(s).then(function(m){v=m;var x=f.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),f.update()})}},{key:"addImageMini",value:function(a,s,f){var v=this,m=f.getSceneConfig().canvas,x=m.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:So}),this.updateIconMap(),this.loadImageMini(s,m).then(function(C){x=C;var A=v.iconData.find(function(O){return O.id===a});A&&(A.image=x,A.width=x.width,A.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,f){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){f(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=Qi,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var f=a.iconMap[s],v=f.x,m=f.y,x=f.image,C=f.width,A=C===void 0?64:C,O=f.height,D=O===void 0?64:O,Z=Math.max(A,D),X=Z/So,te=D/X,Ee=A/X;x&&a.ctx.drawImage(x,v+(So-Ee)/2,m+(So-te)/2,Ee,te)})}},{key:"updateIconMap",value:function(){var a=pr(this.iconData,Vo,Qi),s=a.mapping,f=a.canvasHeight;this.iconMap=s,this.canvasHeight=f}},{key:"loadImageMini",value:function(a,s){return new Promise(function(f,v){var m=s.createImage();m.crossOrigin="anonymous",m.onload=function(){f(m)},m.onerror=function(){v(new Error("Could not load image at "+a))},m.src=a})}}]),r}($o.EventEmitter))||us),In=N(49685);function Zi(){var e=new In.WT(16);return In.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Co(e){var i=new In.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function zl(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function we(e,i,r,n,a,s,f,v,m,x,C,A,O,D,Z,X){var te=new In.WT(16);return te[0]=e,te[1]=i,te[2]=r,te[3]=n,te[4]=a,te[5]=s,te[6]=f,te[7]=v,te[8]=m,te[9]=x,te[10]=C,te[11]=A,te[12]=O,te[13]=D,te[14]=Z,te[15]=X,te}function jt(e,i,r,n,a,s,f,v,m,x,C,A,O,D,Z,X,te){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=f,e[6]=v,e[7]=m,e[8]=x,e[9]=C,e[10]=A,e[11]=O,e[12]=D,e[13]=Z,e[14]=X,e[15]=te,e}function At(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hn(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],f=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=f,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Oi(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],m=i[6],x=i[7],C=i[8],A=i[9],O=i[10],D=i[11],Z=i[12],X=i[13],te=i[14],Ee=i[15],Ue=r*v-n*f,Qe=r*m-a*f,ct=r*x-s*f,St=n*m-a*v,bt=n*x-s*v,Kt=a*x-s*m,lr=C*X-A*Z,Mr=C*te-O*Z,Xr=C*Ee-D*Z,_r=A*te-O*X,on=A*Ee-D*X,Ln=O*Ee-D*te,Un=Ue*Ln-Qe*on+ct*_r+St*Xr-bt*Mr+Kt*lr;return Un?(Un=1/Un,e[0]=(v*Ln-m*on+x*_r)*Un,e[1]=(a*on-n*Ln-s*_r)*Un,e[2]=(X*Kt-te*bt+Ee*St)*Un,e[3]=(O*bt-A*Kt-D*St)*Un,e[4]=(m*Xr-f*Ln-x*Mr)*Un,e[5]=(r*Ln-a*Xr+s*Mr)*Un,e[6]=(te*ct-Z*Kt-Ee*Qe)*Un,e[7]=(C*Kt-O*ct+D*Qe)*Un,e[8]=(f*on-v*Xr+x*lr)*Un,e[9]=(n*Xr-r*on-s*lr)*Un,e[10]=(Z*bt-X*ct+Ee*Ue)*Un,e[11]=(A*ct-C*bt-D*Ue)*Un,e[12]=(v*Mr-f*_r-m*lr)*Un,e[13]=(r*_r-n*Mr+a*lr)*Un,e[14]=(X*Qe-Z*St-te*Ue)*Un,e[15]=(C*St-A*Qe+O*Ue)*Un,e):null}function Se(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],m=i[6],x=i[7],C=i[8],A=i[9],O=i[10],D=i[11],Z=i[12],X=i[13],te=i[14],Ee=i[15];return e[0]=v*(O*Ee-D*te)-A*(m*Ee-x*te)+X*(m*D-x*O),e[1]=-(n*(O*Ee-D*te)-A*(a*Ee-s*te)+X*(a*D-s*O)),e[2]=n*(m*Ee-x*te)-v*(a*Ee-s*te)+X*(a*x-s*m),e[3]=-(n*(m*D-x*O)-v*(a*D-s*O)+A*(a*x-s*m)),e[4]=-(f*(O*Ee-D*te)-C*(m*Ee-x*te)+Z*(m*D-x*O)),e[5]=r*(O*Ee-D*te)-C*(a*Ee-s*te)+Z*(a*D-s*O),e[6]=-(r*(m*Ee-x*te)-f*(a*Ee-s*te)+Z*(a*x-s*m)),e[7]=r*(m*D-x*O)-f*(a*D-s*O)+C*(a*x-s*m),e[8]=f*(A*Ee-D*X)-C*(v*Ee-x*X)+Z*(v*D-x*A),e[9]=-(r*(A*Ee-D*X)-C*(n*Ee-s*X)+Z*(n*D-s*A)),e[10]=r*(v*Ee-x*X)-f*(n*Ee-s*X)+Z*(n*x-s*v),e[11]=-(r*(v*D-x*A)-f*(n*D-s*A)+C*(n*x-s*v)),e[12]=-(f*(A*te-O*X)-C*(v*te-m*X)+Z*(v*O-m*A)),e[13]=r*(A*te-O*X)-C*(n*te-a*X)+Z*(n*O-a*A),e[14]=-(r*(v*te-m*X)-f*(n*te-a*X)+Z*(n*m-a*v)),e[15]=r*(v*O-m*A)-f*(n*O-a*A)+C*(n*m-a*v),e}function ie(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],f=e[5],v=e[6],m=e[7],x=e[8],C=e[9],A=e[10],O=e[11],D=e[12],Z=e[13],X=e[14],te=e[15],Ee=i*f-r*s,Ue=i*v-n*s,Qe=i*m-a*s,ct=r*v-n*f,St=r*m-a*f,bt=n*m-a*v,Kt=x*Z-C*D,lr=x*X-A*D,Mr=x*te-O*D,Xr=C*X-A*Z,_r=C*te-O*Z,on=A*te-O*X;return Ee*on-Ue*_r+Qe*Xr+ct*Mr-St*lr+bt*Kt}function Ze(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=i[4],m=i[5],x=i[6],C=i[7],A=i[8],O=i[9],D=i[10],Z=i[11],X=i[12],te=i[13],Ee=i[14],Ue=i[15],Qe=r[0],ct=r[1],St=r[2],bt=r[3];return e[0]=Qe*n+ct*v+St*A+bt*X,e[1]=Qe*a+ct*m+St*O+bt*te,e[2]=Qe*s+ct*x+St*D+bt*Ee,e[3]=Qe*f+ct*C+St*Z+bt*Ue,Qe=r[4],ct=r[5],St=r[6],bt=r[7],e[4]=Qe*n+ct*v+St*A+bt*X,e[5]=Qe*a+ct*m+St*O+bt*te,e[6]=Qe*s+ct*x+St*D+bt*Ee,e[7]=Qe*f+ct*C+St*Z+bt*Ue,Qe=r[8],ct=r[9],St=r[10],bt=r[11],e[8]=Qe*n+ct*v+St*A+bt*X,e[9]=Qe*a+ct*m+St*O+bt*te,e[10]=Qe*s+ct*x+St*D+bt*Ee,e[11]=Qe*f+ct*C+St*Z+bt*Ue,Qe=r[12],ct=r[13],St=r[14],bt=r[15],e[12]=Qe*n+ct*v+St*A+bt*X,e[13]=Qe*a+ct*m+St*O+bt*te,e[14]=Qe*s+ct*x+St*D+bt*Ee,e[15]=Qe*f+ct*C+St*Z+bt*Ue,e}function ft(e,i,r){var n=r[0],a=r[1],s=r[2],f,v,m,x,C,A,O,D,Z,X,te,Ee;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(f=i[0],v=i[1],m=i[2],x=i[3],C=i[4],A=i[5],O=i[6],D=i[7],Z=i[8],X=i[9],te=i[10],Ee=i[11],e[0]=f,e[1]=v,e[2]=m,e[3]=x,e[4]=C,e[5]=A,e[6]=O,e[7]=D,e[8]=Z,e[9]=X,e[10]=te,e[11]=Ee,e[12]=f*n+C*a+Z*s+i[12],e[13]=v*n+A*a+X*s+i[13],e[14]=m*n+O*a+te*s+i[14],e[15]=x*n+D*a+Ee*s+i[15]),e}function Rt(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function $e(e,i,r,n){var a=n[0],s=n[1],f=n[2],v=Math.hypot(a,s,f),m,x,C,A,O,D,Z,X,te,Ee,Ue,Qe,ct,St,bt,Kt,lr,Mr,Xr,_r,on,Ln,Un,Fa;return v<In.Ib?null:(v=1/v,a*=v,s*=v,f*=v,m=Math.sin(r),x=Math.cos(r),C=1-x,A=i[0],O=i[1],D=i[2],Z=i[3],X=i[4],te=i[5],Ee=i[6],Ue=i[7],Qe=i[8],ct=i[9],St=i[10],bt=i[11],Kt=a*a*C+x,lr=s*a*C+f*m,Mr=f*a*C-s*m,Xr=a*s*C-f*m,_r=s*s*C+x,on=f*s*C+a*m,Ln=a*f*C+s*m,Un=s*f*C-a*m,Fa=f*f*C+x,e[0]=A*Kt+X*lr+Qe*Mr,e[1]=O*Kt+te*lr+ct*Mr,e[2]=D*Kt+Ee*lr+St*Mr,e[3]=Z*Kt+Ue*lr+bt*Mr,e[4]=A*Xr+X*_r+Qe*on,e[5]=O*Xr+te*_r+ct*on,e[6]=D*Xr+Ee*_r+St*on,e[7]=Z*Xr+Ue*_r+bt*on,e[8]=A*Ln+X*Un+Qe*Fa,e[9]=O*Ln+te*Un+ct*Fa,e[10]=D*Ln+Ee*Un+St*Fa,e[11]=Z*Ln+Ue*Un+bt*Fa,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Fe(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],f=i[5],v=i[6],m=i[7],x=i[8],C=i[9],A=i[10],O=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=f*a+C*n,e[6]=v*a+A*n,e[7]=m*a+O*n,e[8]=x*a-s*n,e[9]=C*a-f*n,e[10]=A*a-v*n,e[11]=O*a-m*n,e}function st(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],m=i[3],x=i[8],C=i[9],A=i[10],O=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=f*a-C*n,e[2]=v*a-A*n,e[3]=m*a-O*n,e[8]=s*n+x*a,e[9]=f*n+C*a,e[10]=v*n+A*a,e[11]=m*n+O*a,e}function _e(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],m=i[3],x=i[4],C=i[5],A=i[6],O=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=f*a+C*n,e[2]=v*a+A*n,e[3]=m*a+O*n,e[4]=x*a-s*n,e[5]=C*a-f*n,e[6]=A*a-v*n,e[7]=O*a-m*n,e}function Ve(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Ce(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vt(e,i,r){var n=r[0],a=r[1],s=r[2],f=Math.hypot(n,a,s),v,m,x;return f<In.Ib?null:(f=1/f,n*=f,a*=f,s*=f,v=Math.sin(i),m=Math.cos(i),x=1-m,e[0]=n*n*x+m,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+m,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Tt(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Br(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=n+n,m=a+a,x=s+s,C=n*v,A=n*m,O=n*x,D=a*m,Z=a*x,X=s*x,te=f*v,Ee=f*m,Ue=f*x;return e[0]=1-(D+X),e[1]=A+Ue,e[2]=O-Ee,e[3]=0,e[4]=A-Ue,e[5]=1-(C+X),e[6]=Z+te,e[7]=0,e[8]=O+Ee,e[9]=Z-te,e[10]=1-(C+D),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function rn(e,i){var r=new In.WT(3),n=-i[0],a=-i[1],s=-i[2],f=i[3],v=i[4],m=i[5],x=i[6],C=i[7],A=n*n+a*a+s*s+f*f;return A>0?(r[0]=(v*f+C*n+m*s-x*a)*2/A,r[1]=(m*f+C*a+x*n-v*s)*2/A,r[2]=(x*f+C*s+v*a-m*n)*2/A):(r[0]=(v*f+C*n+m*s-x*a)*2,r[1]=(m*f+C*a+x*n-v*s)*2,r[2]=(x*f+C*s+v*a-m*n)*2),Br(e,i,r),e}function Fr(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function En(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],f=i[5],v=i[6],m=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,f,v),e[2]=Math.hypot(m,x,C),e}function cn(e,i){var r=new In.WT(3);En(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],f=i[0]*n,v=i[1]*a,m=i[2]*s,x=i[4]*n,C=i[5]*a,A=i[6]*s,O=i[8]*n,D=i[9]*a,Z=i[10]*s,X=f+C+Z,te=0;return X>0?(te=Math.sqrt(X+1)*2,e[3]=.25*te,e[0]=(A-D)/te,e[1]=(O-m)/te,e[2]=(v-x)/te):f>C&&f>Z?(te=Math.sqrt(1+f-C-Z)*2,e[3]=(A-D)/te,e[0]=.25*te,e[1]=(v+x)/te,e[2]=(O+m)/te):C>Z?(te=Math.sqrt(1+C-f-Z)*2,e[3]=(O-m)/te,e[0]=(v+x)/te,e[1]=.25*te,e[2]=(A+D)/te):(te=Math.sqrt(1+Z-f-C)*2,e[3]=(v-x)/te,e[0]=(O+m)/te,e[1]=(A+D)/te,e[2]=.25*te),e}function bn(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3],m=a+a,x=s+s,C=f+f,A=a*m,O=a*x,D=a*C,Z=s*x,X=s*C,te=f*C,Ee=v*m,Ue=v*x,Qe=v*C,ct=n[0],St=n[1],bt=n[2];return e[0]=(1-(Z+te))*ct,e[1]=(O+Qe)*ct,e[2]=(D-Ue)*ct,e[3]=0,e[4]=(O-Qe)*St,e[5]=(1-(A+te))*St,e[6]=(X+Ee)*St,e[7]=0,e[8]=(D+Ue)*bt,e[9]=(X-Ee)*bt,e[10]=(1-(A+Z))*bt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function yn(e,i,r,n,a){var s=i[0],f=i[1],v=i[2],m=i[3],x=s+s,C=f+f,A=v+v,O=s*x,D=s*C,Z=s*A,X=f*C,te=f*A,Ee=v*A,Ue=m*x,Qe=m*C,ct=m*A,St=n[0],bt=n[1],Kt=n[2],lr=a[0],Mr=a[1],Xr=a[2],_r=(1-(X+Ee))*St,on=(D+ct)*St,Ln=(Z-Qe)*St,Un=(D-ct)*bt,Fa=(1-(O+Ee))*bt,Mo=(te+Ue)*bt,Ps=(Z+Qe)*Kt,au=(te-Ue)*Kt,ks=(1-(O+X))*Kt;return e[0]=_r,e[1]=on,e[2]=Ln,e[3]=0,e[4]=Un,e[5]=Fa,e[6]=Mo,e[7]=0,e[8]=Ps,e[9]=au,e[10]=ks,e[11]=0,e[12]=r[0]+lr-(_r*lr+Un*Mr+Ps*Xr),e[13]=r[1]+Mr-(on*lr+Fa*Mr+au*Xr),e[14]=r[2]+Xr-(Ln*lr+Mo*Mr+ks*Xr),e[15]=1,e}function pn(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r+r,v=n+n,m=a+a,x=r*f,C=n*f,A=n*v,O=a*f,D=a*v,Z=a*m,X=s*f,te=s*v,Ee=s*m;return e[0]=1-A-Z,e[1]=C+Ee,e[2]=O-te,e[3]=0,e[4]=C-Ee,e[5]=1-x-Z,e[6]=D+X,e[7]=0,e[8]=O+te,e[9]=D-X,e[10]=1-x-A,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $n(e,i,r,n,a,s,f){var v=1/(r-i),m=1/(a-n),x=1/(s-f);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*m,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*m,e[10]=(f+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*s*2*x,e[15]=0,e}function ma(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=(a+n)*f,e[14]=2*a*n*f):(e[10]=-1,e[14]=-2*n),e}var Jo=ma;function Da(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=a*f,e[14]=a*n*f):(e[10]=-1,e[14]=-n),e}function fa(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),f=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),m=2/(f+v),x=2/(a+s);return e[0]=m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((f-v)*m*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function fl(e,i,r,n,a,s,f){var v=1/(i-r),m=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*m,e[14]=(f+s)*x,e[15]=1,e}var Rs=fl;function hl(e,i,r,n,a,s,f){var v=1/(i-r),m=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*m,e[14]=s*x,e[15]=1,e}function Tu(e,i,r,n){var a,s,f,v,m,x,C,A,O,D,Z=i[0],X=i[1],te=i[2],Ee=n[0],Ue=n[1],Qe=n[2],ct=r[0],St=r[1],bt=r[2];return Math.abs(Z-ct)<In.Ib&&Math.abs(X-St)<In.Ib&&Math.abs(te-bt)<In.Ib?At(e):(C=Z-ct,A=X-St,O=te-bt,D=1/Math.hypot(C,A,O),C*=D,A*=D,O*=D,a=Ue*O-Qe*A,s=Qe*C-Ee*O,f=Ee*A-Ue*C,D=Math.hypot(a,s,f),D?(D=1/D,a*=D,s*=D,f*=D):(a=0,s=0,f=0),v=A*f-O*s,m=O*a-C*f,x=C*s-A*a,D=Math.hypot(v,m,x),D?(D=1/D,v*=D,m*=D,x*=D):(v=0,m=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=m,e[6]=A,e[7]=0,e[8]=f,e[9]=x,e[10]=O,e[11]=0,e[12]=-(a*Z+s*X+f*te),e[13]=-(v*Z+m*X+x*te),e[14]=-(C*Z+A*X+O*te),e[15]=1,e)}function _p(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=n[0],m=n[1],x=n[2],C=a-r[0],A=s-r[1],O=f-r[2],D=C*C+A*A+O*O;D>0&&(D=1/Math.sqrt(D),C*=D,A*=D,O*=D);var Z=m*O-x*A,X=x*C-v*O,te=v*A-m*C;return D=Z*Z+X*X+te*te,D>0&&(D=1/Math.sqrt(D),Z*=D,X*=D,te*=D),e[0]=Z,e[1]=X,e[2]=te,e[3]=0,e[4]=A*te-O*X,e[5]=O*Z-C*te,e[6]=C*X-A*Z,e[7]=0,e[8]=C,e[9]=A,e[10]=O,e[11]=0,e[12]=a,e[13]=s,e[14]=f,e[15]=1,e}function Mu(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ec(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ah(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Zd(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function es(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function xp(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Kc(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Uh(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=e[4],v=e[5],m=e[6],x=e[7],C=e[8],A=e[9],O=e[10],D=e[11],Z=e[12],X=e[13],te=e[14],Ee=e[15],Ue=i[0],Qe=i[1],ct=i[2],St=i[3],bt=i[4],Kt=i[5],lr=i[6],Mr=i[7],Xr=i[8],_r=i[9],on=i[10],Ln=i[11],Un=i[12],Fa=i[13],Mo=i[14],Ps=i[15];return Math.abs(r-Ue)<=In.Ib*Math.max(1,Math.abs(r),Math.abs(Ue))&&Math.abs(n-Qe)<=In.Ib*Math.max(1,Math.abs(n),Math.abs(Qe))&&Math.abs(a-ct)<=In.Ib*Math.max(1,Math.abs(a),Math.abs(ct))&&Math.abs(s-St)<=In.Ib*Math.max(1,Math.abs(s),Math.abs(St))&&Math.abs(f-bt)<=In.Ib*Math.max(1,Math.abs(f),Math.abs(bt))&&Math.abs(v-Kt)<=In.Ib*Math.max(1,Math.abs(v),Math.abs(Kt))&&Math.abs(m-lr)<=In.Ib*Math.max(1,Math.abs(m),Math.abs(lr))&&Math.abs(x-Mr)<=In.Ib*Math.max(1,Math.abs(x),Math.abs(Mr))&&Math.abs(C-Xr)<=In.Ib*Math.max(1,Math.abs(C),Math.abs(Xr))&&Math.abs(A-_r)<=In.Ib*Math.max(1,Math.abs(A),Math.abs(_r))&&Math.abs(O-on)<=In.Ib*Math.max(1,Math.abs(O),Math.abs(on))&&Math.abs(D-Ln)<=In.Ib*Math.max(1,Math.abs(D),Math.abs(Ln))&&Math.abs(Z-Un)<=In.Ib*Math.max(1,Math.abs(Z),Math.abs(Un))&&Math.abs(X-Fa)<=In.Ib*Math.max(1,Math.abs(X),Math.abs(Fa))&&Math.abs(te-Mo)<=In.Ib*Math.max(1,Math.abs(te),Math.abs(Mo))&&Math.abs(Ee-Ps)<=In.Ib*Math.max(1,Math.abs(Ee),Math.abs(Ps))}var id=Ze,jd=Zd,oh,Sc,Ov=(oh=(0,nt.b2)(),oh(Sc=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"overridedViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredProjectionMatrix",void 0),(0,I.Z)(this,"viewMatrixInverse",void 0),(0,I.Z)(this,"cameraPosition",void 0)}return(0,Ct.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Zi(),Oi(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,Q.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=Ve(Zi(),[r,n,0]);this.jitteredProjectionMatrix=Ze(Zi(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Ze(Zi(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Sc),Vd,Rv;function ys(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Rf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Rf(e,i){if(!!e){if(typeof e=="string")return Gd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gd(e,i)}}function Gd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var t=(Vd=(0,nt.b2)(),Vd(Rv=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"controlCorners",void 0),(0,I.Z)(this,"controlContainer",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"controls",[]),(0,I.Z)(this,"unAddControls",[])}return(0,Ct.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Be.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(Be.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=ys(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=ca("div",n+"control-container",this.container);function s(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=f.map(function(m){return n+m}).join(" ");r[f.join("")]=ca("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&oo(this.controlCorners[r]);this.controlContainer&&oo(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Rv),o,u,p=(o=(0,nt.b2)(),o(u=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"markers",[]),(0,I.Z)(this,"markerLayers",[]),(0,I.Z)(this,"unAddMarkers",[]),(0,I.Z)(this,"unAddMarkerLayers",[])}return(0,Ct.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Be.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||u),y,b,S=(y=(0,nt.b2)(),y(b=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"popup",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"unAddPopup",void 0)}return(0,Ct.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Be.IMapService)}}]),e}())||b),P=N(82492),k=N.n(P),z={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},j=z,H,ee;function ne(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Me(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ne(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ne(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Oe={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ke={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},je=(H=(0,nt.b2)(),H(ee=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"sceneConfigCache",{}),(0,I.Z)(this,"layerConfigCache",{})}return(0,Ct.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return j[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=Me(Me({},Oe),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=Me({},k()({},this.sceneConfigCache[r],Ke,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||ee);function He(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function tt(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(f){s[f]=n[f]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(f,v){return v(e,i,f)||f},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Gt(){var e=new In.WT(4);return In.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Yt(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function hr(e,i,r,n){var a=new In.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function Rr(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function $r(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function zn(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function dn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Vn(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function mn(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Li(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function ai(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Mn(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function ji(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Ci(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function ta(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Gn(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function ga(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function uo(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function Lo(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function Ao(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function lo(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function ko(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function _s(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r*r+n*n+a*a+s*s;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=n*f,e[2]=a*f,e[3]=s*f,e}function xs(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function ru(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],f=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],m=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],A=i[1],O=i[2],D=i[3];return e[0]=A*x-O*m+D*v,e[1]=-(C*x)+O*f-D*s,e[2]=C*m-A*f+D*a,e[3]=-(C*v)+A*s-O*a,e}function Ts(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=f+n*(r[2]-f),e[3]=v+n*(r[3]-v),e}function nu(e,i){i=i||1;var r,n,a,s,f,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,f=r*r+n*n;while(f>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var m=Math.sqrt((1-f)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*m,e[3]=i*s*m,e}function mo(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*f,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*f,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*f,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*f,e}function Ms(e,i,r){var n=i[0],a=i[1],s=i[2],f=r[0],v=r[1],m=r[2],x=r[3],C=x*n+v*s-m*a,A=x*a+m*n-f*s,O=x*s+f*a-v*n,D=-f*n-v*a-m*s;return e[0]=C*x+D*-f+A*-m-O*-v,e[1]=A*x+D*-v+O*-f-C*-m,e[2]=O*x+D*-m+C*-v-A*-f,e[3]=i[3],e}function Ki(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Na(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ia(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function sa(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=i[0],v=i[1],m=i[2],x=i[3];return Math.abs(r-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var gu=null,Gs=null,io=null,ts=null,Hs=null,ya=null,$c=null,pl=function(){var e=Gt();return function(i,r,n,a,s,f){var v,m;for(r||(r=4),n||(n=0),a?m=Math.min(a*r+n,i.length):m=i.length,v=n;v<m;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,f),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),Ul=Math.PI/180,Do=512,Jl=4003e4;function dl(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,f=e.highPrecision,v=f===void 0?!1:f,m=e.flipY,x=m===void 0?!1:m;s=s!==void 0?s:Math.pow(2,a);var C={},A=Do*s,O=Math.cos(r*Ul),D=A/360,Z=D/O,X=A/Jl/O;if(C.pixelsPerMeter=[X,-X,X],C.metersPerPixel=[1/X,-1/X,1/X],C.pixelsPerDegree=[D,-Z,X],C.degreesPerPixel=[1/D,-1/Z,1/X],v){var te=Ul*Math.tan(r*Ul)/O,Ee=D*te/2,Ue=A/Jl*te,Qe=Ue/Z*X;C.pixelsPerDegree2=[0,-Ee,Ue],C.pixelsPerMeter2=[Qe,0,Qe],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var vl;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(vl||(vl={}));var ml={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},sh,Cc,uh,Zh,lh,bp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ad=(sh=(0,nt.b2)(),Cc=(0,nt.f3)(Be.ICameraService),sh(uh=(Zh=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"needRefresh",!0),He(this,"cameraService",lh,this),(0,I.Z)(this,"coordinateSystem",void 0),(0,I.Z)(this,"viewportCenter",void 0),(0,I.Z)(this,"viewportCenterProjection",void 0),(0,I.Z)(this,"pixelsPerDegree",void 0),(0,I.Z)(this,"pixelsPerDegree2",void 0),(0,I.Z)(this,"pixelsPerMeter",void 0)}return(0,Ct.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=dl({latitude:a[1],zoom:r}),f=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=f,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===vl.LNGLAT||this.coordinateSystem===vl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===vl.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===vl.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var f=dl({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=f.pixelsPerMeter,m=f.pixelsPerDegree,x=f.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),A=this.cameraService.getProjectionMatrix(),O=Ze([],A,C),D=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=mo([],[D[0],D[1],0,1],O),C=this.cameraService.getViewMatrixUncentered()||C,O=Ze([],A,C),O=Ze([],O,bp),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=v,this.pixelsPerDegree=m,this.pixelsPerDegree2=x}}]),e}(),lh=tt(Zh.prototype,"cameraService",[Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zh))||uh),od=N(20396),gl=N.n(od),bs;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(bs||(bs={}));var ch,Qc,fh,jh,Ep;function Sp(e){var i=Cp();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Cp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sd={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Ap=(ch=(0,nt.b2)(),Qc=(0,nt.f3)(Be.IMapService),ch(fh=(jh=function(e){(0,Yr.Z)(r,e);var i=Sp(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"indragging",!1),He((0,ae.Z)(n),"mapService",Ep,(0,ae.Z)(n)),(0,I.Z)((0,ae.Z)(n),"hammertime",void 0),(0,I.Z)((0,ae.Z)(n),"lastClickTime",0),(0,I.Z)((0,ae.Z)(n),"lastClickXY",[-1,-1]),(0,I.Z)((0,ae.Z)(n),"clickTimer",void 0),(0,I.Z)((0,ae.Z)(n),"$containter",void 0),(0,I.Z)((0,ae.Z)(n),"onDrag",function(v){var m=n.interactionEvent(v);m.type=sd[m.type],m.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(bs.Drag,m)}),(0,I.Z)((0,ae.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var m=n.interactionEvent(v);n.emit(bs.Hover,m)}),(0,I.Z)((0,ae.Z)(n),"onTouch",function(v){var m=v.touches[0];n.onHover({x:m.pageX,y:m.pageY,type:"touch"})}),(0,I.Z)((0,ae.Z)(n),"onHover",function(v){var m=v.clientX,x=v.clientY,C=m,A=x,O=v.type,D=n.mapService.getMapContainer();if(D)if(_o)C=C-D.left-0,A=A-D.top-0;else{var Z=D.getBoundingClientRect(),X=Z.top,te=Z.left;C=C-te-D.clientLeft,A=A-X-D.clientTop}var Ee=n.mapService.containerToLngLat([C,A]);if(O==="click"){if(!_o&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,A,Ee);return}if(O==="touch"){n.isDoubleTap(C,A,Ee);return}O!=="click"&&O!=="dblclick"&&n.emit(bs.Hover,{x:C,y:A,lngLat:Ee,type:O,target:v})}),n}return(0,Ct.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(bs.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,f=a.y;this.emit(bs.Hover,{x:s,y:f})}},{key:"triggerSelect",value:function(a){this.emit(bs.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(bs.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(_o)da.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(gl()).Manager(a);s.add(new(gl()).Tap({event:"dblclick",taps:2})),s.add(new(gl()).Tap({event:"click"})),s.add(new(gl()).Pan({threshold:0,pointers:0})),s.add(new(gl()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(_o)da.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,f=a.pointerType,v,m;f==="touch"?(m=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(m=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),A=C.top,O=C.left;v-=O,m-=A}var D=this.mapService.containerToLngLat([v,m]);return{x:v,y:m,lngLat:D,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,f){var v=this,m=new Date().getTime(),x="click";m-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(bs.Hover,{x:a,y:s,lngLat:f,type:x})):(this.lastClickTime=m,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(bs.Hover,{x:a,y:s,lngLat:f,type:x})},400))}}]),r}(ea()),Ep=tt(jh.prototype,"mapService",[Qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jh))||fh),wp=0;function Tp(e){if(_o)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(wp++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function ud(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(f){(f==="l7-marker"||f==="l7-popup")&&(n=!1)})}}),n}var W;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(W||(W={}));var Mp,hh,Vh,Lf,Gh,ph,ld,kf,cd,Hd,fd,Lv,Hh;function wo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Uu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wo(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var k0=(Mp=(0,nt.b2)(),hh=(0,nt.f3)(Be.IMapService),Vh=(0,nt.f3)(Be.IRendererService),Lf=(0,nt.f3)(Be.IGlobalConfigService),Gh=(0,nt.f3)(Be.IInteractionService),ph=(0,nt.f3)(Be.ILayerService),Mp(ld=(kf=function(){function e(){var i=this;(0,lt.Z)(this,e),He(this,"mapService",cd,this),He(this,"rendererService",Hd,this),He(this,"configService",fd,this),He(this,"interactionService",Lv,this),He(this,"layerService",Hh,this),(0,I.Z)(this,"pickingFBO",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0),(0,I.Z)(this,"alreadyInPicking",!1),(0,I.Z)(this,"pickBufferScale",1),(0,I.Z)(this,"lastPickTime",new Date().getTime()),(0,I.Z)(this,"pickedLayers",[]),(0,I.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,f=n.y,v=n.lngLat,m=n.type,x=n.target,C=!1,A=i.rendererService,O=A.getViewportSize,D=A.readPixels,Z=A.getContainer,X=i.getContainerSize(Z()),te=X.width,Ee=X.height;te*=ba,Ee*=ba;var Ue=r.getLayerConfig(),Qe=Ue.enableHighlight,ct=Ue.enableSelect,St=s*ba,bt=f*ba;if(St>te-1*ba||St<0||bt>Ee-1*ba||bt<0)return!1;var Kt;if(Kt=D({x:Math.floor(St/i.pickBufferScale),y:Math.floor((Ee-(f+1)*ba)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Kt[0]!==0||Kt[1]!==0||Kt[2]!==0){var lr=Qr(Kt),Mr=r.getSource().getFeatureById(lr);lr!==r.getCurrentPickId()&&m==="mousemove"&&(m="mouseenter");var Xr={x:s,y:f,type:m,lngLat:v,featureId:lr,feature:Mr,target:x};Mr&&(C=!0,r.setCurrentPickId(lr),i.pickedLayers=[r],i.triggerHoverOnLayer(r,Xr))}else{var _r={x:s,y:f,lngLat:v,type:r.getCurrentPickId()!==null&&m==="mousemove"?"mouseout":"un"+m,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,Uu(Uu({},_r),{},{type:"unpick"})),i.triggerHoverOnLayer(r,_r),r.setCurrentPickId(null),i.pickedLayers=[]}if(Qe&&i.highlightPickedFeature(r,Kt),ct&&m==="click"&&((a=Kt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var on=Qr(Kt);r.getCurrentSelectedId()===null||on!==r.getCurrentSelectedId()?(i.selectFeature(r,Kt),r.setCurrentSelectedId(on)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,Ct.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,f=n.getViewportSize,v=n.getContainer,m=this.getContainerSize(v()),x=m.width,C=m.height;x*=ba,C*=ba,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.interactionService.on(bs.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,qi.Z)(ni().mark(function n(a,s,f){var v=this,m,x,C,A;return ni().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:m=this.rendererService,x=m.useFramebuffer,C=m.clear,A=m.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var Z=v.pickBox(a,s);f(Z)});case 3:case"end":return D.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(_r){var on=_r<0?0:_r;return Math.floor(on*ba/a.pickBufferScale)}),f=(0,Q.Z)(s,4),v=f[0],m=f[1],x=f[2],C=f[3],A=this.rendererService,O=A.getViewportSize,D=A.readPixels,Z=A.getContainer,X=this.getContainerSize(Z()),te=X.width,Ee=X.height;if(te*=ba,Ee*=ba,v>(te-1)*ba/this.pickBufferScale||x<0||m>(Ee-1)*ba/this.pickBufferScale||C<0)return[];var Ue,Qe=Math.min(te/this.pickBufferScale,x)-v,ct=Math.min(Ee/this.pickBufferScale,C)-m;Ue=D({x:v,y:Math.floor(Ee/this.pickBufferScale-(C+1)),width:Qe,height:ct,data:new Uint8Array(Qe*ct*4),framebuffer:this.pickingFBO});for(var St=[],bt={},Kt=0;Kt<Ue.length/4;Kt=Kt+1){var lr=Ue.slice(Kt*4,Kt*4+4),Mr=Qr(lr);if(Mr!==-1&&!bt[Mr]){var Xr=r.getSource().getFeatureById(Mr);St.push(Uu(Uu({},Xr),{},{pickedFeatureIdx:Mr})),bt[Mr]=!0}}return St}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,f=s===void 0?"":s,v=a.cursorEnabled;if(v){var m=this.mapService.version,x=m==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",f))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ba,height:r.height/ba}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,qi.Z)(ni().mark(function n(a){var s;return ni().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||["contextmenu","click","mouseup"].includes(a.type))){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=ba,s*=ba,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,qi.Z)(ni().mark(function n(a){var s=this,f,v,m,x,C;return ni().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:f=this.rendererService,v=f.getViewportSize,m=f.useFramebuffer,x=f.clear,C=f.getContainer,this.resizePickingFBO(),m(this.pickingFBO,function(){var D=s.layerService.getRenderList();D.filter(function(Z){return Z.needPick(a.type)}).reverse().some(function(Z){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Z.hooks.beforePickingEncode.call(),Z.masks.length>0&&Z.masks.map(function(te){te.hooks.beforeRenderData.call(),te.hooks.beforeRender.call(),te.render(),te.hooks.afterRender.call()}),Z.renderModels(!0),Z.hooks.afterPickingEncode.call(),s.pickedLayers.map(function(te){s.selectFeature(te,new Uint8Array([0,0,0,0]))});var X=s.pickFromPickingFBO(Z,a);return s.layerService.pickedLayerId=X?+Z.id:-1,X&&!Z.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){ud(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,Q.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeHighlight.call([s,f,v])}},{key:"selectFeature",value:function(r,n){var a=(0,Q.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeSelect.call([s,f,v])}}]),e}(),cd=tt(kf.prototype,"mapService",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=tt(kf.prototype,"rendererService",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fd=tt(kf.prototype,"configService",[Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lv=tt(kf.prototype,"interactionService",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hh=tt(kf.prototype,"layerService",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kf))||ld),Df=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,lt.Z)(this,e),(0,I.Z)(this,"autoStart",void 0),(0,I.Z)(this,"startTime",0),(0,I.Z)(this,"oldTime",0),(0,I.Z)(this,"running",!1),(0,I.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Ct.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),hd,Wd,Pp,ec,Ip,Jc,Op,Rp,pd;function kv(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Lp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Lp(e,i){if(!!e){if(typeof e=="string")return Xd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xd(e,i)}}function Xd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Dv=(hd=(0,nt.b2)(),Wd=(0,nt.f3)(Be.IRendererService),Pp=(0,nt.f3)(Be.IMapService),ec=(0,nt.f3)(Be.IGlobalConfigService),hd(Ip=(Jc=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"pickedLayerId",-1),(0,I.Z)(this,"clock",new Df),(0,I.Z)(this,"alreadyInRendering",!1),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"layerList",[]),(0,I.Z)(this,"layerRenderID",void 0),(0,I.Z)(this,"sceneInited",!1),(0,I.Z)(this,"animateInstanceCount",0),(0,I.Z)(this,"shaderPicking",!0),(0,I.Z)(this,"enableRender",!0),He(this,"renderService",Op,this),He(this,"mapService",Rp,this),He(this,"configService",pd,this)}return(0,Ct.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,qi.Z)(ni().mark(function n(){var a,s,f;return ni().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){m.next=2;break}return m.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=kv(this.layerList),m.prev=5,a.s();case 7:if((s=a.n()).done){m.next=21;break}if(f=s.value,f.hooks.beforeRenderData.call(),f.hooks.beforeRender.call(),!f.isLayerGroup&&f.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),f.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!f.getLayerConfig().enableMultiPassRenderer){m.next=17;break}return m.next=15,f.renderMultiPass();case 15:m.next=18;break;case 17:f.render();case 18:f.hooks.afterRender.call();case 19:m.next=7;break;case 21:m.next=26;break;case 23:m.prev=23,m.t0=m.catch(5),a.e(m.t0);case 26:return m.prev=26,a.f(),m.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return m.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=sr(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=da.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){da.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Op=tt(Jc.prototype,"renderService",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rp=tt(Jc.prototype,"mapService",[Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pd=tt(Jc.prototype,"configService",[ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jc))||Ip),dh=N(81253),Fv=N(14293),Ac=N.n(Fv),Zu=function(){function e(i){var r=this;(0,lt.Z)(this,e),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"scale",void 0),(0,I.Z)(this,"descriptor",void 0),(0,I.Z)(this,"featureBufferLayout",[]),(0,I.Z)(this,"needRescale",!1),(0,I.Z)(this,"needRemapping",!1),(0,I.Z)(this,"needRegenerateVertices",!1),(0,I.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,I.Z)(this,"vertexAttribute",void 0),(0,I.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,f){var v,m=(v=r.scale)===null||v===void 0?void 0:v.scalers[f].func,x=m(s);return x})}),this.setProps(i)}return(0,Ct.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,ir.Z)(r));if(!Ac()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),dd=["buffer","update","name"],Bv=["buffer","update","name"],ju,Nv,Yd,Ff,Bf,vh;function mh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ef(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D0(e){return new Promise(function(i){return setTimeout(i,e)})}var zv=(ju={},(0,I.Z)(ju,W.FLOAT,4),(0,I.Z)(ju,W.UNSIGNED_BYTE,1),(0,I.Z)(ju,W.UNSIGNED_SHORT,2),ju),Uv=(Nv=(0,nt.b2)(),Yd=(0,nt.f3)(Be.IRendererService),Nv(Ff=(Bf=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"attributesAndIndices",void 0),He(this,"rendererService",vh,this),(0,I.Z)(this,"attributes",[]),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Ct.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Zu(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(ef(ef({},n),{},{name:r})));var f=n.scale;f&&s&&(s.scale=f,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,f=this.attributes.find(function(ct){return ct.name===r});if(f&&f.descriptor){var v=f.descriptor,m=v.update,x=v.buffer,C=v.size,A=C===void 0?0:C,O=zv[x.type||W.FLOAT];if(m){var D=this.featureLayout,Z=D.elements,X=D.sizePerElement,te=Z.slice(a,s);if(!te.length)return;var Ee=te[0].offset,Ue=Ee*A*O,Qe=te.map(function(ct,St){for(var bt=ct.featureIdx,Kt=ct.vertices,lr=ct.normals,Mr=Kt.length/X,Xr=[],_r=0;_r<Mr;_r++){var on=lr?lr.slice(_r*3,_r*3+3):[];Xr.push.apply(Xr,(0,ir.Z)(m(n[bt],bt,Kt.slice(_r*X,_r*X+X),St,on)))}return Xr}).reduce(function(ct,St){return ct.push.apply(ct,(0,ir.Z)(St)),ct},[]);f.vertexAttribute.updateBuffer({data:Qe,offset:Ue})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var f=this.attributes.map(function(Ue){return Ue.resetDescriptor(),Ue.descriptor}),v=0,m=[],x=[],C=[],A=3;r.forEach(function(Ue,Qe){var ct=s.triangulation(Ue,a),St=ct.indices,bt=ct.vertices,Kt=ct.normals,lr=ct.size,Mr=ct.indexes;St.forEach(function(Ln){x.push(Ln+v)}),A=lr;var Xr=bt.length/lr;s.featureLayout.sizePerElement=A,s.featureLayout.elements.push({featureIdx:Qe,vertices:bt,normals:Kt,offset:v}),v+=Xr;for(var _r=function(Un){var Fa=(Kt==null?void 0:Kt.slice(Un*3,Un*3+3))||[],Mo=bt.slice(Un*lr,Un*lr+lr),Ps=0;Mr&&Mr[Un]!==void 0&&(Ps=Mr[Un]),f.forEach(function(au,ks){if(au&&au.update){var Rc;(Rc=au.buffer.data).push.apply(Rc,(0,ir.Z)(au.update(Ue,Qe,Mo,Un,Fa,Ps)))}})},on=0;on<Xr;on++)_r(on)});var O=this.rendererService,D=O.createAttribute,Z=O.createBuffer,X=O.createElements,te={};f.forEach(function(Ue,Qe){if(Ue){var ct=Ue.buffer,St=Ue.update,bt=Ue.name,Kt=(0,dh.Z)(Ue,dd),lr=D(ef({buffer:Z(ct)},Kt));te[Ue.name||""]=lr,s.attributes[Qe].vertexAttribute=lr}});var Ee=X({data:x,type:W.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:te,elements:Ee},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(D){return D.resetDescriptor(),D.descriptor}),f=0,v=[],m=3;r.forEach(function(D,Z){var X=a.triangulation(D),te=X.indices,Ee=X.vertices,Ue=X.normals,Qe=X.size,ct=X.indexes;te.forEach(function(lr){v.push(lr+f)}),m=Qe;var St=Ee.length/Qe;a.featureLayout.sizePerElement=m,a.featureLayout.elements.push({featureIdx:Z,vertices:Ee,normals:Ue,offset:f}),f+=St;for(var bt=function(Mr){var Xr=(Ue==null?void 0:Ue.slice(Mr*3,Mr*3+3))||[],_r=Ee.slice(Mr*Qe,Mr*Qe+Qe),on=0;ct&&ct[Mr]!==void 0&&(on=ct[Mr]),s.forEach(function(Ln,Un){if(Ln&&Ln.update){var Fa;(Fa=Ln.buffer.data).push.apply(Fa,(0,ir.Z)(Ln.update(D,Z,_r,Mr,Xr,on)))}})},Kt=0;Kt<St;Kt++)bt(Kt)});var x=this.rendererService,C=x.createAttribute,A=x.createBuffer,O={};return s.forEach(function(D,Z){if(D){var X=D.buffer,te=D.update,Ee=D.name,Ue=(0,dh.Z)(D,Bv),Qe=C(ef({buffer:A(X)},Ue));O[D.name||""]=Qe,a.attributes[Z].vertexAttribute=Qe}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),vh=tt(Bf.prototype,"rendererService",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bf))||Ff),qd=N(67709),Kd=N.n(qd),vd,wc,$d,md,gd,Qd,yd,Jd,ev,_d,tv,Wh,rv,kp,Zv,nv,jv,iu,Vv,Gv,Hv,Wv,Xv,Yv,tc,Dp,iv,Xh,av,Cm,Am,wm,Tm;function Ob(e){var i=Rb();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Rb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lb=(vd=(0,nt.b2)(),wc=(0,nt.f3)(Be.SceneID),$d=(0,nt.f3)(Be.IIconService),md=(0,nt.f3)(Be.IFontService),gd=(0,nt.f3)(Be.IControlService),Qd=(0,nt.f3)(Be.IGlobalConfigService),yd=(0,nt.f3)(Be.IMapService),Jd=(0,nt.f3)(Be.ICoordinateSystemService),ev=(0,nt.f3)(Be.IRendererService),_d=(0,nt.f3)(Be.ILayerService),tv=(0,nt.f3)(Be.ICameraService),Wh=(0,nt.f3)(Be.IInteractionService),rv=(0,nt.f3)(Be.IPickingService),kp=(0,nt.f3)(Be.IShaderModuleService),Zv=(0,nt.f3)(Be.IMarkerService),nv=(0,nt.f3)(Be.IPopupService),vd(jv=(iu=function(e){(0,Yr.Z)(r,e);var i=Ob(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,ae.Z)(n),"destroyed",!1),(0,I.Z)((0,ae.Z)(n),"loaded",!1),(0,I.Z)((0,ae.Z)(n),"loadFont",!1),(0,I.Z)((0,ae.Z)(n),"fontFamily",""),He((0,ae.Z)(n),"id",Vv,(0,ae.Z)(n)),He((0,ae.Z)(n),"iconService",Gv,(0,ae.Z)(n)),He((0,ae.Z)(n),"fontService",Hv,(0,ae.Z)(n)),He((0,ae.Z)(n),"controlService",Wv,(0,ae.Z)(n)),He((0,ae.Z)(n),"configService",Xv,(0,ae.Z)(n)),He((0,ae.Z)(n),"map",Yv,(0,ae.Z)(n)),He((0,ae.Z)(n),"coordinateSystemService",tc,(0,ae.Z)(n)),He((0,ae.Z)(n),"rendererService",Dp,(0,ae.Z)(n)),He((0,ae.Z)(n),"layerService",iv,(0,ae.Z)(n)),He((0,ae.Z)(n),"cameraService",Xh,(0,ae.Z)(n)),He((0,ae.Z)(n),"interactionService",av,(0,ae.Z)(n)),He((0,ae.Z)(n),"pickingService",Cm,(0,ae.Z)(n)),He((0,ae.Z)(n),"shaderModuleService",Am,(0,ae.Z)(n)),He((0,ae.Z)(n),"markerService",wm,(0,ae.Z)(n)),He((0,ae.Z)(n),"popupService",Tm,(0,ae.Z)(n)),(0,I.Z)((0,ae.Z)(n),"inited",!1),(0,I.Z)((0,ae.Z)(n),"initPromise",void 0),(0,I.Z)((0,ae.Z)(n),"rendering",!1),(0,I.Z)((0,ae.Z)(n),"$container",void 0),(0,I.Z)((0,ae.Z)(n),"canvas",void 0),(0,I.Z)((0,ae.Z)(n),"markerContainer",void 0),(0,I.Z)((0,ae.Z)(n),"hooks",void 0),(0,I.Z)((0,ae.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),ds(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,I.Z)((0,ae.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new Dl},n}return(0,Ct.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,qi.Z)(ni().mark(function f(){return ni().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){m.next=6;break}return m.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(bs.Drag,s.addSceneEvent.bind(s));case 13:case"end":return m.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,qi.Z)(ni().mark(function f(){var v,m;return ni().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=Tp(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=ca("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Kd()(s.$container,s.handleWindowResized),da.matchMedia&&((m=da.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||m===void 0||m.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,qi.Z)(ni().mark(function f(){return ni().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(bs.Drag,s.addSceneEvent.bind(s));case 5:case"end":return m.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,qi.Z)(ni().mark(function f(){var v;return ni().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,qi.Z)(ni().mark(function s(){return ni().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var f=document.createElement("style");f.type="text/css",f.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(f),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,f=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=ca("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,f;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var m;(m=a.$container)===null||m===void 0||m.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(f=s.parentNode)===null||f===void 0||f.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,qd.unbind)(this.$container,this.handleWindowResized),da.matchMedia){var v;(v=da.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,f=ba,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*f,x.height=m*f),this.rendererService.viewport({x:0,y:0,width:f*v,height:f*m})}},{key:"setCanvas",value:function(){var a,s,f=ba,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*f,x.height=m*f,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}($o.EventEmitter),Vv=tt(iu.prototype,"id",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gv=tt(iu.prototype,"iconService",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hv=tt(iu.prototype,"fontService",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wv=tt(iu.prototype,"controlService",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv=tt(iu.prototype,"configService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yv=tt(iu.prototype,"map",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tc=tt(iu.prototype,"coordinateSystemService",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=tt(iu.prototype,"rendererService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=tt(iu.prototype,"layerService",[_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh=tt(iu.prototype,"cameraService",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),av=tt(iu.prototype,"interactionService",[Wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cm=tt(iu.prototype,"pickingService",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am=tt(iu.prototype,"shaderModuleService",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm=tt(iu.prototype,"markerService",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm=tt(iu.prototype,"popupService",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iu))||jv),kb=N(44908),Mm=N.n(kb);function Db(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Fb=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Pm(e){var i={};return e=e.replace(Fb,function(r,n,a){var s=a.split(":"),f=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(m,x){return m.push(Number(x.trim())),m},[]):v=new Array(Db(n)).fill(0);break;default:}return i[f]=v,"uniform ".concat(n," ").concat(f,`;
`)}),{content:e,uniforms:i}}var Im,Om;function Rm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ov(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Lm="#define PI 3.14159265359",Bb=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Nb=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,zb=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Ub=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,Zb=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,jb=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Vb=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Gb=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Hb=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Wb=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Xb=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Yb=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,qb=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Kb=/precision\s+(high|low|medium)p\s+float/,$b=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Qb=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Jb=(Im=(0,nt.b2)(),Im(Om=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"moduleCache",{}),(0,I.Z)(this,"rawContentCache",{})}return(0,Ct.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Lm,fs:Lm}),this.registerModule("decode",{vs:Bb,fs:""}),this.registerModule("projection",{vs:Vb,fs:""}),this.registerModule("project",{vs:jb,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Gb}),this.registerModule("lighting",{vs:zb,fs:""}),this.registerModule("light",{vs:Nb,fs:""}),this.registerModule("picking",{vs:Zb,fs:Ub}),this.registerModule("styleMapping",{vs:Hb,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:qb,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Wb,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Xb,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Yb,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,f=n.uniforms,v=Pm(a),m=v.content,x=v.uniforms,C=Pm(s),A=C.content,O=C.uniforms;this.rawContentCache[r]={fs:A,uniforms:ov(ov(ov({},x),O),f),vs:m}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,f=this.processModule(a,[],"vs"),v=f.content,m=f.includeList,x=this.processModule(s,[],"fs"),C=x.content,A=x.includeList,O=C,D=Mm()(m.concat(A).concat(r)).reduce(function(Z,X){return ov(ov({},Z),n.rawContentCache[X].uniforms)},{});return Kb.test(C)||(O=$b+C),this.moduleCache[r]={fs:O.trim(),uniforms:D,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,f=r.replace(Qb,function(v,m){var x=m.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var A=s.rawContentCache[C][a];n.push(C);var O=s.processModule(A,n,a),D=O.content;return D});return{content:f,includeList:n}}}]),e}())||Om),qv=N(66213),Yh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Yh||(Yh={}));var km,Dm,Kv=(km=(0,nt.b2)(),km(Dm=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"config",void 0)}return(0,Ct.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Yh.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Be.IRendererService),this.cameraService=r.getContainer().get(Be.ICameraService),this.mapService=r.getContainer().get(Be.IMapService),this.interactionService=r.getContainer().get(Be.IInteractionService),this.layerService=r.getContainer().get(Be.ILayerService),this.shaderModuleService=r.getContainer().get(Be.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Dm),Fm,Bm;function e2(e){var i=t2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function t2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r2=(Fm=(0,nt.b2)(),Fm(Bm=function(e){(0,Yr.Z)(r,e);var i=e2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,qv.Z)((0,It.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Kv))||Bm),Nm,zm,Um,F0,Zm;function n2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function i2(e,i){if(!!e){if(typeof e=="string")return jm(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jm(e,i)}}function jm(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var a2=(Nm=(0,nt.b2)(),zm=(0,nt.f3)(Be.IPostProcessor),Nm(Um=(F0=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"passes",[]),He(this,"postProcessor",Zm,this),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"renderFlag",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0)}return(0,Ct.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,qi.Z)(ni().mark(function n(){var a,s,f;return ni().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a=n2(this.passes),m.prev=1,a.s();case 3:if((s=a.n()).done){m.next=9;break}return f=s.value,m.next=7,f.render(this.layer);case 7:m.next=3;break;case 9:m.next=14;break;case 11:m.prev=11,m.t0=m.catch(1),a.e(m.t0);case 14:return m.prev=14,a.f(),m.finish(14);case 17:return m.next=19,this.postProcessor.render(this.layer);case 19:case"end":return m.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Yh.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Zm=tt(F0.prototype,"postProcessor",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0))||Um),Vm,Gm;function Hm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o2(e){var i=s2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function s2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u2=(Vm=(0,nt.b2)(),Vm(Gm=function(e){(0,Yr.Z)(r,e);var i=o2(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"pickingFBO",void 0),(0,I.Z)((0,ae.Z)(n),"layer",void 0),(0,I.Z)((0,ae.Z)(n),"width",0),(0,I.Z)((0,ae.Z)(n),"height",0),(0,I.Z)((0,ae.Z)(n),"alreadyInRendering",!1),(0,I.Z)((0,ae.Z)(n),"pickFromPickingFBO",function(v){var m=v.x,x=v.y,C=v.lngLat,A=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(A))){var O=n.rendererService,D=O.getViewportSize,Z=O.readPixels,X=O.useFramebuffer,te=D(),Ee=te.width,Ue=te.height,Qe=n.layer.getLayerConfig(),ct=Qe.enableHighlight,St=Qe.enableSelect,bt=m*ba,Kt=x*ba;if(!(bt>Ee||bt<0||Kt>Ue||Kt<0)){var lr;X(n.pickingFBO,function(){var Mr;if(lr=Z({x:Math.round(bt),y:Math.round(Ue-(x+1)*ba),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),lr[0]!==0||lr[1]!==0||lr[2]!==0){var Xr=Qr(lr),_r=n.layer.getSource().getFeatureById(Xr),on={x:m,y:x,type:A,lngLat:C,featureId:Xr,feature:_r};_r&&(n.layer.setCurrentPickId(Xr),n.triggerHoverOnLayer(on))}else{var Ln={x:m,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+A:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Wm(Wm({},Ln),{},{type:"unpick"})),n.triggerHoverOnLayer(Ln),n.layer.setCurrentPickId(null)}ct&&n.highlightPickedFeature(lr),St&&A==="click"&&((Mr=lr)===null||Mr===void 0?void 0:Mr.toString())!==[0,0,0,0].toString()&&n.selectFeature(lr)})}}}),n}return(0,Ct.Z)(r,[{key:"getType",value:function(){return Yh.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,qv.Z)((0,It.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var f=this.rendererService,v=f.createTexture2D,m=f.createFramebuffer,x=f.getViewportSize,C=x(),A=C.width,O=C.height;this.pickingFBO=m({color:v({width:A,height:O,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.interactionService.on(bs.Hover,this.pickFromPickingFBO),this.interactionService.on(bs.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(bs.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var f=this.rendererService,v=f.getViewportSize,m=f.useFramebuffer,x=f.clear,C=v(),A=C.width,O=C.height;this.alreadyInRendering=!0,(this.width!==A||this.height!==O)&&(this.pickingFBO.resize({width:A,height:O}),this.width=A,this.height=O),m(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var D=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(D),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,Q.Z)(a,3),f=s[0],v=s[1],m=s[2];this.layer.hooks.beforeHighlight.call([f,v,m]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,Q.Z)(a,3),f=s[0],v=s[1],m=s[2];this.layer.hooks.beforeSelect.call([f,v,m]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,f=Rn(s);this.selectFeature(new Uint8Array(f))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,f=Rn(s);this.highlightPickedFeature(new Uint8Array(f))}}]),r}(Kv))||Gm),l2=N(11700),c2=N.n(l2),f2=N(68929),h2=N.n(f2),Xm,Ym,qm,B0,Km;function $m(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$m(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$m(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var p2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gh=(Xm=(0,nt.b2)(),Ym=(0,nt.f3)(Be.IShaderModuleService),Xm(qm=(B0=function(){function e(){(0,lt.Z)(this,e),He(this,"shaderModuleService",Km,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"config",void 0),(0,I.Z)(this,"quad",p2),(0,I.Z)(this,"enabled",!0),(0,I.Z)(this,"renderToScreen",!1),(0,I.Z)(this,"model",void 0),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"optionsToUpdate",{})}return(0,Ct.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Yh.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Be.IRendererService),this.shaderModuleService=r.getContainer().get(Be.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,f=a.createBuffer,v=a.createModel,m=this.setupShaders(),x=m.vs,C=m.fs,A=m.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:f({data:[-4,-4,4,-4,0,4],type:W.FLOAT}),size:2})},uniforms:sv(sv({u_Texture:null},A),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),f=this.rendererService,v=f.useFramebuffer,m=f.getViewportSize,x=f.clear,C=m(),A=C.width,O=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var D=sv({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[A,O]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(D.u_BloomFinal=1,D.u_Texture2=n),a.model.draw({uniforms:D})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=sv(sv({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){Ac()(r[a])||(n["u_".concat(c2()(h2()(a)))]=r[a])}),n}}]),e}(),Km=tt(B0.prototype,"shaderModuleService",[Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B0))||qm),Qm,Jm;function eg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?eg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function d2(e){var i=v2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function v2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m2=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,g2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,y2=(Qm=(0,nt.b2)(),Qm(Jm=function(e){(0,Yr.Z)(r,e);var i=d2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:g2,fs:m2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:tg(tg({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ac()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Ac()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Ac()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(gh))||Jm),rg,ng;function ig(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ag(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ig(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ig(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _2(e){var i=x2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function x2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,E2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,S2=(rg=(0,nt.b2)(),rg(ng=function(e){(0,Yr.Z)(r,e);var i=_2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:E2,fs:b2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:ag(ag({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ac()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(gh))||ng),og,sg;function ug(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function lg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ug(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ug(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function C2(e){var i=A2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function A2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,T2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,M2=(og=(0,nt.b2)(),og(sg=function(e){(0,Yr.Z)(r,e);var i=C2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:T2,fs:w2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:lg(lg({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ac()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(gh))||sg),cg,fg;function hg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function pg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function P2(e){var i=I2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function I2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,R2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,L2=(cg=(0,nt.b2)(),cg(fg=function(e){(0,Yr.Z)(r,e);var i=P2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:R2,fs:O2});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:pg(pg({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||fg),dg,vg;function k2(e){var i=D2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,B2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,N2=(dg=(0,nt.b2)(),dg(vg=function(e){(0,Yr.Z)(r,e);var i=k2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:B2,fs:F2}),this.shaderModuleService.getModule("copy-pass")}}]),r}(gh))||vg),mg,gg;function yg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _g(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z2(e){var i=U2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,j2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,V2=(mg=(0,nt.b2)(),mg(gg=function(e){(0,Yr.Z)(r,e);var i=z2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:j2,fs:Z2});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:_g(_g({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||gg),xg,bg;function Eg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Eg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Eg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function G2(e){var i=H2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function H2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,X2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Y2=(xg=(0,nt.b2)(),xg(bg=function(e){(0,Yr.Z)(r,e);var i=G2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:X2,fs:W2});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:Sg(Sg({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||bg),Cg,Ag;function q2(e){var i=K2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function K2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Q2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,J2=(Cg=(0,nt.b2)(),Cg(Ag=function(e){(0,Yr.Z)(r,e);var i=q2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Q2,fs:$2}),this.shaderModuleService.getModule("noise-pass")}}]),r}(gh))||Ag),wg,Tg;function eE(e){var i=tE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function tE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,iE=(wg=(0,nt.b2)(),wg(Tg=function(e){(0,Yr.Z)(r,e);var i=eE(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:rE,fs:nE}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(gh))||Tg),Mg,Pg,Ig,Og,xd,Rg,aE=(Mg=(0,nt.b2)(),Pg=(0,nt.f3)(Be.IRendererService),Ig=(0,nt.zY)(),Mg(Og=(xd=function(){function e(){(0,lt.Z)(this,e),He(this,"rendererService",Rg,this),(0,I.Z)(this,"passes",[]),(0,I.Z)(this,"readFBO",void 0),(0,I.Z)(this,"writeFBO",void 0)}return(0,Ct.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),f=s.width,v=s.height;return a({x:0,y:0,width:f,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,qi.Z)(ni().mark(function f(){return ni().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return m.stop()}},f)})))})}},{key:"renderBloomPass",value:function(){var i=(0,qi.Z)(ni().mark(function n(a,s){var f,v;return ni().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:f=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,f);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,qi.Z)(ni().mark(function n(a){var s,f;return ni().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:s=0;case 1:if(!(s<this.passes.length)){m.next=15;break}if(f=this.passes[s],f.setRenderToScreen(this.isLastEnabledPass(s)),f.getName()!=="bloom"){m.next=9;break}return m.next=7,this.renderBloomPass(a,f);case 7:m.next=12;break;case 9:return m.next=11,f.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,m.next=1;break;case 15:case"end":return m.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Rg=tt(xd.prototype,"rendererService",[Pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt(xd.prototype,"init",[Ig],Object.getOwnPropertyDescriptor(xd.prototype,"init"),xd.prototype),xd))||Og),Lg,kg;function oE(e){var i=sE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function sE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uE=(Lg=(0,nt.b2)(),Lg(kg=function(e){(0,Yr.Z)(r,e);var i=oE(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getType",value:function(){return Yh.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,qv.Z)((0,It.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,f=s.useFramebuffer,v=s.clear,m=a.multiPassRenderer.getPostProcessor().getReadFBO();f(m,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:m}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Kv))||kg),Dg,Fg,Bg,N0,Ng;function zg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ug(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lE(e){var i=cE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function cE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fE=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Zg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,hE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function jg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var pE=1,dE=(Dg=(0,nt.b2)(),Fg=(0,nt.f3)(Be.IShaderModuleService),Dg(Bg=(N0=function(e){(0,Yr.Z)(r,e);var i=lE(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),He((0,ae.Z)(n),"shaderModuleService",Ng,(0,ae.Z)(n)),(0,I.Z)((0,ae.Z)(n),"haltonSequence",[]),(0,I.Z)((0,ae.Z)(n),"accumulatingId",0),(0,I.Z)((0,ae.Z)(n),"frame",0),(0,I.Z)((0,ae.Z)(n),"timer",void 0),(0,I.Z)((0,ae.Z)(n),"sampleRenderTarget",void 0),(0,I.Z)((0,ae.Z)(n),"prevRenderTarget",void 0),(0,I.Z)((0,ae.Z)(n),"outputRenderTarget",void 0),(0,I.Z)((0,ae.Z)(n),"copyRenderTarget",void 0),(0,I.Z)((0,ae.Z)(n),"blendModel",void 0),(0,I.Z)((0,ae.Z)(n),"outputModel",void 0),(0,I.Z)((0,ae.Z)(n),"copyModel",void 0),n}return(0,Ct.Z)(r,[{key:"getType",value:function(){return Yh.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,qv.Z)((0,It.Z)(r.prototype),"init",this).call(this,a,s);var f=this.rendererService,v=f.createFramebuffer,m=f.createTexture2D;this.sampleRenderTarget=v({color:m({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:m({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:m({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:m({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([jg(x,2),jg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",fE),this.outputModel=this.createTriangleModel("copy-pass",Zg,{blend:{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE_MINUS_SRC_ALPHA,srcAlpha:W.ONE,dstAlpha:W.ONE_MINUS_SRC_ALPHA},equation:{rgb:W.FUNC_ADD,alpha:W.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Zg)}},{key:"render",value:function(a){var s=this,f=this.rendererService,v=f.clear,m=f.getViewportSize,x=f.useFramebuffer,C=m(),A=C.width,O=C.height;this.sampleRenderTarget.resize({width:A,height:O}),this.prevRenderTarget.resize({width:A,height:O}),this.outputRenderTarget.resize({width:A,height:O}),this.copyRenderTarget.resize({width:A,height:O}),this.resetFrame(),this.stopAccumulating();var D=a.multiPassRenderer.getPostProcessor().getReadFBO();x(D,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:D}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var Z=function X(te){!s.accumulatingId||te!==s.accumulatingId||s.isFinished()||(s.doRender(a),da.requestAnimationFrame(function(){X(te)}))};this.accumulatingId=pE++,this.timer=da.setTimeout(function(){Z(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,f=this.rendererService,v=f.clear,m=f.getViewportSize,x=f.useFramebuffer,C=m(),A=C.width,O=C.height,D=a.getLayerConfig(),Z=D.jitterScale,X=Z===void 0?1:Z,te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((te[0]*2-1)/A*X,(te[1]*2-1)/O*X),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Ee=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Ee.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Ue=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ue,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,da.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,f){this.shaderModuleService.registerModule(a,{vs:hE,fs:s});var v=this.shaderModuleService.getModule(a),m=v.vs,x=v.fs,C=v.uniforms,A=this.rendererService,O=A.createAttribute,D=A.createBuffer,Z=A.createModel;return Z(Ug({vs:m,fs:x,attributes:{a_Position:O({buffer:D({data:[-4,-4,4,-4,0,4],type:W.FLOAT}),size:2})},uniforms:Ug({},C),depth:{enable:!1},count:3},f))}}]),r}(Kv),Ng=tt(N0.prototype,"shaderModuleService",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0))||Bg),uv=new nt.W2;uv.bind(Be.IGlobalConfigService).to(je).inSingletonScope(),(0,nt.GW)((0,nt.b2)(),$o.EventEmitter),uv.bind(Be.IEventEmitter).to($o.EventEmitter);var Vg=(0,yr.Z)(uv,!1),z0=function(i){var r=Vg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},A4=function(i){var r=Vg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},rc=uv,vE=0;function mE(){var e=new nt.W2;return e.parent=uv,e.bind(Be.SceneID).toConstantValue("".concat(vE++)),e.bind(Be.IShaderModuleService).to(Jb).inSingletonScope(),e.bind(Be.ILayerService).to(Dv).inSingletonScope(),e.bind(Be.ISceneService).to(Lb).inSingletonScope(),e.bind(Be.ICameraService).to(Ov).inSingletonScope(),e.bind(Be.ICoordinateSystemService).to(ad).inSingletonScope(),e.bind(Be.IInteractionService).to(Ap).inSingletonScope(),e.bind(Be.IPickingService).to(k0).inSingletonScope(),e.bind(Be.IControlService).to(t).inSingletonScope(),e.bind(Be.IMarkerService).to(p).inSingletonScope(),e.bind(Be.IIconService).to(ri).inSingletonScope(),e.bind(Be.IFontService).to(Qo).inSingletonScope(),e.bind(Be.IPopupService).to(S).inSingletonScope(),e.bind(Be.INormalPass).to(r2).whenTargetNamed("clear"),e.bind(Be.INormalPass).to(u2).whenTargetNamed("pixelPicking"),e.bind(Be.INormalPass).to(uE).whenTargetNamed("render"),e.bind(Be.INormalPass).to(dE).whenTargetNamed("taa"),e.bind(Be.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Be.INormalPass,r)}}),e.bind(Be.IPostProcessingPass).to(N2).whenTargetNamed("copy"),e.bind(Be.IPostProcessingPass).to(y2).whenTargetNamed("bloom"),e.bind(Be.IPostProcessingPass).to(S2).whenTargetNamed("blurH"),e.bind(Be.IPostProcessingPass).to(M2).whenTargetNamed("blurV"),e.bind(Be.IPostProcessingPass).to(J2).whenTargetNamed("noise"),e.bind(Be.IPostProcessingPass).to(iE).whenTargetNamed("sepia"),e.bind(Be.IPostProcessingPass).to(L2).whenTargetNamed("colorHalftone"),e.bind(Be.IPostProcessingPass).to(V2).whenTargetNamed("hexagonalPixelate"),e.bind(Be.IPostProcessingPass).to(Y2).whenTargetNamed("ink"),e.bind(Be.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Be.IPostProcessingPass,r);return n.setName(r),n}}),e}function lv(e){var i=new nt.W2;return i.parent=e,i.bind(Be.IStyleAttributeService).to(Uv).inSingletonScope(),i.bind(Be.IMultiPassRenderer).to(a2).inSingletonScope(),i.bind(Be.IPostProcessor).to(aE).inSingletonScope(),i}var w4=N(74691),gE=null;function T4(e){return gE.indexOf(e)}var yE=2,M4=4,_E=64,P4=128,xE=256,bE=512,I4=8192,O4=16384,R4=32768,EE=null,Gg=131072,L4=262144,SE=524288,k4=1048576,CE=2097152,D4=4194304,AE=8388608,wE=16777216,TE=null;function $v(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function F4(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,f=e.opacity,v=e.stroke,m=e.strokeWidth,x=e.strokeOpacity,C=[],A=[],O=[],D=[$v(i[0],i[1]),$v(i[2],i[3])],Z=[$v(v[0],v[1]),$v(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(X){var te=_slicedToArray(X,2),Ee=te[0],Ue=te[1];C.push([].concat(D,[(Ee+1)*AE+(Ue+1)*CE+getShapeIndex(s)*Gg+r,(n+512)*SE+(a+512)*_E])),A.push([].concat(Z,[m,x])),O.push([f,0,0,0])}),{packedBuffer:C,packedBuffer2:A,packedBuffer3:O}}function B4(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*TE+r*wE+n*Gg+r*EE+n*bE+r*xE+n*yE+r}var Tc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Tc||(Tc={}));var To;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(To||(To={}));var qh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(qh||(qh={}));var wn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(wn||(wn={}));var ME=["mapload","mapchange","mapAfterFrameChange"],Fp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},U0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Kh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Kh||(Kh={}));function Hg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function PE(e){var i=IE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function IE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OE=0,Qv=function(e){(0,Yr.Z)(r,e);var i=PE(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this),(0,I.Z)((0,ae.Z)(a),"controlOption",void 0),(0,I.Z)((0,ae.Z)(a),"container",void 0),(0,I.Z)((0,ae.Z)(a),"sceneContainer",void 0),(0,I.Z)((0,ae.Z)(a),"mapsService",void 0),(0,I.Z)((0,ae.Z)(a),"renderService",void 0),(0,I.Z)((0,ae.Z)(a),"layerService",void 0),(0,I.Z)((0,ae.Z)(a),"controlService",void 0),(0,I.Z)((0,ae.Z)(a),"isShow",void 0),a.controlOption=Wg(Wg({},a.getDefault()),n||{}),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{position:Kh.TOPRIGHT,name:"".concat(OE++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Kh.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Be.IMapService),this.renderService=a.get(Be.IRendererService),this.layerService=a.get(Be.ILayerService),this.controlService=a.get(Be.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,f=this.controlOption.position,v=this.controlService.controlCorners[f];return Us(s,"l7-control"),f.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Us(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;fu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;oo(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}($o.EventEmitter);function RE(e){var i=LE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function LE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N4=function(e){(0,Yr.Z)(r,e);var i=RE(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,ae.Z)(a),"layerControlInputs",void 0),(0,I.Z)((0,ae.Z)(a),"layers",void 0),(0,I.Z)((0,ae.Z)(a),"lastZIndex",void 0),(0,I.Z)((0,ae.Z)(a),"handlingClick",void 0),(0,I.Z)((0,ae.Z)(a),"layersLink",void 0),(0,I.Z)((0,ae.Z)(a),"baseLayersList",void 0),(0,I.Z)((0,ae.Z)(a),"separator",void 0),(0,I.Z)((0,ae.Z)(a),"overlaysList",void 0),(0,I.Z)((0,ae.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),Nt(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ae.Z)(a)),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Kh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Us(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var f=s-(this.container.offsetTop+50);return f<this.form.clientHeight?(Us(this.form,"l7-control-layers-scrollbar"),this.form.style.height=f+"px"):fu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return fu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=ca("div",a),f=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=ca("form",a+"-list");f&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=ca("a",a+"-toggle",s);var m=this.layersLink;m.title="Layers",f||this.expand(),this.baseLayersList=ca("div",a+"-base",v),this.separator=ca("div",a+"-separator",v),this.overlaysList=ca("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,f=s.baseLayers,v=f===void 0?{}:f,m=s.overlayers,x=m===void 0?{}:m;Object.keys(v).forEach(function(C,A){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,A){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;On(this.baseLayersList),On(this.overlaysList),this.layerControlInputs=[];var a,s,f,v,m=0;for(f=0;f<this.layers.length;f++)v=this.layers[f],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,m+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&m>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,f,v=this.mapsService.getZoom(),m=a.length-1;m>=0;m--)if(s=a[m],f=this.layerService.getLayer(s.layerId),f&&f.inited){var x=f.getMinZoom(),C=f.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,f){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:f});var v=this.controlOption,m=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;m&&this.layers.sort(function(A,O){return x(A.layer,O.layer,A.name,O.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),f=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;f&&this.emit(f,s)}},{key:"createRadioElement",value:function(a,s){var f='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=f,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),f=this.layerService.getLayer(a.layer.id),v=f&&f.inited&&a.layer.isVisible(),m;a.overlay?(m=document.createElement("input"),m.type="checkbox",m.className="l7-control-layers-selector",m.defaultChecked=v):m=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(m),m.layerId=a.layer.id,m.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(m),C.appendChild(x);var A=a.overlay?this.overlaysList:this.baseLayersList;return A.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,f,v=[],m=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],f=this.layerService.getLayer(s.layerId),s.checked?v.push(f):s.checked||m.push(f);m.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(Qv);function kE(e){var i=DE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function DE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FE=function(e){(0,Yr.Z)(r,e);var i=kE(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{position:Kh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=ca("div",a),f=ca("a","l7-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://antv.alipay.com/l7",f.setAttribute("aria-label","AntV logo"),f.setAttribute("rel","noopener nofollow"),s.appendChild(f),s}},{key:"onRemove",value:function(){return null}}]),r}(Qv);function BE(e){var i=NE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function NE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z4=function(e){(0,Yr.Z)(r,e);var i=BE(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,ae.Z)(a),"mScale",void 0),(0,I.Z)((0,ae.Z)(a),"iScale",void 0),Nt(["update"],(0,ae.Z)(a)),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{position:Kh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=ca("div",a);this.addScales(a+"-line",s);var f=this.controlOption.updateWhenIdle;return this.mapsService.on(f?"moveend":"mapmove",this.update),this.mapsService.on(f?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,f=a.getSize()[1]/2,v=a.containerToLngLat([0,f]),m=a.containerToLngLat([s,f]),x=U([v.lng,v.lat],[m.lng,m.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,f=s.metric,v=s.imperial;f&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),f=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,f,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,f,v,m;s>5280?(f=s/5280,v=this.getRoundNum(f),this.updateScale(this.iScale,v+" mi",v/f)):(m=this.getRoundNum(s),this.updateScale(this.iScale,m+" ft",m/s))}},{key:"updateScale",value:function(a,s,f){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*f)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),f=a/s;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,s*f}},{key:"addScales",value:function(a,s){var f=this.controlOption,v=f.metric,m=f.imperial;v&&(this.mScale=ca("div",a,s)),m&&(this.iScale=ca("div",a,s))}}]),r}(Qv);function zE(e){var i=UE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function UE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U4=function(e){(0,Yr.Z)(r,e);var i=zE(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,ae.Z)(a),"disabled",void 0),(0,I.Z)((0,ae.Z)(a),"zoomInButton",void 0),(0,I.Z)((0,ae.Z)(a),"zoomOutButton",void 0),Nt(["updateDisabled","zoomIn","zoomOut"],(0,ae.Z)(a)),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{position:Kh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=ca("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,f,v,m){var x=ca("a",f,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",m),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";fu(this.zoomInButton,s),fu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Us(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Us(this.zoomInButton,s)}}]),r}(Qv);function Xg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZE(e){var i=jE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qg=function(e){(0,Yr.Z)(r,e);var i=ZE(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this),(0,I.Z)((0,ae.Z)(a),"markerOption",void 0),(0,I.Z)((0,ae.Z)(a),"defaultMarker",void 0),(0,I.Z)((0,ae.Z)(a),"popup",void 0),(0,I.Z)((0,ae.Z)(a),"mapsService",void 0),(0,I.Z)((0,ae.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,ae.Z)(a),"lngLat",void 0),(0,I.Z)((0,ae.Z)(a),"scene",void 0),(0,I.Z)((0,ae.Z)(a),"added",!1),(0,I.Z)((0,ae.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Yg(Yg({},a.getDefault()),n),Nt(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ae.Z)(a)),a.init(),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Fn.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Be.IMapService),this.sceneSerive=a.get(Be.ISceneService);var s=this.markerOption,f=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(f),this.registerMarkerEvent(f),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&oo(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var f=this.markerOption.element;return f&&oo(f),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.anchor;this.updatePosition(),pc(s,"".concat(Ai[f]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.offsets,v=this.lngLat,m=v.lng,x=v.lat,C=this.mapsService.getBounds(),A=this.mapsService.lngLatToContainer([m,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var O=this.mapsService.getContainer(),D=0,Z=0;if(O&&(D=O.scrollWidth,Z=O.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(A.x>D){var X=this.mapsService.lngLatToContainer([m-360,x]);A.x=X.x}if(A.x<0){var te=this.mapsService.lngLatToContainer([m+360,x]);A.x=te.x}}(A.x>D||A.x<0||A.y>Z||A.y<0)&&(s.style.display="none"),s.style.left=A.x+f[0]+"px",s.style.top=A.y-f[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,f=this.markerOption,v=f.color,m=f.anchor;if(!s){this.defaultMarker=!0,s=ca("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}Us(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(A){var O,D,Z=((O=a.markerOption)===null||O===void 0?void 0:O.style)&&((D=a.markerOption)===null||D===void 0?void 0:D.style[A]);s&&(s.style[A]=Z)}),s.addEventListener("click",function(A){a.onMapClick(A)}),s.addEventListener("click",this.eventHandle),un(s,m,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}($o.EventEmitter);function Kg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $g(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VE(e){var i=GE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z4=function(e){(0,Yr.Z)(r,e);var i=VE(r);function r(n){var a,s;return(0,lt.Z)(this,r),s=i.call(this),(0,I.Z)((0,ae.Z)(s),"markers",[]),(0,I.Z)((0,ae.Z)(s),"markerLayerOption",void 0),(0,I.Z)((0,ae.Z)(s),"clusterIndex",void 0),(0,I.Z)((0,ae.Z)(s),"points",[]),(0,I.Z)((0,ae.Z)(s),"clusterMarkers",[]),(0,I.Z)((0,ae.Z)(s),"mapsService",void 0),(0,I.Z)((0,ae.Z)(s),"scene",void 0),(0,I.Z)((0,ae.Z)(s),"zoom",void 0),(0,I.Z)((0,ae.Z)(s),"bbox",void 0),s.markerLayerOption=k()(s.getDefault(),n),Nt(["update"],(0,ae.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Be.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var f=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=oe(v,.5),this.zoom=Math.floor(f),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var f=a.getLnglat(),v=f.lng,m=f.lat,x={geometry:{type:"Point",coordinates:[v,m]},properties:$g($g({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,f=a.minZoom,v=f===void 0?0:f,m=a.maxZoom;this.clusterIndex=new(Qp())({radius:s,minZoom:v,maxZoom:m}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var f=this,v=a[0].concat(a[1]),m=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],m.forEach(function(x){var C,A=f.markerLayerOption.clusterOption,O=A.field,D=A.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var Z,X=f.getLeaves((Z=x.properties)===null||Z===void 0?void 0:Z.cluster_id);if(x.properties.clusterData=X,O&&D){var te=X==null?void 0:X.map(function(St){var bt=(0,I.Z)({},O,St.properties[O]);return bt}),Ee=Ks(te,O),Ue=Cu(D,Ee),Qe="point_"+D;x.properties[Qe]=Ue.toFixed(2)}}var ct=f.clusterMarker(x);f.clusterMarkers.push(ct),ct.addTo(f.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,f):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,f=s,v=f.element,m=v===void 0?this.generateElement.bind(this):v,x=new qg({element:m(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!fe(this.bbox,s))&&(this.bbox=oe(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=ca("div","l7-marker-cluster"),f=ca("div","",s),v=ca("span","",f),m=this.markerLayerOption.clusterOption,x=m.field,C=m.method;a.properties.point_count=a.properties.point_count||1;var A=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=A,s}}]),r}($o.EventEmitter);function Qg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function HE(e){var i=WE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function WE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ey=function(e){(0,Yr.Z)(r,e);var i=HE(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this),(0,I.Z)((0,ae.Z)(a),"popupOption",void 0),(0,I.Z)((0,ae.Z)(a),"mapsService",void 0),(0,I.Z)((0,ae.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,ae.Z)(a),"lngLat",void 0),(0,I.Z)((0,ae.Z)(a),"content",void 0),(0,I.Z)((0,ae.Z)(a),"closeButton",void 0),(0,I.Z)((0,ae.Z)(a),"timeoutInstance",void 0),(0,I.Z)((0,ae.Z)(a),"container",void 0),(0,I.Z)((0,ae.Z)(a),"tip",void 0),(0,I.Z)((0,ae.Z)(a),"scene",void 0),a.popupOption=Jg(Jg({},a.getdefault()),n),Nt(["update","onClickClose","remove"],(0,ae.Z)(a)),a}return(0,Ct.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Be.IMapService),this.sceneSerive=a.get(Be.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),f=window.document.createElement("body"),v;for(f.innerHTML=a;v=f.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&oo(this.content),this.content=ca("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=ca("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,f){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),f&&f.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Fn.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,f=this.popupOption,v=f.className,m=f.maxWidth,x=f.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(O){return a.container.classList.add(O)});var A=this.popupOption.stopPropagation;A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){a.container.addEventListener(O,function(D){D.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}m&&this.container.style.maxWidth!==m&&(this.container.style.maxWidth=m),this.updatePosition(),pc(this.container,"".concat(Ai[x])),un(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,f=a.lat,v=this.popupOption.offsets,m=this.mapsService.lngLatToContainer([s,f]);this.container.style.left=m.x+v[0]+"px",this.container.style.top=m.y-v[1]+"px"}}}]),r}($o.EventEmitter);function XE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}XE(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var YE=N(52353),qE=N.n(YE),KE=N(13218),Vu=N.n(KE),$h,ty=($h={},(0,I.Z)($h,Tc.additive,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)($h,Tc.none,{enable:!1}),(0,I.Z)($h,Tc.normal,{enable:!0,func:{srcRGB:W.SRC_ALPHA,dstRGB:W.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)($h,Tc.subtractive,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE,srcAlpha:W.ZERO,dstAlpha:W.ONE_MINUS_SRC_COLOR},equation:{rgb:W.FUNC_SUBTRACT,alpha:W.FUNC_SUBTRACT}}),(0,I.Z)($h,Tc.max,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE},equation:{rgb:W.MAX_EXT}}),(0,I.Z)($h,Tc.min,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE},equation:{rgb:W.MIN_EXT}}),$h),$E=N(81763),Gu=N.n($E),j4=1024;function yl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function QE(e,i){e.opacity&&Jv("opacity",i,e.opacity),e.strokeWidth&&Jv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Jv("strokeOpacity",i,e.strokeOpacity),e.stroke&&JE("stroke",i,e.stroke),e.offsets&&ry("offsets",i,e.offsets),e.textOffset&&ry("textOffset",i,e.textOffset),e.thetaOffset&&Jv("thetaOffset",i,e.thetaOffset)}function Jv(e,i,r){ws()(r)?yl(e,i,r,function(n){return n}):Gu()(r)?yl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?ws()(r[0])&&Rl()(r[1])||ws()(r[0])&&Array.isArray(r[1])&&Gu()(r[1][0])&&Gu()(r[1][1])?yl(e,i,r[0],r[1]):yl(e,i,[1],void 0):yl(e,i,[1],void 0)}function ry(e,i,r){ws()(r)?yl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&ws()(r[0])&&Rl()(r[1])?yl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&Gu()(r[0])&&Gu()(r[1])?yl(e,i,r,void 0):yl(e,i,[0,0],void 0)}function JE(e,i,r){ws()(r)?yl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(ws()(r[0])&&Rl()(r[1])||ws()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?yl(e,i,r[0],r[1]):yl(e,i,"#fff",void 0)}var Ls;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Ls||(Ls={}));function eS(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=Re(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function tS(e,i){var r=this;e.length>0&&i.version===Ls["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Ls["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Ls["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function rS(e,i){e.length>0&&i.version===Ls.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=nS(r.coordinates,i),r.simpleCoordinate=!0)})}function nS(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(f){s.push(i.simpleMapCoord.unproject(f))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function iS(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var m,x=v.field;(i.hasOwnProperty(x)||((m=e.scale)===null||m===void 0?void 0:m.type)==="variable")&&s.push(i[x])});var f=e.mapping?e.mapping(s):[];return e.name==="color"&&!Dr(f[0])?[r]:f}function aS(e,i,r,n,a,s){var f=s==null?void 0:s.getLayerConfig(),v=f.arrow,m=v===void 0?{enable:!1}:v,x=i.map(function(C){var A={id:C._id,coordinates:C.coordinates};if(e.filter(function(Z){return Z.scale!==void 0}).forEach(function(Z){var X=iS(Z,C,a);Z.needRemapping=!1,Z.name==="color"&&(X=X.map(function(te){return sr(te)})),A[Z.name]=Array.isArray(X)&&X.length===1?X[0]:X,Z.name==="shape"&&(A.shape=r.getIconFontKey(A[Z.name]))}),A.shape==="line"&&m.enable){var O=A.coordinates,D=eS(O[0],O[1]);A.coordinates.splice(1,0,D,D)}return A});return tS(x,n),rS(x,n),x}function oS(e,i,r,n,a,s){var f=new Dt(a,s),v=e.getBottomColor(),m=n.getLayerStyleAttributes()||[],x=f.data.dataArray,C=x,A=aS(m,C,i,r,v,e);return f.destroy(),A}function ny(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function iy(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),ny(i).forEach(function(m){var x=(0,Q.Z)(m,2),C=x[0],A=x[1];a.add(r(C),A)}),a.add(r("copy")),a}var sS=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function uS(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}sS.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var lS=["passes"],cS=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],ay,Z0,oy;function fS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=hS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function hS(e,i){if(!!e){if(typeof e=="string")return sy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sy(e,i)}}function sy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function uy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?uy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pS(e){var i=dS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function dS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ly=0,Qh=(ay=z0(Be.IGlobalConfigService),Z0=function(e){(0,Yr.Z)(r,e);var i=pS(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,ae.Z)(n),"id","".concat(ly++)),(0,I.Z)((0,ae.Z)(n),"name","".concat(ly)),(0,I.Z)((0,ae.Z)(n),"type",void 0),(0,I.Z)((0,ae.Z)(n),"visible",!0),(0,I.Z)((0,ae.Z)(n),"zIndex",0),(0,I.Z)((0,ae.Z)(n),"minZoom",void 0),(0,I.Z)((0,ae.Z)(n),"maxZoom",void 0),(0,I.Z)((0,ae.Z)(n),"inited",!1),(0,I.Z)((0,ae.Z)(n),"layerModelNeedUpdate",!1),(0,I.Z)((0,ae.Z)(n),"pickedFeatureID",null),(0,I.Z)((0,ae.Z)(n),"selectedFeatureID",null),(0,I.Z)((0,ae.Z)(n),"styleNeedUpdate",!1),(0,I.Z)((0,ae.Z)(n),"rendering",void 0),(0,I.Z)((0,ae.Z)(n),"clusterZoom",0),(0,I.Z)((0,ae.Z)(n),"layerType",void 0),(0,I.Z)((0,ae.Z)(n),"isLayerGroup",!1),(0,I.Z)((0,ae.Z)(n),"triangulation",void 0),(0,I.Z)((0,ae.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,ae.Z)(n),"hooks",{init:new Fh,afterInit:new Fh,beforeRender:new Fh,beforeRenderData:new Dh,afterRender:new vu,beforePickingEncode:new vu,afterPickingEncode:new vu,beforeHighlight:new vu(["pickedColor"]),afterHighlight:new vu,beforeSelect:new vu(["pickedColor"]),afterSelect:new vu,beforeDestroy:new vu,afterDestroy:new vu}),(0,I.Z)((0,ae.Z)(n),"models",[]),(0,I.Z)((0,ae.Z)(n),"multiPassRenderer",void 0),(0,I.Z)((0,ae.Z)(n),"plugins",void 0),(0,I.Z)((0,ae.Z)(n),"sourceOption",void 0),(0,I.Z)((0,ae.Z)(n),"layerModel",void 0),(0,I.Z)((0,ae.Z)(n),"shapeOption",void 0),(0,I.Z)((0,ae.Z)(n),"sceneContainer",void 0),(0,I.Z)((0,ae.Z)(n),"layerChildren",[]),(0,I.Z)((0,ae.Z)(n),"masks",[]),He((0,ae.Z)(n),"configService",oy,(0,ae.Z)(n)),(0,I.Z)((0,ae.Z)(n),"shaderModuleService",void 0),(0,I.Z)((0,ae.Z)(n),"cameraService",void 0),(0,I.Z)((0,ae.Z)(n),"coordinateService",void 0),(0,I.Z)((0,ae.Z)(n),"iconService",void 0),(0,I.Z)((0,ae.Z)(n),"fontService",void 0),(0,I.Z)((0,ae.Z)(n),"pickingService",void 0),(0,I.Z)((0,ae.Z)(n),"rendererService",void 0),(0,I.Z)((0,ae.Z)(n),"layerService",void 0),(0,I.Z)((0,ae.Z)(n),"interactionService",void 0),(0,I.Z)((0,ae.Z)(n),"mapService",void 0),(0,I.Z)((0,ae.Z)(n),"styleAttributeService",void 0),(0,I.Z)((0,ae.Z)(n),"layerSource",void 0),(0,I.Z)((0,ae.Z)(n),"postProcessingPassFactory",void 0),(0,I.Z)((0,ae.Z)(n),"normalPassFactory",void 0),(0,I.Z)((0,ae.Z)(n),"animateOptions",{enable:!1}),(0,I.Z)((0,ae.Z)(n),"container",void 0),(0,I.Z)((0,ae.Z)(n),"encodedData",void 0),(0,I.Z)((0,ae.Z)(n),"configSchema",void 0),(0,I.Z)((0,ae.Z)(n),"currentPickId",null),(0,I.Z)((0,ae.Z)(n),"rawConfig",void 0),(0,I.Z)((0,ae.Z)(n),"needUpdateConfig",void 0),(0,I.Z)((0,ae.Z)(n),"pendingStyleAttributes",[]),(0,I.Z)((0,ae.Z)(n),"scaleOptions",{}),(0,I.Z)((0,ae.Z)(n),"animateStartTime",void 0),(0,I.Z)((0,ae.Z)(n),"aniamateStatus",!1),(0,I.Z)((0,ae.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,I.Z)((0,ae.Z)(n),"isDestroied",!1),(0,I.Z)((0,ae.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Ct.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Hu(Hu({},this.needUpdateConfig),a);else{var s=this.container.get(Be.SceneID);QE(a,this),this.configService.setLayerConfig(s,this.id,Hu(Hu(Hu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Be.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Be.IIconService),this.fontService=this.container.get(Be.IFontService),this.rendererService=this.container.get(Be.IRendererService),this.layerService=this.container.get(Be.ILayerService),this.interactionService=this.container.get(Be.IInteractionService),this.pickingService=this.container.get(Be.IPickingService),this.mapService=this.container.get(Be.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,m=f.passes;v&&m!==null&&m!==void 0&&m.length&&m.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Be.ICameraService),this.coordinateService=this.container.get(Be.ICoordinateSystemService),this.shaderModuleService=this.container.get(Be.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Be.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Be.IFactoryNormalPass),this.styleAttributeService=this.container.get(Be.IStyleAttributeService),this.multiPassRenderer=this.container.get(Be.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var D=O.attributeName,Z=O.attributeField,X=O.attributeValues,te=O.updateOptions;a.styleAttributeService.updateStyleAttribute(D,{scale:Hu({field:Z},a.splitValuesAndCallbackInAttribute(X,a.getLayerConfig()[D]))},te)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Be.ILayerPlugin);var x=fS(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var A=C.value;A.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var f=this.calculateEncodeData(a,s),v=this.triangulation;return f&&v?this.styleAttributeService.createAttributesAndIndices(f,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?oS(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Hu(Hu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,m,x,C=(v=this.styleAttributeService)===null||v===void 0||(m=v.getLayerStyleAttribute("shape"))===null||m===void 0||(x=m.scale)===null||x===void 0?void 0:x.field,A=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),uS(this,C,A),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return Vu()(a)?(s.enable=!0,s=Hu(Hu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new Dt(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,m=(0,dh.Z)(a,lS);return v&&ny(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=Hu(Hu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Vu()(a)?this.scaleOptions=Hu(Hu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,qi.Z)(ni().mark(function s(){return ni().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Vu()(a)?!0:a,Vu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(Vu()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Vu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Vu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:m,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Vu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Vu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Rn(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Vu()(a)?!0:a,Vu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(Vu()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Vu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Vu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:m,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Vu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Vu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Rn(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,m=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!f&&a>=m&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,m=v===void 0?[]:v;this.multiPassRenderer=iy(this,m,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,A=x.height;this.multiPassRenderer.resize(C,A)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(m){return Math.abs(m)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,I.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,I.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var m=s.domain().filter(function(x){return!qE()(x)}).map(function(x){return(0,I.Z)({value:x},a,s(x))});return m}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,m=a.triangulation,x=a.segmentNumber,C=(0,dh.Z)(a,cS);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var A=this.shaderModuleService.getModule(s),O=A.vs,D=A.fs,Z=A.uniforms,X=this.rendererService.createModel,te=this.styleAttributeService.createAttributesAndIndices(this.encodedData,m,x),Ee=te.attributes,Ue=te.elements;return X(Hu({attributes:Ee,uniforms:Z,fs:D,vs:O,elements:Ue,blend:ty[Tc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,m=s.enableSelect,x=m===void 0?!0:m,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,qi.Z)(ni().mark(function s(f){return ni().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,f.render();case 2:case"end":return m.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Hu({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:Rl()(a)?void 0:a||s,callback:Rl()(a)?a:void 0}}}]),r}($o.EventEmitter),oy=tt(Z0.prototype,"configService",[ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z0),vS=N(18446),bd=N.n(vS),cy,j0,fy;function mS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function gS(e,i){if(!!e){if(typeof e=="string")return hy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hy(e,i)}}function hy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var co=(cy=z0(Be.IGlobalConfigService),j0=function(){function e(i){(0,lt.Z)(this,e),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),He(this,"configService",fy,this),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Be.IRendererService),this.shaderModuleService=i.getContainer().get(Be.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Be.IStyleAttributeService),this.mapService=i.getContainer().get(Be.IMapService),this.iconService=i.getContainer().get(Be.IIconService),this.fontService=i.getContainer().get(Be.IFontService),this.cameraService=i.getContainer().get(Be.ICameraService),this.layerService=i.getContainer().get(Be.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:W.NEAREST,min:W.NEAREST,width:1,height:1}))}return(0,Ct.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return bd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),bd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),bd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),bd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),bd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),bd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Gu()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Gu()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Gu()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Gu()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return ws()(r)?!!(0,mr.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=sr(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&Gu()(r[0])&&Gu()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=mS(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,m=v.attr,x=v.count,C=n[m];C!==void 0?m==="stroke"?r.push.apply(r,(0,ir.Z)(sr(C))):m==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(Gu()(C)?C:1):this.patchMod(r,x)}}catch(A){s.e(A)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,m=[],x=0;x<s;x++){var C=n[x];this.patchData(m,C,a)}for(var A=m.length;A<v;A++)m.push(-1);return{data:m,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return ty[Tc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),fy=tt(j0.prototype,"configService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j0),yS=N(9187),Nf=N.n(yS),py=100,V4=36,G4=40;function dy(e){return e/180*Math.acos(-1)}function vy(e){var i=dy(e[0])+Math.PI/2,r=dy(e[1]),n=py+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),f=n*Math.sin(r);return[s,f,a]}function H4(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var f=typeof i.segments!="undefined"?i.segments:32,v=2+f,m=2*v,x=[],C=[],A=[],O=[],D=[],Z=[],X=0;X<=v;X++){for(var te=X/v,Ee=te*Math.PI,Ue=0;Ue<=m;Ue++){var Qe=Ue/m,ct=Qe*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Ee),mat4.identity(r),mat4.rotateY(r,r,ct),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),A.push(s.slice()),O.push.apply(O,_toConsumableArray(s.slice())),vec3.normalize(s,s),D.push.apply(D,_toConsumableArray(s.slice())),Z.push([Qe,1-te]),O.push(Qe,1-te)}if(X>0)for(var St=A.length,bt=St-2*(m+1);bt+m+2<St;bt++)x.push([bt,bt+1,bt+m+1]),C.push(bt,bt+1,bt+m+1),x.push([bt+m+1,bt+1,bt+m+2]),C.push(bt+m+1,bt+1,bt+m+2)}return{cells:x,positions:A,uvs:Z,positionsArr:O,indicesArr:C,normalArr:D}}var gi=N(31437),e0=gi.Ue(),W4=gi.Ue(),Ws=gi.Ue(),Jh=gi.Ue(),Ed=gi.Ue();function V0(e,i,r,n,a){gi.IH(e,r,n),gi.Fv(e,e),i=gi.al(-e[1],e[0]);var s=gi.al(-r[1],r[0]);return[a/gi.AK(i,s),i]}function ep(e,i){return gi.t8(e,-i[1],i[0])}function Sd(e,i,r){return gi.lu(e,i,r),gi.Fv(e,e),e}function G0(e,i){return e[0]===i[0]&&e[1]===i[1]}function X4(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var gy=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,lt.Z)(this,e),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",gi.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),(0,I.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Ct.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var m,x,C,A=r[v-1];A.push((m=n[v-1][2])!==null&&m!==void 0?m:0);var O=n[v-1],D=r[v];D.push((x=n[v][2])!==null&&x!==void 0?x:0);var Z=n[v],X=v<r.length-1?[].concat((0,ir.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Ee=this.segment_gaode2(a,f,A,D,X,O,Z,te);f+=Ee}if(this.dash)for(var Ue=0;Ue<a.positions.length/6;Ue++)a.positions[Ue*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var m,x,C,A=r[v-1];A.push((m=n[v-1][2])!==null&&m!==void 0?m:0);var O=n[v-1],D=r[v];D.push((x=n[v][2])!==null&&x!==void 0?x:0);var Z=n[v],X=v<r.length-1?[].concat((0,ir.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Ee=this.simpleSegment(a,f,A,D,X,O,Z,te);f+=Ee}if(this.dash)for(var Ue=0;Ue<a.positions.length/6;Ue++)a.positions[Ue*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],m=r[f],x=f<r.length-1?r[f+1]:null,C=this.segment(n,s,v,m,x);s+=C}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],m=r[f],x=f<r.length-1?r[f+1]:null,C=this.simpleSegment(n,s,v,m,x);s+=C}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,f,v,m,x){var C=0,A=r.indices,O=r.positions,D=r.normals,Z=this.cap==="square",X=this.join==="bevel",te=w([m[0],m[1]]),Ee=w([v[0],v[1]]);Sd(Ws,s,a);var Ue=0;if(this.dash&&(Ue=this.lineSegmentDistance(te,Ee),this.totalDistance+=Ue),this.normal||(this.normal=gi.Ue(),ep(this.normal,Ws)),!this.started)if(this.started=!0,Z){var Qe=gi.Ue(),ct=gi.Ue();gi.IH(Qe,this.normal,Ws),gi.IH(ct,this.normal,Ws),D.push(ct[0],ct[1],0),D.push(Qe[0],Qe[1],0),O.push(a[0],a[1],a[2]|0,this.totalDistance-Ue,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),O.push(a[0],a[1],a[2]|0,this.totalDistance-Ue,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,D,a,this.normal,this.thickness,this.totalDistance-Ue);if(A.push(n+0,n+1,n+2),f){G0(s,f)&&gi.IH(f,s,gi.Fv(f,gi.$X(f,s,a))),Sd(Jh,f,s);var Kt=V0(Ed,gi.Ue(),Ws,Jh,this.thickness),lr=(0,Q.Z)(Kt,2),Mr=lr[0],Xr=lr[1],_r=gi.AK(Ed,this.normal)<0?-1:1,on=X;if(!on&&this.join==="miter"){var Ln=Mr;Ln>this.miterLimit&&(on=!0)}on?(D.push(this.normal[0],this.normal[1],0),D.push(Xr[0],Xr[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*_r,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*_r,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push.apply(A,(0,ir.Z)(this.lastFlip!==-_r?[n,n+2,n+3]:[n+2,n+1,n+3])),A.push(n+2,n+3,n+4),ep(e0,Jh),gi.JG(this.normal,e0),D.push(this.normal[0],this.normal[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*_r,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(O,D,s,Xr,Mr,this.totalDistance),A.push.apply(A,(0,ir.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_r=-1,gi.JG(this.normal,Xr),C+=2),this.lastFlip=_r}else{if(ep(this.normal,Ws),Z){var St=gi.Ue(),bt=gi.Ue();gi.lu(bt,Ws,this.normal),gi.IH(St,Ws,this.normal),D.push(bt[0],bt[1],0),D.push(St[0],St[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,D,s,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,ir.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,f){var v=0,m=r.indices,x=r.positions,C=r.normals,A=w([s[0],s[1]]),O=w([a[0],a[1]]);Sd(Ws,A,O);var D=0;if(this.dash&&(D=this.lineSegmentDistance(A,O),this.totalDistance+=D),this.normal||(this.normal=gi.Ue(),ep(this.normal,Ws)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-D)),m.push(n+0,n+1,n+2),!f)ep(this.normal,Ws),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),m.push.apply(m,(0,ir.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var Z=w([f[0],f[1]]);G0(A,Z)&&gi.IH(Z,A,gi.Fv(Z,gi.$X(Z,A,O))),Sd(Jh,Z,A);var X=V0(Ed,gi.Ue(),Ws,Jh,this.thickness),te=(0,Q.Z)(X,2),Ee=te[0],Ue=te[1],Qe=gi.AK(Ed,this.normal)<0?-1:1;this.extrusions(x,C,s,Ue,Ee,this.totalDistance),m.push.apply(m,(0,ir.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Qe=-1,gi.JG(this.normal,Ue),v+=2,this.lastFlip=Qe}return v}},{key:"segment",value:function(r,n,a,s,f){var v=0,m=r.indices,x=r.positions,C=r.normals,A=this.cap==="square",O=this.join==="bevel",D=w([s[0],s[1]]),Z=w([a[0],a[1]]);Sd(Ws,D,Z);var X=0;if(this.dash&&(X=this.lineSegmentDistance(D,Z),this.totalDistance+=X),this.normal||(this.normal=gi.Ue(),ep(this.normal,Ws)),!this.started)if(this.started=!0,A){var te=gi.Ue(),Ee=gi.Ue();gi.IH(te,this.normal,Ws),gi.IH(Ee,this.normal,Ws),C.push(Ee[0],Ee[1],0),C.push(te[0],te[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-X);if(m.push(n+0,n+1,n+2),f){var ct=w([f[0],f[1]]);G0(D,ct)&&gi.IH(ct,D,gi.Fv(ct,gi.$X(ct,D,Z))),Sd(Jh,ct,D);var St=V0(Ed,gi.Ue(),Ws,Jh,this.thickness),bt=(0,Q.Z)(St,2),Kt=bt[0],lr=bt[1],Mr=gi.AK(Ed,this.normal)<0?-1:1,Xr=O;if(!Xr&&this.join==="miter"){var _r=Kt;_r>this.miterLimit&&(Xr=!0)}Xr?(C.push(this.normal[0],this.normal[1],0),C.push(lr[0],lr[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,m.push.apply(m,(0,ir.Z)(this.lastFlip!==-Mr?[n,n+2,n+3]:[n+2,n+1,n+3])),m.push(n+2,n+3,n+4),ep(e0,Jh),gi.JG(this.normal,e0),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,lr,Kt,this.totalDistance),m.push.apply(m,(0,ir.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Mr=-1,gi.JG(this.normal,lr),v+=2),this.lastFlip=Mr}else{if(ep(this.normal,Ws),A){var Ue=gi.Ue(),Qe=gi.Ue();gi.lu(Qe,Ws,this.normal),gi.IH(Ue,Ws,this.normal),C.push(Qe[0],Qe[1],0),C.push(Ue[0],Ue[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);m.push.apply(m,(0,ir.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,f,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-f,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,f,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Bp(e){if(Gu()(e[0]))return e;if(Gu()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Gu()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(f){r+=f[0],n+=f[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function _S(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,f=0,v=0,m=0;m<e.length;m+=2){var x=e[m],C=e[m+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,f+=C,v++)}return{center:[s/v,f/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Ha=N(77160);function xS(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Nf().flatten(e),s=a.vertices,f=a.dimensions,v=[],m=[],x=0;x<s.length/f;x++)f===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=Nf()(a.vertices,a.holes,a.dimensions);m.push.apply(m,(0,ir.Z)(C));for(var A=function(Z){var X=a.vertices.slice(Z*f,(Z+1)*f),te=a.vertices.slice((Z+1)*f,(Z+2)*f);te.length===0&&(te=a.vertices.slice(0,f));var Ee=v.length/3;v.push(X[0],X[1],1,te[0],te[1],1,X[0],X[1],0,te[0],te[1],0),m.push.apply(m,(0,ir.Z)([0,2,1,2,3,1].map(function(Ue){return Ue+Ee})))},O=0;O<n;O++)A(O);return{positions:v,index:m}}function bS(e){var i=Nf().flatten(e),r=Nf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function yy(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Nf().flatten(e),f=s.vertices,v=s.dimensions,m=[],x=[],C=[],A=0;A<f.length/v;A++)v===2?m.push(f[A*2],f[A*2+1],1,-1,-1):m.push(f[A*3],f[A*3+1],1,-1,-1),C.push(0,0,1);var O=Nf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,ir.Z)(O));for(var D=function(te){var Ee=s.vertices.slice(te*v,(te+1)*v),Ue=s.vertices.slice((te+1)*v,(te+2)*v);Ue.length===0&&(Ue=s.vertices.slice(0,v));var Qe=m.length/5;m.push(Ee[0],Ee[1],1,0,0,Ue[0],Ue[1],1,.1,0,Ee[0],Ee[1],0,0,.8,Ue[0],Ue[1],0,.1,.8);var ct=ES([Ue[0],Ue[1],1],[Ee[0],Ee[1],0],[Ee[0],Ee[1],1],i);C.push.apply(C,(0,ir.Z)(ct).concat((0,ir.Z)(ct),(0,ir.Z)(ct),(0,ir.Z)(ct))),x.push.apply(x,(0,ir.Z)([1,2,0,3,2,1].map(function(St){return St+Qe})))},Z=0;Z<a;Z++)D(Z);return{positions:m,index:x,normals:C}}function ES(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Ha.create(),s=Ha.create(),f=Ha.create();n&&(e=l(e),i=l(i),r=l(r));var v=Ha.fromValues.apply(Ha,(0,ir.Z)(e)),m=Ha.fromValues.apply(Ha,(0,ir.Z)(i)),x=Ha.fromValues.apply(Ha,(0,ir.Z)(r));Ha.sub(a,x,m),Ha.sub(s,v,m),Ha.cross(f,a,s);var C=Ha.create();return Ha.normalize(C,f),C}var Mc,Np;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Np||(Np={}));var zp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(zp||(zp={}));function cv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(f){var v=Math.sin(f+Math.PI/4),m=Math.cos(f+Math.PI/4);return[v,m,0]});return s}function _y(){return cv(30)}function xy(){return cv(4)}function by(){return cv(3)}function Ey(){return cv(6,1)}function Sy(){return cv(5)}var Cd=(Mc={},(0,I.Z)(Mc,zp.CIRCLE,_y),(0,I.Z)(Mc,zp.HEXAGON,Ey),(0,I.Z)(Mc,zp.TRIANGLE,by),(0,I.Z)(Mc,zp.SQUARE,xy),(0,I.Z)(Mc,zp.PENTAGON,Sy),(0,I.Z)(Mc,Np.CYLINDER,_y),(0,I.Z)(Mc,Np.HEXAGONCOLUMN,Ey),(0,I.Z)(Mc,Np.TRIANGLECOLUMN,by),(0,I.Z)(Mc,Np.SQUARECOLUMN,xy),(0,I.Z)(Mc,Np.PENTAGONCOLUMN,Sy),Mc),t0={};function Up(e){var i=Bp(e.coordinates);return{vertices:[].concat((0,ir.Z)(i),(0,ir.Z)(i),(0,ir.Z)(i),(0,ir.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Cy(e){var i=Bp(e.coordinates),r=vy(i);return{vertices:[].concat((0,ir.Z)(r),(0,ir.Z)(r),(0,ir.Z)(r),(0,ir.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Ay(e){var i=e.shape,r=wS(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function wy(e){var i=Bp(e.coordinates);return{vertices:(0,ir.Z)(i),indices:[0],size:i.length}}function fv(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new gy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.extrude_gaode2(m,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.extrude(O)})}var A=a.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,indexes:A.indexes,size:6}}function SS(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new gy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.simpleExtrude_gaode2(m,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.simpleExtrude(O)})}var A=a.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,size:6}}function r0(e){var i=e.coordinates,r=Nf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Nf()(n,s,a),vertices:n,size:a}}function CS(e){var i=e.coordinates,r=Nf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Nf()(n,s,a),vertices:AS(n),size:a+4}}function AS(e){for(var i=[],r=_S(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat((0,ir.Z)(n),[a]))}return i}function Ty(e){var i=e.coordinates,r=yy(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function My(e){var i=e.shape,r=MS(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function Py(e){var i=e.coordinates,r=[].concat((0,ir.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,ir.Z)(i[1]),[0,1,0],(0,ir.Z)(i[0]),[0,0,1],(0,ir.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function n0(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,ir.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function Iy(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=i0(-1,1),a=i0(1,1),s=i0(-1,-1),f=i0(1,-1),v=[].concat((0,ir.Z)(i),(0,ir.Z)(n),(0,ir.Z)(i),(0,ir.Z)(s),(0,ir.Z)(i),(0,ir.Z)(f),(0,ir.Z)(i),(0,ir.Z)(a)),m=[0,1,2,3,0,2];return{vertices:v,indices:m,size:5}}function wS(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t0&&t0[e])return t0[e];var r=Cd[e]?Cd[e]():Cd.cylinder(),n=yy([r],i);return t0[e]=n,n}function Y4(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,m=vec3.create(),x=vec3.create(),C=vec3.create(),A=0,O=i.length;A<O;A+=3){s=i[A+0]*3,f=i[A+1]*3,v=i[A+2]*3;var D=[e[s],e[s+1]],Z=[e[f],e[f+1]],X=[e[v],e[v+1]];n&&(D=lngLatToMeters(D),Z=lngLatToMeters(Z),X=lngLatToMeters(X));var te=D,Ee=_slicedToArray(te,2),Ue=Ee[0],Qe=Ee[1],ct=vec3.fromValues(Ue,Qe,e[s+2]),St=Z,bt=_slicedToArray(St,2),Kt=bt[0],lr=bt[1],Mr=vec3.fromValues(Kt,lr,e[f+2]),Xr=X,_r=_slicedToArray(Xr,2),on=_r[0],Ln=_r[1],Un=vec3.fromValues(on,Ln,e[v+2]);vec3.sub(m,Un,Mr),vec3.sub(x,ct,Mr),vec3.cross(C,m,x),a[s]+=m[0],a[s+1]+=m[1],a[s+2]+=m[2],a[f]+=m[0],a[f+1]+=m[1],a[f+2]+=m[2],a[v]+=m[0],a[v+1]+=m[1],a[v+2]+=m[2]}return TS(a),a}function TS(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function q4(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function MS(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Cd[e]?Cd[e]():Cd.circle(),n=i.indexOf(e)===-1?bS([r]):xS([r]);return n}function i0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function K4(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function $4(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function PS(e){var i=IS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function IS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,RS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,LS=function(e){(0,Yr.Z)(r,e);var i=PS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"cityCenter",void 0),(0,I.Z)((0,ae.Z)(n),"cityMinSize",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.baseColor,m=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,A=a.windowColor,O=A===void 0?"rgb(30,60,89)":A,D=a.time,Z=D===void 0?0:D,X=a.sweep,te=X===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:X;return{u_cityCenter:te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*te.sweepRadius,u_circleSweep:te.enable?1:0,u_circleSweepColor:sr(te.sweepColor).slice(0,3),u_circleSweepSpeed:te.sweepSpeed,u_opacity:f,u_baseColor:sr(m),u_brightColor:sr(C),u_windowColor:sr(O),u_time:this.layer.getLayerAnimateTime()||Z}}},{key:"calCityGeo",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(m+f)/2]);var x=this.mapService.lngLatToCoord([v,m]),C=this.mapService.lngLatToCoord([s,f]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var A=v-s,O=m-f;this.cityCenter=[(v+s)/2,(m+f)/2],this.cityMinSize=Math.sqrt(Math.pow(A,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:RS,fragmentShader:OS,triangulation:Ty,cull:{enable:!0,face:W.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m){var x=s.size;return[v[3],v[4]]}}})}}]),r}(co);function kS(e){var i=DS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=function(e){(0,Yr.Z)(r,e);var i=kS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"type","PolygonLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new LS(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Qh);function BS(e){var i=NS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function NS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,US=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZS=function(e){(0,Yr.Z)(r,e);var i=BS(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:zS,fragmentShader:US,triangulation:My,depth:{enable:!1},primitive:W.TRIANGLES,blend:this.getBlend(),stencil:Sn(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:wn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(co);function jS(e){var i=VS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,HS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,WS=function(e){(0,Yr.Z)(r,e);var i=jS(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:GS,fragmentShader:HS,triangulation:Ay,depth:{enable:!0},blend:this.getBlend(),stencil:Sn(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:wn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(co);function XS(e,i){for(var r=[],n=[],a=[],s=e+1,f=i+1,v=e/2,m=i/2,x=0;x<f;x++)for(var C=x-m,A=0;A<s;A++){var O=A-v;n.push(O/v,-C/m,0),a.push(A/e),a.push(1-x/i)}for(var D=0;D<i;D++)for(var Z=0;Z<e;Z++){var X=Z+s*D,te=Z+s*(D+1),Ee=Z+1+s*(D+1),Ue=Z+1+s*D;r.push(X,te,Ue),r.push(te,Ee,Ue)}return{vertices:n,indices:r,uvs:a}}var Oy,Ry;function Ly(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ky(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ly(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ly(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function YS(e){var i=qS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function qS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,$S=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,QS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,JS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,eC=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,tC=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Dy=(Oy=(0,nt.b2)(),Oy(Ry=function(e){(0,Yr.Z)(r,e);var i=YS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"colorTexture",void 0),(0,I.Z)((0,ae.Z)(n),"heatmapFramerBuffer",void 0),(0,I.Z)((0,ae.Z)(n),"intensityModel",void 0),(0,I.Z)((0,ae.Z)(n),"colorModel",void 0),(0,I.Z)((0,ae.Z)(n),"shapeType",void 0),n}return(0,Ct.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,f=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,f=s.createFramebuffer,v=s.clear,m=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,A=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(A==null||(a=A.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var D=m(),Z=D.width,X=D.height;return this.heatmapFramerBuffer=f({color:x({width:Math.floor(Z/4),height:Math.floor(X/4),wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.LINEAR,mag:W.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:wn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=Iy,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:tC,fragmentShader:eC,triangulation:Iy,depth:{enable:!1},cull:{enable:!0,face:Xn(this.mapService.version)},blend:{enable:!0,func:{srcRGB:W.ONE,srcAlpha:1,dstRGB:W.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:JS,fs:QS});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,A=x.fs,O=x.uniforms,D=this.rendererService,Z=D.createAttribute,X=D.createElements,te=D.createBuffer,Ee=D.createModel;return Ee({vs:C,fs:A,attributes:{a_Position:Z({buffer:te({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:W.FLOAT}),size:3}),a_Uv:Z({buffer:te({data:[0,1,1,1,0,0,1,0],type:W.FLOAT}),size:2})},uniforms:ky({},O),depth:{enable:!1},blend:this.getBlend(),count:6,elements:X({data:[0,2,1,2,3,1],type:W.UNSIGNED_INT,count:6}),stencil:Sn(f,m)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.intensity,v=f===void 0?10:f,m=a.radius,x=m===void 0?5:m;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=Zi();Oi(f,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ir.Z)(f)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),A=C.width,O=C.height,D=XS(A/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:$S,fs:KS});var Z=this.shaderModuleService.getModule("heatmap3dColor"),X=Z.vs,te=Z.fs,Ee=Z.uniforms,Ue=this.rendererService,Qe=Ue.createAttribute,ct=Ue.createElements,St=Ue.createBuffer,bt=Ue.createModel;return bt({vs:X,fs:te,attributes:{a_Position:Qe({buffer:St({data:D.vertices,type:W.FLOAT}),size:3}),a_Uv:Qe({buffer:St({data:D.uvs,type:W.FLOAT}),size:2})},primitive:W.TRIANGLES,uniforms:ky({},Ee),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:W.SRC_ALPHA,srcAlpha:1,dstRGB:W.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:ct({data:D.indices,type:W.UNSIGNED_INT,count:D.indices.length}),stencil:Sn(f,m)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),f=s.rampColors,v=kn(f);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.NEAREST,mag:W.NEAREST,flipY:!1})}}]),r}(co))||Ry);function rC(e){var i=nC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function nC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,aC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,oC=function(e){(0,Yr.Z)(r,e);var i=rC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:aC,fragmentShader:iC,triangulation:My,depth:{enable:!1},primitive:W.TRIANGLES,blend:this.getBlend(),stencil:Sn(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:wn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(co),sC={heatmap:Dy,heatmap3d:Dy,grid:ZS,grid3d:WS,hexagon:oC},uC=sC;function lC(e){var i=cC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fC=function(e){(0,Yr.Z)(r,e);var i=lC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"type","HeatMapLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new uC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(f){return f.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=this.getLayerConfig(),v=f.shape3d,m=this.getSource(),x=m.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(Qh);function hC(e){var i=pC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function pC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,vC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,mC=function(e){(0,Yr.Z)(r,e);var i=hC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mask,v=f===void 0?!1:f,m=s.maskInside,x=m===void 0?!0:m,C=this.layer.getSource(),A=this.rendererService.createTexture2D;if(this.texture=A({height:0,width:0}),_o){var O=this.layerService.sceneService.getSceneConfig().canvas,D=O.createImage();D.crossOrigin="anonymous",D.src=C.data.originData,D.onload=function(){a.texture=A({data:D,width:D.width,height:D.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(Z){a.texture=A({data:Z[0],width:Z[0].width,height:Z[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:vC,fragmentShader:dC,triangulation:Py,primitive:W.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Sn(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}}]),r}(co),gC={image:mC},yC=gC;function _C(e){var i=xC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fy=function(e){(0,Yr.Z)(r,e);var i=_C(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"type","ImageLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new yC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(Qh);function bC(e){var i=EC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function EC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SC=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,CC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,AC=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,wC=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,TC=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,MC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,PC={solid:0,dash:1},IC=function(e){(0,Yr.Z)(r,e);var i=bC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.lineType,O=A===void 0?"solid":A,D=a.dashArray,Z=D===void 0?[10,5]:D,X=a.forward,te=X===void 0?!0:X,Ee=a.lineTexture,Ue=Ee===void 0?!1:Ee,Qe=a.iconStep,ct=Qe===void 0?100:Qe,St=a.segmentNumber,bt=St===void 0?30:St,Kt=a.thetaOffset,lr=Kt===void 0?.314:Kt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,thetaOffset:lr})){this.judgeStyleAttributes({opacity:f,thetaOffset:lr});var Mr=this.layer.getEncodedData(),Xr=this.calDataFrame(this.cellLength,Mr,this.cellProperties),_r=Xr.data,on=Xr.width,Ln=Xr.height;this.rowCount=Ln,this.dataTexture=this.cellLength>0&&_r.length>0?this.createTexture2D({flipY:!0,data:_r,format:W.LUMINANCE,type:W.FLOAT,width:on,height:Ln}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}Z.length===2&&Z.push(0,0);var Un=0,Fa=[0,0,0,0],Mo=[0,0,0,0];return v&&m&&(Fa=sr(v),Mo=sr(m),Un=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Number(lr),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:bt,u_line_type:PC[O||"solid"],u_dash_array:Z,u_blur:.9,u_lineDir:te?1:-1,u_texture:this.texture,u_line_texture:Ue?1:0,u_icon_step:ct,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Un,u_sourceColor:Fa,u_targetColor:Mo}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:SC,vert:CC,type:"dash"}:s&&f?{frag:TC,vert:MC,type:"linear"}:{frag:AC,vert:wC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,A=this.getShaders(),O=A.frag,D=A.vert,Z=A.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+Z,vertexShader:D,fragmentShader:O,triangulation:n0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f,stencil:Sn(m,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(co);function OC(e){var i=RC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function RC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,kC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,DC=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,FC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,BC={solid:0,dash:1},NC=function(e){(0,Yr.Z)(r,e);var i=OC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.lineType,O=A===void 0?"solid":A,D=a.dashArray,Z=D===void 0?[10,5]:D,X=a.lineTexture,te=X===void 0?!1:X,Ee=a.iconStep,Ue=Ee===void 0?100:Ee,Qe=a.segmentNumber,ct=Qe===void 0?30:Qe,St=a.globalArcHeight,bt=St===void 0?10:St;Z.length===2&&Z.push(0,0);var Kt=0,lr=[0,0,0,0],Mr=[0,0,0,0];if(v&&m&&(lr=sr(v),Mr=sr(m),Kt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Xr=this.layer.getEncodedData(),_r=this.calDataFrame(this.cellLength,Xr,this.cellProperties),on=_r.data,Ln=_r.width,Un=_r.height;this.rowCount=Un,this.dataTexture=this.cellLength>0&&on.length>0?this.createTexture2D({flipY:!0,data:on,format:W.LUMINANCE,type:W.FLOAT,width:Ln,height:Un}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:py,u_global_height:bt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:ct,u_line_type:BC[O]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ue,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Kt,u_sourceColor:lr,u_targetColor:Mr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:DC,vert:FC,type:"linear"}:{frag:LC,vert:kC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,A=this.getShaders(),O=A.frag,D=A.vert,Z=A.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+Z,vertexShader:D,fragmentShader:O,triangulation:n0,blend:this.getBlend(),segmentNumber:f,stencil:Sn(m,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(co);function zC(e){var i=UC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZC=`#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,jC=`#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,VC=function(e){(0,Yr.Z)(r,e);var i=zC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.forward,C=x===void 0?!0:x,A=a.segmentNumber,O=A===void 0?30:A,D=a.thetaOffset,Z=D===void 0?.314:D,X=0,te=[0,0,0,0],Ee=[0,0,0,0];return v&&m&&(te=sr(v),Ee=sr(m),X=1),{u_thetaOffset:Z,u_opacity:Number(f),segmentNumber:O,u_blur:.9,u_lineDir:C?1:-1,u_linearColor:X,u_sourceColor:te,u_targetColor:Ee}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:jC,fragmentShader:ZC,triangulation:n0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(s,f,v,m){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(co);function GC(e){var i=HC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,XC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,YC={solid:0,dash:1},qC=function(e){(0,Yr.Z)(r,e);var i=GC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.lineType,O=A===void 0?"solid":A,D=a.dashArray,Z=D===void 0?[10,5]:D,X=a.lineTexture,te=X===void 0?!1:X,Ee=a.iconStep,Ue=Ee===void 0?100:Ee,Qe=a.segmentNumber,ct=Qe===void 0?30:Qe;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var St=0,bt=[0,0,0,0],Kt=[0,0,0,0];if(v&&m&&(bt=sr(v),Kt=sr(m),St=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var lr=this.layer.getEncodedData(),Mr=this.calDataFrame(this.cellLength,lr,this.cellProperties),Xr=Mr.data,_r=Mr.width,on=Mr.height;this.rowCount=on,this.dataTexture=this.cellLength>0&&Xr.length>0?this.createTexture2D({flipY:!0,data:Xr,format:W.LUMINANCE,type:W.FLOAT,width:_r,height:on}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:ct,u_line_type:YC[O]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ue,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:St,u_sourceColor:bt,u_targetColor:Kt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:XC,fragmentShader:WC,triangulation:n0,depth:{enable:!1},blend:this.getBlend(),stencil:Sn(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(co);function KC(e){var i=$C();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function $C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,JC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,eA=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,By=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,tA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,rA={solid:0,dash:1},Ny=function(e){(0,Yr.Z)(r,e);var i=KC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.lineType,O=A===void 0?"solid":A,D=a.dashArray,Z=D===void 0?[10,5,0,0]:D,X=a.lineTexture,te=X===void 0?!1:X,Ee=a.iconStep,Ue=Ee===void 0?100:Ee,Qe=a.vertexHeightScale,ct=Qe===void 0?20:Qe,St=a.borderWidth,bt=St===void 0?0:St,Kt=a.borderColor,lr=Kt===void 0?"#ccc":Kt,Mr=a.raisingHeight,Xr=Mr===void 0?0:Mr,_r=a.heightfixed,on=_r===void 0?!1:_r,Ln=a.arrow,Un=Ln===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Ln;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Fa=0,Mo=[0,0,0,0],Ps=[0,0,0,0];if(v&&m&&(Mo=sr(v),Ps=sr(m),Fa=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var au=this.layer.getEncodedData(),ks=this.calDataFrame(this.cellLength,au,this.cellProperties),Rc=ks.data,Sm=ks.width,L0=ks.height;this.rowCount=L0,this.dataTexture=this.cellLength>0&&Rc.length>0?this.createTexture2D({flipY:!0,data:Rc,format:W.LUMINANCE,type:W.FLOAT,width:Sm,height:L0}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,u_line_type:rA[O],u_dash_array:Z,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ue,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:bt,u_borderColor:sr(lr),u_linearColor:Fa,u_sourceColor:Mo,u_targetColor:Ps,u_heightfixed:Number(on),u_vertexScale:ct,u_raisingHeight:Number(Xr),u_arrow:Number(Un.enable),u_arrowHeight:Un.arrowHeight||3,u_arrowWidth:Un.arrowWidth||2,u_tailWidth:Un.tailWidth===void 0?1:Un.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,A=this.getShaders(),O=A.frag,D=A.vert,Z=A.type;return this.layer.triangulation=fv,[this.layer.buildLayerModel({moduleName:"line_"+Z,vertexShader:D,fragmentShader:O,triangulation:fv,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Sn(f,m)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:QC,vert:JC,type:"dash"}:s&&f?{frag:tA,vert:By,type:"linear"}:{frag:eA,vert:By,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:wn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x,C,A){return A===void 0?[m[3],10]:[m[3],A]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,m,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(co);function nA(e){var i=iA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aA=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,oA=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,sA=function(e){(0,Yr.Z)(r,e);var i=nA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"colorTexture",void 0),(0,I.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var m=n.layer.getLayerConfig(),x=m.rampColors,C=kn(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.NEAREST,mag:W.NEAREST,flipY:!1})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.vertexHeightScale,m=v===void 0?20:v,x=a.raisingHeight,C=x===void 0?0:x,A=a.heightfixed,O=A===void 0?!1:A;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var D=this.layer.getEncodedData(),Z=this.calDataFrame(this.cellLength,D,this.cellProperties),X=Z.data,te=Z.width,Ee=Z.height;this.rowCount=Ee,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:W.LUMINANCE,type:W.FLOAT,width:te,height:Ee}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_texture:this.colorTexture,u_heightfixed:Number(O),u_vertexScale:m,u_raisingHeight:Number(C)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,A=this.getShaders(),O=A.frag,D=A.vert,Z=A.type;return this.layer.triangulation=fv,[this.layer.buildLayerModel({moduleName:"line_"+Z,vertexShader:D,fragmentShader:O,triangulation:fv,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Sn(f,m)})]}},{key:"getShaders",value:function(){return{frag:aA,vert:oA,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:wn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){return[v[4]]}}})}}]),r}(co);function uA(e){var i=lA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function lA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cA=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,fA=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,zy=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,hA=function(e){(0,Yr.Z)(r,e);var i=uA(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.vertexHeightScale,C=x===void 0?20:x,A=0,O=[0,0,0,0],D=[0,0,0,0];if(v&&m&&(O=sr(v),D=sr(m),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Z=this.layer.getEncodedData(),X=this.calDataFrame(this.cellLength,Z,this.cellProperties),te=X.data,Ee=X.width,Ue=X.height;this.rowCount=Ue,this.dataTexture=this.cellLength>0&&te.length>0?this.createTexture2D({flipY:!0,data:te,format:W.LUMINANCE,type:W.FLOAT,width:Ee,height:Ue}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_linearColor:A,u_sourceColor:O,u_targetColor:D,u_vertexScale:C}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:cA,vert:zy,type:"simple_linear"}:{frag:fA,vert:zy,type:"simple_normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),C=x.frag,A=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:A,fragmentShader:C,triangulation:SS,primitive:W.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Sn(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:wn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){return[v[4]]}}})}}]),r}(co);function pA(e){var i=dA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function dA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vA=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,mA=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,gA=function(e){(0,Yr.Z)(r,e);var i=pA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.heightfixed,O=A===void 0?!1:A,D=a.lineTexture,Z=D===void 0?!1:D,X=a.iconStep,te=X===void 0?100:X,Ee=a.iconStepCount,Ue=Ee===void 0?1:Ee;this.rendererService.getDirty()&&this.texture.bind();var Qe=0,ct=[0,0,0,0],St=[0,0,0,0];if(v&&m&&(ct=sr(v),St=sr(m),Qe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var bt=this.layer.getEncodedData(),Kt=this.calDataFrame(this.cellLength,bt,this.cellProperties),lr=Kt.data,Mr=Kt.width,Xr=Kt.height;this.rowCount=Xr,this.dataTexture=this.cellLength>0&&lr.length>0?this.createTexture2D({flipY:!0,data:lr,format:W.LUMINANCE,type:W.FLOAT,width:Mr,height:Xr}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_heightfixed:Number(O),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,u_texture:this.texture,u_line_texture:Z?1:0,u_iconStepCount:Ue,u_icon_step:te,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Qe,u_sourceColor:ct,u_targetColor:St}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:mA,fragmentShader:vA,triangulation:fv,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:wn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,m,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(co),yA={arc:IC,arcmini:VC,arc3d:NC,greatcircle:qC,wall:gA,line:Ny,simple:hA,linearline:sA},_A=yA;function xA(e){var i=bA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function bA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uy=function(e){(0,Yr.Z)(r,e);var i=xA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"type","LineLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new _A[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f||"line"}}]),r}(Qh);function EA(e){var i=SA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function SA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CA=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,AA=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Zy=function(e){(0,Yr.Z)(r,e);var i=EA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"raiseCount",0),(0,I.Z)((0,ae.Z)(n),"raiserepeat",0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,m=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,A=a.pickLight,O=A===void 0?!1:A,D=a.heightfixed,Z=D===void 0?!1:D,X=a.opacityLinear,te=X===void 0?{enable:!1,dir:"up"}:X,Ee=a.lightEnable,Ue=Ee===void 0?!0:Ee;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var Qe=this.layer.getEncodedData(),ct=this.calDataFrame(this.cellLength,Qe,this.cellProperties),St=ct.data,bt=ct.width,Kt=ct.height;this.rowCount=Kt,this.dataTexture=this.cellLength>0&&St.length>0?this.createTexture2D({flipY:!0,data:St,format:W.LUMINANCE,type:W.FLOAT,width:bt,height:Kt}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}var lr=0,Mr=[0,0,0,0],Xr=[0,0,0,0];if(x&&C&&(Mr=sr(x),Xr=sr(C),lr=1),this.raiseCount<1&&this.raiserepeat>0&&f.enable){var _r=f.speed,on=_r===void 0?.01:_r,Ln=f.repeat,Un=Ln===void 0?!1:Ln;this.raiseCount+=on,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(Z),u_r:f.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(m),u_linearColor:lr,u_sourceColor:Mr,u_targetColor:Xr,u_opacitylinear:Number(te.enable),u_opacitylinear_dir:te.dir==="up"?1:0,u_lightEnable:Number(Ue)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,f=s===void 0?!0:s,v=a.animateOption.repeat,m=v===void 0?1:v;return this.raiserepeat=m,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:AA,fragmentShader:CA,triangulation:Ay,blend:this.getBlend(),cull:{enable:!0,face:Xn(this.mapService.version)},depth:{enable:f}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,m,x){var C=f.size;if(C){var A=[];return Array.isArray(C)&&(A=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(A=[C,C,C]),A}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,m,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:wn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v){var m=Bp(f.coordinates);return a?vy([m[0],m[1]]):[m[0],m[1],0]}}})}}]),r}(co);function wA(e){var i=TA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function TA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jy=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,MA=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,H0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Vy=function(e){(0,Yr.Z)(r,e);var i=wA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"meter2coord",1),(0,I.Z)((0,ae.Z)(n),"isMeter",!1),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,m=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,A=a.stroke,O=A===void 0?"rgba(0,0,0,0)":A,D=a.offsets,Z=D===void 0?[0,0]:D,X=a.blend,te=a.blur,Ee=te===void 0?0:te,Ue=a.raisingHeight,Qe=Ue===void 0?0:Ue;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:m,strokeWidth:C,stroke:O,offsets:Z})){this.judgeStyleAttributes({opacity:f,strokeOpacity:m,strokeWidth:C,stroke:O,offsets:Z});var ct=this.layer.getEncodedData(),St=this.calDataFrame(this.cellLength,ct,this.cellProperties),bt=St.data,Kt=St.width,lr=St.height;this.rowCount=lr,this.dataTexture=this.cellLength>0&&bt.length>0?this.createTexture2D({flipY:!0,data:bt,format:W.LUMINANCE,type:W.FLOAT,width:Kt,height:lr}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Qe),u_isMeter:Number(this.isMeter),u_blur:Ee,u_additive:X==="additive"?1:0,u_globel:this.mapService.version===Ls.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_stroke_opacity:Number(m),u_stroke_width:Number(C),u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(Z)?Z:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Up)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*A.meterInMercatorCoordinateUnits(),Z=new window.mapboxgl.MercatorCoordinate(A.x-D,A.y,A.z),X=Z.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,A=this.getShaders(C),O=A.frag,D=A.vert,Z=A.type,X=this.mapService.version==="GLOBEL";return this.layer.triangulation=X?Cy:Up,[this.layer.buildLayerModel({moduleName:"pointfill_"+Z,vertexShader:D,fragmentShader:O,triangulation:X?Cy:Up,depth:{enable:X},blend:this.getBlend(),stencil:Sn(f,m),cull:{enable:!0,face:Xn(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:jy,vert:H0,type:"wave"};default:return{frag:jy,vert:H0,type:"wave"}}else return{frag:MA,vert:H0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(v,m,x,C){var A;if(s){var O=(0,Q.Z)(x,3),D=O[0],Z=O[1],X=O[2],te=Ha.fromValues(0,0,1),Ee=Ha.fromValues(D,0,X),Ue=D>=0?Ha.angle(te,Ee):Math.PI*2-Ha.angle(te,Ee),Qe=Math.PI*2-Math.asin(Z/100),ct=Zi();st(ct,ct,Ue),Fe(ct,ct,Qe);var St=Ha.fromValues(1,1,0);Ha.transformMat4(St,St,ct),Ha.normalize(St,St);var bt=Ha.fromValues(-1,1,0);Ha.transformMat4(bt,bt,ct),Ha.normalize(bt,bt);var Kt=Ha.fromValues(-1,-1,0);Ha.transformMat4(Kt,Kt,ct),Ha.normalize(Kt,Kt);var lr=Ha.fromValues(1,-1,0);Ha.transformMat4(lr,lr,ct),Ha.normalize(lr,lr),A=[].concat((0,ir.Z)(St),(0,ir.Z)(bt),(0,ir.Z)(Kt),(0,ir.Z)(lr))}else A=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Mr=C%4*3;return[A[Mr],A[Mr+1],A[Mr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(v,m,x,C){var A=v.size,O=A===void 0?5:A;return Array.isArray(O)?[O[0]*a.meter2coord]:[O*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:wn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(v,m,x,C){var A=v.shape,O=A===void 0?2:A,D=a.layer.getLayerConfig().shape2d,Z=D.indexOf(O);return[Z]}}})}}]),r}(co);function PA(e){var i=IA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OA=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,RA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,LA=function(e){(0,Yr.Z)(r,e);var i=PA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"meter2coord",1),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"isMeter",!1),(0,I.Z)((0,ae.Z)(n),"radian",0),(0,I.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.LINEAR,min:W.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v,x=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var C=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(C=-1),this.radian=x!==void 0?C*Math.PI*x/180:C*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),D=O.data,Z=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:W.LUMINANCE,type:W.FLOAT,width:Z,height:X}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Up)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*A.meterInMercatorCoordinateUnits(),Z=new window.mapboxgl.MercatorCoordinate(A.x-D,A.y,A.z),X=Z.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),C=x.frag,A=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:A,fragmentShader:C,triangulation:Up,depth:{enable:!1},blend:this.getBlend(),stencil:Sn(f,m),cull:{enable:!0,face:Xn(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:OA,vert:RA,type:"point_fillImage"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:wn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.rotate,A=C===void 0?0:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),A=f.shape,O=C[A]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,m,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=x%4*3;return[C[A],C[A+1],C[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,A=C===void 0?5:C;return Array.isArray(A)?[A[0]*a.meter2coord]:[A*a.meter2coord]}}})}}]),r}(co);function kA(e){var i=DA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function DA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,BA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,NA=function(e){(0,Yr.Z)(r,e);var i=kA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:BA,fragmentShader:FA,triangulation:wy,primitive:W.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=a.fontService.mapping,A=f.shape,O=a.fontService.getGlyph(A),D=C[O],Z=D.x,X=D.y;return[Z,X]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:W.LINEAR,min:W.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.fontWeight,v=f===void 0?"normal":f,m=s.fontFamily,x=m===void 0?"sans-serif":m,C=this.layer.getEncodedData(),A=[];C.forEach(function(O){var D=O.shape,Z=D===void 0?"":D;Z=Z.toString();var X=a.fontService.getGlyph(Z);A.indexOf(X)===-1&&A.push(X)}),this.fontService.setFontOptions({characterSet:A,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(co);function zA(e){var i=UA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function UA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,jA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,Gy=function(e){(0,Yr.Z)(r,e);var i=zA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.LINEAR,min:W.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),A=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:W.LUMINANCE,type:W.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:jA,fragmentShader:ZA,triangulation:wy,primitive:W.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Sn(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,A=C===void 0?5:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),A=f.shape,O=C[A]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(co);function VA(e){var i=GA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function GA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,WA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Hy(e){var i=e.coordinates;return{vertices:(0,ir.Z)(i),indices:[0],size:i.length}}var Wy=function(e){(0,Yr.Z)(r,e);var i=VA(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),A=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:W.LUMINANCE,type:W.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return this.layer.triangulation=Hy,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:WA,fragmentShader:HA,triangulation:Hy,depth:{enable:!1},primitive:W.POINTS,blend:this.getBlend(),stencil:Sn(f,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Tc.additive}}}]),r}(co);function XA(e){var i=YA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,KA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,$A=function(e){(0,Yr.Z)(r,e);var i=XA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"meter2coord",1),(0,I.Z)((0,ae.Z)(n),"isMeter",!1),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v,x=a.blend,C=a.speed,A=C===void 0?1:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var O=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,O,this.cellProperties),Z=D.data,X=D.width,te=D.height;this.rowCount=te,this.dataTexture=this.cellLength>0&&Z.length>0?this.createTexture2D({flipY:!0,data:Z,format:W.LUMINANCE,type:W.FLOAT,width:X,height:te}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:A,u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Up)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*A.meterInMercatorCoordinateUnits(),Z=new window.mapboxgl.MercatorCoordinate(A.x-D,A.y,A.z),X=Z.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),C=x.frag,A=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:A,fragmentShader:C,triangulation:Up,depth:{enable:!1},blend:this.getBlend(),stencil:Sn(f,m),cull:{enable:!0,face:Xn(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:qA,vert:KA,type:"point_radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,m,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var A=x%4*3;return[C[A],C[A+1],C[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,A=C===void 0?5:C;return Array.isArray(A)?[A[0]*a.meter2coord]:[A*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:wn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,m,x){var C=f.shape,A=C===void 0?2:C,O=a.layer.getLayerConfig().shape2d,D=O.indexOf(A);return[D]}}})}}]),r}(co);function QA(e){var i=JA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function JA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ew=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,tw=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Xy(e){var i=e.coordinates;return{vertices:(0,ir.Z)(i),indices:[0],size:i.length}}var rw=function(e){(0,Yr.Z)(r,e);var i=QA(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,A=C===void 0?1:C,O=a.strokeWidth,D=O===void 0?0:O,Z=a.stroke,X=Z===void 0?"#fff":Z;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var te=this.layer.getEncodedData(),Ee=this.calDataFrame(this.cellLength,te,this.cellProperties),Ue=Ee.data,Qe=Ee.width,ct=Ee.height;this.rowCount=ct,this.dataTexture=this.cellLength>0&&Ue.length>0?this.createTexture2D({flipY:!0,data:Ue,format:W.LUMINANCE,type:W.FLOAT,width:Qe,height:ct}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0],u_stroke_opacity:Number(A),u_stroke_width:Number(D),u_stroke_color:this.getStrokeColor(X)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return this.layer.triangulation=Xy,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:tw,fragmentShader:ew,triangulation:Xy,depth:{enable:!1},primitive:W.POINTS,blend:this.getBlend(),stencil:Sn(f,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Tc.additive}}}]),r}(co);function nw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=iw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function iw(e,i){if(!!e){if(typeof e=="string")return Yy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yy(e,i)}}function Yy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var aw=function(){function e(i,r,n){(0,lt.Z)(this,e),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Ct.Z)(e,[{key:"insert",value:function(r,n,a,s,f){this.forEachCell(n,a,s,f,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(f)}},{key:"query",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!1,f)}},{key:"hitTest",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!0,f)}},{key:"insertBoxCell",value:function(r,n,a,s,f,v){this.boxCells[f].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,f,v){if(a<0||r>this.width||s<0||n>this.height)return f?!1:[];var m=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(f)return!0;for(var x=0;x<this.boxKeys.length;x++)m.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?m.filter(v):m}var C={hitTest:f,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,m,C,v),f?m.length>0:m}},{key:"queryCell",value:function(r,n,a,s,f,v,m,x){var C=m.seenUids,A=this.boxCells[f];if(A!==null){var O=this.bboxes,D=nw(A),Z;try{for(D.s();!(Z=D.n()).done;){var X=Z.value;if(!C.box[X]){C.box[X]=!0;var te=X*4;if(r<=O[te+2]&&n<=O[te+3]&&a>=O[te+0]&&s>=O[te+1]&&(!x||x(this.boxKeys[X]))){if(m.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[X],x1:O[te],y1:O[te+1],x2:O[te+2],y2:O[te+3]})}}}}catch(Ee){D.e(Ee)}finally{D.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,f,v,m,x){for(var C=this.convertToXCellCoord(r),A=this.convertToYCellCoord(n),O=this.convertToXCellCoord(a),D=this.convertToYCellCoord(s),Z=C;Z<=O;Z++)for(var X=A;X<=D;X++){var te=this.xCellCount*X+Z;if(f.call(this,r,n,a,s,te,v,m,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),ow=aw,sw=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new ow(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Ct.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,f=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,f)||this.grid.hitTest(n,a,s,f)?{box:[]}:{box:[n,a,s,f]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=hr(n,a,0,1),f=Gt(),v=we.apply(le,(0,ir.Z)(r));return mo(f,s,v),{x:(f[0]/f[3]+1)/2*this.width+this.viewportPadding,y:(-f[1]/f[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function qy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=uw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function uw(e,i){if(!!e){if(typeof e=="string")return Ky(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ky(e,i)}}function Ky(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $y(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Qy(e,i,r,n,a){if(!!a){var s=e[n],f=s.glyph;if(f)for(var v=i[f].advance*s.scale,m=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=m}}function Jy(e,i,r,n,a,s,f){var v=(i-r)*a,m=(-n*f+.5)*s,x=qy(e),C;try{for(x.s();!(C=x.n()).done;){var A=C.value;A.x+=v,A.y+=m}}catch(O){x.e(O)}finally{x.f()}}function lw(e,i,r,n,a,s,f){var v=-8,m=0,x=v,C=0,A=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,D=A.length;r.forEach(function(Ue){if(Ue.split("").forEach(function(ct){var St=i[ct],bt=0;St&&(A.push({glyph:ct,x:m,y:x+bt,vertical:!1,scale:1,metrics:St}),m+=St.advance+f)}),A.length!==D){var Qe=m-f;C=Math.max(Qe,C),Qy(A,i,D,A.length-1,O)}m=0,x-=n+5});var Z=$y(a),X=Z.horizontalAlign,te=Z.verticalAlign;Jy(A,O,X,te,C,n,r.length);var Ee=x-v;e.top+=-te*Ee,e.bottom=e.top-Ee,e.left+=-X*C,e.right=e.left+C}function cw(e,i,r,n,a,s,f){var v=-8,m=0,x=v,C=0,A=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,D=A.length;r.forEach(function(Ue){var Qe=i[Ue],ct=0;if(Qe&&(A.push({glyph:Ue,x:Qe.advance/2,y:x+ct,vertical:!1,scale:1,metrics:Qe}),m+=Qe.advance+f),A.length!==D){var St=m-f;C=Math.max(St,C),Qy(A,i,D,A.length-1,O)}m=0,x-=n+5});var Z=$y(a),X=Z.horizontalAlign,te=Z.verticalAlign;Jy(A,O,X,te,C,n,r.length);var Ee=x-v;e.top+=-te*Ee,e.bottom=e.top-Ee,e.left+=-X*C,e.right=e.left+C}function fw(e,i,r,n,a,s){var f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,m=e.split(`
`),x=[],C={positionedGlyphs:x,top:f[1],bottom:f[1],left:f[0],right:f[0],lineCount:m.length,text:e};return v?cw(C,i,m,r,n,a,s):lw(C,i,m,r,n,a,s),x.length?C:!1}function hw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],f=qy(a),v;try{for(f.s();!(v=f.n()).done;){var m=v.value,x=m.metrics,C=4,A=x.advance*m.scale/2,O=r?[m.x+A,m.y]:[0,0],D=r?[0,0]:[m.x+A+i[0],m.y+i[1]],Z=(0-C)*m.scale-A+D[0],X=(0-C)*m.scale+D[1],te=Z+x.width*m.scale,Ee=X+x.height*m.scale,Ue={x:Z,y:X},Qe={x:te,y:X},ct={x:Z,y:Ee},St={x:te,y:Ee};s.push({tl:Ue,tr:Qe,bl:ct,br:St,tex:x,glyphOffset:O})}}catch(bt){f.e(bt)}finally{f.f()}return s}function pw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=dw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function dw(e,i){if(!!e){if(typeof e=="string")return e_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e_(e,i)}}function e_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function vw(e){var i=mw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function mw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,r_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function n_(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,f=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,m){n.push.apply(n,(0,ir.Z)(f).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,ir.Z)(f),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,ir.Z)(f),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,ir.Z)(f),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+m*4,1+m*4,2+m*4,2+m*4,3+m*4,0+m*4)}),{vertices:n,indices:a,size:7}}var i_=function(e){(0,Yr.Z)(r,e);var i=vw(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"glyphInfo",void 0),(0,I.Z)((0,ae.Z)(n),"glyphInfoMap",{}),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"currentZoom",-1),(0,I.Z)((0,ae.Z)(n),"extent",void 0),(0,I.Z)((0,ae.Z)(n),"textureHeight",0),(0,I.Z)((0,ae.Z)(n),"textCount",0),(0,I.Z)((0,ae.Z)(n),"preTextStyle",{}),(0,I.Z)((0,ae.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),m=v.mask,x=m===void 0?!1:m,C=v.maskInside,A=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:r_,fragmentShader:t_,triangulation:n_.bind((0,ae.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Sn(x,A)})]}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.stroke,m=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,A=a.textAnchor,O=A===void 0?"center":A,D=a.textAllowOverlap,Z=D===void 0?!1:D,X=a.halo,te=X===void 0?.5:X,Ee=a.gamma,Ue=Ee===void 0?2:Ee,Qe=a.raisingHeight,ct=Qe===void 0?0:Qe,St=this.fontService,bt=St.canvas,Kt=St.mapping;if(Object.keys(Kt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Kt).length),this.preTextStyle={textAnchor:O,textAllowOverlap:Z},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeWidth:C,stroke:m})){this.judgeStyleAttributes({opacity:f,strokeWidth:C,stroke:m});var lr=this.layer.getEncodedData(),Mr=this.calDataFrame(this.cellLength,lr,this.cellProperties),Xr=Mr.data,_r=Mr.width,on=Mr.height;this.rowCount=on,this.dataTexture=this.cellLength>0&&Xr.length>0?this.createTexture2D({flipY:!0,data:Xr,format:W.LUMINANCE,type:W.FLOAT,width:_r,height:on}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(ct),u_opacity:Number(f),u_stroke_width:Number(C),u_stroke_color:this.getStrokeColor(m),u_sdf_map:this.texture,u_halo_blur:te,u_gamma_scale:Ue,u_sdf_map_size:[bt.width,bt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,f=s===void 0?"center":s,v=a.textAllowOverlap,m=v===void 0?!0:v;return this.preTextStyle={textAnchor:f,textAllowOverlap:m},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,f=s===void 0?!1:s,v=this.mapService.getZoom(),m=this.mapService.getBounds(),x=fe(this.extent,m);return!f&&(Math.abs(this.currentZoom-v)>1||!x)||f!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:wn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:wn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:wn.Attribute,descriptor:{name:"a_tex",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return oe(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,m=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(A){var O=A.shape,D=O===void 0?"":O;D=D.toString();var Z=pw(D),X;try{for(Z.s();!(X=Z.n()).done;){var te=X.value;C.indexOf(te)===-1&&C.push(te)}}catch(Ee){Z.e(Ee)}finally{Z.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:m,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,m=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(A){var O=A.shape,D=O===void 0?"":O;D="".concat(D),C.indexOf(D)===-1&&C.push(D)}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:m,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,f=this.fontService.mapping,v=this.layer.getLayerConfig(),m=v.spacing,x=m===void 0?2:m,C=v.textAnchor,A=C===void 0?"center":C,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(D){var Z=D.shape,X=Z===void 0?"":Z,te=D.id,Ee=D.size,Ue=Ee===void 0?1:Ee,Qe=D.textOffset,ct=Qe===void 0?[0,0]:Qe,St=fw(X.toString(),f,Ue,A,"left",x,ct,a),bt=hw(St,ct,!1);return D.shaping=St,D.glyphQuads=bt,D.centroid=Bp(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?Bp(D.originCoordinates):D.originCentroid=D.centroid,s.glyphInfoMap[te]={shaping:St,glyphQuads:bt,centroid:Bp(D.coordinates)},D})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.padding,v=f===void 0?[4,4]:f,m=s.textAllowOverlap,x=m===void 0?!1:m;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),A=C.width,O=C.height,D=new sw(A,O),Z=this.glyphInfo.filter(function(X){var te=X.shaping,Ee=X.id,Ue=Ee===void 0?0:Ee,Qe=X.version==="GAODE2.x"?X.originCentroid:X.centroid,ct=X.size,St=ct/24,bt=a.mapService.lngLatToContainer(Qe),Kt=D.placeCollisionBox({x1:te.left*St-v[0],x2:te.right*St+v[0],y1:te.top*St-v[1],y2:te.bottom*St+v[1],anchorPointX:bt.x,anchorPointY:bt.y}),lr=Kt.box;return lr&&lr.length?(D.insertCollisionBox(lr,Ue),!0):!1});Z.forEach(function(X){a.glyphInfoMap[X.id]=X})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,f=s===void 0?!1:s;f?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(f)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:W.LINEAR,min:W.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:r_,fragmentShader:t_,triangulation:n_.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Sn(f,m)})]}}]),r}(co),gw={fillImage:LA,fill:Vy,radar:$A,image:Gy,normal:Wy,simplePoint:rw,extrude:Zy,text:i_,icon:NA},yw=gw;function _w(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function xw(e,i){if(!!e){if(typeof e=="string")return a_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a_(e,i)}}function a_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function bw(e){var i=Ew();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o_=function(e){(0,Yr.Z)(r,e);var i=bw(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"type","PointLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new yw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,f=a.values,v=this.getLayerConfig(),m=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(m==null?void 0:m.indexOf(s))!==-1)return"fill";if(f&&f instanceof Array){var A=_w(f),O;try{for(A.s();!(O=A.n()).done;){var D=O.value;if(typeof D=="string"&&C.hasOwnProperty(D))return"image"}}catch(Z){A.e(Z)}finally{A.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),f=this.getLayerConfig(),v=f.shape2d,m=f.shape3d,x=this.iconService.getIconMap(),C=s.find(function(O){return O.hasOwnProperty("shape")});if(C){var A=C.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":A==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(A))!==-1?"fill":(m==null?void 0:m.indexOf(A))!==-1?"extrude":x.hasOwnProperty(A)?"image":this.fontService.getGlyph(A)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Qh);function Sw(e){var i=Cw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ww=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,Tw=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Mw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,Pw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,Iw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,Ow=function(e){(0,Yr.Z)(r,e);var i=Sw(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.heightfixed,m=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,A=a.topsurface,O=A===void 0?!0:A,D=a.sidesurface,Z=D===void 0?!0:D,X=a.sourceColor,te=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Ee=this.layer.getEncodedData(),Ue=this.calDataFrame(this.cellLength,Ee,this.cellProperties),Qe=Ue.data,ct=Ue.width,St=Ue.height;this.rowCount=St,this.dataTexture=this.cellLength>0&&Qe.length>0?this.createTexture2D({flipY:!0,data:Qe,format:W.LUMINANCE,type:W.FLOAT,width:ct,height:St}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}var bt=0,Kt=[1,1,1,1],lr=[1,1,1,1];return X&&te&&(Kt=sr(X),lr=sr(te),bt=1),{u_topsurface:Number(O),u_sidesurface:Number(Z),u_heightfixed:Number(m),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:Number(f),u_linearColor:bt,u_sourceColor:Kt,u_targetColor:lr,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),C=x.frag,A=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:A,fragmentShader:C,triangulation:Ty,stencil:Sn(f,m),cull:{enable:!0,face:W.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,f=a.mapTexture;return f?{frag:Tw,vert:Mw,type:"polygonExtrudeTexture"}:s?{frag:Pw,vert:Iw,type:"polygonExtrudePickLight"}:{frag:Aw,vert:ww,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],C=m-f,A=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:wn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(D,Z,X,te,Ee){var Ue=X[0],Qe=X[1];return[(Ue-f)/C,(Qe-v)/A,X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(D,Z,X,te,Ee){return Ee}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(D,Z,X,te){var Ee=D.size,Ue=Ee===void 0?10:Ee;return Array.isArray(Ue)?[Ue[0]]:[Ue]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),f){var m=new Image;m.crossOrigin="",m.src=f,m.onload=function(){a.texture=v({data:m,width:m.width,height:m.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.LINEAR,mag:W.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(co);function Rw(e){var i=Lw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Dw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Fw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,Bw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Nw=function(e){(0,Yr.Z)(r,e);var i=Rw(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,f=s===void 0?0:s,v=a.opacity,m=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),D=O.data,Z=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:W.LUMINANCE,type:W.FLOAT,width:Z,height:X}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(f),u_opacity:m,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.getModelParams(),s=a.frag,f=a.vert,v=a.triangulation,m=a.type,x=this.layer.getLayerConfig(),C=x.mask,A=C===void 0?!1:C,O=x.maskInside,D=O===void 0?!0:O;return this.layer.triangulation=v,[this.layer.buildLayerModel({moduleName:m,vertexShader:f,fragmentShader:s,triangulation:v,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:W.BACK},stencil:Sn(A,D)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s;f.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:wn.Attribute,descriptor:{name:"a_linear",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(m,x,C,A,O){return[C[3],C[4],C[5]]}}})}},{key:"getModelParams",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1}:s;return f.enable?{frag:Dw,vert:Fw,type:"polygon_linear",triangulation:CS}:{frag:kw,vert:Bw,type:"polygon_fill",triangulation:r0}}}]),r}(co);function zw(e){var i=Uw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zw=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,jw=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Vw=function(e){(0,Yr.Z)(r,e);var i=zw(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture1",void 0),(0,I.Z)((0,ae.Z)(n),"texture2",void 0),(0,I.Z)((0,ae.Z)(n),"texture3",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.watercolor,m=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),D=O.data,Z=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:W.LUMINANCE,type:W.FLOAT,width:Z,height:X}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:sr(m),u_watercolor2:sr(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:f}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:jw,fragmentShader:Zw,triangulation:r0,depth:{enable:!1},stencil:Sn(f,m)})]}},{key:"clearModels",value:function(){var a,s,f,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(f=this.texture3)===null||f===void 0||f.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],C=m-f,A=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:wn.Attribute,descriptor:{name:"a_uv",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(D,Z,X,te,Ee){var Ue=(0,Q.Z)(X,2),Qe=Ue[0],ct=Ue[1];return[(Qe-f)/C,(ct-v)/A]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,f={height:0,width:0};this.texture1=s(f),this.texture2=s(f),this.texture3=s(f),v(function(x){a.texture1=m(x[0]),a.texture2=m(x[1]),a.texture3=m(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,A=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(D){var Z=new Image;Z.crossOrigin="",Z.src=D,A.push(Z),Z.onload=function(){C++,C===3&&x(A)}})}function m(x){return s({data:x,width:x.width,height:x.height,wrapS:W.MIRRORED_REPEAT,wrapT:W.MIRRORED_REPEAT,min:W.LINEAR,mag:W.LINEAR})}}}]),r}(co);function Gw(e){var i=Hw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ww=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,Xw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Yw=function(e){(0,Yr.Z)(r,e);var i=Gw(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.speed,m=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),A=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:W.LUMINANCE,type:W.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:m,u_opacity:f}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:Xw,fragmentShader:Ww,triangulation:r0,depth:{enable:!1},stencil:Sn(f,m)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],C=m-f,A=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:wn.Attribute,descriptor:{name:"a_uv",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(D,Z,X,te,Ee){var Ue=(0,Q.Z)(X,2),Qe=Ue[0],ct=Ue[1];return[(Qe-f)/C,(ct-v)/A]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var m=new Image;m.crossOrigin="",f?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),m.src=f):m.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",m.onload=function(){a.texture=v({data:m,width:m.width,height:m.height,wrapS:W.MIRRORED_REPEAT,wrapT:W.MIRRORED_REPEAT,min:W.LINEAR,mag:W.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(co),qw={fill:Nw,line:Ny,extrude:Ow,text:i_,point_fill:Vy,point_image:Gy,point_normal:Wy,point_extrude:Zy,water:Yw,ocean:Vw},Kw=qw;function $w(e){var i=Qw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function Qw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s_=function(e){(0,Yr.Z)(r,e);var i=$w(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"type","PolygonLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Kw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f==="fill"?"fill":f==="extrude"?"extrude":f==="water"?"water":f==="ocean"?"ocean":f==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),f=s.shape2d,v=s.shape3d,m=this.iconService.getIconMap(),x=a.find(function(A){return A.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(f==null?void 0:f.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":m.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(Qh);function Jw(e){var i=eT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function eT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tT=function(e){(0,Yr.Z)(r,e);var i=Jw(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"isLayerGroup",!0),n}return(0,Ct.Z)(r,[{key:"addChild",value:function(a){this.layerChildren.push(a)}},{key:"removeChild",value:function(a){var s=this.layerChildren.indexOf(a);s>-1&&this.layerChildren.splice(s,1),a.destroy()}},{key:"clearChild",value:function(){this.layerChildren.forEach(function(a){a.destroy()}),this.layerChildren=[]}},{key:"hasChild",value:function(a){return this.layerChildren.includes(a)}}]),r}(Qh);function rT(e){var i=nT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function nT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iT=function(e){(0,Yr.Z)(r,e);var i=rT(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"initedTileset",!1),(0,I.Z)((0,ae.Z)(n),"tilesetManager",void 0),(0,I.Z)((0,ae.Z)(n),"showGrid",!1),(0,I.Z)((0,ae.Z)(n),"subGridLayer",void 0),(0,I.Z)((0,ae.Z)(n),"subTextLayer",void 0),(0,I.Z)((0,ae.Z)(n),"lastViewStates",void 0),(0,I.Z)((0,ae.Z)(n),"timer",void 0),(0,I.Z)((0,ae.Z)(n),"renderSubLayers",function(){if(!!n.tilesetManager){var v=n.layer;n.tilesetManager.tiles.filter(function(m){return m.isLoaded}).map(function(m){return m.layer?m.layer.updateLayerConfig({visible:m.isVisible}):(m.layer=n.creatSubLayer(m),v.addChild(m.layer)),m.layer}),n.showGrid&&(v.hasChild(n.subGridLayer)||v.addChild(n.subGridLayer),v.hasChild(n.subTextLayer)||v.addChild(n.subTextLayer)),n.layerService.renderLayers(),n.tilesetManager.isLoaded&&v.emit("tiles-loaded",n.tilesetManager.currentTiles)}}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var a,s=this.layer.getSource();this.tilesetManager=s.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var f=this.getCurrentView(),v=f.latLonBounds,m=f.zoom;return(a=this.tilesetManager)===null||a===void 0||a.update(m,v),this.showGrid&&this.renderSubGridLayer(),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"clearModels",value:function(){}},{key:"renderSubGridLayer",value:function(){if(!!this.tilesetManager){var a=this.tilesetManager.currentTiles.map(function(f){return f.bboxPolygon}),s={type:"FeatureCollection",features:a};if(this.subGridLayer){this.subGridLayer.setData(s),this.subTextLayer.setData(s);return}this.subGridLayer=new Uy({autoFit:!1}).source(s).size(1).color("red").shape("simple").style({lineType:"dash",dashArray:[1,2]}),this.subTextLayer=new o_({autoFit:!1}).source(s).size(14).color("red").shape("meta","text").style({opacity:1,strokeWidth:1,stroke:"#fff"}),this.subGridLayer.setContainer(lv(this.layer.sceneContainer),this.layer.sceneContainer),this.subTextLayer.setContainer(lv(this.layer.sceneContainer),this.layer.sceneContainer),this.subGridLayer.init(),this.subTextLayer.init()}}},{key:"registerBuiltinAttributes",value:function(){}},{key:"bindTilesetEvent",value:function(){var a=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(s){}),this.tilesetManager.on("tile-unload",function(s){a.destroySubLayer(s)}),this.tilesetManager.on("tile-error",function(s,f){}),this.tilesetManager.on("tile-update",this.renderSubLayers),this.mapService.on("mapchange",function(s){var f=a.getCurrentView(),v=f.latLonBounds,m=f.zoom;if(a.mapService.version==="GAODE1.x"){var x=a.layer.getLayerConfig(),C=x.visible;m<3&&C?(a.layer.updateLayerConfig({visible:!1}),a.layerService.updateLayerRenderList()):m>=3&&!C&&(a.layer.updateLayerConfig({visible:!0}),a.layerService.updateLayerRenderList())}a.lastViewStates&&a.lastViewStates.zoom===m&&a.lastViewStates.latLonBounds.toString()===v.toString()||(a.lastViewStates={zoom:m,latLonBounds:v},a.timer&&(clearTimeout(a.timer),a.timer=null),a.timer=setTimeout(function(){var A;(A=a.tilesetManager)===null||A===void 0||A.update(m,v),a.showGrid&&a.renderSubGridLayer()},250))}))}},{key:"creatSubLayer",value:function(a){var s=this.layer.getLayerConfig(),f=s.opacity,v=f===void 0?1:f,m=s.zIndex,x=m===void 0?0:m,C=new Fy({visible:a.isVisible,zIndex:x}).source(a.data,{parser:{type:"image",extent:a.bounds}}).style({opacity:v}),A=lv(this.layer.sceneContainer);return C.setContainer(A,this.layer.sceneContainer),C.init(),C}},{key:"destroySubLayer",value:function(a){if(a.layer){var s=this.layer;s.removeChild(a.layer)}}},{key:"getCurrentView",value:function(){var a=this.mapService.getBounds(),s=[a[0][0],a[0][1],a[1][0],a[1][1]],f=this.mapService.getZoom();return{latLonBounds:s,zoom:f}}}]),r}(co);function aT(e){var i=oT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function oT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sT=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,uT=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,u_=function(e){(0,Yr.Z)(r,e);var i=aT(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"texture",void 0),(0,I.Z)((0,ae.Z)(n),"colorTexture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.clampLow,m=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,A=a.noDataValue,O=A===void 0?-9999999:A,D=a.domain,Z=D===void 0?[0,1]:D;return this.updateColorTexure(),{u_opacity:f||1,u_texture:this.texture,u_domain:Z,u_clampLow:m,u_clampHigh:typeof C!="undefined"?C:m,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){this.layer.isLayerGroup=!1;var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,A=x.data.dataArray[0];this.texture=C({data:A.data,width:A.width,height:A.height,format:W.LUMINANCE,type:W.FLOAT});var O=this.layer.getLayerConfig(),D=O.rampColors,Z=kn(D);return this.colorTexture=C({data:Z.data,width:Z.width,height:Z.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:uT,fragmentShader:sT,triangulation:Py,primitive:W.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Sn(f,m)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),f=s.rampColors,v=kn(f);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(co),lT={raster:u_,raster3d:u_,rasterTile:iT},cT=lT;function fT(e){var i=hT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function hT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pT=function(e){(0,Yr.Z)(r,e);var i=fT(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"type","RasterLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new cT[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{},rasterTile:{}};return s[a]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),r}(tT);function dT(e){var i=vT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function vT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mT=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,gT=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,yT=function(e){(0,Yr.Z)(r,e);var i=dT(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?0:s;return{u_opacity:Gu()(f)?f:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:gT,fragmentShader:mT,triangulation:r0,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:W.ALWAYS,ref:1,mask:255},opFront:{fail:W.REPLACE,zfail:W.REPLACE,zpass:W.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(co),_T={fill:yT},xT=_T;function bT(e){var i=ET();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ST=function(e){(0,Yr.Z)(r,e);var i=bT(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,ae.Z)(n),"type","MaskLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new xT[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(Qh),l_,c_,f_,h_,p_,hv,d_,v_,m_;function g_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function CT(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?g_(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var AT=(l_=(0,nt.b2)(),c_=(0,nt.f3)(Be.IGlobalConfigService),f_=(0,nt.f3)(Be.IMapService),h_=(0,nt.f3)(Be.IFontService),l_(p_=(hv=function(){function e(){(0,lt.Z)(this,e),He(this,"configService",d_,this),He(this,"mapService",v_,this),He(this,"fontService",m_,this)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(O){return O.needRemapping}),A=x;m!=null&&m.needRemapping&&m!==null&&m!==void 0&&m.scale&&(A=x.filter(function(O){return a.applyAttributeMapping(m,O,f)[0]})),C.length&&(m!=null&&m.needRemapping?(r.setEncodedData(a.mapping(r,v,A,void 0,f)),m.needRemapping=!1):r.setEncodedData(a.mapping(r,C,A,r.getEncodedData(),f)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;m!=null&&m.scale&&(C=x.filter(function(A){return a.applyAttributeMapping(m,A,f)[0]})),r.setEncodedData(this.mapping(r,v,C,void 0,f)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=Re(a),f=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return f}},{key:"mapping",value:function(r,n,a,s,f){var v=this,m=r.getLayerConfig(),x=m.arrow,C=x===void 0?{enable:!1}:x,A=a.map(function(O,D){var Z=s?s[D]:{},X=CT({id:O._id,coordinates:O.coordinates},Z);if(n.filter(function(Ue){return Ue.scale!==void 0}).forEach(function(Ue){var Qe=v.applyAttributeMapping(Ue,O,f);Ue.needRemapping=!1,Ue.name==="color"&&(Qe=Qe.map(function(ct){return sr(ct)})),X[Ue.name]=Array.isArray(Qe)&&Qe.length===1?Qe[0]:Qe,Ue.name==="shape"&&(X.shape=v.fontService.getIconFontKey(X[Ue.name]))}),X.shape==="line"&&C.enable){var te=X.coordinates,Ee=v.getArrowPoints(te[0],te[1]);X.coordinates.splice(1,0,Ee,Ee)}return X});return this.adjustData2Amap2Coordinates(A,r),this.adjustData2SimpleCoordinates(A),A}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var a=this;if(r.length>0&&this.mapService.version===Ls["GAODE2.x"]){var s=this.getLayerCenter(n);typeof r[0].coordinates[0]=="number"?r.filter(function(f){return!f.originCoordinates}).map(function(f){f.version=Ls["GAODE2.x"],f.originCoordinates=pu()(f.coordinates),f.coordinates=a.mapService.lngLatToCoordByLayer(f.coordinates,s)}):r.filter(function(f){return!f.originCoordinates}).map(function(f){f.version=Ls["GAODE2.x"],f.originCoordinates=pu()(f.coordinates),f.coordinates=a.mapService.lngLatToCoordsByLayer(f.coordinates,s)})}}},{key:"getLayerCenter",value:function(r){var n=r.getSource();return n.center}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Ls.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(f){var v=[];f.map(function(m){v.push(n.mapService.simpleMapCoord.unproject(m))}),a.push(v)}),a}else{var s=[];return r.map(function(f){s.push(n.mapService.simpleMapCoord.unproject(f))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var f=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];f.forEach(function(x){var C,A=x.field;(n.hasOwnProperty(A)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[A])});var m=r.mapping?r.mapping(v):[];return r.name==="color"&&!Dr(m[0])?[a]:m}}]),e}(),d_=tt(hv.prototype,"configService",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v_=tt(hv.prototype,"mapService",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m_=tt(hv.prototype,"fontService",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hv))||p_),y_,__,wT=(y_=(0,nt.b2)(),y_(__=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"mapService",void 0)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Be.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:zt,options:cr},f=s.data,v=s.options;r.setSource(new Dt(f,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,f=s.zoom,v=f===void 0?0:f,m=s.maxZoom,x=m===void 0?16:m,C=this.mapService.getZoom()-1,A=r.dataState.dataSourceNeedUpdate;return a&&(A||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||__);function W0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function x_(e){return e.length===1&&(e=TT(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function TT(e){return function(i,r){return W0(e(i),r)}}var b_=x_(W0),MT=b_.right,Q4=b_.left,a0=MT;function E_(e,i){var r=e.length,n=-1,a,s,f;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=f=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),f<a&&(f=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=f=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),f<a&&(f=a));return[s,f]}var S_=Array.prototype,J4=S_.slice,eI=S_.map,X0=Math.sqrt(50),Y0=Math.sqrt(10),q0=Math.sqrt(2);function C_(e,i,r){var n,a=-1,s,f,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=o0(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),f=new Array(s=Math.ceil(i-e+1));++a<s;)f[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),f=new Array(s=Math.ceil(e-i+1));++a<s;)f[a]=(e-a)/v;return n&&f.reverse(),f}function o0(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=X0?10:s>=Y0?5:s>=q0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=X0?10:s>=Y0?5:s>=q0?2:1)}function K0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=X0?a*=10:s>=Y0?a*=5:s>=q0&&(a*=2),i<e?-a:a}function tI(){var e=identity,i=extent,r=sturges;function n(a){var s,f=a.length,v,m=new Array(f);for(s=0;s<f;++s)m[s]=e(a[s],s,a);var x=i(m),C=x[0],A=x[1],O=r(m,C,A);Array.isArray(O)||(O=tickStep(C,A,O),O=range(Math.ceil(C/O)*O,A,O));for(var D=O.length;O[0]<=C;)O.shift(),--D;for(;O[D-1]>A;)O.pop(),--D;var Z=new Array(D+1),X;for(s=0;s<=D;++s)X=Z[s]=[],X.x0=s>0?O[s-1]:C,X.x1=s<D?O[s]:A;for(s=0;s<f;++s)v=m[s],C<=v&&v<=A&&Z[bisect(O,v,0,D)].push(a[s]);return Z}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function rI(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function PT(e){return e===null?NaN:+e}function IT(e,i,r){if(r==null&&(r=PT),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),f=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return f+(v-f)*(a-s)}}var OT=N(87765),Pc="$";function s0(){}s0.prototype=A_.prototype={constructor:s0,has:function(e){return Pc+e in this},get:function(e){return this[Pc+e]},set:function(e,i){return this[Pc+e]=i,this},remove:function(e){var i=Pc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Pc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Pc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Pc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Pc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Pc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Pc)return!1;return!0},each:function(e){for(var i in this)i[0]===Pc&&e(this[i],i.slice(1),this)}};function A_(e,i){var r=new s0;if(e instanceof s0)e.each(function(v,m){r.set(m,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var f in e)r.set(f,e[f]);return r}var $0=A_;function nI(){var e=[],i=[],r,n,a;function s(v,m,x,C){if(m>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var A=-1,O=v.length,D=e[m++],Z,X,te=map(),Ee,Ue=x();++A<O;)(Ee=te.get(Z=D(X=v[A])+""))?Ee.push(X):te.set(Z,[X]);return te.each(function(Qe,ct){C(Ue,ct,s(Qe,m,x,C))}),Ue}function f(v,m){if(++m>e.length)return v;var x,C=i[m-1];return n!=null&&m>=e.length?x=v.entries():(x=[],v.each(function(A,O){x.push({key:O,values:f(A,m)})})),C!=null?x.sort(function(A,O){return C(A.key,O.key)}):x}return a={object:function(v){return s(v,0,RT,LT)},map:function(v){return s(v,0,w_,T_)},entries:function(v){return f(s(v,0,w_,T_),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function RT(){return{}}function LT(e,i,r){e[i]=r}function w_(){return map()}function T_(e,i,r){e.set(i,r)}function u0(){}var Zp=$0.prototype;u0.prototype=kT.prototype={constructor:u0,has:Zp.has,add:function(e){return e+="",this[Pc+e]=e,this},remove:Zp.remove,clear:Zp.clear,values:Zp.keys,size:Zp.size,empty:Zp.empty,each:Zp.each};function kT(e,i){var r=new u0;if(e instanceof u0)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var iI=null,M_=Array.prototype,l0=M_.map,jp=M_.slice;function tp(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function P_(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var I_={name:"implicit"};function c0(){var e=$0(),i=[],r=[],n=I_;function a(s){var f=s+"",v=e.get(f);if(!v){if(n!==I_)return n;e.set(f,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=$0();for(var f=-1,v=s.length,m,x;++f<v;)e.has(x=(m=s[f])+"")||e.set(x,i.push(m));return a},a.range=function(s){return arguments.length?(r=jp.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return c0(i,r).unknown(n)},tp.apply(a,arguments),a}function O_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,f=!1,v=0,m=0,x=.5;delete e.unknown;function C(){var A=i().length,O=n[1]<n[0],D=n[O-0],Z=n[1-O];a=(Z-D)/Math.max(1,A-v+m*2),f&&(a=Math.floor(a)),D+=(Z-D-a*(A-v))*x,s=a*(1-v),f&&(D=Math.round(D),s=Math.round(s));var X=sequence(A).map(function(te){return D+a*te});return r(O?X.reverse():X)}return e.domain=function(A){return arguments.length?(i(A),C()):i()},e.range=function(A){return arguments.length?(n=[+A[0],+A[1]],C()):n.slice()},e.rangeRound=function(A){return n=[+A[0],+A[1]],f=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(A){return arguments.length?(f=!!A,C()):f},e.padding=function(A){return arguments.length?(v=Math.min(1,m=+A),C()):v},e.paddingInner=function(A){return arguments.length?(v=Math.min(1,A),C()):v},e.paddingOuter=function(A){return arguments.length?(m=+A,C()):m},e.align=function(A){return arguments.length?(x=Math.max(0,Math.min(1,A)),C()):x},e.copy=function(){return O_(i(),n).round(f).paddingInner(v).paddingOuter(m).align(x)},initRange.apply(C(),arguments)}function R_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return R_(i())},e}function aI(){return R_(O_.apply(null,arguments).paddingInner(1))}var DT=N(21775),FT=N(73626);function BT(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function NT(e){return function(){return e}}function Q0(e){return+e}var L_=[0,1];function Wu(e){return e}function J0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:NT(isNaN(i)?NaN:.5)}function k_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function zT(e,i,r){var n=e[0],a=e[1],s=i[0],f=i[1];return a<n?(n=J0(a,n),s=r(f,s)):(n=J0(n,a),s=r(s,f)),function(v){return s(n(v))}}function UT(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++f<n;)a[f]=J0(e[f],e[f+1]),s[f]=r(i[f],i[f+1]);return function(v){var m=a0(e,v,1,n)-1;return s[m](a[m](v))}}function f0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function em(){var e=L_,i=L_,r=DT.Z,n,a,s,f=Wu,v,m,x;function C(){return v=Math.min(e.length,i.length)>2?UT:zT,m=x=null,A}function A(O){return isNaN(O=+O)?s:(m||(m=v(e.map(n),i,r)))(n(f(O)))}return A.invert=function(O){return f(a((x||(x=v(i,e.map(n),FT.Z)))(O)))},A.domain=function(O){return arguments.length?(e=l0.call(O,Q0),f===Wu||(f=k_(e)),C()):e.slice()},A.range=function(O){return arguments.length?(i=jp.call(O),C()):i.slice()},A.rangeRound=function(O){return i=jp.call(O),r=BT,C()},A.clamp=function(O){return arguments.length?(f=O?k_(e):Wu,A):f!==Wu},A.interpolate=function(O){return arguments.length?(r=O,C()):r},A.unknown=function(O){return arguments.length?(s=O,A):s},function(O,D){return n=O,a=D,C()}}function D_(e,i){return em()(e,i)}var ZT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function h0(e){if(!(i=ZT.exec(e)))throw new Error("invalid format: "+e);var i;return new tm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}h0.prototype=tm.prototype;function tm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}tm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function jT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function p0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Ad(e){return e=p0(Math.abs(e)),e?e[1]:NaN}function VT(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ad(i)/3)))*3-Ad(Math.abs(e)))}function GT(e,i){return function(r,n){for(var a=r.length,s=[],f=0,v=e[0],m=0;a>0&&v>0&&(m+v+1>n&&(v=Math.max(1,n-m)),s.push(r.substring(a-=v,a+v)),!((m+=v+1)>n));)v=e[f=(f+1)%e.length];return s.reverse().join(i)}}function HT(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function WT(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var F_;function XT(e,i){var r=p0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(F_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=n.length;return s===f?n:s>f?n+new Array(s-f+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+p0(e,Math.max(0,i+s-1))[0]}function B_(e,i){var r=p0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var N_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:jT,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return B_(e*100,i)},r:B_,s:XT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function z_(e){return e}var U_=Array.prototype.map,Z_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function YT(e){var i=e.grouping===void 0||e.thousands===void 0?z_:GT(U_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?z_:HT(U_.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",m=e.nan===void 0?"NaN":e.nan+"";function x(A){A=h0(A);var O=A.fill,D=A.align,Z=A.sign,X=A.symbol,te=A.zero,Ee=A.width,Ue=A.comma,Qe=A.precision,ct=A.trim,St=A.type;St==="n"?(Ue=!0,St="g"):N_[St]||(Qe===void 0&&(Qe=12),ct=!0,St="g"),(te||O==="0"&&D==="=")&&(te=!0,O="0",D="=");var bt=X==="$"?r:X==="#"&&/[boxX]/.test(St)?"0"+St.toLowerCase():"",Kt=X==="$"?n:/[%p]/.test(St)?f:"",lr=N_[St],Mr=/[defgprs%]/.test(St);Qe=Qe===void 0?6:/[gprs]/.test(St)?Math.max(1,Math.min(21,Qe)):Math.max(0,Math.min(20,Qe));function Xr(_r){var on=bt,Ln=Kt,Un,Fa,Mo;if(St==="c")Ln=lr(_r)+Ln,_r="";else{_r=+_r;var Ps=_r<0||1/_r<0;if(_r=isNaN(_r)?m:lr(Math.abs(_r),Qe),ct&&(_r=WT(_r)),Ps&&+_r==0&&Z!=="+"&&(Ps=!1),on=(Ps?Z==="("?Z:v:Z==="-"||Z==="("?"":Z)+on,Ln=(St==="s"?Z_[8+F_/3]:"")+Ln+(Ps&&Z==="("?")":""),Mr){for(Un=-1,Fa=_r.length;++Un<Fa;)if(Mo=_r.charCodeAt(Un),48>Mo||Mo>57){Ln=(Mo===46?a+_r.slice(Un+1):_r.slice(Un))+Ln,_r=_r.slice(0,Un);break}}}Ue&&!te&&(_r=i(_r,Infinity));var au=on.length+_r.length+Ln.length,ks=au<Ee?new Array(Ee-au+1).join(O):"";switch(Ue&&te&&(_r=i(ks+_r,ks.length?Ee-Ln.length:Infinity),ks=""),D){case"<":_r=on+_r+Ln+ks;break;case"=":_r=on+ks+_r+Ln;break;case"^":_r=ks.slice(0,au=ks.length>>1)+on+_r+Ln+ks.slice(au);break;default:_r=ks+on+_r+Ln;break}return s(_r)}return Xr.toString=function(){return A+""},Xr}function C(A,O){var D=x((A=h0(A),A.type="f",A)),Z=Math.max(-8,Math.min(8,Math.floor(Ad(O)/3)))*3,X=Math.pow(10,-Z),te=Z_[8+Z/3];return function(Ee){return D(X*Ee)+te}}return{format:x,formatPrefix:C}}var d0,rm,j_;qT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function qT(e){return d0=YT(e),rm=d0.format,j_=d0.formatPrefix,d0}function KT(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Ad(i)-Ad(e))+1}function $T(e){return Math.max(0,-Ad(Math.abs(e)))}function QT(e,i,r,n){var a=K0(e,i,r),s;switch(n=h0(n==null?",f":n),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=VT(a,f))&&(n.precision=s),j_(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=KT(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=$T(a))&&(n.precision=s-(n.type==="%")*2);break}}return rm(n)}function wd(e){var i=e.domain;return e.ticks=function(r){var n=i();return C_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return QT(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,f=n[a],v=n[s],m;return v<f&&(m=f,f=v,v=m,m=a,a=s,s=m),m=o0(f,v,r),m>0?(f=Math.floor(f/m)*m,v=Math.ceil(v/m)*m,m=o0(f,v,r)):m<0&&(f=Math.ceil(f*m)/m,v=Math.floor(v*m)/m,m=o0(f,v,r)),m>0?(n[a]=Math.floor(f/m)*m,n[s]=Math.ceil(v/m)*m,i(n)):m<0&&(n[a]=Math.ceil(f*m)/m,n[s]=Math.floor(v*m)/m,i(n)),e},e}function V_(){var e=D_(Wu,Wu);return e.copy=function(){return f0(e,V_())},tp.apply(e,arguments),wd(e)}function G_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=l0.call(n,Q0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return G_(e).unknown(i)},e=arguments.length?l0.call(e,Q0):[0,1],wd(r)}function H_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],f;return s<a&&(f=r,r=n,n=f,f=a,a=s,s=f),e[r]=i.floor(a),e[n]=i.ceil(s),e}function W_(e){return Math.log(e)}function X_(e){return Math.exp(e)}function JT(e){return-Math.log(-e)}function e5(e){return-Math.exp(-e)}function t5(e){return isFinite(e)?+("1e"+e):e<0?0:e}function r5(e){return e===10?t5:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function n5(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Y_(e){return function(i){return-e(-i)}}function i5(e){var i=e(W_,X_),r=i.domain,n=10,a,s;function f(){return a=n5(n),s=r5(n),r()[0]<0?(a=Y_(a),s=Y_(s),e(JT,e5)):e(W_,X_),i}return i.base=function(v){return arguments.length?(n=+v,f()):n},i.domain=function(v){return arguments.length?(r(v),f()):r()},i.ticks=function(v){var m=r(),x=m[0],C=m[m.length-1],A;(A=C<x)&&(O=x,x=C,C=O);var O=a(x),D=a(C),Z,X,te,Ee=v==null?10:+v,Ue=[];if(!(n%1)&&D-O<Ee){if(O=Math.round(O)-1,D=Math.round(D)+1,x>0){for(;O<D;++O)for(X=1,Z=s(O);X<n;++X)if(te=Z*X,!(te<x)){if(te>C)break;Ue.push(te)}}else for(;O<D;++O)for(X=n-1,Z=s(O);X>=1;--X)if(te=Z*X,!(te<x)){if(te>C)break;Ue.push(te)}}else Ue=C_(O,D,Math.min(D-O,Ee)).map(s);return A?Ue.reverse():Ue},i.tickFormat=function(v,m){if(m==null&&(m=n===10?".0e":","),typeof m!="function"&&(m=rm(m)),v===Infinity)return m;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var A=C/s(Math.round(a(C)));return A*n<n-.5&&(A*=n),A<=x?m(C):""}},i.nice=function(){return r(H_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function q_(){var e=i5(em()).domain([1,10]);return e.copy=function(){return f0(e,q_()).base(e.base())},tp.apply(e,arguments),e}function K_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function $_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function a5(e){var i=1,r=e(K_(i),$_(i));return r.constant=function(n){return arguments.length?e(K_(i=+n),$_(i)):i},linearish(r)}function o5(){var e=a5(transformer());return e.copy=function(){return copy(e,o5()).constant(e.constant())},initRange.apply(e,arguments)}function Q_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function s5(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function u5(e){return e<0?-e*e:e*e}function l5(e){var i=e(Wu,Wu),r=1;function n(){return r===1?e(Wu,Wu):r===.5?e(s5,u5):e(Q_(r),Q_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},wd(i)}function nm(){var e=l5(em());return e.copy=function(){return f0(e,nm()).exponent(e.exponent())},tp.apply(e,arguments),e}function oI(){return nm.apply(null,arguments).exponent(.5)}function J_(){var e=[],i=[],r=[],n;function a(){var f=0,v=Math.max(1,i.length);for(r=new Array(v-1);++f<v;)r[f-1]=IT(e,f/v);return s}function s(f){return isNaN(f=+f)?n:i[a0(r,f)]}return s.invertExtent=function(f){var v=i.indexOf(f);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(f){if(!arguments.length)return e.slice();e=[];for(var v=0,m=f.length,x;v<m;++v)x=f[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(W0),a()},s.range=function(f){return arguments.length?(i=jp.call(f),a()):i.slice()},s.unknown=function(f){return arguments.length?(n=f,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return J_().domain(e).range(i).unknown(n)},tp.apply(s,arguments)}function e1(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function f(m){return m<=m?a[a0(n,m,0,r)]:s}function v(){var m=-1;for(n=new Array(r);++m<r;)n[m]=((m+1)*i-(m-r)*e)/(r+1);return f}return f.domain=function(m){return arguments.length?(e=+m[0],i=+m[1],v()):[e,i]},f.range=function(m){return arguments.length?(r=(a=jp.call(m)).length-1,v()):a.slice()},f.invertExtent=function(m){var x=a.indexOf(m);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},f.unknown=function(m){return arguments.length&&(s=m),f},f.thresholds=function(){return n.slice()},f.copy=function(){return e1().domain([e,i]).range(a).unknown(s)},tp.apply(wd(f),arguments)}function t1(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[a0(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=jp.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=jp.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var f=i.indexOf(s);return[e[f-1],e[f]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return t1().domain(e).range(i).unknown(r)},tp.apply(a,arguments)}var im=new Date,am=new Date;function _l(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var f=a(s),v=a.ceil(s);return s-f<v-s?f:v},a.offset=function(s,f){return i(s=new Date(+s),f==null?1:Math.floor(f)),s},a.range=function(s,f,v){var m=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<f)||!(v>0))return m;do m.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<f);return m},a.filter=function(s){return _l(function(f){if(f>=f)for(;e(f),!s(f);)f.setTime(f-1)},function(f,v){if(f>=f)if(v<0)for(;++v<=0;)for(;i(f,-1),!s(f););else for(;--v>=0;)for(;i(f,1),!s(f););})},r&&(a.count=function(s,f){return im.setTime(+s),am.setTime(+f),e(im),e(am),Math.floor(r(im,am))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(f){return n(f)%s==0}:function(f){return a.count(0,f)%s==0}):a}),a}var om=_l(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});om.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:_l(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Td=om,sI=om.range,r1=_l(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),c5=r1,uI=r1.range,v0=1e3,pv=6e4,n1=36e5,i1=864e5,a1=6048e5;function Vp(e){return _l(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*pv)/a1})}var sm=Vp(0),m0=Vp(1),f5=Vp(2),h5=Vp(3),Md=Vp(4),p5=Vp(5),d5=Vp(6),lI=sm.range,cI=m0.range,fI=f5.range,hI=h5.range,pI=Md.range,dI=p5.range,vI=d5.range,o1=_l(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*pv)/i1},function(e){return e.getDate()-1}),um=o1,mI=o1.range,s1=_l(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*v0-e.getMinutes()*pv)},function(e,i){e.setTime(+e+i*n1)},function(e,i){return(i-e)/n1},function(e){return e.getHours()}),v5=s1,gI=s1.range,u1=_l(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*v0)},function(e,i){e.setTime(+e+i*pv)},function(e,i){return(i-e)/pv},function(e){return e.getMinutes()}),m5=u1,yI=u1.range,l1=_l(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*v0)},function(e,i){return(i-e)/v0},function(e){return e.getUTCSeconds()}),g5=l1,_I=l1.range,g0=_l(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});g0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?_l(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):g0};var y5=g0,xI=g0.range;function Gp(e){return _l(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/a1})}var c1=Gp(0),y0=Gp(1),_5=Gp(2),x5=Gp(3),Pd=Gp(4),b5=Gp(5),E5=Gp(6),bI=c1.range,EI=y0.range,SI=_5.range,CI=x5.range,AI=Pd.range,wI=b5.range,TI=E5.range,f1=_l(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/i1},function(e){return e.getUTCDate()-1}),h1=f1,MI=f1.range,lm=_l(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});lm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:_l(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var dv=lm,PI=lm.range;function cm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function fm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function vv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function S5(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,f=e.shortDays,v=e.months,m=e.shortMonths,x=mv(a),C=gv(a),A=mv(s),O=gv(s),D=mv(f),Z=gv(f),X=mv(v),te=gv(v),Ee=mv(m),Ue=gv(m),Qe={a:Ps,A:au,b:ks,B:Rc,c:null,d:y1,e:y1,f:W5,g:rM,G:iM,H:V5,I:G5,j:H5,L:_1,m:X5,M:Y5,p:Sm,q:L0,Q:A1,s:w1,S:q5,u:K5,U:$5,V:Q5,w:J5,W:eM,x:null,X:null,y:tM,Y:nM,Z:aM,"%":C1},ct={a:_4,A:x4,b:b4,B:E4,c:null,d:b1,e:b1,f:lM,g:_M,G:bM,H:oM,I:sM,j:uM,L:E1,m:cM,M:fM,p:S4,q:C4,Q:A1,s:w1,S:hM,u:pM,U:dM,V:vM,w:mM,W:gM,x:null,X:null,y:yM,Y:xM,Z:EM,"%":C1},St={a:Xr,A:_r,b:on,B:Ln,c:Un,d:m1,e:m1,f:z5,g:v1,G:d1,H:g1,I:g1,j:D5,L:N5,m:k5,M:F5,p:Mr,q:L5,Q:Z5,s:j5,S:B5,u:M5,U:P5,V:I5,w:T5,W:O5,x:Fa,X:Mo,y:v1,Y:d1,Z:R5,"%":U5};Qe.x=bt(r,Qe),Qe.X=bt(n,Qe),Qe.c=bt(i,Qe),ct.x=bt(r,ct),ct.X=bt(n,ct),ct.c=bt(i,ct);function bt(si,Oa){return function(Ka){var gn=[],Zl=-1,Go=0,ic=si.length,ac,Yp,Ib;for(Ka instanceof Date||(Ka=new Date(+Ka));++Zl<ic;)si.charCodeAt(Zl)===37&&(gn.push(si.slice(Go,Zl)),(Yp=p1[ac=si.charAt(++Zl)])!=null?ac=si.charAt(++Zl):Yp=ac==="e"?" ":"0",(Ib=Oa[ac])&&(ac=Ib(Ka,Yp)),gn.push(ac),Go=Zl+1);return gn.push(si.slice(Go,Zl)),gn.join("")}}function Kt(si,Oa){return function(Ka){var gn=vv(1900,void 0,1),Zl=lr(gn,si,Ka+="",0),Go,ic;if(Zl!=Ka.length)return null;if("Q"in gn)return new Date(gn.Q);if("s"in gn)return new Date(gn.s*1e3+("L"in gn?gn.L:0));if(Oa&&!("Z"in gn)&&(gn.Z=0),"p"in gn&&(gn.H=gn.H%12+gn.p*12),gn.m===void 0&&(gn.m="q"in gn?gn.q:0),"V"in gn){if(gn.V<1||gn.V>53)return null;"w"in gn||(gn.w=1),"Z"in gn?(Go=fm(vv(gn.y,0,1)),ic=Go.getUTCDay(),Go=ic>4||ic===0?y0.ceil(Go):y0(Go),Go=h1.offset(Go,(gn.V-1)*7),gn.y=Go.getUTCFullYear(),gn.m=Go.getUTCMonth(),gn.d=Go.getUTCDate()+(gn.w+6)%7):(Go=cm(vv(gn.y,0,1)),ic=Go.getDay(),Go=ic>4||ic===0?m0.ceil(Go):m0(Go),Go=um.offset(Go,(gn.V-1)*7),gn.y=Go.getFullYear(),gn.m=Go.getMonth(),gn.d=Go.getDate()+(gn.w+6)%7)}else("W"in gn||"U"in gn)&&("w"in gn||(gn.w="u"in gn?gn.u%7:"W"in gn?1:0),ic="Z"in gn?fm(vv(gn.y,0,1)).getUTCDay():cm(vv(gn.y,0,1)).getDay(),gn.m=0,gn.d="W"in gn?(gn.w+6)%7+gn.W*7-(ic+5)%7:gn.w+gn.U*7-(ic+6)%7);return"Z"in gn?(gn.H+=gn.Z/100|0,gn.M+=gn.Z%100,fm(gn)):cm(gn)}}function lr(si,Oa,Ka,gn){for(var Zl=0,Go=Oa.length,ic=Ka.length,ac,Yp;Zl<Go;){if(gn>=ic)return-1;if(ac=Oa.charCodeAt(Zl++),ac===37){if(ac=Oa.charAt(Zl++),Yp=St[ac in p1?Oa.charAt(Zl++):ac],!Yp||(gn=Yp(si,Ka,gn))<0)return-1}else if(ac!=Ka.charCodeAt(gn++))return-1}return gn}function Mr(si,Oa,Ka){var gn=x.exec(Oa.slice(Ka));return gn?(si.p=C[gn[0].toLowerCase()],Ka+gn[0].length):-1}function Xr(si,Oa,Ka){var gn=D.exec(Oa.slice(Ka));return gn?(si.w=Z[gn[0].toLowerCase()],Ka+gn[0].length):-1}function _r(si,Oa,Ka){var gn=A.exec(Oa.slice(Ka));return gn?(si.w=O[gn[0].toLowerCase()],Ka+gn[0].length):-1}function on(si,Oa,Ka){var gn=Ee.exec(Oa.slice(Ka));return gn?(si.m=Ue[gn[0].toLowerCase()],Ka+gn[0].length):-1}function Ln(si,Oa,Ka){var gn=X.exec(Oa.slice(Ka));return gn?(si.m=te[gn[0].toLowerCase()],Ka+gn[0].length):-1}function Un(si,Oa,Ka){return lr(si,i,Oa,Ka)}function Fa(si,Oa,Ka){return lr(si,r,Oa,Ka)}function Mo(si,Oa,Ka){return lr(si,n,Oa,Ka)}function Ps(si){return f[si.getDay()]}function au(si){return s[si.getDay()]}function ks(si){return m[si.getMonth()]}function Rc(si){return v[si.getMonth()]}function Sm(si){return a[+(si.getHours()>=12)]}function L0(si){return 1+~~(si.getMonth()/3)}function _4(si){return f[si.getUTCDay()]}function x4(si){return s[si.getUTCDay()]}function b4(si){return m[si.getUTCMonth()]}function E4(si){return v[si.getUTCMonth()]}function S4(si){return a[+(si.getUTCHours()>=12)]}function C4(si){return 1+~~(si.getUTCMonth()/3)}return{format:function(si){var Oa=bt(si+="",Qe);return Oa.toString=function(){return si},Oa},parse:function(si){var Oa=Kt(si+="",!1);return Oa.toString=function(){return si},Oa},utcFormat:function(si){var Oa=bt(si+="",ct);return Oa.toString=function(){return si},Oa},utcParse:function(si){var Oa=Kt(si+="",!0);return Oa.toString=function(){return si},Oa}}}var p1={"-":"",_:" ","0":"0"},yu=/^\s*\d+/,C5=/^%/,A5=/[\\^$*+?|[\]().{}]/g;function qa(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function w5(e){return e.replace(A5,"\\$&")}function mv(e){return new RegExp("^(?:"+e.map(w5).join("|")+")","i")}function gv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function T5(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function M5(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function P5(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function I5(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function O5(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function d1(e,i,r){var n=yu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function v1(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function R5(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function L5(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function k5(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function m1(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function D5(e,i,r){var n=yu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function g1(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function F5(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function B5(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function N5(e,i,r){var n=yu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function z5(e,i,r){var n=yu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function U5(e,i,r){var n=C5.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function Z5(e,i,r){var n=yu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function j5(e,i,r){var n=yu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function y1(e,i){return qa(e.getDate(),i,2)}function V5(e,i){return qa(e.getHours(),i,2)}function G5(e,i){return qa(e.getHours()%12||12,i,2)}function H5(e,i){return qa(1+um.count(Td(e),e),i,3)}function _1(e,i){return qa(e.getMilliseconds(),i,3)}function W5(e,i){return _1(e,i)+"000"}function X5(e,i){return qa(e.getMonth()+1,i,2)}function Y5(e,i){return qa(e.getMinutes(),i,2)}function q5(e,i){return qa(e.getSeconds(),i,2)}function K5(e){var i=e.getDay();return i===0?7:i}function $5(e,i){return qa(sm.count(Td(e)-1,e),i,2)}function x1(e){var i=e.getDay();return i>=4||i===0?Md(e):Md.ceil(e)}function Q5(e,i){return e=x1(e),qa(Md.count(Td(e),e)+(Td(e).getDay()===4),i,2)}function J5(e){return e.getDay()}function eM(e,i){return qa(m0.count(Td(e)-1,e),i,2)}function tM(e,i){return qa(e.getFullYear()%100,i,2)}function rM(e,i){return e=x1(e),qa(e.getFullYear()%100,i,2)}function nM(e,i){return qa(e.getFullYear()%1e4,i,4)}function iM(e,i){var r=e.getDay();return e=r>=4||r===0?Md(e):Md.ceil(e),qa(e.getFullYear()%1e4,i,4)}function aM(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+qa(i/60|0,"0",2)+qa(i%60,"0",2)}function b1(e,i){return qa(e.getUTCDate(),i,2)}function oM(e,i){return qa(e.getUTCHours(),i,2)}function sM(e,i){return qa(e.getUTCHours()%12||12,i,2)}function uM(e,i){return qa(1+h1.count(dv(e),e),i,3)}function E1(e,i){return qa(e.getUTCMilliseconds(),i,3)}function lM(e,i){return E1(e,i)+"000"}function cM(e,i){return qa(e.getUTCMonth()+1,i,2)}function fM(e,i){return qa(e.getUTCMinutes(),i,2)}function hM(e,i){return qa(e.getUTCSeconds(),i,2)}function pM(e){var i=e.getUTCDay();return i===0?7:i}function dM(e,i){return qa(c1.count(dv(e)-1,e),i,2)}function S1(e){var i=e.getUTCDay();return i>=4||i===0?Pd(e):Pd.ceil(e)}function vM(e,i){return e=S1(e),qa(Pd.count(dv(e),e)+(dv(e).getUTCDay()===4),i,2)}function mM(e){return e.getUTCDay()}function gM(e,i){return qa(y0.count(dv(e)-1,e),i,2)}function yM(e,i){return qa(e.getUTCFullYear()%100,i,2)}function _M(e,i){return e=S1(e),qa(e.getUTCFullYear()%100,i,2)}function xM(e,i){return qa(e.getUTCFullYear()%1e4,i,4)}function bM(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Pd(e):Pd.ceil(e),qa(e.getUTCFullYear()%1e4,i,4)}function EM(){return"+0000"}function C1(){return"%"}function A1(e){return+e}function w1(e){return Math.floor(+e/1e3)}var Id,T1,SM,CM,AM;wM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function wM(e){return Id=S5(e),T1=Id.format,SM=Id.parse,CM=Id.utcFormat,AM=Id.utcParse,Id}var yv=1e3,_v=yv*60,xv=_v*60,bv=xv*24,TM=bv*7,M1=bv*30,hm=bv*365;function MM(e){return new Date(e)}function PM(e){return e instanceof Date?+e:+new Date(+e)}function P1(e,i,r,n,a,s,f,v,m){var x=D_(Wu,Wu),C=x.invert,A=x.domain,O=m(".%L"),D=m(":%S"),Z=m("%I:%M"),X=m("%I %p"),te=m("%a %d"),Ee=m("%b %d"),Ue=m("%B"),Qe=m("%Y"),ct=[[f,1,yv],[f,5,5*yv],[f,15,15*yv],[f,30,30*yv],[s,1,_v],[s,5,5*_v],[s,15,15*_v],[s,30,30*_v],[a,1,xv],[a,3,3*xv],[a,6,6*xv],[a,12,12*xv],[n,1,bv],[n,2,2*bv],[r,1,TM],[i,1,M1],[i,3,3*M1],[e,1,hm]];function St(Kt){return(f(Kt)<Kt?O:s(Kt)<Kt?D:a(Kt)<Kt?Z:n(Kt)<Kt?X:i(Kt)<Kt?r(Kt)<Kt?te:Ee:e(Kt)<Kt?Ue:Qe)(Kt)}function bt(Kt,lr,Mr,Xr){if(Kt==null&&(Kt=10),typeof Kt=="number"){var _r=Math.abs(Mr-lr)/Kt,on=x_(function(Ln){return Ln[2]}).right(ct,_r);on===ct.length?(Xr=K0(lr/hm,Mr/hm,Kt),Kt=e):on?(on=ct[_r/ct[on-1][2]<ct[on][2]/_r?on-1:on],Xr=on[1],Kt=on[0]):(Xr=Math.max(K0(lr,Mr,Kt),1),Kt=v)}return Xr==null?Kt:Kt.every(Xr)}return x.invert=function(Kt){return new Date(C(Kt))},x.domain=function(Kt){return arguments.length?A(l0.call(Kt,PM)):A().map(MM)},x.ticks=function(Kt,lr){var Mr=A(),Xr=Mr[0],_r=Mr[Mr.length-1],on=_r<Xr,Ln;return on&&(Ln=Xr,Xr=_r,_r=Ln),Ln=bt(Kt,Xr,_r,lr),Ln=Ln?Ln.range(Xr,_r+1):[],on?Ln.reverse():Ln},x.tickFormat=function(Kt,lr){return lr==null?St:m(lr)},x.nice=function(Kt,lr){var Mr=A();return(Kt=bt(Kt,Mr[0],Mr[Mr.length-1],lr))?A(H_(Mr,Kt)):x},x.copy=function(){return f0(x,P1(e,i,r,n,a,s,f,v,m))},x}function IM(){return tp.apply(P1(Td,c5,sm,um,v5,m5,g5,y5,T1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function II(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function _0(){var e=0,i=1,r,n,a,s,f=Wu,v=!1,m;function x(C){return isNaN(C=+C)?m:f(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(f=C,x):f},x.unknown=function(C){return arguments.length?(m=C,x):m},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function Ev(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function I1(){var e=wd(_0()(Wu));return e.copy=function(){return Ev(e,I1())},P_.apply(e,arguments)}function OM(){var e=loggish(_0()).domain([1,10]);return e.copy=function(){return Ev(e,OM()).base(e.base())},initInterpolator.apply(e,arguments)}function RM(){var e=symlogish(_0());return e.copy=function(){return Ev(e,RM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function O1(){var e=powish(_0());return e.copy=function(){return Ev(e,O1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function OI(){return O1.apply(null,arguments).exponent(.5)}function LM(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,f;a<s;++a)f=n[a],f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return LM(i).domain(e)},initInterpolator.apply(r,arguments)}function x0(){var e=0,i=.5,r=1,n,a,s,f,v,m=Wu,x,C=!1,A;function O(D){return isNaN(D=+D)?A:(D=.5+((D=+x(D))-a)*(D<a?f:v),m(C?Math.max(0,Math.min(1,D)):D))}return O.domain=function(D){return arguments.length?(n=x(e=+D[0]),a=x(i=+D[1]),s=x(r=+D[2]),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O):[e,i,r]},O.clamp=function(D){return arguments.length?(C=!!D,O):C},O.interpolator=function(D){return arguments.length?(m=D,O):m},O.unknown=function(D){return arguments.length?(A=D,O):A},function(D){return x=D,n=D(e),a=D(i),s=D(r),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O}}function R1(){var e=wd(x0()(Wu));return e.copy=function(){return Ev(e,R1())},P_.apply(e,arguments)}function kM(){var e=loggish(x0()).domain([.1,1,10]);return e.copy=function(){return copy(e,kM()).base(e.base())},initInterpolator.apply(e,arguments)}function DM(){var e=symlogish(x0());return e.copy=function(){return copy(e,DM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function L1(){var e=powish(x0());return e.copy=function(){return copy(e,L1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function RI(){return L1.apply(null,arguments).exponent(.5)}var nc,k1,D1,F1,pm,B1;function N1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function z1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var FM=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,BM=(nc={},(0,I.Z)(nc,To.LINEAR,V_),(0,I.Z)(nc,To.POWER,nm),(0,I.Z)(nc,To.LOG,q_),(0,I.Z)(nc,To.IDENTITY,G_),(0,I.Z)(nc,To.SEQUENTIAL,I1),(0,I.Z)(nc,To.TIME,IM),(0,I.Z)(nc,To.QUANTILE,J_),(0,I.Z)(nc,To.QUANTIZE,e1),(0,I.Z)(nc,To.THRESHOLD,t1),(0,I.Z)(nc,To.CAT,c0),(0,I.Z)(nc,To.DIVERGING,R1),nc),NM=(k1=(0,nt.b2)(),D1=(0,nt.f3)(Be.IGlobalConfigService),k1(F1=(pm=function(){function e(){(0,lt.Z)(this,e),He(this,"configService",B1,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(f||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(f||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes();if(f){var v=r.getSource().data.dataArray;if(v.length===0)return;var m=f.filter(function(x){return x.needRescale});m.length&&a.caculateScalesForAttributes(m,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var f=s.scale,v=s.name;f.names=a.parseFields(s.scale.field||[]);var m=[];f.names.forEach(function(x){var C;m.push(a.createScale(x,s.name,(C=s.scale)===null||C===void 0?void 0:C.values,n))}),m.some(function(x){return x.type===qh.VARIABLE})?(f.type=qh.VARIABLE,m.forEach(function(x){if(!f.callback){var C,A,O,D,Z;f.values&&f.values!=="text"&&((C=x.option)===null||C===void 0?void 0:C.type)!==To.DIVERGING&&((A=x.option)===null||A===void 0?void 0:A.type)!==To.SEQUENTIAL?x.scale.range(f.values):((O=x.option)===null||O===void 0?void 0:O.type)===To.CAT?x.scale.range(x.option.domain):(((D=x.option)===null||D===void 0?void 0:D.type)===To.DIVERGING||((Z=x.option)===null||Z===void 0?void 0:Z.type)===To.SEQUENTIAL)&&x.scale.interpolator(OT.hD(f.values))}})):(f.type=qh.CONSTANT,f.defaultValues=m.map(function(x,C){return x.scale(f.names[C])})),f.scalers=m.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:ws()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var f,v,m=this.scaleOptions[n]&&((f=this.scaleOptions[n])===null||f===void 0?void 0:f.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:qh.VARIABLE,option:m};if(!s||!s.length)return m&&m.type?x.scale=this.createDefaultScale(m):(x.scale=c0([r]),x.type=qh.CONSTANT),x;var C=(v=s.find(function(D){return!Ac()(D[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||Ac()(C)&&!m)x.scale=c0([r]),x.type=qh.CONSTANT;else{var A=m&&m.type||this.getDefaultType(C);a==="text"&&(A=To.CAT);var O=this.createScaleConfig(A,r,m,s);x.scale=this.createDefaultScale(O),x.option=O}return x}},{key:"getDefaultType",value:function(r){var n=To.LINEAR;return typeof r=="string"&&(n=FM.test(r)?To.TIME:To.CAT),n}},{key:"createScaleConfig",value:function(r,n,a,s){var f={type:r},v=(s==null?void 0:s.map(function(C){return C[n]}))||[];if(a!=null&&a.domain)f.domain=a==null?void 0:a.domain;else if(r!==To.CAT&&r!==To.QUANTILE&&r!==To.DIVERGING)f.domain=E_(v);else if(r===To.CAT)f.domain=Mm()(v);else if(r===To.QUANTILE)f.domain=v;else if(r===To.DIVERGING){var m=E_(v),x=(a==null?void 0:a.neutral)!==void 0?a==null?void 0:a.neutral:(m[0]+m[1])/2;f.domain=[m[0],x,m[1]]}return z1(z1({},f),a)}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=r.unknown,f=r.clamp,v=r.nice,m=BM[n]();return a&&m.domain&&m.domain(a),s&&m.unknown(s),f!==void 0&&m.clamp&&m.clamp(f),v!==void 0&&m.nice&&m.nice(v),m}}]),e}(),B1=tt(pm.prototype,"configService",[D1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pm))||F1),U1,Z1,j1,V1,b0,G1,H1;function W1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?W1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var UM=(U1=(0,nt.b2)(),Z1=(0,nt.f3)(Be.ICameraService),j1=(0,nt.f3)(Be.IRendererService),U1(V1=(b0=function(){function e(){(0,lt.Z)(this,e),He(this,"cameraService",G1,this),He(this,"rendererService",H1,this)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(zM({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),G1=tt(b0.prototype,"cameraService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H1=tt(b0.prototype,"rendererService",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b0))||V1),X1,Y1,ZM=(X1=(0,nt.b2)(),X1(Y1=function(){function e(){(0,lt.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||Y1),q1,K1,jM=(q1=(0,nt.b2)(),q1(K1=function(){function e(){(0,lt.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||K1),$1,Q1,VM=["type"];function J1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?J1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ex={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},GM={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},HM={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},WM={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},LI=null;function XM(e){var i={u_DirectionalLights:new Array(3).fill(Sv({},HM)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Sv({},WM)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[GM]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,f=(0,dh.Z)(r,VM),v=ex[s].lights,m=ex[s].num,x=i[m];i[v][x]=Sv(Sv({},i[v][x]),f),i[m]++}),i}var YM=($1=(0,nt.b2)(),$1(Q1=function(){function e(){(0,lt.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(Sv({},XM()))})})}}]),e}())||Q1),tx,rx,nx,dm,ix,qM=(tx=(0,nt.b2)(),rx=(0,nt.f3)(Be.IGlobalConfigService),tx(nx=(dm=function(){function e(){(0,lt.Z)(this,e),He(this,"configService",ix,this),(0,I.Z)(this,"enabled",void 0)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,f=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var m=r.getLayerConfig(),x=m.enableMultiPassRenderer,C=m.passes,A=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=iy(r,A,f,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var m=s.getViewportSize(),x=m.width,C=m.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),ix=tt(dm.prototype,"configService",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm))||nx),ax,ox,E0={NONE:0,ENCODE:1,HIGHLIGHT:2},KM=(ax=(0,nt.b2)(),ax(ox=function(){function e(){(0,lt.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var f=!0;s.registerStyleAttribute({name:"pickingColor",type:wn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:W.FLOAT},size:3,update:function(m,x){var C=m.id;return f?Rn(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(m){return m.addUniforms({u_PickingStage:E0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(m){return m.addUniforms({u_PickingStage:E0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),m=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,A=typeof m=="string"?sr(m):m||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Qr(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:E0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:A.map(function(D){return D*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),m=v.selectColor,x=v.selectMix,C=x===void 0?0:x,A=typeof m=="string"?sr(m):m||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Qr(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:E0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:A.map(function(D){return D*255}),u_activeMix:C,u_CurrentSelectedId:f,u_SelectColor:A.map(function(D){return D*255}),u_EnableSelect:1})})})}}]),e}())||ox),sx,ux,$M=(sx=(0,nt.b2)(),sx(ux=function(){function e(){(0,lt.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:wn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:W.FLOAT},size:3,update:function(a,s,f){return f.length===2?[f[0],f[1],0]:[f[0],f[1],f[2]]}}}),r.registerStyleAttribute({name:"filter",type:wn.Attribute,descriptor:{name:"filter",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s){var f=a.filter;return f?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:wn.Attribute,descriptor:{name:"a_Color",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(a,s){var f=a.color;return!f||!f.length?[1,1,1,1]:f}}}),r.registerStyleAttribute({name:"vertexId",type:wn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s,f,v){return[s]}}})}}]),e}())||ux),lx,cx,fx,hx,px,dx,Od,vx,mx,gx,yx,QM=(lx=(0,nt.b2)(),cx=(0,nt.f3)(Be.ICameraService),fx=(0,nt.f3)(Be.ICoordinateSystemService),hx=(0,nt.f3)(Be.IRendererService),px=(0,nt.f3)(Be.IMapService),lx(dx=(Od=function(){function e(){(0,lt.Z)(this,e),He(this,"cameraService",vx,this),He(this,"coordinateSystemService",mx,this),He(this,"rendererService",gx,this),He(this,"mapService",yx,this)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){if(n.coordinateSystemService.refresh(),a==="GAODE2.x"){var v=n.getLayerCenter(r);n.mapService.map.customCoords.setCenter(v),n.mapService.setCustomCoordCenter(v),s=n.mapService.map.customCoords.getMVPMatrix(),f=n.mapService.getCustomCoordCenter()}var m=n.rendererService.getViewportSize(),x=m.width,C=m.height;r.models.forEach(function(A){var O;A.addUniforms((O={},(0,I.Z)(O,Fp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,I.Z)(O,Fp.ViewMatrix,n.cameraService.getViewMatrix()),(0,I.Z)(O,Fp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,I.Z)(O,Fp.Zoom,n.cameraService.getZoom()),(0,I.Z)(O,Fp.ZoomScale,n.cameraService.getZoomScale()),(0,I.Z)(O,Fp.FocalDistance,n.cameraService.getFocalDistance()),(0,I.Z)(O,Fp.CameraPosition,n.cameraService.getCameraPosition()),(0,I.Z)(O,ml.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(O,ml.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,I.Z)(O,ml.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(O,ml.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(O,ml.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(O,ml.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(O,ml.Mvp,s),(0,I.Z)(O,"u_SceneCenterMKT",f),(0,I.Z)(O,"u_ViewportSize",[x,C]),(0,I.Z)(O,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,I.Z)(O,"u_DevicePixelRatio",da.devicePixelRatio),(0,I.Z)(O,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,I.Z)(O,"u_shaderPick",Number(r.getShaderPickStat())),O))})})}},{key:"getLayerCenter",value:function(r){var n=r.getSource();return n.center}}]),e}(),vx=tt(Od.prototype,"cameraService",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mx=tt(Od.prototype,"coordinateSystemService",[fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gx=tt(Od.prototype,"rendererService",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=tt(Od.prototype,"mapService",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Od))||dx),_x,xx,JM=(_x=(0,nt.b2)(),_x(xx=function(){function e(){(0,lt.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||xx),bx,Ex,e3=(bx=(0,nt.b2)(),bx(Ex=function(){function e(){(0,lt.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(f&&f.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(m){return m.needRegenerateVertices=!1});return}s.filter(function(m){return m.needRegenerateVertices}).forEach(function(m){a.updateAttributeByFeatureRange(m.name,r.getEncodedData(),m.featureRange.startIndex,m.featureRange.endIndex),m.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(f){return f.needRegenerateVertices}).forEach(function(f){a.updateAttributeByFeatureRange(f.name,r.getEncodedData(),f.featureRange.startIndex,f.featureRange.endIndex),f.needRegenerateVertices=!1})}}]),e}())||Ex);rc.bind(Be.ILayerPlugin).to(wT).inRequestScope(),rc.bind(Be.ILayerPlugin).to($M).inRequestScope(),rc.bind(Be.ILayerPlugin).to(NM).inRequestScope(),rc.bind(Be.ILayerPlugin).to(AT).inRequestScope(),rc.bind(Be.ILayerPlugin).to(jM).inRequestScope(),rc.bind(Be.ILayerPlugin).to(e3).inRequestScope(),rc.bind(Be.ILayerPlugin).to(JM).inRequestScope(),rc.bind(Be.ILayerPlugin).to(qM).inRequestScope(),rc.bind(Be.ILayerPlugin).to(QM).inRequestScope(),rc.bind(Be.ILayerPlugin).to(UM).inRequestScope(),rc.bind(Be.ILayerPlugin).to(YM).inRequestScope(),rc.bind(Be.ILayerPlugin).to(KM).inRequestScope(),rc.bind(Be.ILayerPlugin).to(ZM).inRequestScope();var t3=N(88307),r3=N.n(t3),n3=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,f=r.normalized,v=r.size,m=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:f||!1,divisor:m||0},v&&(this.attribute.size=v)}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),yh,Cv,_h,Ic,Av,rp,wv,S0,zf,Hp,Pu,Uf,Zf,C0,i3=(yh={},(0,I.Z)(yh,W.POINTS,"points"),(0,I.Z)(yh,W.LINES,"lines"),(0,I.Z)(yh,W.LINE_LOOP,"line loop"),(0,I.Z)(yh,W.LINE_STRIP,"line strip"),(0,I.Z)(yh,W.TRIANGLES,"triangles"),(0,I.Z)(yh,W.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(yh,W.TRIANGLE_STRIP,"triangle strip"),yh),Sx=(Cv={},(0,I.Z)(Cv,W.STATIC_DRAW,"static"),(0,I.Z)(Cv,W.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(Cv,W.STREAM_DRAW,"stream"),Cv),vm=(_h={},(0,I.Z)(_h,W.BYTE,"int8"),(0,I.Z)(_h,W.UNSIGNED_INT,"int16"),(0,I.Z)(_h,W.INT,"int32"),(0,I.Z)(_h,W.UNSIGNED_BYTE,"uint8"),(0,I.Z)(_h,W.UNSIGNED_SHORT,"uint16"),(0,I.Z)(_h,W.UNSIGNED_INT,"uint32"),(0,I.Z)(_h,W.FLOAT,"float"),_h),a3=(Ic={},(0,I.Z)(Ic,W.ALPHA,"alpha"),(0,I.Z)(Ic,W.LUMINANCE,"luminance"),(0,I.Z)(Ic,W.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(Ic,W.RGB,"rgb"),(0,I.Z)(Ic,W.RGBA,"rgba"),(0,I.Z)(Ic,W.RGBA4,"rgba4"),(0,I.Z)(Ic,W.RGB5_A1,"rgb5 a1"),(0,I.Z)(Ic,W.RGB565,"rgb565"),(0,I.Z)(Ic,W.DEPTH_COMPONENT,"depth"),(0,I.Z)(Ic,W.DEPTH_STENCIL,"depth stencil"),Ic),o3=(Av={},(0,I.Z)(Av,W.DONT_CARE,"dont care"),(0,I.Z)(Av,W.NICEST,"nice"),(0,I.Z)(Av,W.FASTEST,"fast"),Av),Cx=(rp={},(0,I.Z)(rp,W.NEAREST,"nearest"),(0,I.Z)(rp,W.LINEAR,"linear"),(0,I.Z)(rp,W.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(rp,W.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(rp,W.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(rp,W.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),rp),Ax=(wv={},(0,I.Z)(wv,W.REPEAT,"repeat"),(0,I.Z)(wv,W.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(wv,W.MIRRORED_REPEAT,"mirror"),wv),s3=(S0={},(0,I.Z)(S0,W.NONE,"none"),(0,I.Z)(S0,W.BROWSER_DEFAULT_WEBGL,"browser"),S0),u3=(zf={},(0,I.Z)(zf,W.NEVER,"never"),(0,I.Z)(zf,W.ALWAYS,"always"),(0,I.Z)(zf,W.LESS,"less"),(0,I.Z)(zf,W.LEQUAL,"lequal"),(0,I.Z)(zf,W.GREATER,"greater"),(0,I.Z)(zf,W.GEQUAL,"gequal"),(0,I.Z)(zf,W.EQUAL,"equal"),(0,I.Z)(zf,W.NOTEQUAL,"notequal"),zf),Tx=(Hp={},(0,I.Z)(Hp,W.FUNC_ADD,"add"),(0,I.Z)(Hp,W.MIN_EXT,"min"),(0,I.Z)(Hp,W.MAX_EXT,"max"),(0,I.Z)(Hp,W.FUNC_SUBTRACT,"subtract"),(0,I.Z)(Hp,W.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Hp),A0=(Pu={},(0,I.Z)(Pu,W.ZERO,"zero"),(0,I.Z)(Pu,W.ONE,"one"),(0,I.Z)(Pu,W.SRC_COLOR,"src color"),(0,I.Z)(Pu,W.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Pu,W.SRC_ALPHA,"src alpha"),(0,I.Z)(Pu,W.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Pu,W.DST_COLOR,"dst color"),(0,I.Z)(Pu,W.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Pu,W.DST_ALPHA,"dst alpha"),(0,I.Z)(Pu,W.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Pu,W.CONSTANT_COLOR,"constant color"),(0,I.Z)(Pu,W.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Pu,W.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Pu,W.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Pu,W.SRC_ALPHA_SATURATE,"src alpha saturate"),Pu),l3=(Uf={},(0,I.Z)(Uf,W.NEVER,"never"),(0,I.Z)(Uf,W.ALWAYS,"always"),(0,I.Z)(Uf,W.LESS,"less"),(0,I.Z)(Uf,W.LEQUAL,"lequal"),(0,I.Z)(Uf,W.GREATER,"greater"),(0,I.Z)(Uf,W.GEQUAL,"gequal"),(0,I.Z)(Uf,W.EQUAL,"equal"),(0,I.Z)(Uf,W.NOTEQUAL,"notequal"),Uf),Rd=(Zf={},(0,I.Z)(Zf,W.ZERO,"zero"),(0,I.Z)(Zf,W.KEEP,"keep"),(0,I.Z)(Zf,W.REPLACE,"replace"),(0,I.Z)(Zf,W.INVERT,"invert"),(0,I.Z)(Zf,W.INCR,"increment"),(0,I.Z)(Zf,W.DECR,"decrement"),(0,I.Z)(Zf,W.INCR_WRAP,"increment wrap"),(0,I.Z)(Zf,W.DECR_WRAP,"decrement wrap"),Zf),c3=(C0={},(0,I.Z)(C0,W.FRONT,"front"),(0,I.Z)(C0,W.BACK,"back"),C0),f3=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:Sx[a||W.STATIC_DRAW],type:vm[s||W.UNSIGNED_BYTE]})}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),h3=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,f=r.count;this.elements=i.elements({data:n,usage:Sx[a||W.STATIC_DRAW],type:vm[s||W.UNSIGNED_BYTE],count:f})}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),p3=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,f=r.colors,v=r.depth,m=r.stencil,x={width:n,height:a};Array.isArray(f)&&(x.colors=f.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),d3=N(36719),v3=N.n(d3),m3=N(68630),g3=N.n(m3);function Mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Oc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mx(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var y3=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawPickCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,f=r.uniforms,v=r.primitive,m=r.count,x=r.elements,C=r.depth,A=r.blend,O=r.stencil,D=r.cull,Z=r.instances,X={};this.options=r,f&&(this.uniforms=this.extractUniforms(f),Object.keys(f).forEach(function(Qe){X[Qe]=i.prop(Qe)}));var te={};Object.keys(s).forEach(function(Qe){te[Qe]=s[Qe].get()});var Ee={attributes:te,frag:a,uniforms:X,vert:n,blend:{},primitive:i3[v===void 0?W.TRIANGLES:v]};Z&&(Ee.instances=Z),m&&(Ee.count=m),x&&(Ee.elements=x.get()),this.initDepthDrawParams({depth:C},Ee),this.initBlendDrawParams({blend:A},Ee),this.initStencilDrawParams({stencil:O},Ee),this.initCullDrawParams({cull:D},Ee),this.drawCommand=i(Ee);var Ue=pu()(Ee);Ue.blend=Oc(Oc({},Ue.blend),{},{enable:!1}),this.drawPickCommand=i(Ue),this.drawParams=Ee}return(0,Ct.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(f){a[f]=r[f].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=pu()(this.drawParams);s.blend=Oc(Oc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=pu()(this.drawParams);a.blend=Oc(Oc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=Oc(Oc({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Oc(Oc({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(f){var v=(0,Sh.Z)(a[f]);v==="boolean"||v==="number"||Array.isArray(a[f])||a[f].BYTES_PER_ELEMENT?s[f]=a[f]:s[f]=a[f].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:u3[a.func||W.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,f=a.func,v=a.equation,m=a.color,x=m===void 0?[0,0,0,0]:m;n.blend={enable:!!s,func:{srcRGB:A0[f&&f.srcRGB||W.SRC_ALPHA],srcAlpha:A0[f&&f.srcAlpha||W.SRC_ALPHA],dstRGB:A0[f&&f.dstRGB||W.ONE_MINUS_SRC_ALPHA],dstAlpha:A0[f&&f.dstAlpha||W.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Tx[v&&v.rgb||W.FUNC_ADD],alpha:Tx[v&&v.alpha||W.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,f=a.mask,v=f===void 0?-1:f,m=a.func,x=m===void 0?{cmp:W.ALWAYS,ref:0,mask:-1}:m,C=a.opFront,A=C===void 0?{fail:W.KEEP,zfail:W.KEEP,zpass:W.KEEP}:C,O=a.opBack,D=O===void 0?{fail:W.KEEP,zfail:W.KEEP,zpass:W.KEEP}:O;n.stencil={enable:!!s,mask:v,func:Oc(Oc({},x),{},{cmp:l3[x.cmp]}),opFront:{fail:Rd[A.fail],zfail:Rd[A.zfail],zpass:Rd[A.zpass]},opBack:{fail:Rd[D.fail],zfail:Rd[D.zfail],zpass:Rd[D.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,f=a.face,v=f===void 0?W.BACK:f;n.cull={enable:!!s,face:c3[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var f=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||v3()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}g3()(n)&&Object.keys(n).forEach(function(v){f.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,m){Object.keys(v).forEach(function(x){f.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(m,"]"))})})}}]),e}(),_3=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?W.UNSIGNED_BYTE:a,f=r.width,v=r.height,m=r.flipY,x=m===void 0?!1:m,C=r.format,A=C===void 0?W.RGBA:C,O=r.mipmap,D=O===void 0?!1:O,Z=r.wrapS,X=Z===void 0?W.CLAMP_TO_EDGE:Z,te=r.wrapT,Ee=te===void 0?W.CLAMP_TO_EDGE:te,Ue=r.aniso,Qe=Ue===void 0?0:Ue,ct=r.alignment,St=ct===void 0?1:ct,bt=r.premultiplyAlpha,Kt=bt===void 0?!1:bt,lr=r.mag,Mr=lr===void 0?W.NEAREST:lr,Xr=r.min,_r=Xr===void 0?W.NEAREST:Xr,on=r.colorSpace,Ln=on===void 0?W.BROWSER_DEFAULT_WEBGL:on,Un=r.x,Fa=Un===void 0?0:Un,Mo=r.y,Ps=Mo===void 0?0:Mo,au=r.copy,ks=au===void 0?!1:au;this.width=f,this.height=v;var Rc={width:f,height:v,type:vm[s],format:a3[A],wrapS:Ax[X],wrapT:Ax[Ee],mag:Cx[Mr],min:Cx[_r],alignment:St,flipY:x,colorSpace:s3[Ln],premultiplyAlpha:Kt,aniso:Qe,x:Fa,y:Ps,copy:ks};n&&(Rc.data=n),typeof D=="number"?Rc.mipmap=o3[D]:typeof D=="boolean"&&(Rc.mipmap=D),this.texture=i.texture(Rc)}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),Px,Ix,x3=(Px=(0,nt.b2)(),Px(Ix=function(){function e(){var i=this;(0,lt.Z)(this,e),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(r){return new y3(i.gl,r)}),(0,I.Z)(this,"createAttribute",function(r){return new n3(i.gl,r)}),(0,I.Z)(this,"createBuffer",function(r){return new f3(i.gl,r)}),(0,I.Z)(this,"createElements",function(r){return new h3(i.gl,r)}),(0,I.Z)(this,"createTexture2D",function(r){return new _3(i.gl,r)}),(0,I.Z)(this,"createFramebuffer",function(r){return new p3(i.gl,r)}),(0,I.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,I.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,f=r.framebuffer,v=f===void 0?null:f,m={color:n,depth:a,stencil:s};m.framebuffer=v===null?v:v.get(),i.gl.clear(m)}),(0,I.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,f=r.height;i.gl._gl.viewport(n,a,s,f),i.width=s,i.height=f,i.gl._refresh()}),(0,I.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,f=r.width,v=r.height,m={x:a,y:s,width:f,height:v};return n&&(m.framebuffer=n.get()),i.gl.read(m)}),(0,I.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){if(_o)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,I.Z)(this,"getCanvas",function(){return i.canvas}),(0,I.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,I.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Ct.Z)(e,[{key:"init",value:function(){var i=(0,qi.Z)(ni().mark(function n(a,s){var f=this;return ni().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return this.canvas=a,m.next=3,new Promise(function(x,C){r3()({canvas:f.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,D){(O||!D)&&C(O),x(D)}})});case 3:this.gl=m.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return m.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Ix);function Ox(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ox(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ox(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var b3=function(){function e(i){(0,lt.Z)(this,e),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,f=mE();this.container=f,n.setContainer(f,r,a,s),f.bind(Be.IRendererService).to(x3).inSingletonScope(),this.sceneService=f.get(Be.ISceneService),this.mapService=f.get(Be.IMapService),this.iconService=f.get(Be.IIconService),this.fontService=f.get(Be.IFontService),this.controlService=f.get(Be.IControlService),this.layerService=f.get(Be.ILayerService),this.markerService=f.get(Be.IMarkerService),this.interactionService=f.get(Be.IInteractionService),this.popupService=f.get(Be.IPopupService),_o?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Ct.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=lv(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,f=a.maskfence,v=a.maskColor,m=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&f){var A=new ST().source(f).shape("fill").color(m).style({opacity:C});this.addMask(A,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=lv(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,Q.Z)(a,2),f=s[0],v=s[1];n.fontService.addIconFont(f,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){_o?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){U0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){U0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){U0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,f=a.animate;this.mapService.fitBounds(r,n||Rx(Rx({},s),{},{animate:f}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Be.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:qs(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new FE({position:a}))}}]),e}(),kI="2.8.41";function Lx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function DI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Lx(Object(r),!0).forEach(function(n){E3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function E3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function FI(e,i){return w3(e)||A3(e,i)||C3(e,i)||S3()}function S3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C3(e,i){if(!!e){if(typeof e=="string")return kx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kx(e,i)}}function kx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function A3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function w3(e){if(Array.isArray(e))return e}var BI=null,NI=null,Dx,mm,Fx;function Bx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bx(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var T3=(Dx=z0(Be.IGlobalConfigService),mm=function(){function e(i){(0,lt.Z)(this,e),He(this,"configService",Fx,this),(0,I.Z)(this,"config",void 0),this.config=i}return(0,Ct.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(Be.MapConfig).toConstantValue(Nx(Nx({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(Be.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Fx=tt(mm.prototype,"configService",[Dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm),M3=N(6158),Tv=N.n(M3);function Mv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function w0(e,i){var r=mo([],i,e);return ta(r,r,1/r[3]),r}function zI(e,i){var r=e%i;return r<0?i+r:r}function UI(e,i,r){return r*i+(1-r)*e}function Wp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var tf=Math.PI,zx=tf/4,xh=tf/180,Ux=180/tf,gm=512,ym=4003e4,P3=1.5;function Zx(e){return Math.pow(2,e)}function I3(e){return Math.log2(e)}function T0(e,i){var r=(0,Q.Z)(e,2),n=r[0],a=r[1];Wp(Number.isFinite(n)&&Number.isFinite(i)),Wp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=gm;var s=n*xh,f=a*xh,v=i*(s+tf)/(2*tf),m=i*(tf-Math.log(Math.tan(zx+f*.5)))/(2*tf);return[v,m]}function _m(e,i){var r=(0,Q.Z)(e,2),n=r[0],a=r[1];i*=gm;var s=n/i*(2*tf)-tf,f=2*(Math.atan(Math.exp(tf-a/i*(2*tf)))-zx);return[s*Ux,f*Ux]}function ZI(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*xh);return I3(ym*r)-9}function jx(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,f=s===void 0?!1:s;a=a!==void 0?a:Zx(n),Wp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},m=gm*a,x=Math.cos(i*xh),C=m/360,A=C/x,O=m/ym/x;if(v.pixelsPerMeter=[O,-O,O],v.metersPerPixel=[1/O,-1/O,1/O],v.pixelsPerDegree=[C,-A,O],v.degreesPerPixel=[1/C,-1/A,1/O],f){var D=xh*Math.tan(i*xh)/x,Z=C*D/2,X=m/ym*D,te=X/A*O;v.pixelsPerDegree2=[0,-Z,X],v.pixelsPerMeter2=[te,0,te]}return v}function jI(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],f=_slicedToArray(i,3),v=f[0],m=f[1],x=f[2],C=1,A=jx({longitude:n,latitude:a,scale:C,highPrecision:!0}),O=A.pixelsPerMeter,D=A.pixelsPerMeter2,Z=T0(e,C);Z[0]+=v*(O[0]+D[0]*m),Z[1]+=m*(O[1]+D[1]*m);var X=_m(Z,C),te=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[X[0],X[1],te]:X}function O3(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,f=s===void 0?null:s,v=e.flipY,m=v===void 0?!1:v,x=Mv();return ft(x,x,[0,0,-a]),Rt(x,x,[1,1,1/i]),Fe(x,x,-r*xh),_e(x,x,n*xh),m&&Rt(x,x,[1,-1,1]),f&&ft(x,x,Ha.negate([],f)),x}function R3(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?P3:n,s=e.pitch,f=s===void 0?0:s,v=e.nearZMultiplier,m=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,A=f*xh,O=Math.atan(.5/a),D=Math.sin(O)*a/Math.sin(Math.PI/2-A-O),Z=Math.cos(Math.PI/2-A)*D+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:m,far:Z*C}}function L3(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,f=e.farZMultiplier,v=R3({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:f}),m=v.fov,x=v.aspect,C=v.near,A=v.far,O=Jo([],m,x,C,A);return O}function k3(e,i){var r=(0,Q.Z)(e,3),n=r[0],a=r[1],s=r[2],f=s===void 0?0:s;return Wp(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(f)),w0(i,[n,a,f,1])}function Vx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Q.Z)(e,3),a=n[0],s=n[1],f=n[2];if(Wp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(f)){var v=w0(i,[a,s,f,1]);return v}var m=w0(i,[a,s,0,1]),x=w0(i,[a,s,1,1]),C=m[2],A=x[2],O=C===A?0:((r||0)-C)/(A-C);return gi.t7([],m,x,O)}var Gx=Mv(),D3=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?Gx:a,f=i.projectionMatrix,v=f===void 0?Gx:f;(0,lt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var m=Mv();Ze(m,m,this.projectionMatrix),Ze(m,m,this.viewMatrix),this.viewProjectionMatrix=m;var x=Mv();Rt(x,x,[this.width/2,-this.height/2,1]),ft(x,x,[1,-1,0]),Ze(x,x,this.viewProjectionMatrix);var C=Oi(Mv(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Ct.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Uh(r.projectionMatrix,this.projectionMatrix)&&Uh(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=this.projectPosition(r),v=k3(f,this.pixelProjectionMatrix),m=(0,Q.Z)(v,2),x=m[0],C=m[1],A=s?C:this.height-C;return r.length===2?[x,A]:[x,A,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=n.targetZ,v=(0,Q.Z)(r,3),m=v[0],x=v[1],C=v[2],A=s?x:this.height-x,O=f&&f*this.pixelsPerMeter,D=Vx([m,A,C],this.pixelUnprojectionMatrix,O),Z=this.unprojectPosition(D),X=(0,Q.Z)(Z,3),te=X[0],Ee=X[1],Ue=X[2];return Number.isFinite(C)?[te,Ee,Ue]:Number.isFinite(f)?[te,Ee,f]:[te,Ee]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,Q.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,f,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,Q.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,f,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function F3(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,f=e.maxZoom,v=f===void 0?24:f,m=e.padding,x=m===void 0?0:m,C=e.offset,A=C===void 0?[0,0]:C,O=(0,Q.Z)(n,2),D=(0,Q.Z)(O[0],2),Z=D[0],X=D[1],te=(0,Q.Z)(O[1],2),Ee=te[0],Ue=te[1];if(Number.isFinite(x)){var Qe=x;x={top:Qe,bottom:Qe,left:Qe,right:Qe}}else Wp(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var ct=new Hx({width:i,height:r,longitude:0,latitude:0,zoom:0}),St=ct.project([Z,Ue]),bt=ct.project([Ee,X]),Kt=[Math.max(Math.abs(bt[0]-St[0]),s),Math.max(Math.abs(bt[1]-St[1]),s)],lr=[i-x.left-x.right-Math.abs(A[0])*2,r-x.top-x.bottom-Math.abs(A[1])*2];Wp(lr[0]>0&&lr[1]>0);var Mr=lr[0]/Kt[0],Xr=lr[1]/Kt[1],_r=(x.right-x.left)/2/Mr,on=(x.bottom-x.top)/2/Xr,Ln=[(bt[0]+St[0])/2+_r,(bt[1]+St[1])/2+on],Un=ct.unproject(Ln),Fa=ct.zoom+Math.log2(Math.abs(Math.min(Mr,Xr)));return{longitude:Un[0],latitude:Un[1],zoom:Math.min(Fa,v)}}var Hx=function(e){(0,Yr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,f=n.latitude,v=f===void 0?0:f,m=n.longitude,x=m===void 0?0:m,C=n.zoom,A=C===void 0?0:C,O=n.pitch,D=O===void 0?0:O,Z=n.bearing,X=Z===void 0?0:Z,te=n.altitude,Ee=te===void 0?1.5:te,Ue=n.nearZMultiplier,Qe=n.farZMultiplier;(0,lt.Z)(this,i),a=a||1,s=s||1;var ct=Zx(A);Ee=Math.max(.75,Ee);var St=T0([x,v],ct);St[2]=0;var bt=L3({width:a,height:s,pitch:D,bearing:X,altitude:Ee,nearZMultiplier:Ue||1/s,farZMultiplier:Qe||1.01}),Kt=O3({height:s,center:St,pitch:D,bearing:X,altitude:Ee,flipY:!0});return r=(0,jr.Z)(this,(0,It.Z)(i).call(this,{width:a,height:s,viewMatrix:Kt,projectionMatrix:bt})),r.latitude=v,r.longitude=x,r.zoom=A,r.pitch=D,r.bearing=X,r.altitude=Ee,r.scale=ct,r.center=St,r.pixelsPerMeter=jx((0,ae.Z)((0,ae.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ae.Z)((0,ae.Z)(r))),r}return(0,Ct.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return T0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return _m(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,f=Vx(s,this.pixelUnprojectionMatrix),v=T0(a,this.scale),m=gi.IH([],v,gi.tk([],f)),x=gi.IH([],this.center,m);return _m(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,f=this.height,v=F3(Object.assign({width:s,height:f,bounds:n},a)),m=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:f,longitude:m,latitude:x,zoom:C})}}]),i}(D3),B3=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"viewport",void 0)}return(0,Ct.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,f=r.bearing,v=r.viewportHeight,m=r.viewportWidth;this.viewport=new Hx({width:m,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:f})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),N3=function(){function e(i){(0,lt.Z)(this,e),(0,I.Z)(this,"size",1e4),this.size=i||1e4}return(0,Ct.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),Wx={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},z3=["id","attributionControl","style","token","rotation","mapInstance"],Xx,Yx,qx,Kx,$x,Qx,Ld,Jx,eb,tb,rb;function nb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function U3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?nb(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Z3(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}Z3(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Tv();var ib={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},j3=0,V3=12,ab="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",G3=(Xx=(0,nt.b2)(),Yx=(0,nt.f3)(Be.MapConfig),qx=(0,nt.f3)(Be.IGlobalConfigService),Kx=(0,nt.f3)(Be.ICoordinateSystemService),$x=(0,nt.f3)(Be.IEventEmitter),Xx(Qx=(Ld=function(){function e(){var i=this;(0,lt.Z)(this,e),(0,I.Z)(this,"version",Ls.MAPBOX),(0,I.Z)(this,"map",void 0),(0,I.Z)(this,"simpleMapCoord",new N3),(0,I.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),He(this,"config",Jx,this),He(this,"configService",eb,this),He(this,"coordinateSystemService",tb,this),He(this,"eventEmitter",rb,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,f=s===void 0?V3:s;i.viewport.getZoom()>f?i.coordinateSystemService.setCoordinateSystem(vl.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(vl.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Ct.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=ca("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){ME.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(ib[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(ib[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,f=a.y;return[s-n.x,f-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,f=s===void 0?0:s,v=a.y,m=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:f,y:m,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),m=v.meterInMercatorCoordinateUnits(),x=Zi();return ft(x,x,Ha.fromValues(v.x-f.x,v.y-f.y,v.z||0-f.z)),Rt(x,x,Ha.fromValues(m*s[0],-m*s[1],m*s[2])),Fe(x,x,a[0]),st(x,x,a[1]),_e(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,qi.Z)(ni().mark(function n(){var a,s,f,v,m,x,C,A,O,D,Z,X,te;return ni().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:a=this.config,s=a.id,f=s===void 0?"map":s,v=a.attributionControl,m=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,A=a.token,O=A===void 0?ab:A,D=a.rotation,Z=D===void 0?0:D,X=a.mapInstance,te=(0,dh.Z)(a,z3),this.viewport=new B3,!X&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===ab&&C!=="blank"&&!window.mapboxgl.accessToken&&!X&&console.warn(this.configService.getSceneWarninfo("MapToken")),!X&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),X?(this.map=X,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(f),this.map=new window.mapboxgl.Map(U3({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:m,bearing:Z},te))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ue.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(Tv()).LngLat(r[0],r[1]),s=new(Tv()).LngLat(n[0],n[1]),f=a.distanceTo(s),v=Tv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),m=Tv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,A=m.x,O=m.y,D=Math.sqrt(Math.pow(x-A,2)+Math.pow(C-O,2))*4194304*2;return D/f}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+j3++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:Wx[r]?Wx[r]:r}}]),e}(),Jx=tt(Ld.prototype,"config",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=tt(Ld.prototype,"configService",[qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tb=tt(Ld.prototype,"coordinateSystemService",[Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rb=tt(Ld.prototype,"eventEmitter",[$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ld))||Qx);function H3(e){var i=W3();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,jr.Z)(this,a)}}function W3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function X3(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}X3(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Y3=function(e){(0,Yr.Z)(r,e);var i=H3(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getServiceConstructor",value:function(){return G3}}]),r}(T3);function ob(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sb(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ob(Object(r),!0).forEach(function(n){q3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ob(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function q3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function K3(e,i){return eP(e)||J3(e,i)||Q3(e,i)||$3()}function $3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q3(e,i){if(!!e){if(typeof e=="string")return ub(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ub(e,i)}}function ub(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function J3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function eP(e){if(Array.isArray(e))return e}var tP=Le.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,f=(0,Le.createRef)(),v=(0,Le.useState)(),m=K3(v,2),x=m[0],C=m[1];return(0,Le.useEffect)(function(){var A=new b3(sb(sb({id:f.current},a),{},{map:new Y3(n)}));return A.on("loaded",function(){C(A),s&&s(A)}),function(){A.destroy()}},[]),(0,Le.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,Le.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,Le.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,Le.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,Le.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),Le.createElement(Cr.Provider,{value:x},(0,Le.createElement)("div",{ref:f,style:i,className:r},x&&e.children))}),rP=tP;function lb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function VI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?lb(Object(r),!0).forEach(function(n){nP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function GI(e,i){return sP(e)||oP(e,i)||aP(e,i)||iP()}function iP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aP(e,i){if(!!e){if(typeof e=="string")return cb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cb(e,i)}}function cb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function oP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function sP(e){if(Array.isArray(e))return e}var HI=null,WI=null;function fb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function XI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fb(Object(r),!0).forEach(function(n){uP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function YI(e,i){return hP(e)||fP(e,i)||cP(e,i)||lP()}function lP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cP(e,i){if(!!e){if(typeof e=="string")return hb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hb(e,i)}}function hb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function fP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function hP(e){if(Array.isArray(e))return e}var qI=null,KI=null;function $I(e,i){return mP(e)||vP(e,i)||dP(e,i)||pP()}function pP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dP(e,i){if(!!e){if(typeof e=="string")return pb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pb(e,i)}}function pb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function vP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function mP(e){if(Array.isArray(e))return e}var QI=null,JI=null;function db(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?db(Object(r),!0).forEach(function(n){gP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):db(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function tO(e,i){if(e==null)return{};var r=yP(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function yP(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var rO=null,vb=N(73935);function mb(e,i){return EP(e)||bP(e,i)||xP(e,i)||_P()}function _P(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xP(e,i){if(!!e){if(typeof e=="string")return gb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gb(e,i)}}function gb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function bP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function EP(e){if(Array.isArray(e))return e}var yb=Le.useEffect,_b=Le.useState,SP=/\B([A-Z])/g,CP=function(i){return i.replace(SP,"-$1").toLowerCase()};function nO(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=_b(),f=mb(s,2),v=f[0],m=f[1],x=useSceneValue(),C=_b(function(){return document.createElement("div")}),A=mb(C,1),O=A[0];return yb(function(){var D=new Control({position:a});return D.onAdd=function(){if(i&&(O.className=i),r){var Z=Object.keys(r).map(function(X){return"".concat(CP(X),":").concat(r[X])}).join(";");O.style.cssText=Z}return O},D.onRemove=function(){},m(D),x.addControl(D),function(){x.removeControl(D)}},[]),yb(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,O)}var xb=(0,Le.createContext)({});function iO(){return useContext(xb)}var jf=N(96486),aO=Le.useEffect,AP=Le.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},jf.isEqual),oO=Le.useEffect,wP=Le.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},jf.isEqual),sO=Le.useEffect,TP=Le.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},jf.isEqual),MP=Le.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},jf.isEqual),PP=Le.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},jf.isEqual),uO=Le.useEffect,IP=Le.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},jf.isEqual),OP=Le.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},jf.isEqual),RP=Le.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},jf.isEqual),LP=["data"];function kP(e,i){if(e==null)return{};var r=DP(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function DP(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var FP=Le.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=kP(n,LP);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},jf.isEqual),lO=Le.useEffect,BP=Le.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},jf.isEqual);function NP(e,i){return jP(e)||ZP(e,i)||UP(e,i)||zP()}function zP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UP(e,i){if(!!e){if(typeof e=="string")return bb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bb(e,i)}}function bb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function ZP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function jP(e){if(Array.isArray(e))return e}var Pv=Le.useEffect,VP=Le.useState;function Eb(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,f=i.size,v=i.scale,m=i.active,x=i.select,C=i.filter,A=i.animate,O=i.options,D=i.onLayerLoaded,Z=qn(),X=VP(function(){var Ue;switch(e){case"polygonLayer":Ue=new s_(O);break;case"lineLayer":Ue=new Uy(O);break;case"pointLayer":Ue=new o_(O);break;case"heatmapLayer":Ue=new fC(O);break;case"rasterLayer":Ue=new pT(O);break;case"imageLayer":Ue=new Fy(O);break;case"citybuildingLayer":Ue=new FS(O);break;default:Ue=new s_(O)}return Ue.on("inited",function(){D&&D(Ue,Z)}),Ue}),te=NP(X,1),Ee=te[0];return Pv(function(){return Z.addLayer(Ee),function(){Z.removeLayer(Ee)}},[]),Pv(function(){Ee.inited&&O&&Ee.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),Pv(function(){Ee.inited&&(O==null?void 0:O.zIndex)&&Ee.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),Pv(function(){Ee.inited&&(O==null?void 0:O.blend)&&Ee.setBlend(O.blend)},[O==null?void 0:O.blend]),Pv(function(){Z.render()}),Le.createElement(xb.Provider,{value:Ee},Le.createElement(FP,{layer:Ee,source:r}),v&&Le.createElement(PP,{layer:Ee,scale:v}),n&&Le.createElement(TP,{layer:Ee,color:n}),f&&Le.createElement(RP,{layer:Ee,size:f}),a&&Le.createElement(OP,{layer:Ee,shape:a}),s&&Le.createElement(BP,{layer:Ee,style:s}),m&&Le.createElement(AP,{layer:Ee,active:m}),x&&Le.createElement(IP,{layer:Ee,select:x}),C&&Le.createElement(MP,{layer:Ee,filter:C}),A&&Le.createElement(wP,{layer:Ee,animate:A}),i.children)}var cO=null,fO=null,Sb=Le.memo(function(i){return Eb("pointLayer",i)}),GP=Le.memo(function(i){return Eb("heatmapLayer",i)}),hO=null,pO=null,dO=null,vO=Le.useEffect,mO=null,gO=null;function M0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M0=function(r){return typeof r}:M0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},M0(e)}function Cb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function P0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cb(Object(r),!0).forEach(function(n){HP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function HP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function WP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ab(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function XP(e,i,r){return i&&Ab(e.prototype,i),r&&Ab(e,r),e}function YP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&xm(e,i)}function xm(e,i){return xm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},xm(e,i)}function qP(e){var i=QP();return function(){var n=I0(e),a;if(i){var s=I0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return KP(this,a)}}function KP(e,i){if(i&&(M0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $P(e)}function $P(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function QP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function I0(e){return I0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},I0(e)}var yO=function(e){YP(r,e);var i=qP(r);function r(n){var a;return WP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return XP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,f=s.lnglat,v=s.children,m=s.option,x=s.lngLat,C=new ey(P0(P0({},m),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));f&&C.setLnglat(f),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,f,v,m,x,C,A=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(f=a.lnglat)===null||f===void 0?void 0:f.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(m=v.lnglat)===null||m===void 0?void 0:m.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],D=A.toString()!==O.toString();if(D){var Z;this.popup.remove(),this.popup=new ey(P0(P0({},this.props.option),{},{stopPropagation:(Z=this.props.option)===null||Z===void 0?void 0:Z.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return Le.createElement(Cr.Consumer,{},function(s){return s&&(a.scene=s),(0,vb.createPortal)(a.props.children,a.el)})}}]),r}(Le.PureComponent);function O0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?O0=function(r){return typeof r}:O0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},O0(e)}function JP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function wb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e4(e,i,r){return i&&wb(e.prototype,i),r&&wb(e,r),e}function t4(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&bm(e,i)}function bm(e,i){return bm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},bm(e,i)}function r4(e){var i=a4();return function(){var n=R0(e),a;if(i){var s=R0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return n4(this,a)}}function n4(e,i){if(i&&(O0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return i4(e)}function i4(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function R0(e){return R0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},R0(e)}var _O=function(e){t4(r,e);var i=r4(r);function r(n){var a;return JP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return e4(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,f=a.children,v=a.option,m=a.onMarkerLoaded,x=new qg(v);s&&x.setLnglat(s),f&&x.setElement(this.el),this.marker=x,m&&m(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,f=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());f&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return Le.createElement(Cr.Consumer,{},function(s){return s&&(a.scene=s),(0,vb.createPortal)(a.props.children,a.el)})}}]),r}(Le.PureComponent),xO=Le.useEffect,bO=null,EO=null,SO=Le.useEffect,CO=null,o4=N(83832),hi=N(85893),s4=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],u4=function(e){(0,Mt.Z)(r,e);var i=(0,yt.Z)(r);function r(){var n;(0,qe.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),n.state={data:null,grid:null,loading:!1},n}return(0,ke.Z)(r,[{key:"componentDidMount",value:function(){var n=(0,Te.Z)(qt().mark(function s(){var f,v,m,x;return qt().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(O){return O.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(O){return O.json()})]);case 2:f=A.sent,v=(0,en.Z)(f,2),m=v[0],x=v[1],this.setState({data:m,grid:x,loading:!0});case 7:case"end":return A.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"render",value:function(){var a=this.state,s=a.data,f=a.grid,v=a.loading;return v===!1?(0,hi.jsx)(o4.Z,{}):(0,hi.jsxs)(rP,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[f&&(0,hi.jsx)(GP,{source:{data:f,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),s&&[(0,hi.jsx)(Sb,{options:{autoFit:!0},source:{data:s},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:s4},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,hi.jsx)(Sb,{source:{data:s},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(x){return x>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),r}(Le.Component),Tb=N(86582),l4=N(93343),c4=N(70499),Xp=N.n(c4);function f4(e){return e*1<10?"0".concat(e):e}function Mb(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(f4(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var h4=function(e){(0,Mt.Z)(r,e);var i=(0,yt.Z)(r);function r(){var n;(0,qe.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),n.state={activeData:Mb()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:Mb()},function(){n.loopData()})},1e3)})},n}return(0,ke.Z)(r,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var a=this.state.activeData,s=a===void 0?[]:a;return(0,hi.jsxs)("div",{className:Xp().activeChart,children:[(0,hi.jsx)(se.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,hi.jsx)("div",{style:{marginTop:32},children:(0,hi.jsx)(l4.Z,{autoFit:!0,data:s.map(function(f){return f.y}),height:84})}),s&&(0,hi.jsxs)("div",{children:[(0,hi.jsxs)("div",{className:Xp().activeChartGrid,children:[(0,hi.jsxs)("p",{children:[(0,Tb.Z)(s).sort()[s.length-1].y+200," \u4EBF\u5143"]}),(0,hi.jsxs)("p",{children:[(0,Tb.Z)(s).sort()[Math.floor(s.length/2)].y," \u4EBF\u5143"]})]}),(0,hi.jsx)("div",{className:Xp().dashedLine,children:(0,hi.jsx)("div",{className:Xp().line})}),(0,hi.jsx)("div",{className:Xp().dashedLine,children:(0,hi.jsx)("div",{className:Xp().line})})]}),s&&(0,hi.jsxs)("div",{className:Xp().activeChartLegend,children:[(0,hi.jsx)("span",{children:"00:00"}),(0,hi.jsx)("span",{children:s[Math.floor(s.length/2)].x}),(0,hi.jsx)("span",{children:s[s.length-1].x})]})]})}}]),r}(Le.Component);function p4(){return Em.apply(this,arguments)}function Em(){return Em=(0,Te.Z)(qt().mark(function e(){return qt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,at.WY)("/api/tags"));case 1:case"end":return r.stop()}},e)})),Em.apply(this,arguments)}var d4=N(19134),Pb=N.n(d4),v4=se.Z.Countdown,m4=Date.now()+1e3*60*60*24*2+1e3*30,g4=function(){var i=(0,at.QT)(p4),r=i.loading,n=i.data,a=(n==null?void 0:n.list)||[];return(0,hi.jsx)($t.Z,{children:(0,hi.jsxs)(hi.Fragment,{children:[(0,hi.jsxs)(V.Z,{gutter:24,children:[(0,hi.jsx)(ue.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,hi.jsxs)(g.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,hi.jsxs)(V.Z,{children:[(0,hi.jsx)(ue.Z,{md:6,sm:12,xs:24,children:(0,hi.jsx)(se.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:kr()(124543233).format("0,0")})}),(0,hi.jsx)(ue.Z,{md:6,sm:12,xs:24,children:(0,hi.jsx)(se.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,hi.jsx)(ue.Z,{md:6,sm:12,xs:24,children:(0,hi.jsx)(v4,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:m4,format:"HH:mm:ss:SSS"})}),(0,hi.jsx)(ue.Z,{md:6,sm:12,xs:24,children:(0,hi.jsx)(se.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:kr()(234).format("0,0")})})]}),(0,hi.jsx)("div",{className:Pb().mapChart,children:(0,hi.jsx)(u4,{})})]})}),(0,hi.jsxs)(ue.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,hi.jsx)(g.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,hi.jsx)(h4,{})}),(0,hi.jsx)(g.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,hi.jsx)(gt,{height:180,autoFit:!0,percent:.87,range:{ticks:[0,1/4,2/4,3/4,1]},axis:{label:{formatter:function(f){return Number(f)*100}}},statistic:{content:{content:"\u4F18",style:{color:"#30bf78"}}}})})]})]}),(0,hi.jsxs)(V.Z,{gutter:24,children:[(0,hi.jsx)(ue.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,hi.jsx)(g.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:Pb().pieCard,children:(0,hi.jsxs)(V.Z,{style:{padding:"16px 0"},children:[(0,hi.jsx)(ue.Z,{span:8,children:(0,hi.jsx)(et.Z,{autoFit:!0,height:128,percent:.28})}),(0,hi.jsx)(ue.Z,{span:8,children:(0,hi.jsx)(et.Z,{color:"#5DDECF",autoFit:!0,height:128,percent:.22})}),(0,hi.jsx)(ue.Z,{span:8,children:(0,hi.jsx)(et.Z,{color:"#2FC25B",autoFit:!0,height:128,percent:.32})})]})})}),(0,hi.jsx)(ue.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,hi.jsx)(g.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:r,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,hi.jsx)(Qt,{data:a,autoFit:!0,wordField:"name",weightField:"value",colorField:"name",height:162,wordStyle:{fontSize:[10,20]}})})}),(0,hi.jsx)(ue.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,hi.jsx)(g.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,hi.jsx)(wt,{height:161,percent:.35,autoFit:!0,outline:{border:2,distance:4},padding:[0,0,0,0],statistic:{content:{style:{fontSize:"16px"}}}})})})]})]})})},y4=g4},9187:function(Ot){"use strict";Ot.exports=J,Ot.exports.default=J;function J(Te,qe,ke){ke=ke||2;var Mt=qe&&qe.length,yt=Mt?qe[0]*ke:Te.length,Zt=N(Te,0,yt,ke,!0),qt=[];if(!Zt||Zt.next===Zt.prev)return qt;var Cr,qn,fn,Hi,Zn,Hn,pi;if(Mt&&(Zt=ue(Te,qe,Zt,ke)),Te.length>80*ke){Cr=fn=Te[0],qn=Hi=Te[1];for(var Kn=ke;Kn<yt;Kn+=ke)Zn=Te[Kn],Hn=Te[Kn+1],Zn<Cr&&(Cr=Zn),Hn<qn&&(qn=Hn),Zn>fn&&(fn=Zn),Hn>Hi&&(Hi=Hn);pi=Math.max(fn-Cr,Hi-qn),pi=pi!==0?1/pi:0}return ye(Zt,qt,ke,Cr,qn,pi),qt}function N(Te,qe,ke,Mt,yt){var Zt,qt;if(yt===en(Te,qe,ke,Mt)>0)for(Zt=qe;Zt<ke;Zt+=Mt)qt=$t(Zt,Te[Zt],Te[Zt+1],qt);else for(Zt=ke-Mt;Zt>=qe;Zt-=Mt)qt=$t(Zt,Te[Zt],Te[Zt+1],qt);return qt&&gt(qt,qt.next)&&(Sr(qt),qt=qt.next),qt}function le(Te,qe){if(!Te)return Te;qe||(qe=Te);var ke=Te,Mt;do if(Mt=!1,!ke.steiner&&(gt(ke,ke.next)||pt(ke.prev,ke,ke.next)===0)){if(Sr(ke),ke=qe=ke.prev,ke===ke.next)break;Mt=!0}else ke=ke.next;while(Mt||ke!==qe);return qe}function ye(Te,qe,ke,Mt,yt,Zt,qt){if(!!Te){!qt&&Zt&&ut(Te,Mt,yt,Zt);for(var Cr=Te,qn,fn;Te.prev!==Te.next;){if(qn=Te.prev,fn=Te.next,Zt?ve(Te,Mt,yt,Zt):g(Te)){qe.push(qn.i/ke),qe.push(Te.i/ke),qe.push(fn.i/ke),Sr(Te),Te=fn.next,Cr=fn.next;continue}if(Te=fn,Te===Cr){qt?qt===1?(Te=V(le(Te),qe,ke),ye(Te,qe,ke,Mt,yt,Zt,2)):qt===2&&ce(Te,qe,ke,Mt,yt,Zt):ye(le(Te),qe,ke,Mt,yt,Zt,1);break}}}}function g(Te){var qe=Te.prev,ke=Te,Mt=Te.next;if(pt(qe,ke,Mt)>=0)return!1;for(var yt=Te.next.next;yt!==Te.prev;){if(Jt(qe.x,qe.y,ke.x,ke.y,Mt.x,Mt.y,yt.x,yt.y)&&pt(yt.prev,yt,yt.next)>=0)return!1;yt=yt.next}return!0}function ve(Te,qe,ke,Mt){var yt=Te.prev,Zt=Te,qt=Te.next;if(pt(yt,Zt,qt)>=0)return!1;for(var Cr=yt.x<Zt.x?yt.x<qt.x?yt.x:qt.x:Zt.x<qt.x?Zt.x:qt.x,qn=yt.y<Zt.y?yt.y<qt.y?yt.y:qt.y:Zt.y<qt.y?Zt.y:qt.y,fn=yt.x>Zt.x?yt.x>qt.x?yt.x:qt.x:Zt.x>qt.x?Zt.x:qt.x,Hi=yt.y>Zt.y?yt.y>qt.y?yt.y:qt.y:Zt.y>qt.y?Zt.y:qt.y,Zn=ur(Cr,qn,qe,ke,Mt),Hn=ur(fn,Hi,qe,ke,Mt),pi=Te.prevZ,Kn=Te.nextZ;pi&&pi.z>=Zn&&Kn&&Kn.z<=Hn;){if(pi!==Te.prev&&pi!==Te.next&&Jt(yt.x,yt.y,Zt.x,Zt.y,qt.x,qt.y,pi.x,pi.y)&&pt(pi.prev,pi,pi.next)>=0||(pi=pi.prevZ,Kn!==Te.prev&&Kn!==Te.next&&Jt(yt.x,yt.y,Zt.x,Zt.y,qt.x,qt.y,Kn.x,Kn.y)&&pt(Kn.prev,Kn,Kn.next)>=0))return!1;Kn=Kn.nextZ}for(;pi&&pi.z>=Zn;){if(pi!==Te.prev&&pi!==Te.next&&Jt(yt.x,yt.y,Zt.x,Zt.y,qt.x,qt.y,pi.x,pi.y)&&pt(pi.prev,pi,pi.next)>=0)return!1;pi=pi.prevZ}for(;Kn&&Kn.z<=Hn;){if(Kn!==Te.prev&&Kn!==Te.next&&Jt(yt.x,yt.y,Zt.x,Zt.y,qt.x,qt.y,Kn.x,Kn.y)&&pt(Kn.prev,Kn,Kn.next)>=0)return!1;Kn=Kn.nextZ}return!0}function V(Te,qe,ke){var Mt=Te;do{var yt=Mt.prev,Zt=Mt.next.next;!gt(yt,Zt)&&er(yt,Mt,Mt.next,Zt)&&rt(yt,Zt)&&rt(Zt,yt)&&(qe.push(yt.i/ke),qe.push(Mt.i/ke),qe.push(Zt.i/ke),Sr(Mt),Sr(Mt.next),Mt=Te=Zt),Mt=Mt.next}while(Mt!==Te);return le(Mt)}function ce(Te,qe,ke,Mt,yt,Zt){var qt=Te;do{for(var Cr=qt.next.next;Cr!==qt.prev;){if(qt.i!==Cr.i&&kt(qt,Cr)){var qn=et(qt,Cr);qt=le(qt,qt.next),qn=le(qn,qn.next),ye(qt,qe,ke,Mt,yt,Zt),ye(qn,qe,ke,Mt,yt,Zt);return}Cr=Cr.next}qt=qt.next}while(qt!==Te)}function ue(Te,qe,ke,Mt){var yt=[],Zt,qt,Cr,qn,fn;for(Zt=0,qt=qe.length;Zt<qt;Zt++)Cr=qe[Zt]*Mt,qn=Zt<qt-1?qe[Zt+1]*Mt:Te.length,fn=N(Te,Cr,qn,Mt,!1),fn===fn.next&&(fn.steiner=!0),yt.push(Pt(fn));for(yt.sort(Ne),Zt=0;Zt<yt.length;Zt++)ke=se(yt[Zt],ke),ke=le(ke,ke.next);return ke}function Ne(Te,qe){return Te.x-qe.x}function se(Te,qe){var ke=at(Te,qe);if(!ke)return qe;var Mt=et(ke,Te),yt=le(ke,ke.next);return le(Mt,Mt.next),qe===ke?yt:qe}function at(Te,qe){var ke=qe,Mt=Te.x,yt=Te.y,Zt=-Infinity,qt;do{if(yt<=ke.y&&yt>=ke.next.y&&ke.next.y!==ke.y){var Cr=ke.x+(yt-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(Cr<=Mt&&Cr>Zt){if(Zt=Cr,Cr===Mt){if(yt===ke.y)return ke;if(yt===ke.next.y)return ke.next}qt=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==qe);if(!qt)return null;if(Mt===Zt)return qt;var qn=qt,fn=qt.x,Hi=qt.y,Zn=Infinity,Hn;ke=qt;do Mt>=ke.x&&ke.x>=fn&&Mt!==ke.x&&Jt(yt<Hi?Mt:Zt,yt,fn,Hi,yt<Hi?Zt:Mt,yt,ke.x,ke.y)&&(Hn=Math.abs(yt-ke.y)/(Mt-ke.x),rt(ke,Te)&&(Hn<Zn||Hn===Zn&&(ke.x>qt.x||ke.x===qt.x&&Le(qt,ke)))&&(qt=ke,Zn=Hn)),ke=ke.next;while(ke!==qn);return qt}function Le(Te,qe){return pt(Te.prev,Te,qe.prev)<0&&pt(qe.next,Te,Te.next)<0}function ut(Te,qe,ke,Mt){var yt=Te;do yt.z===null&&(yt.z=ur(yt.x,yt.y,qe,ke,Mt)),yt.prevZ=yt.prev,yt.nextZ=yt.next,yt=yt.next;while(yt!==Te);yt.prevZ.nextZ=null,yt.prevZ=null,Ht(yt)}function Ht(Te){var qe,ke,Mt,yt,Zt,qt,Cr,qn,fn=1;do{for(ke=Te,Te=null,Zt=null,qt=0;ke;){for(qt++,Mt=ke,Cr=0,qe=0;qe<fn&&(Cr++,Mt=Mt.nextZ,!!Mt);qe++);for(qn=fn;Cr>0||qn>0&&Mt;)Cr!==0&&(qn===0||!Mt||ke.z<=Mt.z)?(yt=ke,ke=ke.nextZ,Cr--):(yt=Mt,Mt=Mt.nextZ,qn--),Zt?Zt.nextZ=yt:Te=yt,yt.prevZ=Zt,Zt=yt;ke=Mt}Zt.nextZ=null,fn*=2}while(qt>1);return Te}function ur(Te,qe,ke,Mt,yt){return Te=32767*(Te-ke)*yt,qe=32767*(qe-Mt)*yt,Te=(Te|Te<<8)&16711935,Te=(Te|Te<<4)&252645135,Te=(Te|Te<<2)&858993459,Te=(Te|Te<<1)&1431655765,qe=(qe|qe<<8)&16711935,qe=(qe|qe<<4)&252645135,qe=(qe|qe<<2)&858993459,qe=(qe|qe<<1)&1431655765,Te|qe<<1}function Pt(Te){var qe=Te,ke=Te;do(qe.x<ke.x||qe.x===ke.x&&qe.y<ke.y)&&(ke=qe),qe=qe.next;while(qe!==Te);return ke}function Jt(Te,qe,ke,Mt,yt,Zt,qt,Cr){return(yt-qt)*(qe-Cr)-(Te-qt)*(Zt-Cr)>=0&&(Te-qt)*(Mt-Cr)-(ke-qt)*(qe-Cr)>=0&&(ke-qt)*(Zt-Cr)-(yt-qt)*(Mt-Cr)>=0}function kt(Te,qe){return Te.next.i!==qe.i&&Te.prev.i!==qe.i&&!xt(Te,qe)&&(rt(Te,qe)&&rt(qe,Te)&&wt(Te,qe)&&(pt(Te.prev,Te,qe.prev)||pt(Te,qe.prev,qe))||gt(Te,qe)&&pt(Te.prev,Te,Te.next)>0&&pt(qe.prev,qe,qe.next)>0)}function pt(Te,qe,ke){return(qe.y-Te.y)*(ke.x-qe.x)-(qe.x-Te.x)*(ke.y-qe.y)}function gt(Te,qe){return Te.x===qe.x&&Te.y===qe.y}function er(Te,qe,ke,Mt){var yt=Qt(pt(Te,qe,ke)),Zt=Qt(pt(Te,qe,Mt)),qt=Qt(pt(ke,Mt,Te)),Cr=Qt(pt(ke,Mt,qe));return!!(yt!==Zt&&qt!==Cr||yt===0&&q(Te,ke,qe)||Zt===0&&q(Te,Mt,qe)||qt===0&&q(ke,Te,Mt)||Cr===0&&q(ke,qe,Mt))}function q(Te,qe,ke){return qe.x<=Math.max(Te.x,ke.x)&&qe.x>=Math.min(Te.x,ke.x)&&qe.y<=Math.max(Te.y,ke.y)&&qe.y>=Math.min(Te.y,ke.y)}function Qt(Te){return Te>0?1:Te<0?-1:0}function xt(Te,qe){var ke=Te;do{if(ke.i!==Te.i&&ke.next.i!==Te.i&&ke.i!==qe.i&&ke.next.i!==qe.i&&er(ke,ke.next,Te,qe))return!0;ke=ke.next}while(ke!==Te);return!1}function rt(Te,qe){return pt(Te.prev,Te,Te.next)<0?pt(Te,qe,Te.next)>=0&&pt(Te,Te.prev,qe)>=0:pt(Te,qe,Te.prev)<0||pt(Te,Te.next,qe)<0}function wt(Te,qe){var ke=Te,Mt=!1,yt=(Te.x+qe.x)/2,Zt=(Te.y+qe.y)/2;do ke.y>Zt!=ke.next.y>Zt&&ke.next.y!==ke.y&&yt<(ke.next.x-ke.x)*(Zt-ke.y)/(ke.next.y-ke.y)+ke.x&&(Mt=!Mt),ke=ke.next;while(ke!==Te);return Mt}function et(Te,qe){var ke=new kr(Te.i,Te.x,Te.y),Mt=new kr(qe.i,qe.x,qe.y),yt=Te.next,Zt=qe.prev;return Te.next=qe,qe.prev=Te,ke.next=yt,yt.prev=ke,Mt.next=ke,ke.prev=Mt,Zt.next=Mt,Mt.prev=Zt,Mt}function $t(Te,qe,ke,Mt){var yt=new kr(Te,qe,ke);return Mt?(yt.next=Mt.next,yt.prev=Mt,Mt.next.prev=yt,Mt.next=yt):(yt.prev=yt,yt.next=yt),yt}function Sr(Te){Te.next.prev=Te.prev,Te.prev.next=Te.next,Te.prevZ&&(Te.prevZ.nextZ=Te.nextZ),Te.nextZ&&(Te.nextZ.prevZ=Te.prevZ)}function kr(Te,qe,ke){this.i=Te,this.x=qe,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}J.deviation=function(Te,qe,ke,Mt){var yt=qe&&qe.length,Zt=yt?qe[0]*ke:Te.length,qt=Math.abs(en(Te,0,Zt,ke));if(yt)for(var Cr=0,qn=qe.length;Cr<qn;Cr++){var fn=qe[Cr]*ke,Hi=Cr<qn-1?qe[Cr+1]*ke:Te.length;qt-=Math.abs(en(Te,fn,Hi,ke))}var Zn=0;for(Cr=0;Cr<Mt.length;Cr+=3){var Hn=Mt[Cr]*ke,pi=Mt[Cr+1]*ke,Kn=Mt[Cr+2]*ke;Zn+=Math.abs((Te[Hn]-Te[Kn])*(Te[pi+1]-Te[Hn+1])-(Te[Hn]-Te[pi])*(Te[Kn+1]-Te[Hn+1]))}return qt===0&&Zn===0?0:Math.abs((Zn-qt)/qt)};function en(Te,qe,ke,Mt){for(var yt=0,Zt=qe,qt=ke-Mt;Zt<ke;Zt+=Mt)yt+=(Te[qt]-Te[Zt])*(Te[Zt+1]+Te[qt+1]),qt=Zt;return yt}J.flatten=function(Te){for(var qe=Te[0][0].length,ke={vertices:[],holes:[],dimensions:qe},Mt=0,yt=0;yt<Te.length;yt++){for(var Zt=0;Zt<Te[yt].length;Zt++)for(var qt=0;qt<qe;qt++)ke.vertices.push(Te[yt][Zt][qt]);yt>0&&(Mt+=Te[yt-1].length,ke.holes.push(Mt))}return ke}},67709:function(Ot){function J(le){var ye=le.target||le.srcElement;ye.__resizeRAF__&&cancelAnimationFrame(ye.__resizeRAF__),ye.__resizeRAF__=requestAnimationFrame(function(){var g=ye.__resizeTrigger__,ve=g&&g.__resizeListeners__;ve&&ve.forEach(function(V){V.call(g,le)})})}var N=function(ye,g){var ve=this,V=ve.document,ce,ue=V.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ne(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",J)}if(!ye.__resizeListeners__)if(ye.__resizeListeners__=[],ue)ye.__resizeTrigger__=ye,ye.attachEvent("onresize",J);else{getComputedStyle(ye).position==="static"&&(ye.style.position="relative");var se=ye.__resizeTrigger__=V.createElement("object");se.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),se.setAttribute("class","resize-sensor"),se.setAttribute("tabindex","-1"),se.setAttribute("title",""),se.__resizeElement__=ye,se.onload=Ne,se.type="text/html",ce&&ye.appendChild(se),se.data="about:blank",ce||ye.appendChild(se)}ye.__resizeListeners__.push(g)};Ot.exports=typeof window=="undefined"?N:N.bind(window),Ot.exports.unbind=function(le,ye){var g=document.attachEvent,ve=le.__resizeListeners__||[];if(ye){var V=ve.indexOf(ye);V!==-1&&ve.splice(V,1)}else ve=le.__resizeListeners__=[];if(!ve.length){if(g)le.detachEvent("onresize",J);else if(le.__resizeTrigger__){var ce=le.__resizeTrigger__.contentDocument,ue=ce&&ce.defaultView;ue&&(ue.removeEventListener("resize",J),delete ue.__resizeTrigger__),le.__resizeTrigger__=!le.removeChild(le.__resizeTrigger__)}delete le.__resizeListeners__}}},26729:function(Ot){"use strict";var J=Object.prototype.hasOwnProperty,N="~";function le(){}Object.create&&(le.prototype=Object.create(null),new le().__proto__||(N=!1));function ye(ce,ue,Ne){this.fn=ce,this.context=ue,this.once=Ne||!1}function g(ce,ue,Ne,se,at){if(typeof Ne!="function")throw new TypeError("The listener must be a function");var Le=new ye(Ne,se||ce,at),ut=N?N+ue:ue;return ce._events[ut]?ce._events[ut].fn?ce._events[ut]=[ce._events[ut],Le]:ce._events[ut].push(Le):(ce._events[ut]=Le,ce._eventsCount++),ce}function ve(ce,ue){--ce._eventsCount==0?ce._events=new le:delete ce._events[ue]}function V(){this._events=new le,this._eventsCount=0}V.prototype.eventNames=function(){var ue=[],Ne,se;if(this._eventsCount===0)return ue;for(se in Ne=this._events)J.call(Ne,se)&&ue.push(N?se.slice(1):se);return Object.getOwnPropertySymbols?ue.concat(Object.getOwnPropertySymbols(Ne)):ue},V.prototype.listeners=function(ue){var Ne=N?N+ue:ue,se=this._events[Ne];if(!se)return[];if(se.fn)return[se.fn];for(var at=0,Le=se.length,ut=new Array(Le);at<Le;at++)ut[at]=se[at].fn;return ut},V.prototype.listenerCount=function(ue){var Ne=N?N+ue:ue,se=this._events[Ne];return se?se.fn?1:se.length:0},V.prototype.emit=function(ue,Ne,se,at,Le,ut){var Ht=N?N+ue:ue;if(!this._events[Ht])return!1;var ur=this._events[Ht],Pt=arguments.length,Jt,kt;if(ur.fn){switch(ur.once&&this.removeListener(ue,ur.fn,void 0,!0),Pt){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,Ne),!0;case 3:return ur.fn.call(ur.context,Ne,se),!0;case 4:return ur.fn.call(ur.context,Ne,se,at),!0;case 5:return ur.fn.call(ur.context,Ne,se,at,Le),!0;case 6:return ur.fn.call(ur.context,Ne,se,at,Le,ut),!0}for(kt=1,Jt=new Array(Pt-1);kt<Pt;kt++)Jt[kt-1]=arguments[kt];ur.fn.apply(ur.context,Jt)}else{var pt=ur.length,gt;for(kt=0;kt<pt;kt++)switch(ur[kt].once&&this.removeListener(ue,ur[kt].fn,void 0,!0),Pt){case 1:ur[kt].fn.call(ur[kt].context);break;case 2:ur[kt].fn.call(ur[kt].context,Ne);break;case 3:ur[kt].fn.call(ur[kt].context,Ne,se);break;case 4:ur[kt].fn.call(ur[kt].context,Ne,se,at);break;default:if(!Jt)for(gt=1,Jt=new Array(Pt-1);gt<Pt;gt++)Jt[gt-1]=arguments[gt];ur[kt].fn.apply(ur[kt].context,Jt)}}return!0},V.prototype.on=function(ue,Ne,se){return g(this,ue,Ne,se,!1)},V.prototype.once=function(ue,Ne,se){return g(this,ue,Ne,se,!0)},V.prototype.removeListener=function(ue,Ne,se,at){var Le=N?N+ue:ue;if(!this._events[Le])return this;if(!Ne)return ve(this,Le),this;var ut=this._events[Le];if(ut.fn)ut.fn===Ne&&(!at||ut.once)&&(!se||ut.context===se)&&ve(this,Le);else{for(var Ht=0,ur=[],Pt=ut.length;Ht<Pt;Ht++)(ut[Ht].fn!==Ne||at&&!ut[Ht].once||se&&ut[Ht].context!==se)&&ur.push(ut[Ht]);ur.length?this._events[Le]=ur.length===1?ur[0]:ur:ve(this,Le)}return this},V.prototype.removeAllListeners=function(ue){var Ne;return ue?(Ne=N?N+ue:ue,this._events[Ne]&&ve(this,Ne)):(this._events=new le,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,Ot.exports=V},7375:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0});var N=Symbol.for("INJECTION");function le(ce,ue,Ne,se){function at(){return se&&!Reflect.hasMetadata(N,this,ue)&&Reflect.defineMetadata(N,Ne(),this,ue),Reflect.hasMetadata(N,this,ue)?Reflect.getMetadata(N,this,ue):Ne()}function Le(ut){Reflect.defineMetadata(N,ut,this,ue)}Object.defineProperty(ce,ue,{configurable:!0,enumerable:!0,get:at,set:Le})}function ye(ce,ue){return function(Ne){return function(se,at){var Le=function(){return ce.get(Ne)};le(se,at,Le,ue)}}}J.makePropertyInjectDecorator=ye;function g(ce,ue){return function(Ne,se){return function(at,Le){var ut=function(){return ce.getNamed(Ne,se)};le(at,Le,ut,ue)}}}J.makePropertyInjectNamedDecorator=g;function ve(ce,ue){return function(Ne,se,at){return function(Le,ut){var Ht=function(){return ce.getTagged(Ne,se,at)};le(Le,ut,Ht,ue)}}}J.makePropertyInjectTaggedDecorator=ve;function V(ce,ue){return function(Ne){return function(se,at){var Le=function(){return ce.getAll(Ne)};le(se,at,Le,ue)}}}J.makePropertyMultiInjectDecorator=V},84879:function(Ot,J,N){"use strict";var le;le={value:!0};var ye=N(7375);function g(ve,V){V===void 0&&(V=!0);var ce=ye.makePropertyInjectDecorator(ve,V),ue=ye.makePropertyInjectNamedDecorator(ve,V),Ne=ye.makePropertyInjectTaggedDecorator(ve,V),se=ye.makePropertyMultiInjectDecorator(ve,V);return{lazyInject:ce,lazyInjectNamed:ue,lazyInjectTagged:Ne,lazyMultiInject:se}}J.Z=g},99934:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.tagProperty=J.tagParameter=J.decorate=void 0;var le=N(16674),ye=N(6867);function g(se,at,Le,ut){var Ht=ye.TAGGED;V(Ht,se,at,ut,Le)}J.tagParameter=g;function ve(se,at,Le){var ut=ye.TAGGED_PROP;V(ut,se.constructor,at,Le)}J.tagProperty=ve;function V(se,at,Le,ut,Ht){var ur={},Pt=typeof Ht=="number",Jt=Ht!==void 0&&Pt?Ht.toString():Le;if(Pt&&Le!==void 0)throw new Error(le.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(se,at)&&(ur=Reflect.getMetadata(se,at));var kt=ur[Jt];if(!Array.isArray(kt))kt=[];else for(var pt=0,gt=kt;pt<gt.length;pt++){var er=gt[pt];if(er.key===ut.key)throw new Error(le.DUPLICATED_METADATA+" "+er.key.toString())}kt.push(ut),ur[Jt]=kt,Reflect.defineMetadata(se,ur,at)}function ce(se,at){Reflect.decorate(se,at)}function ue(se,at){return function(Le,ut){at(Le,ut,se)}}function Ne(se,at,Le){typeof Le=="number"?ce([ue(Le,se)],at):typeof Le=="string"?Reflect.decorate([se],at,Le):ce([se],at)}J.decorate=Ne},5744:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.inject=J.LazyServiceIdentifer=void 0;var le=N(16674),ye=N(6867),g=N(47738),ve=N(99934),V=function(){function ue(Ne){this._cb=Ne}return ue.prototype.unwrap=function(){return this._cb()},ue}();J.LazyServiceIdentifer=V;function ce(ue){return function(Ne,se,at){if(ue===void 0)throw new Error(le.UNDEFINED_INJECT_ANNOTATION(Ne.name));var Le=new g.Metadata(ye.INJECT_TAG,ue);typeof at=="number"?ve.tagParameter(Ne,se,at,Le):ve.tagProperty(Ne,se,Le)}}J.inject=ce},64315:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.injectable=void 0;var le=N(16674),ye=N(6867);function g(){return function(ve){if(Reflect.hasOwnMetadata(ye.PARAM_TYPES,ve))throw new Error(le.DUPLICATED_INJECTABLE_DECORATOR);var V=Reflect.getMetadata(ye.DESIGN_PARAM_TYPES,ve)||[];return Reflect.defineMetadata(ye.PARAM_TYPES,V,ve),ve}}J.injectable=g},71693:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.multiInject=void 0;var le=N(6867),ye=N(47738),g=N(99934);function ve(V){return function(ce,ue,Ne){var se=new ye.Metadata(le.MULTI_INJECT_TAG,V);typeof Ne=="number"?g.tagParameter(ce,ue,Ne,se):g.tagProperty(ce,ue,se)}}J.multiInject=ve},38085:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.named=void 0;var le=N(6867),ye=N(47738),g=N(99934);function ve(V){return function(ce,ue,Ne){var se=new ye.Metadata(le.NAMED_TAG,V);typeof Ne=="number"?g.tagParameter(ce,ue,Ne,se):g.tagProperty(ce,ue,se)}}J.named=ve},6515:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.optional=void 0;var le=N(6867),ye=N(47738),g=N(99934);function ve(){return function(V,ce,ue){var Ne=new ye.Metadata(le.OPTIONAL_TAG,!0);typeof ue=="number"?g.tagParameter(V,ce,ue,Ne):g.tagProperty(V,ce,Ne)}}J.optional=ve},7014:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.postConstruct=void 0;var le=N(16674),ye=N(6867),g=N(47738);function ve(){return function(V,ce,ue){var Ne=new g.Metadata(ye.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(ye.POST_CONSTRUCT,V.constructor))throw new Error(le.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ye.POST_CONSTRUCT,Ne,V.constructor)}}J.postConstruct=ve},32052:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.tagged=void 0;var le=N(47738),ye=N(99934);function g(ve,V){return function(ce,ue,Ne){var se=new le.Metadata(ve,V);typeof Ne=="number"?ye.tagParameter(ce,ue,Ne,se):ye.tagProperty(ce,ue,se)}}J.tagged=g},55638:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.targetName=void 0;var le=N(6867),ye=N(47738),g=N(99934);function ve(V){return function(ce,ue,Ne){var se=new ye.Metadata(le.NAME_TAG,V);g.tagParameter(ce,ue,Ne,se)}}J.targetName=ve},86757:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.unmanaged=void 0;var le=N(6867),ye=N(47738),g=N(99934);function ve(){return function(V,ce,ue){var Ne=new ye.Metadata(le.UNMANAGED_TAG,!0);g.tagParameter(V,ce,ue,Ne)}}J.unmanaged=ve},44290:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Binding=void 0;var le=N(28421),ye=N(37791),g=function(){function ve(V,ce){this.id=ye.id(),this.activated=!1,this.serviceIdentifier=V,this.scope=ce,this.type=le.BindingTypeEnum.Invalid,this.constraint=function(ue){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ve.prototype.clone=function(){var V=new ve(this.serviceIdentifier,this.scope);return V.activated=V.scope===le.BindingScopeEnum.Singleton?this.activated:!1,V.implementationType=this.implementationType,V.dynamicValue=this.dynamicValue,V.scope=this.scope,V.type=this.type,V.factory=this.factory,V.provider=this.provider,V.constraint=this.constraint,V.onActivation=this.onActivation,V.cache=this.cache,V},ve}();J.Binding=g},23184:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingCount=void 0;var N={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};J.BindingCount=N},16674:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.STACK_OVERFLOW=J.CIRCULAR_DEPENDENCY_IN_FACTORY=J.POST_CONSTRUCT_ERROR=J.MULTIPLE_POST_CONSTRUCT_METHODS=J.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=J.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=J.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=J.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=J.ARGUMENTS_LENGTH_MISMATCH=J.INVALID_DECORATOR_OPERATION=J.INVALID_TO_SELF_VALUE=J.INVALID_FUNCTION_BINDING=J.INVALID_MIDDLEWARE_RETURN=J.NO_MORE_SNAPSHOTS_AVAILABLE=J.INVALID_BINDING_TYPE=J.NOT_IMPLEMENTED=J.CIRCULAR_DEPENDENCY=J.UNDEFINED_INJECT_ANNOTATION=J.MISSING_INJECT_ANNOTATION=J.MISSING_INJECTABLE_ANNOTATION=J.NOT_REGISTERED=J.CANNOT_UNBIND=J.AMBIGUOUS_MATCH=J.KEY_NOT_FOUND=J.NULL_ARGUMENT=J.DUPLICATED_METADATA=J.DUPLICATED_INJECTABLE_DECORATOR=void 0,J.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",J.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",J.NULL_ARGUMENT="NULL argument",J.KEY_NOT_FOUND="Key Not Found",J.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",J.CANNOT_UNBIND="Could not unbind serviceIdentifier:",J.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",J.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",J.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var N=function(ve){return"@inject called with undefined this could mean that the class "+ve+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};J.UNDEFINED_INJECT_ANNOTATION=N,J.CIRCULAR_DEPENDENCY="Circular dependency found:",J.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",J.INVALID_BINDING_TYPE="Invalid binding type:",J.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",J.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",J.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",J.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",J.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var le=function(){for(var ve=[],V=0;V<arguments.length;V++)ve[V]=arguments[V];return"The number of constructor arguments in the derived class "+(ve[0]+" must be >= than the number of constructor arguments of its base class.")};J.ARGUMENTS_LENGTH_MISMATCH=le,J.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",J.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",J.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",J.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",J.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ye=function(){for(var ve=[],V=0;V<arguments.length;V++)ve[V]=arguments[V];return"@postConstruct error in class "+ve[0]+": "+ve[1]};J.POST_CONSTRUCT_ERROR=ye;var g=function(){for(var ve=[],V=0;V<arguments.length;V++)ve[V]=arguments[V];return"It looks like there is a circular dependency "+("in one of the '"+ve[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ve[1]+"'.")};J.CIRCULAR_DEPENDENCY_IN_FACTORY=g,J.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.TargetTypeEnum=J.BindingTypeEnum=J.BindingScopeEnum=void 0;var N={Request:"Request",Singleton:"Singleton",Transient:"Transient"};J.BindingScopeEnum=N;var le={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};J.BindingTypeEnum=le;var ye={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};J.TargetTypeEnum=ye},6867:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.NON_CUSTOM_TAG_KEYS=J.POST_CONSTRUCT=J.DESIGN_PARAM_TYPES=J.PARAM_TYPES=J.TAGGED_PROP=J.TAGGED=J.MULTI_INJECT_TAG=J.INJECT_TAG=J.OPTIONAL_TAG=J.UNMANAGED_TAG=J.NAME_TAG=J.NAMED_TAG=void 0,J.NAMED_TAG="named",J.NAME_TAG="name",J.UNMANAGED_TAG="unmanaged",J.OPTIONAL_TAG="optional",J.INJECT_TAG="inject",J.MULTI_INJECT_TAG="multi_inject",J.TAGGED="inversify:tagged",J.TAGGED_PROP="inversify:tagged_props",J.PARAM_TYPES="inversify:paramtypes",J.DESIGN_PARAM_TYPES="design:paramtypes",J.POST_CONSTRUCT="post_construct";function N(){return[J.INJECT_TAG,J.MULTI_INJECT_TAG,J.NAME_TAG,J.UNMANAGED_TAG,J.NAMED_TAG,J.OPTIONAL_TAG]}J.NON_CUSTOM_TAG_KEYS=N()},51389:function(Ot,J,N){"use strict";var le=this&&this.__awaiter||function(kt,pt,gt,er){function q(Qt){return Qt instanceof gt?Qt:new gt(function(xt){xt(Qt)})}return new(gt||(gt=Promise))(function(Qt,xt){function rt($t){try{et(er.next($t))}catch(Sr){xt(Sr)}}function wt($t){try{et(er.throw($t))}catch(Sr){xt(Sr)}}function et($t){$t.done?Qt($t.value):q($t.value).then(rt,wt)}et((er=er.apply(kt,pt||[])).next())})},ye=this&&this.__generator||function(kt,pt){var gt={label:0,sent:function(){if(Qt[0]&1)throw Qt[1];return Qt[1]},trys:[],ops:[]},er,q,Qt,xt;return xt={next:rt(0),throw:rt(1),return:rt(2)},typeof Symbol=="function"&&(xt[Symbol.iterator]=function(){return this}),xt;function rt(et){return function($t){return wt([et,$t])}}function wt(et){if(er)throw new TypeError("Generator is already executing.");for(;gt;)try{if(er=1,q&&(Qt=et[0]&2?q.return:et[0]?q.throw||((Qt=q.return)&&Qt.call(q),0):q.next)&&!(Qt=Qt.call(q,et[1])).done)return Qt;switch(q=0,Qt&&(et=[et[0]&2,Qt.value]),et[0]){case 0:case 1:Qt=et;break;case 4:return gt.label++,{value:et[1],done:!1};case 5:gt.label++,q=et[1],et=[0];continue;case 7:et=gt.ops.pop(),gt.trys.pop();continue;default:if(Qt=gt.trys,!(Qt=Qt.length>0&&Qt[Qt.length-1])&&(et[0]===6||et[0]===2)){gt=0;continue}if(et[0]===3&&(!Qt||et[1]>Qt[0]&&et[1]<Qt[3])){gt.label=et[1];break}if(et[0]===6&&gt.label<Qt[1]){gt.label=Qt[1],Qt=et;break}if(Qt&&gt.label<Qt[2]){gt.label=Qt[2],gt.ops.push(et);break}Qt[2]&&gt.ops.pop(),gt.trys.pop();continue}et=pt.call(kt,gt)}catch($t){et=[6,$t],q=0}finally{er=Qt=0}if(et[0]&5)throw et[1];return{value:et[0]?et[1]:void 0,done:!0}}},g=this&&this.__spreadArray||function(kt,pt){for(var gt=0,er=pt.length,q=kt.length;gt<er;gt++,q++)kt[q]=pt[gt];return kt};Object.defineProperty(J,"__esModule",{value:!0}),J.Container=void 0;var ve=N(44290),V=N(16674),ce=N(28421),ue=N(6867),Ne=N(51377),se=N(86311),at=N(31927),Le=N(15451),ut=N(37791),Ht=N(55800),ur=N(85700),Pt=N(80175),Jt=function(){function kt(pt){this._appliedMiddleware=[];var gt=pt||{};if(typeof gt!="object")throw new Error(""+V.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(gt.defaultScope===void 0)gt.defaultScope=ce.BindingScopeEnum.Transient;else if(gt.defaultScope!==ce.BindingScopeEnum.Singleton&&gt.defaultScope!==ce.BindingScopeEnum.Transient&&gt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+V.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(gt.autoBindInjectable===void 0)gt.autoBindInjectable=!1;else if(typeof gt.autoBindInjectable!="boolean")throw new Error(""+V.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(gt.skipBaseClassChecks===void 0)gt.skipBaseClassChecks=!1;else if(typeof gt.skipBaseClassChecks!="boolean")throw new Error(""+V.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:gt.autoBindInjectable,defaultScope:gt.defaultScope,skipBaseClassChecks:gt.skipBaseClassChecks},this.id=ut.id(),this._bindingDictionary=new Pt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ne.MetadataReader}return kt.merge=function(pt,gt){for(var er=[],q=2;q<arguments.length;q++)er[q-2]=arguments[q];var Qt=new kt,xt=g([pt,gt],er).map(function(et){return se.getBindingDictionary(et)}),rt=se.getBindingDictionary(Qt);function wt(et,$t){et.traverse(function(Sr,kr){kr.forEach(function(en){$t.add(en.serviceIdentifier,en.clone())})})}return xt.forEach(function(et){wt(et,rt)}),Qt},kt.prototype.load=function(){for(var pt=[],gt=0;gt<arguments.length;gt++)pt[gt]=arguments[gt];for(var er=this._getContainerModuleHelpersFactory(),q=0,Qt=pt;q<Qt.length;q++){var xt=Qt[q],rt=er(xt.id);xt.registry(rt.bindFunction,rt.unbindFunction,rt.isboundFunction,rt.rebindFunction)}},kt.prototype.loadAsync=function(){for(var pt=[],gt=0;gt<arguments.length;gt++)pt[gt]=arguments[gt];return le(this,void 0,void 0,function(){var er,q,Qt,xt,rt;return ye(this,function(wt){switch(wt.label){case 0:er=this._getContainerModuleHelpersFactory(),q=0,Qt=pt,wt.label=1;case 1:return q<Qt.length?(xt=Qt[q],rt=er(xt.id),[4,xt.registry(rt.bindFunction,rt.unbindFunction,rt.isboundFunction,rt.rebindFunction)]):[3,4];case 2:wt.sent(),wt.label=3;case 3:return q++,[3,1];case 4:return[2]}})})},kt.prototype.unload=function(){for(var pt=this,gt=[],er=0;er<arguments.length;er++)gt[er]=arguments[er];var q=function(Qt){return function(xt){return xt.moduleId===Qt}};gt.forEach(function(Qt){var xt=q(Qt.id);pt._bindingDictionary.removeByCondition(xt)})},kt.prototype.bind=function(pt){var gt=this.options.defaultScope||ce.BindingScopeEnum.Transient,er=new ve.Binding(pt,gt);return this._bindingDictionary.add(pt,er),new Le.BindingToSyntax(er)},kt.prototype.rebind=function(pt){return this.unbind(pt),this.bind(pt)},kt.prototype.unbind=function(pt){try{this._bindingDictionary.remove(pt)}catch(gt){throw new Error(V.CANNOT_UNBIND+" "+Ht.getServiceIdentifierAsString(pt))}},kt.prototype.unbindAll=function(){this._bindingDictionary=new Pt.Lookup},kt.prototype.isBound=function(pt){var gt=this._bindingDictionary.hasKey(pt);return!gt&&this.parent&&(gt=this.parent.isBound(pt)),gt},kt.prototype.isBoundNamed=function(pt,gt){return this.isBoundTagged(pt,ue.NAMED_TAG,gt)},kt.prototype.isBoundTagged=function(pt,gt,er){var q=!1;if(this._bindingDictionary.hasKey(pt)){var Qt=this._bindingDictionary.get(pt),xt=se.createMockRequest(this,pt,gt,er);q=Qt.some(function(rt){return rt.constraint(xt)})}return!q&&this.parent&&(q=this.parent.isBoundTagged(pt,gt,er)),q},kt.prototype.snapshot=function(){this._snapshots.push(ur.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},kt.prototype.restore=function(){var pt=this._snapshots.pop();if(pt===void 0)throw new Error(V.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=pt.bindings,this._middleware=pt.middleware},kt.prototype.createChild=function(pt){var gt=new kt(pt||this.options);return gt.parent=this,gt},kt.prototype.applyMiddleware=function(){for(var pt=[],gt=0;gt<arguments.length;gt++)pt[gt]=arguments[gt];this._appliedMiddleware=this._appliedMiddleware.concat(pt);var er=this._middleware?this._middleware:this._planAndResolve();this._middleware=pt.reduce(function(q,Qt){return Qt(q)},er)},kt.prototype.applyCustomMetadataReader=function(pt){this._metadataReader=pt},kt.prototype.get=function(pt){return this._get(!1,!1,ce.TargetTypeEnum.Variable,pt)},kt.prototype.getTagged=function(pt,gt,er){return this._get(!1,!1,ce.TargetTypeEnum.Variable,pt,gt,er)},kt.prototype.getNamed=function(pt,gt){return this.getTagged(pt,ue.NAMED_TAG,gt)},kt.prototype.getAll=function(pt){return this._get(!0,!0,ce.TargetTypeEnum.Variable,pt)},kt.prototype.getAllTagged=function(pt,gt,er){return this._get(!1,!0,ce.TargetTypeEnum.Variable,pt,gt,er)},kt.prototype.getAllNamed=function(pt,gt){return this.getAllTagged(pt,ue.NAMED_TAG,gt)},kt.prototype.resolve=function(pt){var gt=this.createChild();return gt.bind(pt).toSelf(),this._appliedMiddleware.forEach(function(er){gt.applyMiddleware(er)}),gt.get(pt)},kt.prototype._getContainerModuleHelpersFactory=function(){var pt=this,gt=function(rt,wt){rt._binding.moduleId=wt},er=function(rt){return function(wt){var et=pt.bind.bind(pt),$t=et(wt);return gt($t,rt),$t}},q=function(rt){return function(wt){var et=pt.unbind.bind(pt);et(wt)}},Qt=function(rt){return function(wt){var et=pt.isBound.bind(pt);return et(wt)}},xt=function(rt){return function(wt){var et=pt.rebind.bind(pt),$t=et(wt);return gt($t,rt),$t}};return function(rt){return{bindFunction:er(rt),isboundFunction:Qt(rt),rebindFunction:xt(rt),unbindFunction:q(rt)}}},kt.prototype._get=function(pt,gt,er,q,Qt,xt){var rt=null,wt={avoidConstraints:pt,contextInterceptor:function(et){return et},isMultiInject:gt,key:Qt,serviceIdentifier:q,targetType:er,value:xt};if(this._middleware){if(rt=this._middleware(wt),rt==null)throw new Error(V.INVALID_MIDDLEWARE_RETURN)}else rt=this._planAndResolve()(wt);return rt},kt.prototype._planAndResolve=function(){var pt=this;return function(gt){var er=se.plan(pt._metadataReader,pt,gt.isMultiInject,gt.targetType,gt.serviceIdentifier,gt.key,gt.value,gt.avoidConstraints);er=gt.contextInterceptor(er);var q=at.resolve(er);return q}},kt}();J.Container=Jt},33244:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.AsyncContainerModule=J.ContainerModule=void 0;var le=N(37791),ye=function(){function ve(V){this.id=le.id(),this.registry=V}return ve}();J.ContainerModule=ye;var g=function(){function ve(V){this.id=le.id(),this.registry=V}return ve}();J.AsyncContainerModule=g},85700:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.ContainerSnapshot=void 0;var N=function(){function le(){}return le.of=function(ye,g){var ve=new le;return ve.bindings=ye,ve.middleware=g,ve},le}();J.ContainerSnapshot=N},80175:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Lookup=void 0;var le=N(16674),ye=function(){function g(){this._map=new Map}return g.prototype.getMap=function(){return this._map},g.prototype.add=function(ve,V){if(ve==null)throw new Error(le.NULL_ARGUMENT);if(V==null)throw new Error(le.NULL_ARGUMENT);var ce=this._map.get(ve);ce!==void 0?(ce.push(V),this._map.set(ve,ce)):this._map.set(ve,[V])},g.prototype.get=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);var V=this._map.get(ve);if(V!==void 0)return V;throw new Error(le.KEY_NOT_FOUND)},g.prototype.remove=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);if(!this._map.delete(ve))throw new Error(le.KEY_NOT_FOUND)},g.prototype.removeByCondition=function(ve){var V=this;this._map.forEach(function(ce,ue){var Ne=ce.filter(function(se){return!ve(se)});Ne.length>0?V._map.set(ue,Ne):V._map.delete(ue)})},g.prototype.hasKey=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);return this._map.has(ve)},g.prototype.clone=function(){var ve=new g;return this._map.forEach(function(V,ce){V.forEach(function(ue){return ve.add(ce,ue.clone())})}),ve},g.prototype.traverse=function(ve){this._map.forEach(function(V,ce){ve(ce,V)})},g}();J.Lookup=ye},86700:function(Ot,J,N){"use strict";var le;le={value:!0},le=le=le=le=le=le=J.GW=le=le=J.zY=le=le=le=le=le=J.f3=le=le=J.b2=le=le=le=le=le=J.W2=le=void 0;var ye=N(6867);le=ye;var g=N(51389);Object.defineProperty(J,"W2",{enumerable:!0,get:function(){return g.Container}});var ve=N(28421);le={enumerable:!0,get:function(){return ve.BindingScopeEnum}},le={enumerable:!0,get:function(){return ve.BindingTypeEnum}},le={enumerable:!0,get:function(){return ve.TargetTypeEnum}};var V=N(33244);le={enumerable:!0,get:function(){return V.AsyncContainerModule}},le={enumerable:!0,get:function(){return V.ContainerModule}};var ce=N(64315);Object.defineProperty(J,"b2",{enumerable:!0,get:function(){return ce.injectable}});var ue=N(32052);le={enumerable:!0,get:function(){return ue.tagged}};var Ne=N(38085);le={enumerable:!0,get:function(){return Ne.named}};var se=N(5744);Object.defineProperty(J,"f3",{enumerable:!0,get:function(){return se.inject}}),le={enumerable:!0,get:function(){return se.LazyServiceIdentifer}};var at=N(6515);le={enumerable:!0,get:function(){return at.optional}};var Le=N(86757);le={enumerable:!0,get:function(){return Le.unmanaged}};var ut=N(71693);le={enumerable:!0,get:function(){return ut.multiInject}};var Ht=N(55638);le={enumerable:!0,get:function(){return Ht.targetName}};var ur=N(7014);Object.defineProperty(J,"zY",{enumerable:!0,get:function(){return ur.postConstruct}});var Pt=N(51377);le={enumerable:!0,get:function(){return Pt.MetadataReader}};var Jt=N(37791);le={enumerable:!0,get:function(){return Jt.id}};var kt=N(99934);Object.defineProperty(J,"GW",{enumerable:!0,get:function(){return kt.decorate}});var pt=N(80758);le={enumerable:!0,get:function(){return pt.traverseAncerstors}},le={enumerable:!0,get:function(){return pt.taggedConstraint}},le={enumerable:!0,get:function(){return pt.namedConstraint}},le={enumerable:!0,get:function(){return pt.typeConstraint}};var gt=N(55800);le={enumerable:!0,get:function(){return gt.getServiceIdentifierAsString}};var er=N(70600);le={enumerable:!0,get:function(){return er.multiBindToService}}},95228:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Context=void 0;var le=N(37791),ye=function(){function g(ve){this.id=le.id(),this.container=ve}return g.prototype.addPlan=function(ve){this.plan=ve},g.prototype.setCurrentRequest=function(ve){this.currentRequest=ve},g}();J.Context=ye},47738:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Metadata=void 0;var le=N(6867),ye=function(){function g(ve,V){this.key=ve,this.value=V}return g.prototype.toString=function(){return this.key===le.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},g}();J.Metadata=ye},51377:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.MetadataReader=void 0;var le=N(6867),ye=function(){function g(){}return g.prototype.getConstructorMetadata=function(ve){var V=Reflect.getMetadata(le.PARAM_TYPES,ve),ce=Reflect.getMetadata(le.TAGGED,ve);return{compilerGeneratedMetadata:V,userGeneratedMetadata:ce||{}}},g.prototype.getPropertiesMetadata=function(ve){var V=Reflect.getMetadata(le.TAGGED_PROP,ve)||[];return V},g}();J.MetadataReader=ye},55314:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Plan=void 0;var N=function(){function le(ye,g){this.parentContext=ye,this.rootRequest=g}return le}();J.Plan=N},86311:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.getBindingDictionary=J.createMockRequest=J.plan=void 0;var le=N(23184),ye=N(16674),g=N(28421),ve=N(6867),V=N(85265),ce=N(55800),ue=N(95228),Ne=N(47738),se=N(55314),at=N(6e3),Le=N(6748),ut=N(18924);function Ht(q){return q._bindingDictionary}J.getBindingDictionary=Ht;function ur(q,Qt,xt,rt,wt,et){var $t=q?ve.MULTI_INJECT_TAG:ve.INJECT_TAG,Sr=new Ne.Metadata($t,xt),kr=new ut.Target(Qt,rt,xt,Sr);if(wt!==void 0){var en=new Ne.Metadata(wt,et);kr.metadata.push(en)}return kr}function Pt(q,Qt,xt,rt,wt){var et=pt(xt.container,wt.serviceIdentifier),$t=[];return et.length===le.BindingCount.NoBindingsAvailable&&xt.container.options.autoBindInjectable&&typeof wt.serviceIdentifier=="function"&&q.getConstructorMetadata(wt.serviceIdentifier).compilerGeneratedMetadata&&(xt.container.bind(wt.serviceIdentifier).toSelf(),et=pt(xt.container,wt.serviceIdentifier)),Qt?$t=et:$t=et.filter(function(Sr){var kr=new Le.Request(Sr.serviceIdentifier,xt,rt,Sr,wt);return Sr.constraint(kr)}),Jt(wt.serviceIdentifier,$t,wt,xt.container),$t}function Jt(q,Qt,xt,rt){switch(Qt.length){case le.BindingCount.NoBindingsAvailable:if(xt.isOptional())return Qt;var wt=ce.getServiceIdentifierAsString(q),et=ye.NOT_REGISTERED;throw et+=ce.listMetadataForTarget(wt,xt),et+=ce.listRegisteredBindingsForServiceIdentifier(rt,wt,pt),new Error(et);case le.BindingCount.OnlyOneBindingAvailable:if(!xt.isArray())return Qt;case le.BindingCount.MultipleBindingsAvailable:default:if(xt.isArray())return Qt;var wt=ce.getServiceIdentifierAsString(q),et=ye.AMBIGUOUS_MATCH+" "+wt;throw et+=ce.listRegisteredBindingsForServiceIdentifier(rt,wt,pt),new Error(et)}}function kt(q,Qt,xt,rt,wt,et){var $t,Sr;if(wt===null){$t=Pt(q,Qt,rt,null,et),Sr=new Le.Request(xt,rt,null,$t,et);var kr=new se.Plan(rt,Sr);rt.addPlan(kr)}else $t=Pt(q,Qt,rt,wt,et),Sr=wt.addChildRequest(et.serviceIdentifier,$t,et);$t.forEach(function(en){var Te=null;if(et.isArray())Te=Sr.addChildRequest(en.serviceIdentifier,en,et);else{if(en.cache)return;Te=Sr}if(en.type===g.BindingTypeEnum.Instance&&en.implementationType!==null){var qe=at.getDependencies(q,en.implementationType);if(!rt.container.options.skipBaseClassChecks){var ke=at.getBaseClassDependencyCount(q,en.implementationType);if(qe.length<ke){var Mt=ye.ARGUMENTS_LENGTH_MISMATCH(at.getFunctionName(en.implementationType));throw new Error(Mt)}}qe.forEach(function(yt){kt(q,!1,yt.serviceIdentifier,rt,Te,yt)})}})}function pt(q,Qt){var xt=[],rt=Ht(q);return rt.hasKey(Qt)?xt=rt.get(Qt):q.parent!==null&&(xt=pt(q.parent,Qt)),xt}function gt(q,Qt,xt,rt,wt,et,$t,Sr){Sr===void 0&&(Sr=!1);var kr=new ue.Context(Qt),en=ur(xt,rt,wt,"",et,$t);try{return kt(q,Sr,wt,kr,null,en),kr}catch(Te){throw V.isStackOverflowExeption(Te)&&kr.plan&&ce.circularDependencyToException(kr.plan.rootRequest),Te}}J.plan=gt;function er(q,Qt,xt,rt){var wt=new ut.Target(g.TargetTypeEnum.Variable,"",Qt,new Ne.Metadata(xt,rt)),et=new ue.Context(q),$t=new Le.Request(Qt,et,null,[],wt);return $t}J.createMockRequest=er},88460:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.QueryableString=void 0;var N=function(){function le(ye){this.str=ye}return le.prototype.startsWith=function(ye){return this.str.indexOf(ye)===0},le.prototype.endsWith=function(ye){var g="",ve=ye.split("").reverse().join("");return g=this.str.split("").reverse().join(""),this.startsWith.call({str:g},ve)},le.prototype.contains=function(ye){return this.str.indexOf(ye)!==-1},le.prototype.equals=function(ye){return this.str===ye},le.prototype.value=function(){return this.str},le}();J.QueryableString=N},6e3:function(Ot,J,N){"use strict";var le=this&&this.__spreadArray||function(Pt,Jt){for(var kt=0,pt=Jt.length,gt=Pt.length;kt<pt;kt++,gt++)Pt[gt]=Jt[kt];return Pt};Object.defineProperty(J,"__esModule",{value:!0}),J.getFunctionName=J.getBaseClassDependencyCount=J.getDependencies=void 0;var ye=N(5744),g=N(16674),ve=N(28421),V=N(6867),ce=N(55800);Object.defineProperty(J,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var ue=N(18924);function Ne(Pt,Jt){var kt=ce.getFunctionName(Jt),pt=se(Pt,kt,Jt,!1);return pt}J.getDependencies=Ne;function se(Pt,Jt,kt,pt){var gt=Pt.getConstructorMetadata(kt),er=gt.compilerGeneratedMetadata;if(er===void 0){var q=g.MISSING_INJECTABLE_ANNOTATION+" "+Jt+".";throw new Error(q)}var Qt=gt.userGeneratedMetadata,xt=Object.keys(Qt),rt=kt.length===0&&xt.length>0,wt=xt.length>kt.length,et=rt||wt?xt.length:kt.length,$t=Le(pt,Jt,er,Qt,et),Sr=ut(Pt,kt),kr=le(le([],$t),Sr);return kr}function at(Pt,Jt,kt,pt,gt){var er=gt[Pt.toString()]||[],q=ur(er),Qt=q.unmanaged!==!0,xt=pt[Pt],rt=q.inject||q.multiInject;if(xt=rt||xt,xt instanceof ye.LazyServiceIdentifer&&(xt=xt.unwrap()),Qt){var wt=xt===Object,et=xt===Function,$t=xt===void 0,Sr=wt||et||$t;if(!Jt&&Sr){var kr=g.MISSING_INJECT_ANNOTATION+" argument "+Pt+" in class "+kt+".";throw new Error(kr)}var en=new ue.Target(ve.TargetTypeEnum.ConstructorArgument,q.targetName,xt);return en.metadata=er,en}return null}function Le(Pt,Jt,kt,pt,gt){for(var er=[],q=0;q<gt;q++){var Qt=q,xt=at(Qt,Pt,Jt,kt,pt);xt!==null&&er.push(xt)}return er}function ut(Pt,Jt){for(var kt=Pt.getPropertiesMetadata(Jt),pt=[],gt=Object.keys(kt),er=0,q=gt;er<q.length;er++){var Qt=q[er],xt=kt[Qt],rt=ur(kt[Qt]),wt=rt.targetName||Qt,et=rt.inject||rt.multiInject,$t=new ue.Target(ve.TargetTypeEnum.ClassProperty,wt,et);$t.metadata=xt,pt.push($t)}var Sr=Object.getPrototypeOf(Jt.prototype).constructor;if(Sr!==Object){var kr=ut(Pt,Sr);pt=le(le([],pt),kr)}return pt}function Ht(Pt,Jt){var kt=Object.getPrototypeOf(Jt.prototype).constructor;if(kt!==Object){var pt=ce.getFunctionName(kt),gt=se(Pt,pt,kt,!0),er=gt.map(function(xt){return xt.metadata.filter(function(rt){return rt.key===V.UNMANAGED_TAG})}),q=[].concat.apply([],er).length,Qt=gt.length-q;return Qt>0?Qt:Ht(Pt,kt)}else return 0}J.getBaseClassDependencyCount=Ht;function ur(Pt){var Jt={};return Pt.forEach(function(kt){Jt[kt.key.toString()]=kt.value}),{inject:Jt[V.INJECT_TAG],multiInject:Jt[V.MULTI_INJECT_TAG],targetName:Jt[V.NAME_TAG],unmanaged:Jt[V.UNMANAGED_TAG]}}},6748:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Request=void 0;var le=N(37791),ye=function(){function g(ve,V,ce,ue,Ne){this.id=le.id(),this.serviceIdentifier=ve,this.parentContext=V,this.parentRequest=ce,this.target=Ne,this.childRequests=[],this.bindings=Array.isArray(ue)?ue:[ue],this.requestScope=ce===null?new Map:null}return g.prototype.addChildRequest=function(ve,V,ce){var ue=new g(ve,this.parentContext,this,V,ce);return this.childRequests.push(ue),ue},g}();J.Request=ye},18924:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Target=void 0;var le=N(6867),ye=N(37791),g=N(47738),ve=N(88460),V=function(){function ce(ue,Ne,se,at){this.id=ye.id(),this.type=ue,this.serviceIdentifier=se,this.name=new ve.QueryableString(Ne||""),this.metadata=new Array;var Le=null;typeof at=="string"?Le=new g.Metadata(le.NAMED_TAG,at):at instanceof g.Metadata&&(Le=at),Le!==null&&this.metadata.push(Le)}return ce.prototype.hasTag=function(ue){for(var Ne=0,se=this.metadata;Ne<se.length;Ne++){var at=se[Ne];if(at.key===ue)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(le.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(ue){return this.matchesTag(le.MULTI_INJECT_TAG)(ue)},ce.prototype.isNamed=function(){return this.hasTag(le.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(ue){return le.NON_CUSTOM_TAG_KEYS.every(function(Ne){return ue.key!==Ne})})},ce.prototype.isOptional=function(){return this.matchesTag(le.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ue){return ue.key===le.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ue){return le.NON_CUSTOM_TAG_KEYS.every(function(Ne){return ue.key!==Ne})}):null},ce.prototype.matchesNamedTag=function(ue){return this.matchesTag(le.NAMED_TAG)(ue)},ce.prototype.matchesTag=function(ue){var Ne=this;return function(se){for(var at=0,Le=Ne.metadata;at<Le.length;at++){var ut=Le[at];if(ut.key===ue&&ut.value===se)return!0}return!1}},ce}();J.Target=V},52279:function(Ot,J,N){"use strict";var le=this&&this.__spreadArray||function(se,at){for(var Le=0,ut=at.length,Ht=se.length;Le<ut;Le++,Ht++)se[Ht]=at[Le];return se};Object.defineProperty(J,"__esModule",{value:!0}),J.resolveInstance=void 0;var ye=N(16674),g=N(28421),ve=N(6867);function V(se,at,Le){var ut=at.filter(function(ur){return ur.target!==null&&ur.target.type===g.TargetTypeEnum.ClassProperty}),Ht=ut.map(Le);return ut.forEach(function(ur,Pt){var Jt="";Jt=ur.target.name.value();var kt=Ht[Pt];se[Jt]=kt}),se}function ce(se,at){return new(se.bind.apply(se,le([void 0],at)))}function ue(se,at){if(Reflect.hasMetadata(ve.POST_CONSTRUCT,se)){var Le=Reflect.getMetadata(ve.POST_CONSTRUCT,se);try{at[Le.value]()}catch(ut){throw new Error(ye.POST_CONSTRUCT_ERROR(se.name,ut.message))}}}function Ne(se,at,Le){var ut=null;if(at.length>0){var Ht=at.filter(function(Pt){return Pt.target!==null&&Pt.target.type===g.TargetTypeEnum.ConstructorArgument}),ur=Ht.map(Le);ut=ce(se,ur),ut=V(ut,at,Le)}else ut=new se;return ue(se,ut),ut}J.resolveInstance=Ne},31927:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.resolve=void 0;var le=N(16674),ye=N(28421),g=N(85265),ve=N(55800),V=N(52279),ce=function(se,at,Le){try{return Le()}catch(ut){throw g.isStackOverflowExeption(ut)?new Error(le.CIRCULAR_DEPENDENCY_IN_FACTORY(se,at.toString())):ut}},ue=function(se){return function(at){at.parentContext.setCurrentRequest(at);var Le=at.bindings,ut=at.childRequests,Ht=at.target&&at.target.isArray(),ur=!at.parentRequest||!at.parentRequest.target||!at.target||!at.parentRequest.target.matchesArray(at.target.serviceIdentifier);if(Ht&&ur)return ut.map(function(er){var q=ue(se);return q(er)});var Pt=null;if(at.target.isOptional()&&Le.length===0)return;var Jt=Le[0],kt=Jt.scope===ye.BindingScopeEnum.Singleton,pt=Jt.scope===ye.BindingScopeEnum.Request;if(kt&&Jt.activated)return Jt.cache;if(pt&&se!==null&&se.has(Jt.id))return se.get(Jt.id);if(Jt.type===ye.BindingTypeEnum.ConstantValue)Pt=Jt.cache,Jt.activated=!0;else if(Jt.type===ye.BindingTypeEnum.Function)Pt=Jt.cache,Jt.activated=!0;else if(Jt.type===ye.BindingTypeEnum.Constructor)Pt=Jt.implementationType;else if(Jt.type===ye.BindingTypeEnum.DynamicValue&&Jt.dynamicValue!==null)Pt=ce("toDynamicValue",Jt.serviceIdentifier,function(){return Jt.dynamicValue(at.parentContext)});else if(Jt.type===ye.BindingTypeEnum.Factory&&Jt.factory!==null)Pt=ce("toFactory",Jt.serviceIdentifier,function(){return Jt.factory(at.parentContext)});else if(Jt.type===ye.BindingTypeEnum.Provider&&Jt.provider!==null)Pt=ce("toProvider",Jt.serviceIdentifier,function(){return Jt.provider(at.parentContext)});else if(Jt.type===ye.BindingTypeEnum.Instance&&Jt.implementationType!==null)Pt=V.resolveInstance(Jt.implementationType,ut,ue(se));else{var gt=ve.getServiceIdentifierAsString(at.serviceIdentifier);throw new Error(le.INVALID_BINDING_TYPE+" "+gt)}return typeof Jt.onActivation=="function"&&(Pt=Jt.onActivation(at.parentContext,Pt)),kt&&(Jt.cache=Pt,Jt.activated=!0),pt&&se!==null&&!se.has(Jt.id)&&se.set(Jt.id,Pt),Pt}};function Ne(se){var at=ue(se.plan.rootRequest.requestScope);return at(se.plan.rootRequest)}J.resolve=Ne},83366:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingInSyntax=void 0;var le=N(28421),ye=N(71325),g=function(){function ve(V){this._binding=V}return ve.prototype.inRequestScope=function(){return this._binding.scope=le.BindingScopeEnum.Request,new ye.BindingWhenOnSyntax(this._binding)},ve.prototype.inSingletonScope=function(){return this._binding.scope=le.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},ve.prototype.inTransientScope=function(){return this._binding.scope=le.BindingScopeEnum.Transient,new ye.BindingWhenOnSyntax(this._binding)},ve}();J.BindingInSyntax=g},74889:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingInWhenOnSyntax=void 0;var le=N(83366),ye=N(51811),g=N(98370),ve=function(){function V(ce){this._binding=ce,this._bindingWhenSyntax=new g.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding),this._bindingInSyntax=new le.BindingInSyntax(ce)}return V.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},V.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},V.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},V.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},V.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},V.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},V.prototype.whenTargetTagged=function(ce,ue){return this._bindingWhenSyntax.whenTargetTagged(ce,ue)},V.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},V.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},V.prototype.whenParentTagged=function(ce,ue){return this._bindingWhenSyntax.whenParentTagged(ce,ue)},V.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},V.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},V.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},V.prototype.whenAnyAncestorTagged=function(ce,ue){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,ue)},V.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},V.prototype.whenNoAncestorTagged=function(ce,ue){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,ue)},V.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},V.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},V.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},V}();J.BindingInWhenOnSyntax=ve},51811:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingOnSyntax=void 0;var le=N(98370),ye=function(){function g(ve){this._binding=ve}return g.prototype.onActivation=function(ve){return this._binding.onActivation=ve,new le.BindingWhenSyntax(this._binding)},g}();J.BindingOnSyntax=ye},15451:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingToSyntax=void 0;var le=N(16674),ye=N(28421),g=N(74889),ve=N(71325),V=function(){function ce(ue){this._binding=ue}return ce.prototype.to=function(ue){return this._binding.type=ye.BindingTypeEnum.Instance,this._binding.implementationType=ue,new g.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+le.INVALID_TO_SELF_VALUE);var ue=this._binding.serviceIdentifier;return this.to(ue)},ce.prototype.toConstantValue=function(ue){return this._binding.type=ye.BindingTypeEnum.ConstantValue,this._binding.cache=ue,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(ue){return this._binding.type=ye.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ue,this._binding.implementationType=null,new g.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(ue){return this._binding.type=ye.BindingTypeEnum.Constructor,this._binding.implementationType=ue,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(ue){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=ue,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(ue){if(typeof ue!="function")throw new Error(le.INVALID_FUNCTION_BINDING);var Ne=this.toConstantValue(ue);return this._binding.type=ye.BindingTypeEnum.Function,this._binding.scope=ye.BindingScopeEnum.Singleton,Ne},ce.prototype.toAutoFactory=function(ue){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=function(Ne){var se=function(){return Ne.container.get(ue)};return se},this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(ue){return this._binding.type=ye.BindingTypeEnum.Provider,this._binding.provider=ue,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(ue){this.toDynamicValue(function(Ne){return Ne.container.get(ue)})},ce}();J.BindingToSyntax=V},71325:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingWhenOnSyntax=void 0;var le=N(51811),ye=N(98370),g=function(){function ve(V){this._binding=V,this._bindingWhenSyntax=new ye.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new le.BindingOnSyntax(this._binding)}return ve.prototype.when=function(V){return this._bindingWhenSyntax.when(V)},ve.prototype.whenTargetNamed=function(V){return this._bindingWhenSyntax.whenTargetNamed(V)},ve.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ve.prototype.whenTargetTagged=function(V,ce){return this._bindingWhenSyntax.whenTargetTagged(V,ce)},ve.prototype.whenInjectedInto=function(V){return this._bindingWhenSyntax.whenInjectedInto(V)},ve.prototype.whenParentNamed=function(V){return this._bindingWhenSyntax.whenParentNamed(V)},ve.prototype.whenParentTagged=function(V,ce){return this._bindingWhenSyntax.whenParentTagged(V,ce)},ve.prototype.whenAnyAncestorIs=function(V){return this._bindingWhenSyntax.whenAnyAncestorIs(V)},ve.prototype.whenNoAncestorIs=function(V){return this._bindingWhenSyntax.whenNoAncestorIs(V)},ve.prototype.whenAnyAncestorNamed=function(V){return this._bindingWhenSyntax.whenAnyAncestorNamed(V)},ve.prototype.whenAnyAncestorTagged=function(V,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(V,ce)},ve.prototype.whenNoAncestorNamed=function(V){return this._bindingWhenSyntax.whenNoAncestorNamed(V)},ve.prototype.whenNoAncestorTagged=function(V,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(V,ce)},ve.prototype.whenAnyAncestorMatches=function(V){return this._bindingWhenSyntax.whenAnyAncestorMatches(V)},ve.prototype.whenNoAncestorMatches=function(V){return this._bindingWhenSyntax.whenNoAncestorMatches(V)},ve.prototype.onActivation=function(V){return this._bindingOnSyntax.onActivation(V)},ve}();J.BindingWhenOnSyntax=g},98370:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingWhenSyntax=void 0;var le=N(51811),ye=N(80758),g=function(){function ve(V){this._binding=V}return ve.prototype.when=function(V){return this._binding.constraint=V,new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetNamed=function(V){return this._binding.constraint=ye.namedConstraint(V),new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(V){var ce=V.target!==null&&!V.target.isNamed()&&!V.target.isTagged();return ce},new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetTagged=function(V,ce){return this._binding.constraint=ye.taggedConstraint(V)(ce),new le.BindingOnSyntax(this._binding)},ve.prototype.whenInjectedInto=function(V){return this._binding.constraint=function(ce){return ye.typeConstraint(V)(ce.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenParentNamed=function(V){return this._binding.constraint=function(ce){return ye.namedConstraint(V)(ce.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenParentTagged=function(V,ce){return this._binding.constraint=function(ue){return ye.taggedConstraint(V)(ce)(ue.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorIs=function(V){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,ye.typeConstraint(V))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorIs=function(V){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,ye.typeConstraint(V))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorNamed=function(V){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,ye.namedConstraint(V))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorNamed=function(V){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,ye.namedConstraint(V))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorTagged=function(V,ce){return this._binding.constraint=function(ue){return ye.traverseAncerstors(ue,ye.taggedConstraint(V)(ce))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorTagged=function(V,ce){return this._binding.constraint=function(ue){return!ye.traverseAncerstors(ue,ye.taggedConstraint(V)(ce))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorMatches=function(V){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,V)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorMatches=function(V){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,V)},new le.BindingOnSyntax(this._binding)},ve}();J.BindingWhenSyntax=g},80758:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.typeConstraint=J.namedConstraint=J.taggedConstraint=J.traverseAncerstors=void 0;var le=N(6867),ye=N(47738),g=function(ue,Ne){var se=ue.parentRequest;return se!==null?Ne(se)?!0:g(se,Ne):!1};J.traverseAncerstors=g;var ve=function(ue){return function(Ne){var se=function(at){return at!==null&&at.target!==null&&at.target.matchesTag(ue)(Ne)};return se.metaData=new ye.Metadata(ue,Ne),se}};J.taggedConstraint=ve;var V=ve(le.NAMED_TAG);J.namedConstraint=V;var ce=function(ue){return function(Ne){var se=null;if(Ne!==null)if(se=Ne.bindings[0],typeof ue=="string"){var at=se.serviceIdentifier;return at===ue}else{var Le=Ne.bindings[0].implementationType;return ue===Le}return!1}};J.typeConstraint=ce},70600:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.multiBindToService=void 0;var N=function(le){return function(ye){return function(){for(var g=[],ve=0;ve<arguments.length;ve++)g[ve]=arguments[ve];return g.forEach(function(V){return le.bind(V).toService(ye)})}}};J.multiBindToService=N},85265:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.isStackOverflowExeption=void 0;var le=N(16674);function ye(g){return g instanceof RangeError||g.message===le.STACK_OVERFLOW}J.isStackOverflowExeption=ye},37791:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.id=void 0;var N=0;function le(){return N++}J.id=le},55800:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.circularDependencyToException=J.listMetadataForTarget=J.listRegisteredBindingsForServiceIdentifier=J.getServiceIdentifierAsString=J.getFunctionName=void 0;var le=N(16674);function ye(se){if(typeof se=="function"){var at=se;return at.name}else{if(typeof se=="symbol")return se.toString();var at=se;return at}}J.getServiceIdentifierAsString=ye;function g(se,at,Le){var ut="",Ht=Le(se,at);return Ht.length!==0&&(ut=`
Registered bindings:`,Ht.forEach(function(ur){var Pt="Object";ur.implementationType!==null&&(Pt=Ne(ur.implementationType)),ut=ut+`
 `+Pt,ur.constraint.metaData&&(ut=ut+" - "+ur.constraint.metaData)})),ut}J.listRegisteredBindingsForServiceIdentifier=g;function ve(se,at){return se.parentRequest===null?!1:se.parentRequest.serviceIdentifier===at?!0:ve(se.parentRequest,at)}function V(se){function at(ut,Ht){Ht===void 0&&(Ht=[]);var ur=ye(ut.serviceIdentifier);return Ht.push(ur),ut.parentRequest!==null?at(ut.parentRequest,Ht):Ht}var Le=at(se);return Le.reverse().join(" --> ")}function ce(se){se.childRequests.forEach(function(at){if(ve(at,at.serviceIdentifier)){var Le=V(at);throw new Error(le.CIRCULAR_DEPENDENCY+" "+Le)}else ce(at)})}J.circularDependencyToException=ce;function ue(se,at){if(at.isTagged()||at.isNamed()){var Le="",ut=at.getNamedTag(),Ht=at.getCustomTags();return ut!==null&&(Le+=ut.toString()+`
`),Ht!==null&&Ht.forEach(function(ur){Le+=ur.toString()+`
`})," "+se+`
 `+se+" - "+Le}else return" "+se}J.listMetadataForTarget=ue;function Ne(se){if(se.name)return se.name;var at=se.toString(),Le=at.match(/^function\s*([^\s(]+)/);return Le?Le[1]:"Anonymous function: "+at}J.getFunctionName=Ne},31745:function(Ot){"use strict";Ot.exports=N,Ot.exports.default=N;var J=1e20;function N(V,ce,ue,Ne,se,at){this.fontSize=V||24,this.buffer=ce===void 0?3:ce,this.cutoff=Ne||.25,this.fontFamily=se||"sans-serif",this.fontWeight=at||"normal",this.radius=ue||8;var Le=this.size=this.fontSize+this.buffer*2,ut=Le+this.buffer*2,Ht=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Ht?this.canvas=my.createOffscreenCanvas(Le,Le,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Le),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ut*ut),this.gridInner=new Float64Array(ut*ut),this.f=new Float64Array(ut),this.z=new Float64Array(ut+1),this.v=new Uint16Array(ut),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Ht?this.middle=Math.round(Le/2*1):this.middle=Math.round(Le/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function le(V,ce,ue,Ne,se,at,Le){at.fill(J,0,ce*ue),Le.fill(0,0,ce*ue);for(var ut=(ce-Ne)/2,Ht=0;Ht<se;Ht++)for(var ur=0;ur<Ne;ur++){var Pt=(Ht+ut)*ce+ur+ut,Jt=V.data[4*(Ht*Ne+ur)+3]/255;if(Jt===1)at[Pt]=0,Le[Pt]=J;else if(Jt===0)at[Pt]=J,Le[Pt]=0;else{var kt=Math.max(0,.5-Jt),pt=Math.max(0,Jt-.5);at[Pt]=kt*kt,Le[Pt]=pt*pt}}}function ye(V,ce,ue,Ne,se,at,Le){for(var ut=0;ut<ce*ue;ut++){var Ht=Math.sqrt(Ne[ut])-Math.sqrt(se[ut]);V[ut]=Math.round(255-255*(Ht/at+Le))}}N.prototype._draw=function(V,ce){var ue=this.ctx.measureText(V),Ne=ue.width,se=2*this.buffer,at,Le,ut,Ht,ur,Pt,Jt,kt;ce&&this.useMetrics?(ur=Math.floor(ue.actualBoundingBoxAscent),kt=this.buffer+Math.ceil(ue.actualBoundingBoxAscent),Pt=this.buffer,Jt=this.buffer,Le=Math.min(this.size,Math.ceil(ue.actualBoundingBoxRight-ue.actualBoundingBoxLeft)),Ht=Math.min(this.size-Pt,Math.ceil(ue.actualBoundingBoxAscent+ue.actualBoundingBoxDescent)),at=Le+se,ut=Ht+se,this.ctx.textBaseline="alphabetic"):(at=Le=this.size,ut=Ht=this.size,ur=19*this.fontSize/24,Pt=Jt=0,kt=this.middle,this.ctx.textBaseline="middle");var pt;Le&&Ht&&(this.ctx.clearRect(Jt,Pt,Le,Ht),this.ctx.fillText(V,this.buffer,kt),pt=this.ctx.getImageData(Jt,Pt,Le,Ht));var gt=new Uint8ClampedArray(at*ut);return le(pt,at,ut,Le,Ht,this.gridOuter,this.gridInner),g(this.gridOuter,at,ut,this.f,this.v,this.z),g(this.gridInner,at,ut,this.f,this.v,this.z),ye(gt,at,ut,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:gt,metrics:{width:Le,height:Ht,sdfWidth:at,sdfHeight:ut,top:ur,left:0,advance:Ne}}},N.prototype.draw=function(V){return this._draw(V,!1).data},N.prototype.drawWithMetrics=function(V){return this._draw(V,!0)};function g(V,ce,ue,Ne,se,at){for(var Le=0;Le<ce;Le++)ve(V,Le,ce,ue,Ne,se,at);for(var ut=0;ut<ue;ut++)ve(V,ut*ce,1,ce,Ne,se,at)}function ve(V,ce,ue,Ne,se,at,Le){var ut,Ht,ur,Pt;for(at[0]=0,Le[0]=-J,Le[1]=J,ut=0;ut<Ne;ut++)se[ut]=V[ce+ut*ue];for(ut=1,Ht=0,ur=0;ut<Ne;ut++){do Pt=at[Ht],ur=(se[ut]-se[Pt]+ut*ut-Pt*Pt)/(ut-Pt)/2;while(ur<=Le[Ht]&&--Ht>-1);Ht++,at[Ht]=ut,Le[Ht]=ur,Le[Ht+1]=J}for(ut=0,Ht=0;ut<Ne;ut++){for(;Le[Ht+1]<ut;)Ht++;Pt=at[Ht],V[ce+ut*ue]=se[Pt]+(ut-Pt)*(ut-Pt)}}},18857:function(Ot,J,N){"use strict";N.r(J),N.d(J,{Function:function(){return lu},Interpreter:function(){return po},default:function(){return $u},evaluate:function(){return Ku},vm:function(){return le}});var le={};N.r(le),N.d(le,{Script:function(){return jl},compileFunction:function(){return kc},createContext:function(){return oc},runInContext:function(){return qu},runInNewContext:function(){return Dc}});var ye={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},g="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",ve={5:g,"5module":g+" export import",6:g+" const class extends export import super"},V=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ue="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ne=new RegExp("["+ce+"]"),se=new RegExp("["+ce+ue+"]");ce=ue=null;var at=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Le=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function ut(_,T){for(var F=65536,R=0;R<T.length;R+=2){if(F+=T[R],F>_)return!1;if(F+=T[R+1],F>=_)return!0}}function Ht(_,T){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Ne.test(String.fromCharCode(_)):T===!1?!1:ut(_,at)}function ur(_,T){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&se.test(String.fromCharCode(_)):T===!1?!1:ut(_,at)||ut(_,Le)}var Pt=function(T,F){F===void 0&&(F={}),this.label=T,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function Jt(_,T){return new Pt(_,{beforeExpr:!0,binop:T})}var kt={beforeExpr:!0},pt={startsExpr:!0},gt={};function er(_,T){return T===void 0&&(T={}),T.keyword=_,gt[_]=new Pt(_,T)}var q={num:new Pt("num",pt),regexp:new Pt("regexp",pt),string:new Pt("string",pt),name:new Pt("name",pt),eof:new Pt("eof"),bracketL:new Pt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Pt("]"),braceL:new Pt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Pt("}"),parenL:new Pt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Pt(")"),comma:new Pt(",",kt),semi:new Pt(";",kt),colon:new Pt(":",kt),dot:new Pt("."),question:new Pt("?",kt),questionDot:new Pt("?."),arrow:new Pt("=>",kt),template:new Pt("template"),invalidTemplate:new Pt("invalidTemplate"),ellipsis:new Pt("...",kt),backQuote:new Pt("`",pt),dollarBraceL:new Pt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Pt("=",{beforeExpr:!0,isAssign:!0}),assign:new Pt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Pt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Pt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Jt("||",1),logicalAND:Jt("&&",2),bitwiseOR:Jt("|",3),bitwiseXOR:Jt("^",4),bitwiseAND:Jt("&",5),equality:Jt("==/!=/===/!==",6),relational:Jt("</>/<=/>=",7),bitShift:Jt("<</>>/>>>",8),plusMin:new Pt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Jt("%",10),star:Jt("*",10),slash:Jt("/",10),starstar:new Pt("**",{beforeExpr:!0}),coalesce:Jt("??",1),_break:er("break"),_case:er("case",kt),_catch:er("catch"),_continue:er("continue"),_debugger:er("debugger"),_default:er("default",kt),_do:er("do",{isLoop:!0,beforeExpr:!0}),_else:er("else",kt),_finally:er("finally"),_for:er("for",{isLoop:!0}),_function:er("function",pt),_if:er("if"),_return:er("return",kt),_switch:er("switch"),_throw:er("throw",kt),_try:er("try"),_var:er("var"),_const:er("const"),_while:er("while",{isLoop:!0}),_with:er("with"),_new:er("new",{beforeExpr:!0,startsExpr:!0}),_this:er("this",pt),_super:er("super",pt),_class:er("class",pt),_extends:er("extends",kt),_export:er("export"),_import:er("import",pt),_null:er("null",pt),_true:er("true",pt),_false:er("false",pt),_in:er("in",{beforeExpr:!0,binop:7}),_instanceof:er("instanceof",{beforeExpr:!0,binop:7}),_typeof:er("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:er("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:er("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Qt=/\r\n?|\n|\u2028|\u2029/,xt=new RegExp(Qt.source,"g");function rt(_,T){return _===10||_===13||!T&&(_===8232||_===8233)}var wt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,et=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,$t=Object.prototype,Sr=$t.hasOwnProperty,kr=$t.toString;function en(_,T){return Sr.call(_,T)}var Te=Array.isArray||function(_){return kr.call(_)==="[object Array]"};function qe(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var ke=function(T,F){this.line=T,this.column=F};ke.prototype.offset=function(T){return new ke(this.line,this.column+T)};var Mt=function(T,F,R){this.start=F,this.end=R,T.sourceFile!==null&&(this.source=T.sourceFile)};function yt(_,T){for(var F=1,R=0;;){xt.lastIndex=R;var K=xt.exec(_);if(K&&K.index<T)++F,R=K.index+K[0].length;else return new ke(F,T-R)}}var Zt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function qt(_){var T={};for(var F in Zt)T[F]=_&&en(_,F)?_[F]:Zt[F];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),Te(T.onToken)){var R=T.onToken;T.onToken=function(K){return R.push(K)}}return Te(T.onComment)&&(T.onComment=Cr(T,T.onComment)),T}function Cr(_,T){return function(F,R,K,xe,We,dt){var mt={type:F?"Block":"Line",value:R,start:K,end:xe};_.locations&&(mt.loc=new Mt(this,We,dt)),_.ranges&&(mt.range=[K,xe]),T.push(mt)}}var qn=1,fn=2,Hi=qn|fn,Zn=4,Hn=8,pi=16,Kn=32,ui=64,ra=128;function Ri(_,T){return fn|(_?Zn:0)|(T?Hn:0)}var bi=0,Ni=1,aa=2,Ei=3,_a=4,An=5,_i=function(T,F,R){this.options=T=qt(T),this.sourceFile=T.sourceFile,this.keywords=qe(ve[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var K="";if(T.allowReserved!==!0){for(var xe=T.ecmaVersion;!(K=ye[xe]);xe--);T.sourceType==="module"&&(K+=" await")}this.reservedWords=qe(K);var We=(K?K+" ":"")+ye.strict;this.reservedWordsStrict=qe(We),this.reservedWordsStrictBind=qe(We+" "+ye.strictBind),this.input=String(F),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Qt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=q.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(qn),this.regexpState=null},Bi={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};_i.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},Bi.inFunction.get=function(){return(this.currentVarScope().flags&fn)>0},Bi.inGenerator.get=function(){return(this.currentVarScope().flags&Hn)>0},Bi.inAsync.get=function(){return(this.currentVarScope().flags&Zn)>0},Bi.allowSuper.get=function(){return(this.currentThisScope().flags&ui)>0},Bi.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ra)>0},Bi.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},_i.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&fn)>0},_i.extend=function(){for(var T=[],F=arguments.length;F--;)T[F]=arguments[F];for(var R=this,K=0;K<T.length;K++)R=T[K](R);return R},_i.parse=function(T,F){return new this(F,T).parse()},_i.parseExpressionAt=function(T,F,R){var K=new this(R,T,F);return K.nextToken(),K.parseExpression()},_i.tokenizer=function(T,F){return new this(F,T)},Object.defineProperties(_i.prototype,Bi);var Wi=_i.prototype,za=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Wi.strictDirective=function(_){for(;;){et.lastIndex=_,_+=et.exec(this.input)[0].length;var T=za.exec(this.input.slice(_));if(!T)return!1;if((T[1]||T[2])==="use strict"){et.lastIndex=_+T[0].length;var F=et.exec(this.input),R=F.index+F[0].length,K=this.input.charAt(R);return K===";"||K==="}"||Qt.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(R+1)==="=")}_+=T[0].length,et.lastIndex=_,_+=et.exec(this.input)[0].length,this.input[_]===";"&&_++}},Wi.eat=function(_){return this.type===_?(this.next(),!0):!1},Wi.isContextual=function(_){return this.type===q.name&&this.value===_&&!this.containsEsc},Wi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Wi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Wi.canInsertSemicolon=function(){return this.type===q.eof||this.type===q.braceR||Qt.test(this.input.slice(this.lastTokEnd,this.start))},Wi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Wi.semicolon=function(){!this.eat(q.semi)&&!this.insertSemicolon()&&this.unexpected()},Wi.afterTrailingComma=function(_,T){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},Wi.expect=function(_){this.eat(_)||this.unexpected()},Wi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function de(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Wi.checkPatternErrors=function(_,T){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var F=T?_.parenthesizedAssign:_.parenthesizedBind;F>-1&&this.raiseRecoverable(F,"Parenthesized pattern")}},Wi.checkExpressionErrors=function(_,T){if(!_)return!1;var F=_.shorthandAssign,R=_.doubleProto;if(!T)return F>=0||R>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},Wi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Wi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var Nn=_i.prototype;Nn.parseTopLevel=function(_){var T={};for(_.body||(_.body=[]);this.type!==q.eof;){var F=this.parseStatement(null,!0,T);_.body.push(F)}if(this.inModule)for(var R=0,K=Object.keys(this.undefinedExports);R<K.length;R+=1){var xe=K[R];this.raiseRecoverable(this.undefinedExports[xe].start,"Export '"+xe+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Ua={kind:"loop"},ls={kind:"switch"};Nn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;et.lastIndex=this.pos;var T=et.exec(this.input),F=this.pos+T[0].length,R=this.input.charCodeAt(F);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(Ht(R,!0)){for(var K=F+1;ur(this.input.charCodeAt(K),!0);)++K;var xe=this.input.slice(F,K);if(!V.test(xe))return!0}return!1},Nn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;et.lastIndex=this.pos;var _=et.exec(this.input),T=this.pos+_[0].length;return!Qt.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!ur(this.input.charAt(T+8)))},Nn.parseStatement=function(_,T,F){var R=this.type,K=this.startNode(),xe;switch(this.isLet(_)&&(R=q._var,xe="let"),R){case q._break:case q._continue:return this.parseBreakContinueStatement(K,R.keyword);case q._debugger:return this.parseDebuggerStatement(K);case q._do:return this.parseDoStatement(K);case q._for:return this.parseForStatement(K);case q._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case q._class:return _&&this.unexpected(),this.parseClass(K,!0);case q._if:return this.parseIfStatement(K);case q._return:return this.parseReturnStatement(K);case q._switch:return this.parseSwitchStatement(K);case q._throw:return this.parseThrowStatement(K);case q._try:return this.parseTryStatement(K);case q._const:case q._var:return xe=xe||this.value,_&&xe!=="var"&&this.unexpected(),this.parseVarStatement(K,xe);case q._while:return this.parseWhileStatement(K);case q._with:return this.parseWithStatement(K);case q.braceL:return this.parseBlock(!0,K);case q.semi:return this.parseEmptyStatement(K);case q._export:case q._import:if(this.options.ecmaVersion>10&&R===q._import){et.lastIndex=this.pos;var We=et.exec(this.input),dt=this.pos+We[0].length,mt=this.input.charCodeAt(dt);if(mt===40||mt===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===q._import?this.parseImport(K):this.parseExport(K,F);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var fr=this.value,br=this.parseExpression();return R===q.name&&br.type==="Identifier"&&this.eat(q.colon)?this.parseLabeledStatement(K,fr,br,_):this.parseExpressionStatement(K,br)}},Nn.parseBreakContinueStatement=function(_,T){var F=T==="break";this.next(),this.eat(q.semi)||this.insertSemicolon()?_.label=null:this.type!==q.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var K=this.labels[R];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(F||K.kind==="loop")||_.label&&F))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+T),this.finishNode(_,F?"BreakStatement":"ContinueStatement")},Nn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},Nn.parseDoStatement=function(_){return this.next(),this.labels.push(Ua),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(q._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(q.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},Nn.parseForStatement=function(_){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ua),this.enterScope(0),this.expect(q.parenL),this.type===q.semi)return T>-1&&this.unexpected(T),this.parseFor(_,null);var F=this.isLet();if(this.type===q._var||this.type===q._const||F){var R=this.startNode(),K=F?"let":this.value;return this.next(),this.parseVar(R,!0,K),this.finishNode(R,"VariableDeclaration"),(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===q._in?T>-1&&this.unexpected(T):_.await=T>-1),this.parseForIn(_,R)):(T>-1&&this.unexpected(T),this.parseFor(_,R))}var xe=new de,We=this.parseExpression(!0,xe);return this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===q._in?T>-1&&this.unexpected(T):_.await=T>-1),this.toAssignable(We,!1,xe),this.checkLVal(We),this.parseForIn(_,We)):(this.checkExpressionErrors(xe,!0),T>-1&&this.unexpected(T),this.parseFor(_,We))},Nn.parseFunctionStatement=function(_,T,F){return this.next(),this.parseFunction(_,or|(F?0:wr),!1,T)},Nn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(q._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},Nn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(q.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},Nn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(q.braceL),this.labels.push(ls),this.enterScope(0);for(var T,F=!1;this.type!==q.braceR;)if(this.type===q._case||this.type===q._default){var R=this.type===q._case;T&&this.finishNode(T,"SwitchCase"),_.cases.push(T=this.startNode()),T.consequent=[],this.next(),R?T.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,T.test=null),this.expect(q.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},Nn.parseThrowStatement=function(_){return this.next(),Qt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Vt=[];Nn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===q._catch){var T=this.startNode();if(this.next(),this.eat(q.parenL)){T.param=this.parseBindingAtom();var F=T.param.type==="Identifier";this.enterScope(F?Kn:0),this.checkLVal(T.param,F?_a:aa),this.expect(q.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(T,"CatchClause")}return _.finalizer=this.eat(q._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},Nn.parseVarStatement=function(_,T){return this.next(),this.parseVar(_,!1,T),this.semicolon(),this.finishNode(_,"VariableDeclaration")},Nn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Ua),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},Nn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},Nn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},Nn.parseLabeledStatement=function(_,T,F,R){for(var K=0,xe=this.labels;K<xe.length;K+=1){var We=xe[K];We.name===T&&this.raise(F.start,"Label '"+T+"' is already declared")}for(var dt=this.type.isLoop?"loop":this.type===q._switch?"switch":null,mt=this.labels.length-1;mt>=0;mt--){var fr=this.labels[mt];if(fr.statementStart===_.start)fr.statementStart=this.start,fr.kind=dt;else break}return this.labels.push({name:T,kind:dt,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=F,this.finishNode(_,"LabeledStatement")},Nn.parseExpressionStatement=function(_,T){return _.expression=T,this.semicolon(),this.finishNode(_,"ExpressionStatement")},Nn.parseBlock=function(_,T,F){for(_===void 0&&(_=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(q.braceL),_&&this.enterScope(0);this.type!==q.braceR;){var R=this.parseStatement(null);T.body.push(R)}return F&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(T,"BlockStatement")},Nn.parseFor=function(_,T){return _.init=T,this.expect(q.semi),_.test=this.type===q.semi?null:this.parseExpression(),this.expect(q.semi),_.update=this.type===q.parenR?null:this.parseExpression(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},Nn.parseForIn=function(_,T){var F=this.type===q._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),_.left=T,_.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,F?"ForInStatement":"ForOfStatement")},Nn.parseVar=function(_,T,F){for(_.declarations=[],_.kind=F;;){var R=this.startNode();if(this.parseVarId(R,F),this.eat(q.eq)?R.init=this.parseMaybeAssign(T):F==="const"&&!(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(T&&(this.type===q._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(q.comma))break}return _},Nn.parseVarId=function(_,T){_.id=this.parseBindingAtom(),this.checkLVal(_.id,T==="var"?Ni:aa,!1)};var or=1,wr=2,I=4;Nn.parseFunction=function(_,T,F,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===q.star&&T&wr&&this.unexpected(),_.generator=this.eat(q.star)),this.options.ecmaVersion>=8&&(_.async=!!R),T&or&&(_.id=T&I&&this.type!==q.name?null:this.parseIdent(),_.id&&!(T&wr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Ni:aa:Ei));var K=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ri(_.async,_.generator)),T&or||(_.id=this.type===q.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,F,!1),this.yieldPos=K,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(_,T&or?"FunctionDeclaration":"FunctionExpression")},Nn.parseFunctionParams=function(_){this.expect(q.parenL),_.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Nn.parseClass=function(_,T){this.next();var F=this.strict;this.strict=!0,this.parseClassId(_,T),this.parseClassSuper(_);var R=this.startNode(),K=!1;for(R.body=[],this.expect(q.braceL);this.type!==q.braceR;){var xe=this.parseClassElement(_.superClass!==null);xe&&(R.body.push(xe),xe.type==="MethodDefinition"&&xe.kind==="constructor"&&(K&&this.raise(xe.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=F,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,T?"ClassDeclaration":"ClassExpression")},Nn.parseClassElement=function(_){var T=this;if(this.eat(q.semi))return null;var F=this.startNode(),R=function(mt,fr){fr===void 0&&(fr=!1);var br=T.start,Pn=T.startLoc;return T.eatContextual(mt)?T.type!==q.parenL&&(!fr||!T.canInsertSemicolon())?!0:(F.key&&T.unexpected(),F.computed=!1,F.key=T.startNodeAt(br,Pn),F.key.name=mt,T.finishNode(F.key,"Identifier"),!1):!1};F.kind="method",F.static=R("static");var K=this.eat(q.star),xe=!1;K||(this.options.ecmaVersion>=8&&R("async",!0)?(xe=!0,K=this.options.ecmaVersion>=9&&this.eat(q.star)):R("get")?F.kind="get":R("set")&&(F.kind="set")),F.key||this.parsePropertyName(F);var We=F.key,dt=!1;return!F.computed&&!F.static&&(We.type==="Identifier"&&We.name==="constructor"||We.type==="Literal"&&We.value==="constructor")?(F.kind!=="method"&&this.raise(We.start,"Constructor can't have get/set modifier"),K&&this.raise(We.start,"Constructor can't be a generator"),xe&&this.raise(We.start,"Constructor can't be an async method"),F.kind="constructor",dt=_):F.static&&We.type==="Identifier"&&We.name==="prototype"&&this.raise(We.start,"Classes may not have a static property named prototype"),this.parseClassMethod(F,K,xe,dt),F.kind==="get"&&F.value.params.length!==0&&this.raiseRecoverable(F.value.start,"getter should have no params"),F.kind==="set"&&F.value.params.length!==1&&this.raiseRecoverable(F.value.start,"setter should have exactly one param"),F.kind==="set"&&F.value.params[0].type==="RestElement"&&this.raiseRecoverable(F.value.params[0].start,"Setter cannot use rest params"),F},Nn.parseClassMethod=function(_,T,F,R){return _.value=this.parseMethod(T,F,R),this.finishNode(_,"MethodDefinition")},Nn.parseClassId=function(_,T){this.type===q.name?(_.id=this.parseIdent(),T&&this.checkLVal(_.id,aa,!1)):(T===!0&&this.unexpected(),_.id=null)},Nn.parseClassSuper=function(_){_.superClass=this.eat(q._extends)?this.parseExprSubscripts():null},Nn.parseExport=function(_,T){if(this.next(),this.eat(q.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(T,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(q._default)){this.checkExport(T,"default",this.lastTokStart);var F;if(this.type===q._function||(F=this.isAsyncFunction())){var R=this.startNode();this.next(),F&&this.next(),_.declaration=this.parseFunction(R,or|I,!1,F)}else if(this.type===q._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,_.declaration.declarations):this.checkExport(T,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var xe=0,We=_.specifiers;xe<We.length;xe+=1){var dt=We[xe];this.checkUnreserved(dt.local),this.checkLocalExport(dt.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},Nn.checkExport=function(_,T,F){!_||(en(_,T)&&this.raiseRecoverable(F,"Duplicate export '"+T+"'"),_[T]=!0)},Nn.checkPatternExport=function(_,T){var F=T.type;if(F==="Identifier")this.checkExport(_,T.name,T.start);else if(F==="ObjectPattern")for(var R=0,K=T.properties;R<K.length;R+=1){var xe=K[R];this.checkPatternExport(_,xe)}else if(F==="ArrayPattern")for(var We=0,dt=T.elements;We<dt.length;We+=1){var mt=dt[We];mt&&this.checkPatternExport(_,mt)}else F==="Property"?this.checkPatternExport(_,T.value):F==="AssignmentPattern"?this.checkPatternExport(_,T.left):F==="RestElement"?this.checkPatternExport(_,T.argument):F==="ParenthesizedExpression"&&this.checkPatternExport(_,T.expression)},Nn.checkVariableExport=function(_,T){if(!!_)for(var F=0,R=T;F<R.length;F+=1){var K=R[F];this.checkPatternExport(_,K.id)}},Nn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Nn.parseExportSpecifiers=function(_){var T=[],F=!0;for(this.expect(q.braceL);!this.eat(q.braceR);){if(F)F=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),T.push(this.finishNode(R,"ExportSpecifier"))}return T},Nn.parseImport=function(_){return this.next(),this.type===q.string?(_.specifiers=Vt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===q.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},Nn.parseImportSpecifiers=function(){var _=[],T=!0;if(this.type===q.name){var F=this.startNode();if(F.local=this.parseIdent(),this.checkLVal(F.local,aa),_.push(this.finishNode(F,"ImportDefaultSpecifier")),!this.eat(q.comma))return _}if(this.type===q.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,aa),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(q.braceL);!this.eat(q.braceR);){if(T)T=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,aa),_.push(this.finishNode(K,"ImportSpecifier"))}return _},Nn.adaptDirectivePrologue=function(_){for(var T=0;T<_.length&&this.isDirectiveCandidate(_[T]);++T)_[T].directive=_[T].expression.raw.slice(1,-1)},Nn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var ir=_i.prototype;ir.toAssignable=function(_,T,F){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var R=0,K=_.properties;R<K.length;R+=1){var xe=K[R];this.toAssignable(xe,T),xe.type==="RestElement"&&(xe.argument.type==="ArrayPattern"||xe.argument.type==="ObjectPattern")&&this.raise(xe.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,T);break;case"ArrayExpression":_.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(_.elements,T);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,T),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,T,F);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(_.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return _},ir.toAssignableList=function(_,T){for(var F=_.length,R=0;R<F;R++){var K=_[R];K&&this.toAssignable(K,T)}if(F){var xe=_[F-1];this.options.ecmaVersion===6&&T&&xe&&xe.type==="RestElement"&&xe.argument.type!=="Identifier"&&this.unexpected(xe.argument.start)}return _},ir.parseSpread=function(_){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,_),this.finishNode(T,"SpreadElement")},ir.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==q.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},ir.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case q.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(q.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case q.braceL:return this.parseObj(!0)}return this.parseIdent()},ir.parseBindingList=function(_,T,F){for(var R=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(q.comma),T&&this.type===q.comma)R.push(null);else{if(F&&this.afterTrailingComma(_))break;if(this.type===q.ellipsis){var xe=this.parseRestBinding();this.parseBindingListItem(xe),R.push(xe),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var We=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(We),R.push(We)}}return R},ir.parseBindingListItem=function(_){return _},ir.parseMaybeDefault=function(_,T,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(q.eq))return F;var R=this.startNodeAt(_,T);return R.left=F,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},ir.checkLVal=function(_,T,F){switch(T===void 0&&(T=bi),_.type){case"Identifier":T===aa&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(T?"Binding ":"Assigning to ")+_.name+" in strict mode"),F&&(en(F,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),F[_.name]=!0),T!==bi&&T!==An&&this.declareName(_.name,T,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,K=_.properties;R<K.length;R+=1){var xe=K[R];this.checkLVal(xe,T,F)}break;case"Property":this.checkLVal(_.value,T,F);break;case"ArrayPattern":for(var We=0,dt=_.elements;We<dt.length;We+=1){var mt=dt[We];mt&&this.checkLVal(mt,T,F)}break;case"AssignmentPattern":this.checkLVal(_.left,T,F);break;case"RestElement":this.checkLVal(_.argument,T,F);break;case"ParenthesizedExpression":this.checkLVal(_.expression,T,F);break;default:this.raise(_.start,(T?"Binding":"Assigning to")+" rvalue")}};var Dn=_i.prototype;Dn.checkPropClash=function(_,T,F){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,K;switch(R.type){case"Identifier":K=R.name;break;case"Literal":K=String(R.value);break;default:return}var xe=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&xe==="init"&&(T.proto&&(F?F.doubleProto<0&&(F.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),T.proto=!0);return}K="$"+K;var We=T[K];if(We){var dt;xe==="init"?dt=this.strict&&We.init||We.get||We.set:dt=We.init||We[xe],dt&&this.raiseRecoverable(R.start,"Redefinition of property")}else We=T[K]={init:!1,get:!1,set:!1};We[xe]=!0}},Dn.parseExpression=function(_,T){var F=this.start,R=this.startLoc,K=this.parseMaybeAssign(_,T);if(this.type===q.comma){var xe=this.startNodeAt(F,R);for(xe.expressions=[K];this.eat(q.comma);)xe.expressions.push(this.parseMaybeAssign(_,T));return this.finishNode(xe,"SequenceExpression")}return K},Dn.parseMaybeAssign=function(_,T,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,K=-1,xe=-1;T?(K=T.parenthesizedAssign,xe=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new de,R=!0);var We=this.start,dt=this.startLoc;(this.type===q.parenL||this.type===q.name)&&(this.potentialArrowAt=this.start);var mt=this.parseMaybeConditional(_,T);if(F&&(mt=F.call(this,mt,We,dt)),this.type.isAssign){var fr=this.startNodeAt(We,dt);return fr.operator=this.value,fr.left=this.type===q.eq?this.toAssignable(mt,!1,T):mt,R||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=fr.left.start&&(T.shorthandAssign=-1),this.checkLVal(mt),this.next(),fr.right=this.parseMaybeAssign(_),this.finishNode(fr,"AssignmentExpression")}else R&&this.checkExpressionErrors(T,!0);return K>-1&&(T.parenthesizedAssign=K),xe>-1&&(T.trailingComma=xe),mt},Dn.parseMaybeConditional=function(_,T){var F=this.start,R=this.startLoc,K=this.parseExprOps(_,T);if(this.checkExpressionErrors(T))return K;if(this.eat(q.question)){var xe=this.startNodeAt(F,R);return xe.test=K,xe.consequent=this.parseMaybeAssign(),this.expect(q.colon),xe.alternate=this.parseMaybeAssign(_),this.finishNode(xe,"ConditionalExpression")}return K},Dn.parseExprOps=function(_,T){var F=this.start,R=this.startLoc,K=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||K.start===F&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,F,R,-1,_)},Dn.parseExprOp=function(_,T,F,R,K){var xe=this.type.binop;if(xe!=null&&(!K||this.type!==q._in)&&xe>R){var We=this.type===q.logicalOR||this.type===q.logicalAND,dt=this.type===q.coalesce;dt&&(xe=q.logicalAND.binop);var mt=this.value;this.next();var fr=this.start,br=this.startLoc,Pn=this.parseExprOp(this.parseMaybeUnary(null,!1),fr,br,xe,K),ci=this.buildBinary(T,F,_,Pn,mt,We||dt);return(We&&this.type===q.coalesce||dt&&(this.type===q.logicalOR||this.type===q.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ci,T,F,R,K)}return _},Dn.buildBinary=function(_,T,F,R,K,xe){var We=this.startNodeAt(_,T);return We.left=F,We.operator=K,We.right=R,this.finishNode(We,xe?"LogicalExpression":"BinaryExpression")},Dn.parseMaybeUnary=function(_,T){var F=this.start,R=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),T=!0;else if(this.type.prefix){var xe=this.startNode(),We=this.type===q.incDec;xe.operator=this.value,xe.prefix=!0,this.next(),xe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),We?this.checkLVal(xe.argument):this.strict&&xe.operator==="delete"&&xe.argument.type==="Identifier"?this.raiseRecoverable(xe.start,"Deleting local variable in strict mode"):T=!0,K=this.finishNode(xe,We?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var dt=this.startNodeAt(F,R);dt.operator=this.value,dt.prefix=!1,dt.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(dt,"UpdateExpression")}}return!T&&this.eat(q.starstar)?this.buildBinary(F,R,K,this.parseMaybeUnary(null,!1),"**",!1):K},Dn.parseExprSubscripts=function(_){var T=this.start,F=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var K=this.parseSubscripts(R,T,F);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},Dn.parseSubscripts=function(_,T,F,R){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,xe=!1;;){var We=this.parseSubscript(_,T,F,R,K,xe);if(We.optional&&(xe=!0),We===_||We.type==="ArrowFunctionExpression"){if(xe){var dt=this.startNodeAt(T,F);dt.expression=We,We=this.finishNode(dt,"ChainExpression")}return We}_=We}},Dn.parseSubscript=function(_,T,F,R,K,xe){var We=this.options.ecmaVersion>=11,dt=We&&this.eat(q.questionDot);R&&dt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var mt=this.eat(q.bracketL);if(mt||dt&&this.type!==q.parenL&&this.type!==q.backQuote||this.eat(q.dot)){var fr=this.startNodeAt(T,F);fr.object=_,fr.property=mt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),fr.computed=!!mt,mt&&this.expect(q.bracketR),We&&(fr.optional=dt),_=this.finishNode(fr,"MemberExpression")}else if(!R&&this.eat(q.parenL)){var br=new de,Pn=this.yieldPos,ci=this.awaitPos,ei=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Gi=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1,br);if(K&&!dt&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(br,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Pn,this.awaitPos=ci,this.awaitIdentPos=ei,this.parseArrowExpression(this.startNodeAt(T,F),Gi,!0);this.checkExpressionErrors(br,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=ci||this.awaitPos,this.awaitIdentPos=ei||this.awaitIdentPos;var ua=this.startNodeAt(T,F);ua.callee=_,ua.arguments=Gi,We&&(ua.optional=dt),_=this.finishNode(ua,"CallExpression")}else if(this.type===q.backQuote){(dt||xe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Aa=this.startNodeAt(T,F);Aa.tag=_,Aa.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Aa,"TaggedTemplateExpression")}return _},Dn.parseExprAtom=function(_){this.type===q.slash&&this.readRegexp();var T,F=this.potentialArrowAt===this.start;switch(this.type){case q._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===q.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==q.dot&&this.type!==q.bracketL&&this.type!==q.parenL&&this.unexpected(),this.finishNode(T,"Super");case q._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case q.name:var R=this.start,K=this.startLoc,xe=this.containsEsc,We=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!xe&&We.name==="async"&&!this.canInsertSemicolon()&&this.eat(q._function))return this.parseFunction(this.startNodeAt(R,K),0,!1,!0);if(F&&!this.canInsertSemicolon()){if(this.eat(q.arrow))return this.parseArrowExpression(this.startNodeAt(R,K),[We],!1);if(this.options.ecmaVersion>=8&&We.name==="async"&&this.type===q.name&&!xe)return We=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(q.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,K),[We],!0)}return We;case q.regexp:var dt=this.value;return T=this.parseLiteral(dt.value),T.regex={pattern:dt.pattern,flags:dt.flags},T;case q.num:case q.string:return this.parseLiteral(this.value);case q._null:case q._true:case q._false:return T=this.startNode(),T.value=this.type===q._null?null:this.type===q._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case q.parenL:var mt=this.start,fr=this.parseParenAndDistinguishExpression(F);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(fr)&&(_.parenthesizedAssign=mt),_.parenthesizedBind<0&&(_.parenthesizedBind=mt)),fr;case q.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(q.bracketR,!0,!0,_),this.finishNode(T,"ArrayExpression");case q.braceL:return this.parseObj(!1,_);case q._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case q._class:return this.parseClass(this.startNode(),!1);case q._new:return this.parseNew();case q.backQuote:return this.parseTemplate();case q._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Dn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case q.parenL:return this.parseDynamicImport(_);case q.dot:return _.meta=T,this.parseImportMeta(_);default:this.unexpected()}},Dn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(q.parenR)){var T=this.start;this.eat(q.comma)&&this.eat(q.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(_,"ImportExpression")},Dn.parseImportMeta=function(_){this.next();var T=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Dn.parseLiteral=function(_){var T=this.startNode();return T.value=_,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},Dn.parseParenExpression=function(){this.expect(q.parenL);var _=this.parseExpression();return this.expect(q.parenR),_},Dn.parseParenAndDistinguishExpression=function(_){var T=this.start,F=this.startLoc,R,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var xe=this.start,We=this.startLoc,dt=[],mt=!0,fr=!1,br=new de,Pn=this.yieldPos,ci=this.awaitPos,ei;for(this.yieldPos=0,this.awaitPos=0;this.type!==q.parenR;)if(mt?mt=!1:this.expect(q.comma),K&&this.afterTrailingComma(q.parenR,!0)){fr=!0;break}else if(this.type===q.ellipsis){ei=this.start,dt.push(this.parseParenItem(this.parseRestBinding())),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else dt.push(this.parseMaybeAssign(!1,br,this.parseParenItem));var Gi=this.start,ua=this.startLoc;if(this.expect(q.parenR),_&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(br,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Pn,this.awaitPos=ci,this.parseParenArrowList(T,F,dt);(!dt.length||fr)&&this.unexpected(this.lastTokStart),ei&&this.unexpected(ei),this.checkExpressionErrors(br,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=ci||this.awaitPos,dt.length>1?(R=this.startNodeAt(xe,We),R.expressions=dt,this.finishNodeAt(R,"SequenceExpression",Gi,ua)):R=dt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Aa=this.startNodeAt(T,F);return Aa.expression=R,this.finishNode(Aa,"ParenthesizedExpression")}else return R},Dn.parseParenItem=function(_){return _},Dn.parseParenArrowList=function(_,T,F){return this.parseArrowExpression(this.startNodeAt(_,T),F)};var li=[];Dn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(q.dot)){_.meta=T;var F=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,K=this.startLoc,xe=this.type===q._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,K,!0),xe&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(q.parenL)?_.arguments=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1):_.arguments=li,this.finishNode(_,"NewExpression")},Dn.parseTemplateElement=function(_){var T=_.isTagged,F=this.startNode();return this.type===q.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===q.backQuote,this.finishNode(F,"TemplateElement")},Dn.parseTemplate=function(_){_===void 0&&(_={});var T=_.isTagged;T===void 0&&(T=!1);var F=this.startNode();this.next(),F.expressions=[];var R=this.parseTemplateElement({isTagged:T});for(F.quasis=[R];!R.tail;)this.type===q.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(q.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(q.braceR),F.quasis.push(R=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(F,"TemplateLiteral")},Dn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===q.name||this.type===q.num||this.type===q.string||this.type===q.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===q.star)&&!Qt.test(this.input.slice(this.lastTokEnd,this.start))},Dn.parseObj=function(_,T){var F=this.startNode(),R=!0,K={};for(F.properties=[],this.next();!this.eat(q.braceR);){if(R)R=!1;else if(this.expect(q.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(q.braceR))break;var xe=this.parseProperty(_,T);_||this.checkPropClash(xe,K,T),F.properties.push(xe)}return this.finishNode(F,_?"ObjectPattern":"ObjectExpression")},Dn.parseProperty=function(_,T){var F=this.startNode(),R,K,xe,We;if(this.options.ecmaVersion>=9&&this.eat(q.ellipsis))return _?(F.argument=this.parseIdent(!1),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(this.type===q.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),F.argument=this.parseMaybeAssign(!1,T),this.type===q.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(_||T)&&(xe=this.start,We=this.startLoc),_||(R=this.eat(q.star)));var dt=this.containsEsc;return this.parsePropertyName(F),!_&&!dt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(F)?(K=!0,R=this.options.ecmaVersion>=9&&this.eat(q.star),this.parsePropertyName(F,T)):K=!1,this.parsePropertyValue(F,_,R,K,xe,We,T,dt),this.finishNode(F,"Property")},Dn.parsePropertyValue=function(_,T,F,R,K,xe,We,dt){if((F||R)&&this.type===q.colon&&this.unexpected(),this.eat(q.colon))_.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,We),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===q.parenL)T&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(F,R);else if(!T&&!dt&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==q.comma&&this.type!==q.braceR&&this.type!==q.eq){(F||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var mt=_.kind==="get"?0:1;if(_.value.params.length!==mt){var fr=_.value.start;_.kind==="get"?this.raiseRecoverable(fr,"getter should have no params"):this.raiseRecoverable(fr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((F||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",T?_.value=this.parseMaybeDefault(K,xe,_.key):this.type===q.eq&&We?(We.shorthandAssign<0&&(We.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,xe,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Dn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(q.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(q.bracketR),_.key;_.computed=!1}return _.key=this.type===q.num||this.type===q.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Dn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Dn.parseMethod=function(_,T,F){var R=this.startNode(),K=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ri(T,R.generator)|ui|(F?ra:0)),this.expect(q.parenL),R.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=K,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(R,"FunctionExpression")},Dn.parseArrowExpression=function(_,T,F){var R=this.yieldPos,K=this.awaitPos,xe=this.awaitIdentPos;return this.enterScope(Ri(F,!1)|pi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(T,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=K,this.awaitIdentPos=xe,this.finishNode(_,"ArrowFunctionExpression")},Dn.parseFunctionBody=function(_,T,F){var R=T&&this.type!==q.braceL,K=this.strict,xe=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var We=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||We)&&(xe=this.strictDirective(this.end),xe&&We&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var dt=this.labels;this.labels=[],xe&&(this.strict=!0),this.checkParams(_,!K&&!xe&&!T&&!F&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,An),_.body=this.parseBlock(!1,void 0,xe&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=dt}this.exitScope()},Dn.isSimpleParamList=function(_){for(var T=0,F=_;T<F.length;T+=1){var R=F[T];if(R.type!=="Identifier")return!1}return!0},Dn.checkParams=function(_,T){for(var F={},R=0,K=_.params;R<K.length;R+=1){var xe=K[R];this.checkLVal(xe,Ni,T?null:F)}},Dn.parseExprList=function(_,T,F,R){for(var K=[],xe=!0;!this.eat(_);){if(xe)xe=!1;else if(this.expect(q.comma),T&&this.afterTrailingComma(_))break;var We=void 0;F&&this.type===q.comma?We=null:this.type===q.ellipsis?(We=this.parseSpread(R),R&&this.type===q.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):We=this.parseMaybeAssign(!1,R),K.push(We)}return K},Dn.checkUnreserved=function(_){var T=_.start,F=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(T,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,F).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+R+"' is reserved"))}},Dn.parseIdent=function(_,T){var F=this.startNode();return this.type===q.name?F.name=this.value:this.type.keyword?(F.name=this.type.keyword,(F.name==="class"||F.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(F,"Identifier"),_||(this.checkUnreserved(F),F.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=F.start)),F},Dn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===q.semi||this.canInsertSemicolon()||this.type!==q.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(q.star),T.argument=this.parseMaybeAssign(_)),this.finishNode(T,"YieldExpression")},Dn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var Wn=_i.prototype;Wn.raise=function(_,T){var F=yt(this.input,_);T+=" ("+F.line+":"+F.column+")";var R=new SyntaxError(T);throw R.pos=_,R.loc=F,R.raisedAt=this.pos,R},Wn.raiseRecoverable=Wn.raise,Wn.curPosition=function(){if(this.options.locations)return new ke(this.curLine,this.pos-this.lineStart)};var nn=_i.prototype,wi=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};nn.enterScope=function(_){this.scopeStack.push(new wi(_))},nn.exitScope=function(){this.scopeStack.pop()},nn.treatFunctionsAsVarInScope=function(_){return _.flags&fn||!this.inModule&&_.flags&qn},nn.declareName=function(_,T,F){var R=!1;if(T===aa){var K=this.currentScope();R=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&qn&&delete this.undefinedExports[_]}else if(T===_a){var xe=this.currentScope();xe.lexical.push(_)}else if(T===Ei){var We=this.currentScope();this.treatFunctionsAsVar?R=We.lexical.indexOf(_)>-1:R=We.lexical.indexOf(_)>-1||We.var.indexOf(_)>-1,We.functions.push(_)}else for(var dt=this.scopeStack.length-1;dt>=0;--dt){var mt=this.scopeStack[dt];if(mt.lexical.indexOf(_)>-1&&!(mt.flags&Kn&&mt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(mt)&&mt.functions.indexOf(_)>-1){R=!0;break}if(mt.var.push(_),this.inModule&&mt.flags&qn&&delete this.undefinedExports[_],mt.flags&Hi)break}R&&this.raiseRecoverable(F,"Identifier '"+_+"' has already been declared")},nn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},nn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},nn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&Hi)return T}},nn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&Hi&&!(T.flags&pi))return T}};var Ti=function(T,F,R){this.type="",this.start=F,this.end=0,T.options.locations&&(this.loc=new Mt(T,R)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[F,0])},Wa=_i.prototype;Wa.startNode=function(){return new Ti(this,this.start,this.startLoc)},Wa.startNodeAt=function(_,T){return new Ti(this,_,T)};function cs(_,T,F,R){return _.type=T,_.end=F,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=F),_}Wa.finishNode=function(_,T){return cs.call(this,_,T,this.lastTokEnd,this.lastTokEndLoc)},Wa.finishNodeAt=function(_,T,F,R){return cs.call(this,_,T,F,R)};var ha=function(T,F,R,K,xe){this.token=T,this.isExpr=!!F,this.preserveSpace=!!R,this.override=K,this.generator=!!xe},wa={b_stat:new ha("{",!1),b_expr:new ha("{",!0),b_tmpl:new ha("${",!1),p_stat:new ha("(",!1),p_expr:new ha("(",!0),q_tmpl:new ha("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new ha("function",!1),f_expr:new ha("function",!0),f_expr_gen:new ha("function",!0,!1,null,!0),f_gen:new ha("function",!1,!1,null,!0)},Ea=_i.prototype;Ea.initialContext=function(){return[wa.b_stat]},Ea.braceIsBlock=function(_){var T=this.curContext();return T===wa.f_expr||T===wa.f_stat?!0:_===q.colon&&(T===wa.b_stat||T===wa.b_expr)?!T.isExpr:_===q._return||_===q.name&&this.exprAllowed?Qt.test(this.input.slice(this.lastTokEnd,this.start)):_===q._else||_===q.semi||_===q.eof||_===q.parenR||_===q.arrow?!0:_===q.braceL?T===wa.b_stat:_===q._var||_===q._const||_===q.name?!1:!this.exprAllowed},Ea.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var T=this.context[_];if(T.token==="function")return T.generator}return!1},Ea.updateContext=function(_){var T,F=this.type;F.keyword&&_===q.dot?this.exprAllowed=!1:(T=F.updateContext)?T.call(this,_):this.exprAllowed=F.beforeExpr},q.parenR.updateContext=q.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===wa.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},q.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?wa.b_stat:wa.b_expr),this.exprAllowed=!0},q.dollarBraceL.updateContext=function(){this.context.push(wa.b_tmpl),this.exprAllowed=!0},q.parenL.updateContext=function(_){var T=_===q._if||_===q._for||_===q._with||_===q._while;this.context.push(T?wa.p_stat:wa.p_expr),this.exprAllowed=!0},q.incDec.updateContext=function(){},q._function.updateContext=q._class.updateContext=function(_){_.beforeExpr&&_!==q.semi&&_!==q._else&&!(_===q._return&&Qt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===q.colon||_===q.braceL)&&this.curContext()===wa.b_stat)?this.context.push(wa.f_expr):this.context.push(wa.f_stat),this.exprAllowed=!1},q.backQuote.updateContext=function(){this.curContext()===wa.q_tmpl?this.context.pop():this.context.push(wa.q_tmpl),this.exprAllowed=!1},q.star.updateContext=function(_){if(_===q._function){var T=this.context.length-1;this.context[T]===wa.f_expr?this.context[T]=wa.f_expr_gen:this.context[T]=wa.f_gen}this.exprAllowed=!0},q.name.updateContext=function(_){var T=!1;this.options.ecmaVersion>=6&&_!==q.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var G="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",$=G+" Extended_Pictographic",re=$,ge={9:G,10:$,11:re},Pe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",ot=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",he=ot+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",De={9:Ge,10:ot,11:he},_t={};function vr(_){var T=_t[_]={binary:qe(ge[_]+" "+Pe),nonBinary:{General_Category:qe(Pe),Script:qe(De[_])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}vr(9),vr(10),vr(11);var Bt=_i.prototype,Ut=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=_t[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Ut.prototype.reset=function(T,F,R){var K=R.indexOf("u")!==-1;this.start=T|0,this.source=F+"",this.flags=R,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},Ut.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},Ut.prototype.at=function(T,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(T>=K)return-1;var xe=R.charCodeAt(T);if(!(F||this.switchU)||xe<=55295||xe>=57344||T+1>=K)return xe;var We=R.charCodeAt(T+1);return We>=56320&&We<=57343?(xe<<10)+We-56613888:xe},Ut.prototype.nextIndex=function(T,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(T>=K)return K;var xe=R.charCodeAt(T),We;return!(F||this.switchU)||xe<=55295||xe>=57344||T+1>=K||(We=R.charCodeAt(T+1))<56320||We>57343?T+1:T+2},Ut.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},Ut.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},Ut.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},Ut.prototype.eat=function(T,F){return F===void 0&&(F=!1),this.current(F)===T?(this.advance(F),!0):!1};function gr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Bt.validateRegExpFlags=function(_){for(var T=_.validFlags,F=_.flags,R=0;R<F.length;R++){var K=F.charAt(R);T.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),F.indexOf(K,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Bt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Bt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var T=0,F=_.backReferenceNames;T<F.length;T+=1){var R=F[T];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Bt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Bt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Bt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Bt.regexp_eatAssertion=function(_){var T=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=T}if(_.eat(40)&&_.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!F,!0}return _.pos=T,!1},Bt.regexp_eatQuantifier=function(_,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(_,T)?(_.eat(63),!0):!1},Bt.regexp_eatQuantifierPrefix=function(_,T){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,T)},Bt.regexp_eatBracedQuantifier=function(_,T){var F=_.pos;if(_.eat(123)){var R=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<R&&!T&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!T&&_.raise("Incomplete quantifier"),_.pos=F}return!1},Bt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Bt.regexp_eatReverseSolidusAtomEscape=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=T}return!1},Bt.regexp_eatUncapturingGroup=function(_){var T=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=T}return!1},Bt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Bt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Bt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Bt.regexp_eatSyntaxCharacter=function(_){var T=_.current();return _n(T)?(_.lastIntValue=T,_.advance(),!0):!1};function _n(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Bt.regexp_eatPatternCharacters=function(_){for(var T=_.pos,F=0;(F=_.current())!==-1&&!_n(F);)_.advance();return _.pos!==T},Bt.regexp_eatExtendedPatternCharacter=function(_){var T=_.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(_.advance(),!0):!1},Bt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Bt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Bt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=gr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=gr(_.lastIntValue);return!0}return!1},Bt.regexp_eatRegExpIdentifierStart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),ln(R)?(_.lastIntValue=R,!0):(_.pos=T,!1)};function ln(_){return Ht(_,!0)||_===36||_===95}Bt.regexp_eatRegExpIdentifierPart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),Lt(R)?(_.lastIntValue=R,!0):(_.pos=T,!1)};function Lt(_){return ur(_,!0)||_===36||_===95||_===8204||_===8205}Bt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Bt.regexp_eatBackReference=function(_){var T=_.pos;if(this.regexp_eatDecimalEscape(_)){var F=_.lastIntValue;if(_.switchU)return F>_.maxBackReference&&(_.maxBackReference=F),!0;if(F<=_.numCapturingParens)return!0;_.pos=T}return!1},Bt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Bt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Bt.regexp_eatCControlLetter=function(_){var T=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=T}return!1},Bt.regexp_eatZero=function(_){return _.current()===48&&!Si(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Bt.regexp_eatControlEscape=function(_){var T=_.current();return T===116?(_.lastIntValue=9,_.advance(),!0):T===110?(_.lastIntValue=10,_.advance(),!0):T===118?(_.lastIntValue=11,_.advance(),!0):T===102?(_.lastIntValue=12,_.advance(),!0):T===114?(_.lastIntValue=13,_.advance(),!0):!1},Bt.regexp_eatControlLetter=function(_){var T=_.current();return sn(T)?(_.lastIntValue=T%32,_.advance(),!0):!1};function sn(_){return _>=65&&_<=90||_>=97&&_<=122}Bt.regexp_eatRegExpUnicodeEscapeSequence=function(_,T){T===void 0&&(T=!1);var F=_.pos,R=T||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(R&&K>=55296&&K<=56319){var xe=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var We=_.lastIntValue;if(We>=56320&&We<=57343)return _.lastIntValue=(K-55296)*1024+(We-56320)+65536,!0}_.pos=xe,_.lastIntValue=K}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Zr(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=F}return!1};function Zr(_){return _>=0&&_<=1114111}Bt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var T=_.current();return T!==99&&(!_.switchN||T!==107)?(_.lastIntValue=T,_.advance(),!0):!1},Bt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var T=_.current();if(T>=49&&T<=57){do _.lastIntValue=10*_.lastIntValue+(T-48),_.advance();while((T=_.current())>=48&&T<=57);return!0}return!1},Bt.regexp_eatCharacterClassEscape=function(_){var T=_.current();if(Hr(T))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Hr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Bt.regexp_eatUnicodePropertyValueExpression=function(_){var T=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var F=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,F,R),!0}}if(_.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},Bt.regexp_validateUnicodePropertyNameAndValue=function(_,T,F){en(_.unicodeProperties.nonBinary,T)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[T].test(F)||_.raise("Invalid property value")},Bt.regexp_validateUnicodePropertyNameOrValue=function(_,T){_.unicodeProperties.binary.test(T)||_.raise("Invalid property name")},Bt.regexp_eatUnicodePropertyName=function(_){var T=0;for(_.lastStringValue="";oi(T=_.current());)_.lastStringValue+=gr(T),_.advance();return _.lastStringValue!==""};function oi(_){return sn(_)||_===95}Bt.regexp_eatUnicodePropertyValue=function(_){var T=0;for(_.lastStringValue="";tn(T=_.current());)_.lastStringValue+=gr(T),_.advance();return _.lastStringValue!==""};function tn(_){return oi(_)||Si(_)}Bt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Bt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Bt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var T=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var F=_.lastIntValue;_.switchU&&(T===-1||F===-1)&&_.raise("Invalid character class"),T!==-1&&F!==-1&&T>F&&_.raise("Range out of order in character class")}}},Bt.regexp_eatClassAtom=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var F=_.current();(F===99||Mi(F))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=T}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Bt.regexp_eatClassEscape=function(_){var T=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=T}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Bt.regexp_eatClassControlLetter=function(_){var T=_.current();return Si(T)||T===95?(_.lastIntValue=T%32,_.advance(),!0):!1},Bt.regexp_eatHexEscapeSequence=function(_){var T=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=T}return!1},Bt.regexp_eatDecimalDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;Si(F=_.current());)_.lastIntValue=10*_.lastIntValue+(F-48),_.advance();return _.pos!==T};function Si(_){return _>=48&&_<=57}Bt.regexp_eatHexDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;$i(F=_.current());)_.lastIntValue=16*_.lastIntValue+yi(F),_.advance();return _.pos!==T};function $i(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function yi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Bt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var T=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var F=_.lastIntValue;T<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=T*64+F*8+_.lastIntValue:_.lastIntValue=T*8+F}else _.lastIntValue=T;return!0}return!1},Bt.regexp_eatOctalDigit=function(_){var T=_.current();return Mi(T)?(_.lastIntValue=T-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Mi(_){return _>=48&&_<=55}Bt.regexp_eatFixedHexDigits=function(_,T){var F=_.pos;_.lastIntValue=0;for(var R=0;R<T;++R){var K=_.current();if(!$i(K))return _.pos=F,!1;_.lastIntValue=16*_.lastIntValue+yi(K),_.advance()}return!0};var xi=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new Mt(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},ti=_i.prototype;ti.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new xi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ti.getToken=function(){return this.next(),new xi(this)},typeof Symbol!="undefined"&&(ti[Symbol.iterator]=function(){var _=this;return{next:function(){var T=_.getToken();return{done:T.type===q.eof,value:T}}}}),ti.curContext=function(){return this.context[this.context.length-1]},ti.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(q.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ti.readToken=function(_){return Ht(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ti.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var T=this.input.charCodeAt(this.pos+1);return(_<<10)+T-56613888},ti.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),T=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations){xt.lastIndex=T;for(var R;(R=xt.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,F),T,this.pos,_,this.curPosition())},ti.skipLineComment=function(_){for(var T=this.pos,F=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!rt(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+_,this.pos),T,this.pos,F,this.curPosition())},ti.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&wt.test(String.fromCharCode(_)))++this.pos;else break e}}},ti.finishToken=function(_,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=_,this.value=T,this.updateContext(F)},ti.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&T===46?(this.pos+=3,this.finishToken(q.ellipsis)):(++this.pos,this.finishToken(q.dot))},ti.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(q.assign,2):this.finishOp(q.slash,1)},ti.readToken_mult_modulo_exp=function(_){var T=this.input.charCodeAt(this.pos+1),F=1,R=_===42?q.star:q.modulo;return this.options.ecmaVersion>=7&&_===42&&T===42&&(++F,R=q.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(q.assign,F+1):this.finishOp(R,F)},ti.readToken_pipe_amp=function(_){var T=this.input.charCodeAt(this.pos+1);if(T===_){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(q.assign,3)}return this.finishOp(_===124?q.logicalOR:q.logicalAND,2)}return T===61?this.finishOp(q.assign,2):this.finishOp(_===124?q.bitwiseOR:q.bitwiseAND,1)},ti.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(q.assign,2):this.finishOp(q.bitwiseXOR,1)},ti.readToken_plus_min=function(_){var T=this.input.charCodeAt(this.pos+1);return T===_?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Qt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(q.incDec,2):T===61?this.finishOp(q.assign,2):this.finishOp(q.plusMin,1)},ti.readToken_lt_gt=function(_){var T=this.input.charCodeAt(this.pos+1),F=1;return T===_?(F=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(q.assign,F+1):this.finishOp(q.bitShift,F)):T===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(F=2),this.finishOp(q.relational,F))},ti.readToken_eq_excl=function(_){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(q.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(q.arrow)):this.finishOp(_===61?q.eq:q.prefix,1)},ti.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(q.questionDot,2)}if(T===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(q.assign,3)}return this.finishOp(q.coalesce,2)}}return this.finishOp(q.question,1)},ti.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(q.parenL);case 41:return++this.pos,this.finishToken(q.parenR);case 59:return++this.pos,this.finishToken(q.semi);case 44:return++this.pos,this.finishToken(q.comma);case 91:return++this.pos,this.finishToken(q.bracketL);case 93:return++this.pos,this.finishToken(q.bracketR);case 123:return++this.pos,this.finishToken(q.braceL);case 125:return++this.pos,this.finishToken(q.braceR);case 58:return++this.pos,this.finishToken(q.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(q.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(q.prefix,1)}this.raise(this.pos,"Unexpected character '"+na(_)+"'")},ti.finishOp=function(_,T){var F=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(_,F)},ti.readRegexp=function(){for(var _,T,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Qt.test(R)&&this.raise(F,"Unterminated regular expression"),_)_=!1;else{if(R==="[")T=!0;else if(R==="]"&&T)T=!1;else if(R==="/"&&!T)break;_=R==="\\"}++this.pos}var K=this.input.slice(F,this.pos);++this.pos;var xe=this.pos,We=this.readWord1();this.containsEsc&&this.unexpected(xe);var dt=this.regexpState||(this.regexpState=new Ut(this));dt.reset(F,K,We),this.validateRegExpFlags(dt),this.validateRegExpPattern(dt);var mt=null;try{mt=new RegExp(K,We)}catch(fr){}return this.finishToken(q.regexp,{pattern:K,flags:We,value:mt})},ti.readInt=function(_,T,F){for(var R=this.options.ecmaVersion>=12&&T===void 0,K=F&&this.input.charCodeAt(this.pos)===48,xe=this.pos,We=0,dt=0,mt=0,fr=T==null?Infinity:T;mt<fr;++mt,++this.pos){var br=this.input.charCodeAt(this.pos),Pn=void 0;if(R&&br===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),dt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),mt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),dt=br;continue}if(br>=97?Pn=br-97+10:br>=65?Pn=br-65+10:br>=48&&br<=57?Pn=br-48:Pn=Infinity,Pn>=_)break;dt=br,We=We*_+Pn}return R&&dt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===xe||T!=null&&this.pos-xe!==T?null:We};function Vi(_,T){return T?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ta(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ti.readRadixNumber=function(_){var T=this.pos;this.pos+=2;var F=this.readInt(_);return F==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=Ta(this.input.slice(T,this.pos)),++this.pos):Ht(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,F)},ti.readNumber=function(_){var T=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var F=this.pos-T>=2&&this.input.charCodeAt(T)===48;F&&this.strict&&this.raise(T,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!F&&!_&&this.options.ecmaVersion>=11&&R===110){var K=Ta(this.input.slice(T,this.pos));return++this.pos,Ht(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,K)}F&&/[89]/.test(this.input.slice(T,this.pos))&&(F=!1),R===46&&!F&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!F&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),Ht(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var xe=Vi(this.input.slice(T,this.pos),F);return this.finishToken(q.num,xe)},ti.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),T;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else T=this.readHexChar(4);return T};function na(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ti.readString=function(_){for(var T="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(T+=this.input.slice(F,this.pos),T+=this.readEscapedChar(!1),F=this.pos):(rt(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(F,this.pos++),this.finishToken(q.string,T)};var Pi={};ti.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Pi)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ti.invalidStringToken=function(_,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Pi;this.raise(_,T)},ti.readTmplToken=function(){for(var _="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===q.template||this.type===q.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(q.dollarBraceL)):(++this.pos,this.finishToken(q.backQuote)):(_+=this.input.slice(T,this.pos),this.finishToken(q.template,_));if(F===92)_+=this.input.slice(T,this.pos),_+=this.readEscapedChar(!0),T=this.pos;else if(rt(F)){switch(_+=this.input.slice(T,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},ti.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(q.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ti.readEscapedChar=function(_){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return na(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var F=this.pos-1;return this.invalidStringToken(F,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(R,8);return K>255&&(R=R.slice(0,-1),K=parseInt(R,8)),this.pos+=R.length-1,T=this.input.charCodeAt(this.pos),(R!=="0"||T===56||T===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return rt(T)?"":String.fromCharCode(T)}},ti.readHexChar=function(_){var T=this.pos,F=this.readInt(16,_);return F===null&&this.invalidStringToken(T,"Bad character escape sequence"),F},ti.readWord1=function(){this.containsEsc=!1;for(var _="",T=!0,F=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(ur(K,R))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(F,this.pos);var xe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var We=this.readCodePoint();(T?Ht:ur)(We,R)||this.invalidStringToken(xe,"Invalid Unicode escape"),_+=na(We),F=this.pos}else break;T=!1}return _+this.input.slice(F,this.pos)},ti.readWord=function(){var _=this.readWord1(),T=q.name;return this.keywords.test(_)&&(T=gt[_]),this.finishToken(T,_)};var zi="7.4.1";_i.acorn={Parser:_i,version:zi,defaultOptions:Zt,Position:ke,SourceLocation:Mt,getLineInfo:yt,Node:Ti,TokenType:Pt,tokTypes:q,keywordTypes:gt,TokContext:ha,tokContexts:wa,isIdentifierChar:ur,isIdentifierStart:Ht,Token:xi,isNewLine:rt,lineBreak:Qt,lineBreakG:xt,nonASCIIwhitespace:wt};function Ra(_,T){return _i.parse(_,T)}function ou(_,T,F){return _i.parseExpressionAt(_,T,F)}function Sa(_,T){return _i.tokenizer(_,T)}function Ca(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,_.__proto__=T}function Es(_){var T=typeof Map=="function"?new Map:void 0;return Es=function(R){if(R===null||!Xu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(R))return T.get(R);T.set(R,K)}function K(){return Ji(R,arguments,La(this).constructor)}return K.prototype=Object.create(R.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),fo(K,R)},Es(_)}function fs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Ji(_,T,F){return fs()?Ji=Reflect.construct:Ji=function(K,xe,We){var dt=[null];dt.push.apply(dt,xe);var mt=Function.bind.apply(K,dt),fr=new mt;return We&&fo(fr,We.prototype),fr},Ji.apply(null,arguments)}function Xu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function fo(_,T){return fo=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},fo(_,T)}function La(_){return La=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},La(_)}var $a=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Es(Error)),Xi=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Es(SyntaxError)),Ho=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Es(ReferenceError)),Wo=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Es(TypeError)),Yu=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}($a),go=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Xi),Xo=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ho),pa={UnknownError:[3001,"%0",Yu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Yu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Xo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Xo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Xo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Xo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Xo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Xo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Xo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Xo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Xo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Xo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ho],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ho],IsNotConstructor:[2003,"%0 is not a constructor",Wo]};function ho(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Yo(_,T,F){return ho()?Yo=Reflect.construct:Yo=function(K,xe,We){var dt=[null];dt.push.apply(dt,xe);var mt=Function.bind.apply(K,dt),fr=new mt;return We&&Qa(fr,We.prototype),fr},Yo.apply(null,arguments)}function Qa(_,T){return Qa=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},Qa(_,T)}var su="0.0.3";function Lc(_,T){Object.defineProperty(_,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var Ds=Object.prototype.hasOwnProperty,Q=Symbol("Break"),be=Symbol("Continue"),Je=Symbol("DefaultCase"),Ft=Symbol("EmptyStatementReturn"),Lr=Symbol("WithScopeName"),lt=Symbol("SuperScopeName"),Ct=Symbol("RootScopeName"),Ja=Symbol("GlobalScopeName");function Yi(_){return typeof _=="function"}var Za=function(){function _(F){this.interpreter=F}var T=_.prototype;return T.generator=function(){var R=this.interpreter;function K(){return this.getCurrentScope()}function xe(){return this.getGlobalScope()}function We(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:K.bind(R),getGlobalScope:xe.bind(R),getCurrentContext:We.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function qo(_,T,F){if(F===void 0&&(F=!0),!(_ instanceof Za))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var R=_.generator(),K=R.getOptions(),xe={timeout:K.timeout,_initEnv:function(){F||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},We=F?R.getGlobalScope():R.getCurrentScope(),dt=new po(We,xe);return dt.evaluate(T)}}Object.defineProperty(qo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Yr(_){if(!(_ instanceof Za))throw new Error("Illegal call");for(var T=_.generator(),F=arguments.length,R=new Array(F>1?F-1:0),K=1;K<F;K++)R[K-1]=arguments[K];var xe=R.pop(),We=new po(T.getGlobalScope(),T.getOptions()),dt=`
		    (function anonymous(`+R.join(",")+`){
		        `+xe+`
		    });
		    `;return We.evaluate(dt)}Object.defineProperty(Yr,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var jr=function(T){this.value=T},It=function(T){this.value=T},Fo=function(T){this.value=T},ae=function(T,F,R){F===void 0&&(F=null),this.name=R,this.parent=F,this.data=T,this.labelStack=[]};function Xs(){}function uu(_,T){return _===void 0&&(_=null),new ae(Object.create(null),_,T)}function hs(_){return Object.create(_)}var ia={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:qo,Function:Yr};typeof JSON!="undefined"&&(ia.JSON=JSON),typeof Promise!="undefined"&&(ia.Promise=Promise),typeof Set!="undefined"&&(ia.Set=Set),typeof Map!="undefined"&&(ia.Map=Map),typeof Symbol!="undefined"&&(ia.Symbol=Symbol),typeof Proxy!="undefined"&&(ia.Proxy=Proxy),typeof WeakMap!="undefined"&&(ia.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ia.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ia.Reflect=Reflect);var po=function(){function _(F,R){F===void 0&&(F=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=F||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=_.prototype;return T.initEnvironment=function(R){var K;if(R instanceof ae)K=R;else{var xe=null,We=this.createSuperScope(R);this.options.rootContext&&(xe=new ae(hs(this.options.rootContext),We,Ct)),K=new ae(R,xe||We,Ja)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var dt=this.options._initEnv;dt&&dt.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(R){return R instanceof Yu||R instanceof Xo||R instanceof go},T.createSuperScope=function(R){var K=Object.assign({},ia),xe=Object.keys(K);return xe.forEach(function(We){We in R&&delete K[We]}),new ae(K,null,lt)},T.setCurrentContext=function(R){this.currentContext=R},T.setCurrentScope=function(R){this.currentScope=R},T.evaluate=function(R){R===void 0&&(R="");var K;if(!!R)return K=Ra(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,R)},T.appendCode=function(R){return this.evaluate(R)},T.evaluateNode=function(R,K){var xe=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var We=this.getCurrentScope(),dt=this.getCurrentContext(),mt=We.labelStack.concat([]),fr=this.callStack.concat([]),br=function(){xe.setCurrentScope(We),xe.setCurrentContext(dt),We.labelStack=mt,xe.callStack=fr};try{var Pn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Pn()}catch(ci){throw ci}finally{br(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(R,K,xe){var We=R[1].replace("%0",String(K));return xe!==null&&(We+=this.getNodePosition(xe||this.lastExecNode)),We},T.createError=function(R,K){return new K(R)},T.createThrowError=function(R,K){return this.createError(R,K)},T.createInternalThrowError=function(R,K,xe){return this.createError(this.createErrorMessage(R,K,xe),R[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,K=Date.now();return K-this.execStartTime>R},T.getNodePosition=function(R){if(R){var K="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+K:""}return""},T.createClosure=function(R){var K=this,xe;switch(R.type){case"BinaryExpression":xe=this.binaryExpressionHandler(R);break;case"LogicalExpression":xe=this.logicalExpressionHandler(R);break;case"UnaryExpression":xe=this.unaryExpressionHandler(R);break;case"UpdateExpression":xe=this.updateExpressionHandler(R);break;case"ObjectExpression":xe=this.objectExpressionHandler(R);break;case"ArrayExpression":xe=this.arrayExpressionHandler(R);break;case"CallExpression":xe=this.callExpressionHandler(R);break;case"NewExpression":xe=this.newExpressionHandler(R);break;case"MemberExpression":xe=this.memberExpressionHandler(R);break;case"ThisExpression":xe=this.thisExpressionHandler(R);break;case"SequenceExpression":xe=this.sequenceExpressionHandler(R);break;case"Literal":xe=this.literalHandler(R);break;case"Identifier":xe=this.identifierHandler(R);break;case"AssignmentExpression":xe=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":xe=this.functionDeclarationHandler(R);break;case"VariableDeclaration":xe=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":xe=this.programHandler(R);break;case"ExpressionStatement":xe=this.expressionStatementHandler(R);break;case"EmptyStatement":xe=this.emptyStatementHandler(R);break;case"ReturnStatement":xe=this.returnStatementHandler(R);break;case"FunctionExpression":xe=this.functionExpressionHandler(R);break;case"IfStatement":xe=this.ifStatementHandler(R);break;case"ConditionalExpression":xe=this.conditionalExpressionHandler(R);break;case"ForStatement":xe=this.forStatementHandler(R);break;case"WhileStatement":xe=this.whileStatementHandler(R);break;case"DoWhileStatement":xe=this.doWhileStatementHandler(R);break;case"ForInStatement":xe=this.forInStatementHandler(R);break;case"WithStatement":xe=this.withStatementHandler(R);break;case"ThrowStatement":xe=this.throwStatementHandler(R);break;case"TryStatement":xe=this.tryStatementHandler(R);break;case"ContinueStatement":xe=this.continueStatementHandler(R);break;case"BreakStatement":xe=this.breakStatementHandler(R);break;case"SwitchStatement":xe=this.switchStatementHandler(R);break;case"LabeledStatement":xe=this.labeledStatementHandler(R);break;case"DebuggerStatement":xe=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(pa.NodeTypeSyntaxError,R.type,R)}return function(){var We=K.options.timeout;if(We&&We>0&&K.checkTimeout())throw K.createInternalThrowError(pa.ExecutionTimeOutError,We,null);return K.lastExecNode=R,xe.apply(void 0,arguments)}},T.binaryExpressionHandler=function(R){var K=this,xe=this.createClosure(R.left),We=this.createClosure(R.right);return function(){var dt=xe(),mt=We();switch(R.operator){case"==":return dt==mt;case"!=":return dt!=mt;case"===":return dt===mt;case"!==":return dt!==mt;case"<":return dt<mt;case"<=":return dt<=mt;case">":return dt>mt;case">=":return dt>=mt;case"<<":return dt<<mt;case">>":return dt>>mt;case">>>":return dt>>>mt;case"+":return dt+mt;case"-":return dt-mt;case"*":return dt*mt;case"**":return Math.pow(dt,mt);case"/":return dt/mt;case"%":return dt%mt;case"|":return dt|mt;case"^":return dt^mt;case"&":return dt&mt;case"in":return dt in mt;case"instanceof":return dt instanceof mt;default:throw K.createInternalThrowError(pa.BinaryOperatorSyntaxError,R.operator,R)}}},T.logicalExpressionHandler=function(R){var K=this,xe=this.createClosure(R.left),We=this.createClosure(R.right);return function(){switch(R.operator){case"||":return xe()||We();case"&&":return xe()&&We();default:throw K.createInternalThrowError(pa.LogicalOperatorSyntaxError,R.operator,R)}}},T.unaryExpressionHandler=function(R){var K=this;switch(R.operator){case"delete":var xe=this.createObjectGetter(R.argument),We=this.createNameGetter(R.argument);return function(){var br=xe(),Pn=We();return delete br[Pn]};default:var dt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var mt=this.createObjectGetter(R.argument),fr=this.createNameGetter(R.argument);dt=function(){return mt()[fr()]}}else dt=this.createClosure(R.argument);return function(){var br=dt();switch(R.operator){case"-":return-br;case"+":return+br;case"!":return!br;case"~":return~br;case"void":return;case"typeof":return typeof br;default:throw K.createInternalThrowError(pa.UnaryOperatorSyntaxError,R.operator,R)}}}},T.updateExpressionHandler=function(R){var K=this,xe=this.createObjectGetter(R.argument),We=this.createNameGetter(R.argument);return function(){var dt=xe(),mt=We();switch(K.assertVariable(dt,mt,R),R.operator){case"++":return R.prefix?++dt[mt]:dt[mt]++;case"--":return R.prefix?--dt[mt]:dt[mt]--;default:throw K.createInternalThrowError(pa.UpdateOperatorSyntaxError,R.operator,R)}}},T.objectExpressionHandler=function(R){var K=this,xe=[];function We(mt){return mt.type==="Identifier"?mt.name:mt.type==="Literal"?mt.value:this.throwError(pa.ObjectStructureSyntaxError,mt.type,mt)}var dt=Object.create(null);return R.properties.forEach(function(mt){var fr=mt.kind,br=We(mt.key);(!dt[br]||fr==="init")&&(dt[br]={}),dt[br][fr]=K.createClosure(mt.value),xe.push({key:br,property:mt})}),function(){for(var mt={},fr=xe.length,br=0;br<fr;br++){var Pn=xe[br],ci=Pn.key,ei=dt[ci],Gi=ei.init?ei.init():void 0,ua=ei.get?ei.get():function(){},Aa=ei.set?ei.set():function(xl){};if("set"in ei||"get"in ei){var Ui={configurable:!0,enumerable:!0,get:ua,set:Aa};Object.defineProperty(mt,ci,Ui)}else{var Po=Pn.property,Ss=Po.kind;Po.key.type==="Identifier"&&Po.value.type==="FunctionExpression"&&Ss==="init"&&!Po.value.id&&Lc(Gi,Po.key.name),mt[ci]=Gi}}return mt}},T.arrayExpressionHandler=function(R){var K=this,xe=R.elements.map(function(We){return We&&K.createClosure(We)});return function(){for(var We=xe.length,dt=Array(We),mt=0;mt<We;mt++){var fr=xe[mt];fr&&(dt[mt]=fr())}return dt}},T.safeObjectGet=function(R,K,xe){return R[K]},T.createCallFunctionGetter=function(R){var K=this;switch(R.type){case"MemberExpression":var xe=this.createClosure(R.object),We=this.createMemberKeyGetter(R),dt=this.source;return function(){var fr=xe(),br=We(),Pn=K.safeObjectGet(fr,br,R);if(!Pn||!Yi(Pn)){var ci=dt.slice(R.start,R.end);throw K.createInternalThrowError(pa.FunctionUndefinedReferenceError,ci,R)}return Pn.__IS_EVAL_FUNC?function(ei){return Pn(new Za(K),ei,!0)}:Pn.__IS_FUNCTION_FUNC?function(){for(var ei=arguments.length,Gi=new Array(ei),ua=0;ua<ei;ua++)Gi[ua]=arguments[ua];return Pn.apply(void 0,[new Za(K)].concat(Gi))}:Pn.bind(fr)};default:var mt=this.createClosure(R);return function(){var fr="";R.type==="Identifier"&&(fr=R.name);var br=mt();if(!br||!Yi(br))throw K.createInternalThrowError(pa.FunctionUndefinedReferenceError,fr,R);if(R.type==="Identifier"&&br.__IS_EVAL_FUNC&&fr==="eval")return function(ei){var Gi=K.getScopeFromName(fr,K.getCurrentScope()),ua=Gi.name===lt||Gi.name===Ja||Gi.name===Ct;return br(new Za(K),ei,!ua)};if(br.__IS_EVAL_FUNC)return function(ei){return br(new Za(K),ei,!0)};if(br.__IS_FUNCTION_FUNC)return function(){for(var ei=arguments.length,Gi=new Array(ei),ua=0;ua<ei;ua++)Gi[ua]=arguments[ua];return br.apply(void 0,[new Za(K)].concat(Gi))};var Pn=K.options.globalContextInFunction;if(R.type==="Identifier"){var ci=K.getIdentifierScope(R);ci.name===Lr&&(Pn=ci.data)}return br.bind(Pn)}}},T.callExpressionHandler=function(R){var K=this,xe=this.createCallFunctionGetter(R.callee),We=R.arguments.map(function(dt){return K.createClosure(dt)});return function(){return xe().apply(void 0,We.map(function(dt){return dt()}))}},T.functionExpressionHandler=function(R){var K=this,xe=this,We=this.source,dt=this.collectDeclVars,mt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var fr=R.id?R.id.name:"",br=R.params.length,Pn=R.params.map(function(ua){return K.createParamNameGetter(ua)}),ci=this.createClosure(R.body),ei=this.collectDeclVars,Gi=this.collectDeclFuncs;return this.collectDeclVars=dt,this.collectDeclFuncs=mt,function(){var ua=xe.getCurrentScope(),Aa=function Ui(){for(var Po=arguments.length,Ss=new Array(Po),xl=0;xl<Po;xl++)Ss[xl]=arguments[xl];xe.callStack.push(""+fr);var rf=xe.getCurrentScope(),Qu=uu(ua,"FunctionScope("+fr+")");xe.setCurrentScope(Qu),xe.addDeclarationsToScope(ei,Gi,Qu),fr&&(Qu.data[fr]=Ui),Qu.data.arguments=arguments,Pn.forEach(function(_u,yo){Qu.data[_u()]=Ss[yo]});var Fc=xe.getCurrentContext();xe.setCurrentContext(this);var Iu=ci();if(xe.setCurrentContext(Fc),xe.setCurrentScope(rf),xe.callStack.pop(),Iu instanceof jr)return Iu.value};return Lc(Aa,fr),Object.defineProperty(Aa,"length",{value:br,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Aa,"toString",{value:function(){return We.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Aa,"valueOf",{value:function(){return We.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Aa}},T.newExpressionHandler=function(R){var K=this,xe=this.source,We=this.createClosure(R.callee),dt=R.arguments.map(function(mt){return K.createClosure(mt)});return function(){var mt=We();if(!Yi(mt)||mt.__IS_EVAL_FUNC){var fr=R.callee,br=xe.slice(fr.start,fr.end);throw K.createInternalThrowError(pa.IsNotConstructor,br,R)}return mt.__IS_FUNCTION_FUNC?mt.apply(void 0,[new Za(K)].concat(dt.map(function(Pn){return Pn()}))):Yo(mt,dt.map(function(Pn){return Pn()}))}},T.memberExpressionHandler=function(R){var K=this.createClosure(R.object),xe=this.createMemberKeyGetter(R);return function(){var We=K(),dt=xe();return We[dt]}},T.thisExpressionHandler=function(R){var K=this;return function(){return K.getCurrentContext()}},T.sequenceExpressionHandler=function(R){var K=this,xe=R.expressions.map(function(We){return K.createClosure(We)});return function(){for(var We,dt=xe.length,mt=0;mt<dt;mt++){var fr=xe[mt];We=fr()}return We}},T.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},T.identifierHandler=function(R){var K=this;return function(){var xe=K.getCurrentScope(),We=K.getScopeDataFromName(R.name,xe);return K.assertVariable(We,R.name,R),We[R.name]}},T.getIdentifierScope=function(R){var K=this.getCurrentScope(),xe=this.getScopeFromName(R.name,K);return xe},T.assignmentExpressionHandler=function(R){var K=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var xe=this.createObjectGetter(R.left),We=this.createNameGetter(R.left),dt=this.createClosure(R.right);return function(){var mt=xe(),fr=We(),br=dt();switch(R.operator!=="="&&K.assertVariable(mt,fr,R),R.operator){case"=":return mt[fr]=br;case"+=":return mt[fr]+=br;case"-=":return mt[fr]-=br;case"*=":return mt[fr]*=br;case"**=":return mt[fr]=Math.pow(mt[fr],br);case"/=":return mt[fr]/=br;case"%=":return mt[fr]%=br;case"<<=":return mt[fr]<<=br;case">>=":return mt[fr]>>=br;case">>>=":return mt[fr]>>>=br;case"&=":return mt[fr]&=br;case"^=":return mt[fr]^=br;case"|=":return mt[fr]|=br;default:throw K.createInternalThrowError(pa.AssignmentExpressionSyntaxError,R.type,R)}}},T.functionDeclarationHandler=function(R){if(R.id){var K=this.functionExpressionHandler(R);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,K)}return function(){return Ft}},T.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(pa.VariableTypeSyntaxError,R.type,R)},T.variableDeclarationHandler=function(R){for(var K=this,xe,We=[],dt=0;dt<R.declarations.length;dt++){var mt=R.declarations[dt];this.varDeclaration(this.getVariableName(mt.id)),mt.init&&We.push({type:"AssignmentExpression",operator:"=",left:mt.id,right:mt.init})}return We.length&&(xe=this.createClosure({type:"BlockStatement",body:We})),function(){if(xe){var fr=K.isVarDeclMode;K.isVarDeclMode=!0,xe(),K.isVarDeclMode=fr}return Ft}},T.assertVariable=function(R,K,xe){if(R===this.globalScope.data&&!(K in R))throw this.createInternalThrowError(pa.VariableUndefinedReferenceError,K,xe)},T.programHandler=function(R){var K=this,xe=R.body.map(function(We){return K.createClosure(We)});return function(){for(var We=Ft,dt=0;dt<xe.length;dt++){var mt=xe[dt],fr=K.setValue(mt());if(fr!==Ft&&(We=fr,We instanceof jr||We instanceof It||We instanceof Fo||We===Q||We===be))break}return We}},T.expressionStatementHandler=function(R){return this.createClosure(R.expression)},T.emptyStatementHandler=function(R){return function(){return Ft}},T.returnStatementHandler=function(R){var K=R.argument?this.createClosure(R.argument):Xs;return function(){return new jr(K())}},T.ifStatementHandler=function(R){var K=this.createClosure(R.test),xe=this.createClosure(R.consequent),We=R.alternate?this.createClosure(R.alternate):function(){return Ft};return function(){return K()?xe():We()}},T.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},T.forStatementHandler=function(R){var K=this,xe=Xs,We=R.test?this.createClosure(R.test):function(){return!0},dt=Xs,mt=this.createClosure(R.body);return R.type==="ForStatement"&&(xe=R.init?this.createClosure(R.init):xe,dt=R.update?this.createClosure(R.update):Xs),function(fr){var br,Pn=Ft,ci=R.type==="DoWhileStatement";for(fr&&fr.type==="LabeledStatement"&&(br=fr.label.name),xe();ci||We();dt()){ci=!1;var ei=K.setValue(mt());if(!(ei===Ft||ei===be)){if(ei===Q)break;if(Pn=ei,Pn instanceof Fo&&Pn.value===br){Pn=Ft;continue}if(Pn instanceof jr||Pn instanceof It||Pn instanceof Fo)break}}return Pn}},T.whileStatementHandler=function(R){return this.forStatementHandler(R)},T.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},T.forInStatementHandler=function(R){var K=this,xe=R.left,We=this.createClosure(R.right),dt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),xe=R.left.declarations[0].id),function(mt){var fr,br=Ft,Pn;mt&&mt.type==="LabeledStatement"&&(fr=mt.label.name);var ci=We();for(Pn in ci){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:xe,right:{type:"Literal",value:Pn}})();var ei=K.setValue(dt());if(!(ei===Ft||ei===be)){if(ei===Q)break;if(br=ei,br instanceof Fo&&br.value===fr){br=Ft;continue}if(br instanceof jr||br instanceof It||br instanceof Fo)break}}return br}},T.withStatementHandler=function(R){var K=this,xe=this.createClosure(R.object),We=this.createClosure(R.body);return function(){var dt=xe(),mt=K.getCurrentScope(),fr=new ae(dt,mt,Lr);K.setCurrentScope(fr);var br=K.setValue(We());return K.setCurrentScope(mt),br}},T.throwStatementHandler=function(R){var K=this,xe=this.createClosure(R.argument);return function(){throw K.setValue(void 0),xe()}},T.tryStatementHandler=function(R){var K=this,xe=this.createClosure(R.block),We=R.handler?this.catchClauseHandler(R.handler):null,dt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var mt=K.getCurrentScope(),fr=K.getCurrentContext(),br=mt.labelStack.concat([]),Pn=K.callStack.concat([]),ci=Ft,ei,Gi,ua=function(){K.setCurrentScope(mt),K.setCurrentContext(fr),mt.labelStack=br,K.callStack=Pn};try{ci=K.setValue(xe()),ci instanceof jr&&(ei=ci)}catch(Aa){if(ua(),K.isInterruptThrow(Aa))throw Aa;if(We)try{ci=K.setValue(We(Aa)),ci instanceof jr&&(ei=ci)}catch(Ui){if(ua(),K.isInterruptThrow(Ui))throw Ui;Gi=Ui}}if(dt)try{ci=dt(),ci instanceof jr&&(ei=ci)}catch(Aa){if(ua(),K.isInterruptThrow(Aa))throw Aa;Gi=Aa}if(Gi)throw Gi;return ei||ci}},T.catchClauseHandler=function(R){var K=this,xe=this.createParamNameGetter(R.param),We=this.createClosure(R.body);return function(dt){var mt,fr=K.getCurrentScope(),br=fr.data,Pn=xe(),ci=Ds.call(br,Pn),ei=br[Pn];return br[Pn]=dt,mt=We(),ci?br[Pn]=ei:delete br[Pn],mt}},T.continueStatementHandler=function(R){return function(){return R.label?new Fo(R.label.name):be}},T.breakStatementHandler=function(R){return function(){return R.label?new It(R.label.name):Q}},T.switchStatementHandler=function(R){var K=this,xe=this.createClosure(R.discriminant),We=R.cases.map(function(dt){return K.switchCaseHandler(dt)});return function(){for(var dt=xe(),mt=!1,fr,br,Pn,ci=0;ci<We.length;ci++){var ei=We[ci](),Gi=ei.testClosure();if(Gi===Je){Pn=ei;continue}if(mt||Gi===dt){if(mt=!0,br=K.setValue(ei.bodyClosure()),br===Ft)continue;if(br===Q||(fr=br,fr instanceof jr||fr instanceof It||fr instanceof Fo||fr===be))break}}if(!mt&&Pn){br=K.setValue(Pn.bodyClosure());var ua=br===Ft||br===Q||br===be;ua||(fr=br)}return fr}},T.switchCaseHandler=function(R){var K=R.test?this.createClosure(R.test):function(){return Je},xe=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:K,bodyClosure:xe}}},T.labeledStatementHandler=function(R){var K=this,xe=R.label.name,We=this.createClosure(R.body);return function(){var dt,mt=K.getCurrentScope();return mt.labelStack.push(xe),dt=We(R),dt instanceof It&&dt.value===xe&&(dt=Ft),mt.labelStack.pop(),dt}},T.debuggerStatementHandler=function(R){return function(){debugger;return Ft}},T.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(pa.ParamTypeSyntaxError,R.type,R)},T.createObjectKeyGetter=function(R){var K;return R.type==="Identifier"?K=function(){return R.name}:K=this.createClosure(R),function(){return K()}},T.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},T.createObjectGetter=function(R){var K=this;switch(R.type){case"Identifier":return function(){return K.getScopeDataFromName(R.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(pa.AssignmentTypeSyntaxError,R.type,R)}},T.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(pa.AssignmentTypeSyntaxError,R.type,R)}},T.varDeclaration=function(R){var K=this.collectDeclVars;K[R]=void 0},T.funcDeclaration=function(R,K){var xe=this.collectDeclFuncs;xe[R]=K},T.addDeclarationsToScope=function(R,K,xe){var We=xe.data;for(var dt in K){var mt=K[dt];We[dt]=mt&&mt()}for(var fr in R)fr in We||(We[fr]=void 0)},T.getScopeValue=function(R,K){var xe=this.getScopeFromName(R,K);return xe.data[R]},T.getScopeDataFromName=function(R,K){return this.getScopeFromName(R,K).data},T.getScopeFromName=function(R,K){var xe=K;do if(R in xe.data)return xe;while(xe=xe.parent);return this.globalScope},T.setValue=function(R){var K=this.callStack.length;return this.isVarDeclMode||K||R===Ft||R===Q||R===be||R instanceof It||R instanceof Fo||(this.value=R instanceof jr?R.value:R),R},T.getValue=function(){return this.value},_}();po.version=su,po.eval=qo,po.Function=Yr,po.ecmaVersion=5,po.globalContextInFunction=void 0,po.global=Object.create(null);function oc(_){return _===void 0&&(_=Object.create(null)),_}function kc(_,T,F){T===void 0&&(T=[]),F===void 0&&(F={});var R=F.parsingContext,K=F.timeout===void 0?0:F.timeout,xe=`
    (function anonymous(`+T.join(",")+`){
         `+_+`
    });
    `,We=new po(R,{ecmaVersion:F.ecmaVersion,timeout:K,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction});return We.evaluate(xe)}function qu(_,T,F){var R=new po(T,F);return R.evaluate(_)}var Dc=qu,jl=function(){function _(F){this._code=F}var T=_.prototype;return T.runInContext=function(R){return qu(this._code,R)},T.runInNewContext=function(R){return qu(this._code,R)},_}(),Ku=function(_,T,F){return qu(_,T,F)};function lu(){for(var _=arguments.length,T=new Array(_),F=0;F<_;F++)T[F]=arguments[F];var R=T.pop();return kc(R||"",T)}var $u=Ku},20396:function(Ot,J,N){var le;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ye,g,ve,V){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ue=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ne=ce||ue,se=["","webkit","Moz","MS","ms","o"],at=Ne?"":g.createElement("div"),Le="function",ut=Math.round,Ht=Math.abs,ur=Date.now;function Pt(Q,be,Je){return setTimeout(xt(Q,Je),be)}function Jt(Q,be,Je){return Array.isArray(Q)?(kt(Q,Je[be],Je),!0):!1}function kt(Q,be,Je){var Ft;if(!!Q)if(Q.forEach)Q.forEach(be,Je);else if(Q.length!==V)for(Ft=0;Ft<Q.length;)be.call(Je,Q[Ft],Ft,Q),Ft++;else for(Ft in Q)Q.hasOwnProperty(Ft)&&be.call(Je,Q[Ft],Ft,Q)}function pt(Q,be,Je){var Ft="DEPRECATED METHOD: "+be+`
`+Je+` AT 
`;return function(){var Lr=new Error("get-stack-trace"),lt=Lr&&Lr.stack?Lr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ct=ye.console&&(ye.console.warn||ye.console.log);return Ct&&Ct.call(ye.console,Ft,lt),Q.apply(this,arguments)}}var gt;typeof Object.assign!="function"?gt=function(be){if(be===V||be===null)throw new TypeError("Cannot convert undefined or null to object");for(var Je=Object(be),Ft=1;Ft<arguments.length;Ft++){var Lr=arguments[Ft];if(Lr!==V&&Lr!==null)for(var lt in Lr)Lr.hasOwnProperty(lt)&&(Je[lt]=Lr[lt])}return Je}:gt=Object.assign;var er=pt(function(be,Je,Ft){for(var Lr=Object.keys(Je),lt=0;lt<Lr.length;)(!Ft||Ft&&be[Lr[lt]]===V)&&(be[Lr[lt]]=Je[Lr[lt]]),lt++;return be},"extend","Use `assign`."),q=pt(function(be,Je){return er(be,Je,!0)},"merge","Use `assign`.");function Qt(Q,be,Je){var Ft=be.prototype,Lr;Lr=Q.prototype=Object.create(Ft),Lr.constructor=Q,Lr._super=Ft,Je&&gt(Lr,Je)}function xt(Q,be){return function(){return Q.apply(be,arguments)}}function rt(Q,be){return typeof Q==Le?Q.apply(be&&be[0]||V,be):Q}function wt(Q,be){return Q===V?be:Q}function et(Q,be,Je){kt(en(be),function(Ft){Q.addEventListener(Ft,Je,!1)})}function $t(Q,be,Je){kt(en(be),function(Ft){Q.removeEventListener(Ft,Je,!1)})}function Sr(Q,be){for(;Q;){if(Q==be)return!0;Q=Q.parentNode}return!1}function kr(Q,be){return Q.indexOf(be)>-1}function en(Q){return Q.trim().split(/\s+/g)}function Te(Q,be,Je){if(Q.indexOf&&!Je)return Q.indexOf(be);for(var Ft=0;Ft<Q.length;){if(Je&&Q[Ft][Je]==be||!Je&&Q[Ft]===be)return Ft;Ft++}return-1}function qe(Q){return Array.prototype.slice.call(Q,0)}function ke(Q,be,Je){for(var Ft=[],Lr=[],lt=0;lt<Q.length;){var Ct=be?Q[lt][be]:Q[lt];Te(Lr,Ct)<0&&Ft.push(Q[lt]),Lr[lt]=Ct,lt++}return Je&&(be?Ft=Ft.sort(function(Yi,Za){return Yi[be]>Za[be]}):Ft=Ft.sort()),Ft}function Mt(Q,be){for(var Je,Ft,Lr=be[0].toUpperCase()+be.slice(1),lt=0;lt<se.length;){if(Je=se[lt],Ft=Je?Je+Lr:be,Ft in Q)return Ft;lt++}return V}var yt=1;function Zt(){return yt++}function qt(Q){var be=Q.ownerDocument||Q;return be.defaultView||be.parentWindow||ye}var Cr=/mobile|tablet|ip(ad|hone|od)|android/i,qn="ontouchstart"in ye,fn=Mt(ye,"PointerEvent")!==V,Hi=qn&&Cr.test(navigator.userAgent),Zn="touch",Hn="pen",pi="mouse",Kn="kinect",ui=25,ra=1,Ri=2,bi=4,Ni=8,aa=1,Ei=2,_a=4,An=8,_i=16,Bi=Ei|_a,Wi=An|_i,za=Bi|Wi,de=["x","y"],Nn=["clientX","clientY"];function Ua(Q,be){var Je=this;this.manager=Q,this.callback=be,this.element=Q.element,this.target=Q.options.inputTarget,this.domHandler=function(Ft){rt(Q.options.enable,[Q])&&Je.handler(Ft)},this.init()}Ua.prototype={handler:function(){},init:function(){this.evEl&&et(this.element,this.evEl,this.domHandler),this.evTarget&&et(this.target,this.evTarget,this.domHandler),this.evWin&&et(qt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$t(this.element,this.evEl,this.domHandler),this.evTarget&&$t(this.target,this.evTarget,this.domHandler),this.evWin&&$t(qt(this.element),this.evWin,this.domHandler)}};function ls(Q){var be,Je=Q.options.inputClass;return Je?be=Je:fn?be=Pe:Hi?be=Ut:qn?be=Lt:be=Ea,new be(Q,Vt)}function Vt(Q,be,Je){var Ft=Je.pointers.length,Lr=Je.changedPointers.length,lt=be&ra&&Ft-Lr==0,Ct=be&(bi|Ni)&&Ft-Lr==0;Je.isFirst=!!lt,Je.isFinal=!!Ct,lt&&(Q.session={}),Je.eventType=be,or(Q,Je),Q.emit("hammer.input",Je),Q.recognize(Je),Q.session.prevInput=Je}function or(Q,be){var Je=Q.session,Ft=be.pointers,Lr=Ft.length;Je.firstInput||(Je.firstInput=ir(be)),Lr>1&&!Je.firstMultiple?Je.firstMultiple=ir(be):Lr===1&&(Je.firstMultiple=!1);var lt=Je.firstInput,Ct=Je.firstMultiple,Ja=Ct?Ct.center:lt.center,Yi=be.center=Dn(Ft);be.timeStamp=ur(),be.deltaTime=be.timeStamp-lt.timeStamp,be.angle=wi(Ja,Yi),be.distance=nn(Ja,Yi),wr(Je,be),be.offsetDirection=Wn(be.deltaX,be.deltaY);var Za=li(be.deltaTime,be.deltaX,be.deltaY);be.overallVelocityX=Za.x,be.overallVelocityY=Za.y,be.overallVelocity=Ht(Za.x)>Ht(Za.y)?Za.x:Za.y,be.scale=Ct?Wa(Ct.pointers,Ft):1,be.rotation=Ct?Ti(Ct.pointers,Ft):0,be.maxPointers=Je.prevInput?be.pointers.length>Je.prevInput.maxPointers?be.pointers.length:Je.prevInput.maxPointers:be.pointers.length,I(Je,be);var qo=Q.element;Sr(be.srcEvent.target,qo)&&(qo=be.srcEvent.target),be.target=qo}function wr(Q,be){var Je=be.center,Ft=Q.offsetDelta||{},Lr=Q.prevDelta||{},lt=Q.prevInput||{};(be.eventType===ra||lt.eventType===bi)&&(Lr=Q.prevDelta={x:lt.deltaX||0,y:lt.deltaY||0},Ft=Q.offsetDelta={x:Je.x,y:Je.y}),be.deltaX=Lr.x+(Je.x-Ft.x),be.deltaY=Lr.y+(Je.y-Ft.y)}function I(Q,be){var Je=Q.lastInterval||be,Ft=be.timeStamp-Je.timeStamp,Lr,lt,Ct,Ja;if(be.eventType!=Ni&&(Ft>ui||Je.velocity===V)){var Yi=be.deltaX-Je.deltaX,Za=be.deltaY-Je.deltaY,qo=li(Ft,Yi,Za);lt=qo.x,Ct=qo.y,Lr=Ht(qo.x)>Ht(qo.y)?qo.x:qo.y,Ja=Wn(Yi,Za),Q.lastInterval=be}else Lr=Je.velocity,lt=Je.velocityX,Ct=Je.velocityY,Ja=Je.direction;be.velocity=Lr,be.velocityX=lt,be.velocityY=Ct,be.direction=Ja}function ir(Q){for(var be=[],Je=0;Je<Q.pointers.length;)be[Je]={clientX:ut(Q.pointers[Je].clientX),clientY:ut(Q.pointers[Je].clientY)},Je++;return{timeStamp:ur(),pointers:be,center:Dn(be),deltaX:Q.deltaX,deltaY:Q.deltaY}}function Dn(Q){var be=Q.length;if(be===1)return{x:ut(Q[0].clientX),y:ut(Q[0].clientY)};for(var Je=0,Ft=0,Lr=0;Lr<be;)Je+=Q[Lr].clientX,Ft+=Q[Lr].clientY,Lr++;return{x:ut(Je/be),y:ut(Ft/be)}}function li(Q,be,Je){return{x:be/Q||0,y:Je/Q||0}}function Wn(Q,be){return Q===be?aa:Ht(Q)>=Ht(be)?Q<0?Ei:_a:be<0?An:_i}function nn(Q,be,Je){Je||(Je=de);var Ft=be[Je[0]]-Q[Je[0]],Lr=be[Je[1]]-Q[Je[1]];return Math.sqrt(Ft*Ft+Lr*Lr)}function wi(Q,be,Je){Je||(Je=de);var Ft=be[Je[0]]-Q[Je[0]],Lr=be[Je[1]]-Q[Je[1]];return Math.atan2(Lr,Ft)*180/Math.PI}function Ti(Q,be){return wi(be[1],be[0],Nn)+wi(Q[1],Q[0],Nn)}function Wa(Q,be){return nn(be[0],be[1],Nn)/nn(Q[0],Q[1],Nn)}var cs={mousedown:ra,mousemove:Ri,mouseup:bi},ha="mousedown",wa="mousemove mouseup";function Ea(){this.evEl=ha,this.evWin=wa,this.pressed=!1,Ua.apply(this,arguments)}Qt(Ea,Ua,{handler:function(be){var Je=cs[be.type];Je&ra&&be.button===0&&(this.pressed=!0),Je&Ri&&be.which!==1&&(Je=bi),!!this.pressed&&(Je&bi&&(this.pressed=!1),this.callback(this.manager,Je,{pointers:[be],changedPointers:[be],pointerType:pi,srcEvent:be}))}});var G={pointerdown:ra,pointermove:Ri,pointerup:bi,pointercancel:Ni,pointerout:Ni},$={2:Zn,3:Hn,4:pi,5:Kn},re="pointerdown",ge="pointermove pointerup pointercancel";!Ne&&ye.MSPointerEvent&&!ye.PointerEvent&&(re="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Pe(){this.evEl=re,this.evWin=ge,Ua.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Qt(Pe,Ua,{handler:function(be){var Je=this.store,Ft=!1,Lr=be.type.toLowerCase().replace("ms",""),lt=G[Lr],Ct=$[be.pointerType]||be.pointerType,Ja=Ct==Zn,Yi=Te(Je,be.pointerId,"pointerId");lt&ra&&(be.button===0||Ja)?Yi<0&&(Je.push(be),Yi=Je.length-1):lt&(bi|Ni)&&(Ft=!0),!(Yi<0)&&(Je[Yi]=be,this.callback(this.manager,lt,{pointers:Je,changedPointers:[be],pointerType:Ct,srcEvent:be}),Ft&&Je.splice(Yi,1))}});var Ge={touchstart:ra,touchmove:Ri,touchend:bi,touchcancel:Ni},ot="touchstart",he="touchstart touchmove touchend touchcancel";function De(){this.evTarget=ot,this.evWin=he,this.started=!1,Ua.apply(this,arguments)}Qt(De,Ua,{handler:function(be){var Je=Ge[be.type];if(Je===ra&&(this.started=!0),!!this.started){var Ft=_t.call(this,be,Je);Je&(bi|Ni)&&Ft[0].length-Ft[1].length==0&&(this.started=!1),this.callback(this.manager,Je,{pointers:Ft[0],changedPointers:Ft[1],pointerType:Zn,srcEvent:be})}}});function _t(Q,be){var Je=qe(Q.touches),Ft=qe(Q.changedTouches);return be&(bi|Ni)&&(Je=ke(Je.concat(Ft),"identifier",!0)),[Je,Ft]}var vr={touchstart:ra,touchmove:Ri,touchend:bi,touchcancel:Ni},Bt="touchstart touchmove touchend touchcancel";function Ut(){this.evTarget=Bt,this.targetIds={},Ua.apply(this,arguments)}Qt(Ut,Ua,{handler:function(be){var Je=vr[be.type],Ft=gr.call(this,be,Je);!Ft||this.callback(this.manager,Je,{pointers:Ft[0],changedPointers:Ft[1],pointerType:Zn,srcEvent:be})}});function gr(Q,be){var Je=qe(Q.touches),Ft=this.targetIds;if(be&(ra|Ri)&&Je.length===1)return Ft[Je[0].identifier]=!0,[Je,Je];var Lr,lt,Ct=qe(Q.changedTouches),Ja=[],Yi=this.target;if(lt=Je.filter(function(Za){return Sr(Za.target,Yi)}),be===ra)for(Lr=0;Lr<lt.length;)Ft[lt[Lr].identifier]=!0,Lr++;for(Lr=0;Lr<Ct.length;)Ft[Ct[Lr].identifier]&&Ja.push(Ct[Lr]),be&(bi|Ni)&&delete Ft[Ct[Lr].identifier],Lr++;if(!!Ja.length)return[ke(lt.concat(Ja),"identifier",!0),Ja]}var _n=2500,ln=25;function Lt(){Ua.apply(this,arguments);var Q=xt(this.handler,this);this.touch=new Ut(this.manager,Q),this.mouse=new Ea(this.manager,Q),this.primaryTouch=null,this.lastTouches=[]}Qt(Lt,Ua,{handler:function(be,Je,Ft){var Lr=Ft.pointerType==Zn,lt=Ft.pointerType==pi;if(!(lt&&Ft.sourceCapabilities&&Ft.sourceCapabilities.firesTouchEvents)){if(Lr)sn.call(this,Je,Ft);else if(lt&&Hr.call(this,Ft))return;this.callback(be,Je,Ft)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function sn(Q,be){Q&ra?(this.primaryTouch=be.changedPointers[0].identifier,Zr.call(this,be)):Q&(bi|Ni)&&Zr.call(this,be)}function Zr(Q){var be=Q.changedPointers[0];if(be.identifier===this.primaryTouch){var Je={x:be.clientX,y:be.clientY};this.lastTouches.push(Je);var Ft=this.lastTouches,Lr=function(){var lt=Ft.indexOf(Je);lt>-1&&Ft.splice(lt,1)};setTimeout(Lr,_n)}}function Hr(Q){for(var be=Q.srcEvent.clientX,Je=Q.srcEvent.clientY,Ft=0;Ft<this.lastTouches.length;Ft++){var Lr=this.lastTouches[Ft],lt=Math.abs(be-Lr.x),Ct=Math.abs(Je-Lr.y);if(lt<=ln&&Ct<=ln)return!0}return!1}var oi=Ne?V:Mt(at.style,"touchAction"),tn=oi!==V,Si="compute",$i="auto",yi="manipulation",Mi="none",xi="pan-x",ti="pan-y",Vi=Pi();function Ta(Q,be){this.manager=Q,this.set(be)}Ta.prototype={set:function(Q){Q==Si&&(Q=this.compute()),tn&&this.manager.element.style&&Vi[Q]&&(this.manager.element.style[oi]=Q),this.actions=Q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Q=[];return kt(this.manager.recognizers,function(be){rt(be.options.enable,[be])&&(Q=Q.concat(be.getTouchAction()))}),na(Q.join(" "))},preventDefaults:function(Q){var be=Q.srcEvent,Je=Q.offsetDirection;if(this.manager.session.prevented){be.preventDefault();return}var Ft=this.actions,Lr=kr(Ft,Mi)&&!Vi[Mi],lt=kr(Ft,ti)&&!Vi[ti],Ct=kr(Ft,xi)&&!Vi[xi];if(Lr){var Ja=Q.pointers.length===1,Yi=Q.distance<2,Za=Q.deltaTime<250;if(Ja&&Yi&&Za)return}if(!(Ct&&lt)&&(Lr||lt&&Je&Bi||Ct&&Je&Wi))return this.preventSrc(be)},preventSrc:function(Q){this.manager.session.prevented=!0,Q.preventDefault()}};function na(Q){if(kr(Q,Mi))return Mi;var be=kr(Q,xi),Je=kr(Q,ti);return be&&Je?Mi:be||Je?be?xi:ti:kr(Q,yi)?yi:$i}function Pi(){if(!tn)return!1;var Q={};if(Ne)return Q;var be=ye.CSS&&ye.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Je){Q[Je]=be?ye.CSS.supports("touch-action",Je):!0}),Q}var zi=1,Ra=2,ou=4,Sa=8,Ca=Sa,Es=16,fs=32;function Ji(Q){this.options=gt({},this.defaults,Q||{}),this.id=Zt(),this.manager=null,this.options.enable=wt(this.options.enable,!0),this.state=zi,this.simultaneous={},this.requireFail=[]}Ji.prototype={defaults:{},set:function(Q){return gt(this.options,Q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Q){if(Jt(Q,"recognizeWith",this))return this;var be=this.simultaneous;return Q=La(Q,this),be[Q.id]||(be[Q.id]=Q,Q.recognizeWith(this)),this},dropRecognizeWith:function(Q){return Jt(Q,"dropRecognizeWith",this)?this:(Q=La(Q,this),delete this.simultaneous[Q.id],this)},requireFailure:function(Q){if(Jt(Q,"requireFailure",this))return this;var be=this.requireFail;return Q=La(Q,this),Te(be,Q)===-1&&(be.push(Q),Q.requireFailure(this)),this},dropRequireFailure:function(Q){if(Jt(Q,"dropRequireFailure",this))return this;Q=La(Q,this);var be=Te(this.requireFail,Q);return be>-1&&this.requireFail.splice(be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Q){return!!this.simultaneous[Q.id]},emit:function(Q){var be=this,Je=this.state;function Ft(Lr){be.manager.emit(Lr,Q)}Je<Sa&&Ft(be.options.event+Xu(Je)),Ft(be.options.event),Q.additionalEvent&&Ft(Q.additionalEvent),Je>=Sa&&Ft(be.options.event+Xu(Je))},tryEmit:function(Q){if(this.canEmit())return this.emit(Q);this.state=fs},canEmit:function(){for(var Q=0;Q<this.requireFail.length;){if(!(this.requireFail[Q].state&(fs|zi)))return!1;Q++}return!0},recognize:function(Q){var be=gt({},Q);if(!rt(this.options.enable,[this,be])){this.reset(),this.state=fs;return}this.state&(Ca|Es|fs)&&(this.state=zi),this.state=this.process(be),this.state&(Ra|ou|Sa|Es)&&this.tryEmit(be)},process:function(Q){},getTouchAction:function(){},reset:function(){}};function Xu(Q){return Q&Es?"cancel":Q&Sa?"end":Q&ou?"move":Q&Ra?"start":""}function fo(Q){return Q==_i?"down":Q==An?"up":Q==Ei?"left":Q==_a?"right":""}function La(Q,be){var Je=be.manager;return Je?Je.get(Q):Q}function $a(){Ji.apply(this,arguments)}Qt($a,Ji,{defaults:{pointers:1},attrTest:function(Q){var be=this.options.pointers;return be===0||Q.pointers.length===be},process:function(Q){var be=this.state,Je=Q.eventType,Ft=be&(Ra|ou),Lr=this.attrTest(Q);return Ft&&(Je&Ni||!Lr)?be|Es:Ft||Lr?Je&bi?be|Sa:be&Ra?be|ou:Ra:fs}});function Xi(){$a.apply(this,arguments),this.pX=null,this.pY=null}Qt(Xi,$a,{defaults:{event:"pan",threshold:10,pointers:1,direction:za},getTouchAction:function(){var Q=this.options.direction,be=[];return Q&Bi&&be.push(ti),Q&Wi&&be.push(xi),be},directionTest:function(Q){var be=this.options,Je=!0,Ft=Q.distance,Lr=Q.direction,lt=Q.deltaX,Ct=Q.deltaY;return Lr&be.direction||(be.direction&Bi?(Lr=lt===0?aa:lt<0?Ei:_a,Je=lt!=this.pX,Ft=Math.abs(Q.deltaX)):(Lr=Ct===0?aa:Ct<0?An:_i,Je=Ct!=this.pY,Ft=Math.abs(Q.deltaY))),Q.direction=Lr,Je&&Ft>be.threshold&&Lr&be.direction},attrTest:function(Q){return $a.prototype.attrTest.call(this,Q)&&(this.state&Ra||!(this.state&Ra)&&this.directionTest(Q))},emit:function(Q){this.pX=Q.deltaX,this.pY=Q.deltaY;var be=fo(Q.direction);be&&(Q.additionalEvent=this.options.event+be),this._super.emit.call(this,Q)}});function Ho(){$a.apply(this,arguments)}Qt(Ho,$a,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Mi]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.scale-1)>this.options.threshold||this.state&Ra)},emit:function(Q){if(Q.scale!==1){var be=Q.scale<1?"in":"out";Q.additionalEvent=this.options.event+be}this._super.emit.call(this,Q)}});function Wo(){Ji.apply(this,arguments),this._timer=null,this._input=null}Qt(Wo,Ji,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[$i]},process:function(Q){var be=this.options,Je=Q.pointers.length===be.pointers,Ft=Q.distance<be.threshold,Lr=Q.deltaTime>be.time;if(this._input=Q,!Ft||!Je||Q.eventType&(bi|Ni)&&!Lr)this.reset();else if(Q.eventType&ra)this.reset(),this._timer=Pt(function(){this.state=Ca,this.tryEmit()},be.time,this);else if(Q.eventType&bi)return Ca;return fs},reset:function(){clearTimeout(this._timer)},emit:function(Q){this.state===Ca&&(Q&&Q.eventType&bi?this.manager.emit(this.options.event+"up",Q):(this._input.timeStamp=ur(),this.manager.emit(this.options.event,this._input)))}});function Yu(){$a.apply(this,arguments)}Qt(Yu,$a,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Mi]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.rotation)>this.options.threshold||this.state&Ra)}});function go(){$a.apply(this,arguments)}Qt(go,$a,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Bi|Wi,pointers:1},getTouchAction:function(){return Xi.prototype.getTouchAction.call(this)},attrTest:function(Q){var be=this.options.direction,Je;return be&(Bi|Wi)?Je=Q.overallVelocity:be&Bi?Je=Q.overallVelocityX:be&Wi&&(Je=Q.overallVelocityY),this._super.attrTest.call(this,Q)&&be&Q.offsetDirection&&Q.distance>this.options.threshold&&Q.maxPointers==this.options.pointers&&Ht(Je)>this.options.velocity&&Q.eventType&bi},emit:function(Q){var be=fo(Q.offsetDirection);be&&this.manager.emit(this.options.event+be,Q),this.manager.emit(this.options.event,Q)}});function Xo(){Ji.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Qt(Xo,Ji,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[yi]},process:function(Q){var be=this.options,Je=Q.pointers.length===be.pointers,Ft=Q.distance<be.threshold,Lr=Q.deltaTime<be.time;if(this.reset(),Q.eventType&ra&&this.count===0)return this.failTimeout();if(Ft&&Lr&&Je){if(Q.eventType!=bi)return this.failTimeout();var lt=this.pTime?Q.timeStamp-this.pTime<be.interval:!0,Ct=!this.pCenter||nn(this.pCenter,Q.center)<be.posThreshold;this.pTime=Q.timeStamp,this.pCenter=Q.center,!Ct||!lt?this.count=1:this.count+=1,this._input=Q;var Ja=this.count%be.taps;if(Ja===0)return this.hasRequireFailures()?(this._timer=Pt(function(){this.state=Ca,this.tryEmit()},be.interval,this),Ra):Ca}return fs},failTimeout:function(){return this._timer=Pt(function(){this.state=fs},this.options.interval,this),fs},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ca&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function pa(Q,be){return be=be||{},be.recognizers=wt(be.recognizers,pa.defaults.preset),new Qa(Q,be)}pa.VERSION="2.0.7",pa.defaults={domEvents:!1,touchAction:Si,enable:!0,inputTarget:null,inputClass:null,preset:[[Yu,{enable:!1}],[Ho,{enable:!1},["rotate"]],[go,{direction:Bi}],[Xi,{direction:Bi},["swipe"]],[Xo],[Xo,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ho=1,Yo=2;function Qa(Q,be){this.options=gt({},pa.defaults,be||{}),this.options.inputTarget=this.options.inputTarget||Q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Q,this.input=ls(this),this.touchAction=new Ta(this,this.options.touchAction),su(this,!0),kt(this.options.recognizers,function(Je){var Ft=this.add(new Je[0](Je[1]));Je[2]&&Ft.recognizeWith(Je[2]),Je[3]&&Ft.requireFailure(Je[3])},this)}Qa.prototype={set:function(Q){return gt(this.options,Q),Q.touchAction&&this.touchAction.update(),Q.inputTarget&&(this.input.destroy(),this.input.target=Q.inputTarget,this.input.init()),this},stop:function(Q){this.session.stopped=Q?Yo:ho},recognize:function(Q){var be=this.session;if(!be.stopped){this.touchAction.preventDefaults(Q);var Je,Ft=this.recognizers,Lr=be.curRecognizer;(!Lr||Lr&&Lr.state&Ca)&&(Lr=be.curRecognizer=null);for(var lt=0;lt<Ft.length;)Je=Ft[lt],be.stopped!==Yo&&(!Lr||Je==Lr||Je.canRecognizeWith(Lr))?Je.recognize(Q):Je.reset(),!Lr&&Je.state&(Ra|ou|Sa)&&(Lr=be.curRecognizer=Je),lt++}},get:function(Q){if(Q instanceof Ji)return Q;for(var be=this.recognizers,Je=0;Je<be.length;Je++)if(be[Je].options.event==Q)return be[Je];return null},add:function(Q){if(Jt(Q,"add",this))return this;var be=this.get(Q.options.event);return be&&this.remove(be),this.recognizers.push(Q),Q.manager=this,this.touchAction.update(),Q},remove:function(Q){if(Jt(Q,"remove",this))return this;if(Q=this.get(Q),Q){var be=this.recognizers,Je=Te(be,Q);Je!==-1&&(be.splice(Je,1),this.touchAction.update())}return this},on:function(Q,be){if(Q!==V&&be!==V){var Je=this.handlers;return kt(en(Q),function(Ft){Je[Ft]=Je[Ft]||[],Je[Ft].push(be)}),this}},off:function(Q,be){if(Q!==V){var Je=this.handlers;return kt(en(Q),function(Ft){be?Je[Ft]&&Je[Ft].splice(Te(Je[Ft],be),1):delete Je[Ft]}),this}},emit:function(Q,be){this.options.domEvents&&Lc(Q,be);var Je=this.handlers[Q]&&this.handlers[Q].slice();if(!(!Je||!Je.length)){be.type=Q,be.preventDefault=function(){be.srcEvent.preventDefault()};for(var Ft=0;Ft<Je.length;)Je[Ft](be),Ft++}},destroy:function(){this.element&&su(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function su(Q,be){var Je=Q.element;if(!!Je.style){var Ft;kt(Q.options.cssProps,function(Lr,lt){Ft=Mt(Je.style,lt),be?(Q.oldCssProps[Ft]=Je.style[Ft],Je.style[Ft]=Lr):Je.style[Ft]=Q.oldCssProps[Ft]||""}),be||(Q.oldCssProps={})}}function Lc(Q,be){if(!Ne){var Je=g.createEvent("Event");Je.initEvent(Q,!0,!0),Je.gesture=be,be.target.dispatchEvent(Je)}}if(!Ne){gt(pa,{INPUT_START:ra,INPUT_MOVE:Ri,INPUT_END:bi,INPUT_CANCEL:Ni,STATE_POSSIBLE:zi,STATE_BEGAN:Ra,STATE_CHANGED:ou,STATE_ENDED:Sa,STATE_RECOGNIZED:Ca,STATE_CANCELLED:Es,STATE_FAILED:fs,DIRECTION_NONE:aa,DIRECTION_LEFT:Ei,DIRECTION_RIGHT:_a,DIRECTION_UP:An,DIRECTION_DOWN:_i,DIRECTION_HORIZONTAL:Bi,DIRECTION_VERTICAL:Wi,DIRECTION_ALL:za,Manager:Qa,Input:Ua,TouchAction:Ta,TouchInput:Ut,MouseInput:Ea,PointerEventInput:Pe,TouchMouseInput:Lt,SingleTouchInput:De,Recognizer:Ji,AttrRecognizer:$a,Tap:Xo,Pan:Xi,Swipe:go,Pinch:Ho,Rotate:Yu,Press:Wo,on:et,off:$t,each:kt,merge:q,extend:er,assign:gt,inherit:Qt,bindFn:xt,prefixed:Mt});var Ds=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Ds.Hammer=pa,le=function(){return pa}.call(J,N,J,Ot),le!==V&&(Ot.exports=le)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ot,J,N){(function(le,ye){Ot.exports=ye(N(18857))})(this,function(le){"use strict";var ye=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},g=function(B,me){for(var ze=Object.keys(me),zt=0;zt<ze.length;++zt)B[ze[zt]]=me[ze[zt]];return B},ve=`
`;function V(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function ce(B){var me=new Error("(regl) "+B);throw console.error(me),me}function ue(B,me){B||ce(me)}function Ne(B){return B?": "+B:""}function se(B,me,ze){B in me||ce("unknown parameter ("+B+")"+Ne(ze)+". possible values: "+Object.keys(me).join())}function at(B,me){ye(B)||ce("invalid parameter type"+Ne(me)+". must be a typed array")}function Le(B,me){switch(me){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function ut(B,me,ze){Le(B,me)||ce("invalid parameter type"+Ne(ze)+". expected "+me+", got "+typeof B)}function Ht(B,me){B>=0&&(B|0)===B||ce("invalid parameter type, ("+B+")"+Ne(me)+". must be a nonnegative integer")}function ur(B,me,ze){me.indexOf(B)<0&&ce("invalid value"+Ne(ze)+". must be one of: "+me)}var Pt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Jt(B){Object.keys(B).forEach(function(me){Pt.indexOf(me)<0&&ce('invalid regl constructor argument "'+me+'". must be one of '+Pt)})}function kt(B,me){for(B=B+"";B.length<me;)B=" "+B;return B}function pt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function gt(B,me){this.number=B,this.line=me,this.errors=[]}function er(B,me,ze){this.file=B,this.line=me,this.message=ze}function q(){var B=new Error,me=(B.stack||B).toString(),ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(me);if(ze)return ze[1];var zt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(me);return zt?zt[1]:"unknown"}function Qt(){var B=new Error,me=(B.stack||B).toString(),ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(me);if(ze)return ze[1];var zt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(me);return zt?zt[1]:"unknown"}function xt(B,me){var ze=B.split(`
`),zt=1,cr=0,Dt={unknown:new pt,0:new pt};Dt.unknown.name=Dt[0].name=me||q(),Dt.unknown.lines.push(new gt(0,""));for(var nr=0;nr<ze.length;++nr){var nt=ze[nr],yr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(nt);if(yr)switch(yr[1]){case"line":var Be=/(\d+)(\s+\d+)?/.exec(yr[2]);Be&&(zt=Be[1]|0,Be[2]&&(cr=Be[2]|0,cr in Dt||(Dt[cr]=new pt)));break;case"define":var Pr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(yr[2]);Pr&&(Dt[cr].name=Pr[1]?V(Pr[2]):Pr[2]);break}Dt[cr].lines.push(new gt(zt++,nt))}return Object.keys(Dt).forEach(function(Ir){var Ur=Dt[Ir];Ur.lines.forEach(function(Er){Ur.index[Er.number]=Er})}),Dt}function rt(B){var me=[];return B.split(`
`).forEach(function(ze){if(!(ze.length<5)){var zt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ze);zt?me.push(new er(zt[1]|0,zt[2]|0,zt[3].trim())):ze.length>0&&me.push(new er("unknown",0,ze))}}),me}function wt(B,me){me.forEach(function(ze){var zt=B[ze.file];if(zt){var cr=zt.index[ze.line];if(cr){cr.errors.push(ze),zt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(ze)})}function et(B,me,ze,zt,cr){if(!B.getShaderParameter(me,B.COMPILE_STATUS)){var Dt=B.getShaderInfoLog(me),nr=zt===B.FRAGMENT_SHADER?"fragment":"vertex";ke(ze,"string",nr+" shader source must be a string",cr);var nt=xt(ze,cr),yr=rt(Dt);wt(nt,yr),Object.keys(nt).forEach(function(Be){var Pr=nt[Be];if(!Pr.hasErrors)return;var Ir=[""],Ur=[""];function Er(Tr,ht){Ir.push(Tr),Ur.push(ht||"")}Er("file number "+Be+": "+Pr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Pr.lines.forEach(function(Tr){if(Tr.errors.length>0){Er(kt(Tr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Er(Tr.line+ve,"color:red; background-color:yellow; font-weight:bold");var ht=0;Tr.errors.forEach(function(Wt){var xr=Wt.message,Nr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(xr);if(Nr){var pr=Nr[1];switch(xr=Nr[2],pr){case"assign":pr="=";break}ht=Math.max(Tr.line.indexOf(pr,ht),0)}else ht=0;Er(kt("| ",6)),Er(kt("^^^",ht+3)+ve,"font-weight:bold"),Er(kt("| ",6)),Er(xr+ve,"font-weight:bold")}),Er(kt("| ",6)+ve)}else Er(kt(Tr.number,4)+"|  "),Er(Tr.line+ve,"color:red")}),typeof document!="undefined"&&!window.chrome?(Ur[0]=Ir.join("%c"),console.log.apply(console,Ur)):console.log(Ir.join(""))}),ue.raise("Error compiling "+nr+" shader, "+nt[0].name)}}function $t(B,me,ze,zt,cr){if(!B.getProgramParameter(me,B.LINK_STATUS)){var Dt=B.getProgramInfoLog(me),nr=xt(ze,cr),nt=xt(zt,cr),yr='Error linking program with vertex shader, "'+nt[0].name+'", and fragment shader "'+nr[0].name+'"';typeof document!="undefined"?console.log("%c"+yr+ve+"%c"+Dt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(yr+ve+Dt),ue.raise(yr)}}function Sr(B){B._commandRef=q()}function kr(B,me,ze,zt){Sr(B);function cr(yr){return yr?zt.id(yr):0}B._fragId=cr(B.static.frag),B._vertId=cr(B.static.vert);function Dt(yr,Be){Object.keys(Be).forEach(function(Pr){yr[zt.id(Pr)]=!0})}var nr=B._uniformSet={};Dt(nr,me.static),Dt(nr,me.dynamic);var nt=B._attributeSet={};Dt(nt,ze.static),Dt(nt,ze.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function en(B,me){var ze=Qt();ce(B+" in command "+(me||q())+(ze==="unknown"?"":" called from "+ze))}function Te(B,me,ze){B||en(me,ze||q())}function qe(B,me,ze,zt){B in me||en("unknown parameter ("+B+")"+Ne(ze)+". possible values: "+Object.keys(me).join(),zt||q())}function ke(B,me,ze,zt){Le(B,me)||en("invalid parameter type"+Ne(ze)+". expected "+me+", got "+typeof B,zt||q())}function Mt(B){B()}function yt(B,me,ze){B.texture?ur(B.texture._texture.internalformat,me,"unsupported texture format for attachment"):ur(B.renderbuffer._renderbuffer.format,ze,"unsupported renderbuffer format for attachment")}var Zt=33071,qt=9728,Cr=9984,qn=9985,fn=9986,Hi=9987,Zn=5120,Hn=5121,pi=5122,Kn=5123,ui=5124,ra=5125,Ri=5126,bi=32819,Ni=32820,aa=33635,Ei=34042,_a=36193,An={};An[Zn]=An[Hn]=1,An[pi]=An[Kn]=An[_a]=An[aa]=An[bi]=An[Ni]=2,An[ui]=An[ra]=An[Ri]=An[Ei]=4;function _i(B,me){return B===Ni||B===bi||B===aa?2:B===Ei?4:An[B]*me}function Bi(B){return!(B&B-1)&&!!B}function Wi(B,me,ze){var zt,cr=me.width,Dt=me.height,nr=me.channels;ue(cr>0&&cr<=ze.maxTextureSize&&Dt>0&&Dt<=ze.maxTextureSize,"invalid texture shape"),(B.wrapS!==Zt||B.wrapT!==Zt)&&ue(Bi(cr)&&Bi(Dt),"incompatible wrap mode for texture, both width and height must be power of 2"),me.mipmask===1?cr!==1&&Dt!==1&&ue(B.minFilter!==Cr&&B.minFilter!==fn&&B.minFilter!==qn&&B.minFilter!==Hi,"min filter requires mipmap"):(ue(Bi(cr)&&Bi(Dt),"texture must be a square power of 2 to support mipmapping"),ue(me.mipmask===(cr<<1)-1,"missing or incomplete mipmap data")),me.type===Ri&&(ze.extensions.indexOf("oes_texture_float_linear")<0&&ue(B.minFilter===qt&&B.magFilter===qt,"filter not supported, must enable oes_texture_float_linear"),ue(!B.genMipmaps,"mipmap generation not supported with float textures"));var nt=me.images;for(zt=0;zt<16;++zt)if(nt[zt]){var yr=cr>>zt,Be=Dt>>zt;ue(me.mipmask&1<<zt,"missing mipmap data");var Pr=nt[zt];if(ue(Pr.width===yr&&Pr.height===Be,"invalid shape for mip images"),ue(Pr.format===me.format&&Pr.internalformat===me.internalformat&&Pr.type===me.type,"incompatible type for mip image"),!Pr.compressed)if(Pr.data){var Ir=Math.ceil(_i(Pr.type,nr)*yr/Pr.unpackAlignment)*Pr.unpackAlignment;ue(Pr.data.byteLength===Ir*Be,"invalid data for image, buffer size is inconsistent with image format")}else Pr.element||Pr.copy}else B.genMipmaps||ue((me.mipmask&1<<zt)==0,"extra mipmap data");me.compressed&&ue(!B.genMipmaps,"mipmap generation for compressed images not supported")}function za(B,me,ze,zt){var cr=B.width,Dt=B.height,nr=B.channels;ue(cr>0&&cr<=zt.maxTextureSize&&Dt>0&&Dt<=zt.maxTextureSize,"invalid texture shape"),ue(cr===Dt,"cube map must be square"),ue(me.wrapS===Zt&&me.wrapT===Zt,"wrap mode not supported by cube map");for(var nt=0;nt<ze.length;++nt){var yr=ze[nt];ue(yr.width===cr&&yr.height===Dt,"inconsistent cube map face shape"),me.genMipmaps&&(ue(!yr.compressed,"can not generate mipmap for compressed textures"),ue(yr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Be=yr.images,Pr=0;Pr<16;++Pr){var Ir=Be[Pr];if(Ir){var Ur=cr>>Pr,Er=Dt>>Pr;ue(yr.mipmask&1<<Pr,"missing mipmap data"),ue(Ir.width===Ur&&Ir.height===Er,"invalid shape for mip images"),ue(Ir.format===B.format&&Ir.internalformat===B.internalformat&&Ir.type===B.type,"incompatible type for mip image"),Ir.compressed||(Ir.data?ue(Ir.data.byteLength===Ur*Er*Math.max(_i(Ir.type,nr),Ir.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ir.element||Ir.copy)}}}}var de=g(ue,{optional:Mt,raise:ce,commandRaise:en,command:Te,parameter:se,commandParameter:qe,constructor:Jt,type:ut,commandType:ke,isTypedArray:at,nni:Ht,oneOf:ur,shaderError:et,linkError:$t,callSite:Qt,saveCommandRef:Sr,saveDrawInfo:kr,framebufferFormat:yt,guessCommand:q,texture2D:Wi,textureCube:za}),Nn=0,Ua=0,ls=5,Vt=6;function or(B,me){this.id=Nn++,this.type=B,this.data=me}function wr(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(B){if(B.length===0)return[];var me=B.charAt(0),ze=B.charAt(B.length-1);if(B.length>1&&me===ze&&(me==='"'||me==="'"))return['"'+wr(B.substr(1,B.length-2))+'"'];var zt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(zt)return I(B.substr(0,zt.index)).concat(I(zt[1])).concat(I(B.substr(zt.index+zt[0].length)));var cr=B.split(".");if(cr.length===1)return['"'+wr(B)+'"'];for(var Dt=[],nr=0;nr<cr.length;++nr)Dt=Dt.concat(I(cr[nr]));return Dt}function ir(B){return"["+I(B).join("][")+"]"}function Dn(B,me){return new or(B,ir(me+""))}function li(B){return typeof B=="function"&&!B._reglType||B instanceof or}function Wn(B,me){if(typeof B=="function")return new or(Ua,B);if(typeof B=="number"||typeof B=="boolean")return new or(ls,B);if(Array.isArray(B))return new or(Vt,B.map(function(ze,zt){return Wn(ze,me+"["+zt+"]")}));if(B instanceof or)return B;de(!1,"invalid option type in uniform "+me)}var nn={DynamicVariable:or,define:Dn,isDynamic:li,unbox:Wn,accessor:ir},wi={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Ti=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Wa=Ti?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function cs(){var B={"":0},me=[""];return{id:function(ze){var zt=B[ze];return zt||(zt=B[ze]=me.length,me.push(ze),zt)},str:function(ze){return me[ze]}}}function ha(B,me,ze){var zt=document.createElement("canvas");g(zt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(zt),B===document.body&&(zt.style.position="absolute",g(B.style,{margin:0,padding:0}));function cr(){var nt=window.innerWidth,yr=window.innerHeight;if(B!==document.body){var Be=zt.getBoundingClientRect();nt=Be.right-Be.left,yr=Be.bottom-Be.top}zt.width=ze*nt,zt.height=ze*yr}var Dt;B!==document.body&&typeof ResizeObserver=="function"?(Dt=new ResizeObserver(function(){setTimeout(cr)}),Dt.observe(B)):window.addEventListener("resize",cr,!1);function nr(){Dt?Dt.disconnect():window.removeEventListener("resize",cr),B.removeChild(zt)}return cr(),{canvas:zt,onDestroy:nr}}function wa(B,me){function ze(zt){try{return B.getContext(zt,me)}catch(cr){return null}}return ze("webgl")||ze("experimental-webgl")||ze("webgl-experimental")}function Ea(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function G(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function $(B){return typeof B=="string"?B.split():(de(Array.isArray(B),"invalid extension array"),B)}function re(B){return typeof B=="string"?(de(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ge(B){var me=B||{},ze,zt,cr,Dt,nr={},nt=[],yr=[],Be=typeof window=="undefined"?1:window.devicePixelRatio,Pr=!1,Ir=function(Tr){Tr&&de.raise(Tr)},Ur=function(){};if(typeof me=="string"?(de(typeof document!="undefined","selector queries only supported in DOM environments"),ze=document.querySelector(me),de(ze,"invalid query string for element")):typeof me=="object"?Ea(me)?ze=me:G(me)?(Dt=me,cr=Dt.canvas):(de.constructor(me),"gl"in me?Dt=me.gl:"canvas"in me?cr=re(me.canvas):"container"in me&&(zt=re(me.container)),"attributes"in me&&(nr=me.attributes,de.type(nr,"object","invalid context attributes")),"extensions"in me&&(nt=$(me.extensions)),"optionalExtensions"in me&&(yr=$(me.optionalExtensions)),"onDone"in me&&(de.type(me.onDone,"function","invalid or missing onDone callback"),Ir=me.onDone),"profile"in me&&(Pr=!!me.profile),"pixelRatio"in me&&(Be=+me.pixelRatio,de(Be>0,"invalid pixel ratio"))):de.raise("invalid arguments to regl"),ze&&(ze.nodeName.toLowerCase()==="canvas"?cr=ze:zt=ze),!Dt){if(!cr){de(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Er=ha(zt||document.body,Ir,Be);if(!Er)return null;cr=Er.canvas,Ur=Er.onDestroy}nr.premultipliedAlpha===void 0&&(nr.premultipliedAlpha=!0),Dt=wa(cr,nr)}return Dt?{gl:Dt,canvas:cr,container:zt,extensions:nt,optionalExtensions:yr,pixelRatio:Be,profile:Pr,onDone:Ir,onDestroy:Ur}:(Ur(),Ir("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Pe(B,me){var ze={};function zt(nt){de.type(nt,"string","extension name must be string");var yr=nt.toLowerCase(),Be;try{Be=ze[yr]=cr(nt)}catch(Pr){}return!!Be}function cr(nt){return B.getExtension(nt)?B.getExtension(nt):B.getExtension(nt.toLowerCase())?B.getExtension(nt.toLowerCase()):null}for(var Dt=0;Dt<me.extensions.length;++Dt){var nr=me.extensions[Dt];if(!zt(nr))return me.onDestroy(),me.onDone('"'+nr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return me.optionalExtensions.forEach(zt),{extensions:ze,restore:function(){Object.keys(ze).forEach(function(nt){if(ze[nt]&&!zt(nt))throw new Error("(regl): error restoring extension "+nt)})}}}function Ge(B,me){for(var ze=Array(B),zt=0;zt<B;++zt)ze[zt]=me(zt);return ze}var ot=5120,he=5121,De=5122,_t=5123,vr=5124,Bt=5125,Ut=5126;function gr(B){for(var me=16;me<=1<<28;me*=16)if(B<=me)return me;return 0}function _n(B){var me,ze;return me=(B>65535)<<4,B>>>=me,ze=(B>255)<<3,B>>>=ze,me|=ze,ze=(B>15)<<2,B>>>=ze,me|=ze,ze=(B>3)<<1,B>>>=ze,me|=ze,me|B>>1}function ln(){var B=Ge(8,function(){return[]});function me(Dt){var nr=gr(Dt),nt=B[_n(nr)>>2];return nt.length>0?nt.pop():new ArrayBuffer(nr)}function ze(Dt){B[_n(Dt.byteLength)>>2].push(Dt)}function zt(Dt,nr){var nt=null;switch(Dt){case ot:nt=new Int8Array(me(nr),0,nr);break;case he:nt=new Uint8Array(me(nr),0,nr);break;case De:nt=new Int16Array(me(2*nr),0,nr);break;case _t:nt=new Uint16Array(me(2*nr),0,nr);break;case vr:nt=new Int32Array(me(4*nr),0,nr);break;case Bt:nt=new Uint32Array(me(4*nr),0,nr);break;case Ut:nt=new Float32Array(me(4*nr),0,nr);break;default:return null}return nt.length!==nr?nt.subarray(0,nr):nt}function cr(Dt){ze(Dt.buffer)}return{alloc:me,free:ze,allocType:zt,freeType:cr}}var Lt=ln();Lt.zero=ln();var sn=3408,Zr=3410,Hr=3411,oi=3412,tn=3413,Si=3414,$i=3415,yi=33901,Mi=33902,xi=3379,ti=3386,Vi=34921,Ta=36347,na=36348,Pi=35661,zi=35660,Ra=34930,ou=36349,Sa=34076,Ca=34024,Es=7936,fs=7937,Ji=7938,Xu=35724,fo=34047,La=36063,$a=34852,Xi=3553,Ho=34067,Wo=34069,Yu=33984,go=6408,Xo=5126,pa=5121,ho=36160,Yo=36053,Qa=36064,su=16384,Lc=function(B,me){var ze=1;me.ext_texture_filter_anisotropic&&(ze=B.getParameter(fo));var zt=1,cr=1;me.webgl_draw_buffers&&(zt=B.getParameter($a),cr=B.getParameter(La));var Dt=!!me.oes_texture_float;if(Dt){var nr=B.createTexture();B.bindTexture(Xi,nr),B.texImage2D(Xi,0,go,1,1,0,go,Xo,null);var nt=B.createFramebuffer();if(B.bindFramebuffer(ho,nt),B.framebufferTexture2D(ho,Qa,Xi,nr,0),B.bindTexture(Xi,null),B.checkFramebufferStatus(ho)!==Yo)Dt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(su);var yr=Lt.allocType(Xo,4);B.readPixels(0,0,1,1,go,Xo,yr),B.getError()?Dt=!1:(B.deleteFramebuffer(nt),B.deleteTexture(nr),Dt=yr[0]===1),Lt.freeType(yr)}}var Be=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Pr=!0;if(!Be){var Ir=B.createTexture(),Ur=Lt.allocType(pa,36);B.activeTexture(Yu),B.bindTexture(Ho,Ir),B.texImage2D(Wo,0,go,3,3,0,go,pa,Ur),Lt.freeType(Ur),B.bindTexture(Ho,null),B.deleteTexture(Ir),Pr=!B.getError()}return{colorBits:[B.getParameter(Zr),B.getParameter(Hr),B.getParameter(oi),B.getParameter(tn)],depthBits:B.getParameter(Si),stencilBits:B.getParameter($i),subpixelBits:B.getParameter(sn),extensions:Object.keys(me).filter(function(Er){return!!me[Er]}),maxAnisotropic:ze,maxDrawbuffers:zt,maxColorAttachments:cr,pointSizeDims:B.getParameter(yi),lineWidthDims:B.getParameter(Mi),maxViewportDims:B.getParameter(ti),maxCombinedTextureUnits:B.getParameter(Pi),maxCubeMapSize:B.getParameter(Sa),maxRenderbufferSize:B.getParameter(Ca),maxTextureUnits:B.getParameter(Ra),maxTextureSize:B.getParameter(xi),maxAttributes:B.getParameter(Vi),maxVertexUniforms:B.getParameter(Ta),maxVertexTextureUnits:B.getParameter(zi),maxVaryingVectors:B.getParameter(na),maxFragmentUniforms:B.getParameter(ou),glsl:B.getParameter(Xu),renderer:B.getParameter(fs),vendor:B.getParameter(Es),version:B.getParameter(Ji),readFloat:Dt,npotTextureCube:Pr}};function Ds(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||ye(B.data))}var Q=function(B){return Object.keys(B).map(function(me){return B[me]})},be={shape:Ja,flatten:Ct};function Je(B,me,ze){for(var zt=0;zt<me;++zt)ze[zt]=B[zt]}function Ft(B,me,ze,zt){for(var cr=0,Dt=0;Dt<me;++Dt)for(var nr=B[Dt],nt=0;nt<ze;++nt)zt[cr++]=nr[nt]}function Lr(B,me,ze,zt,cr,Dt){for(var nr=Dt,nt=0;nt<me;++nt)for(var yr=B[nt],Be=0;Be<ze;++Be)for(var Pr=yr[Be],Ir=0;Ir<zt;++Ir)cr[nr++]=Pr[Ir]}function lt(B,me,ze,zt,cr){for(var Dt=1,nr=ze+1;nr<me.length;++nr)Dt*=me[nr];var nt=me[ze];if(me.length-ze==4){var yr=me[ze+1],Be=me[ze+2],Pr=me[ze+3];for(nr=0;nr<nt;++nr)Lr(B[nr],yr,Be,Pr,zt,cr),cr+=Dt}else for(nr=0;nr<nt;++nr)lt(B[nr],me,ze+1,zt,cr),cr+=Dt}function Ct(B,me,ze,zt){var cr=1;if(me.length)for(var Dt=0;Dt<me.length;++Dt)cr*=me[Dt];else cr=0;var nr=zt||Lt.allocType(ze,cr);switch(me.length){case 0:break;case 1:Je(B,me[0],nr);break;case 2:Ft(B,me[0],me[1],nr);break;case 3:Lr(B,me[0],me[1],me[2],nr,0);break;default:lt(B,me,0,nr,0)}return nr}function Ja(B){for(var me=[],ze=B;ze.length;ze=ze[0])me.push(ze.length);return me}var Yi={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Za=5120,qo=5122,Yr=5124,jr=5121,It=5123,Fo=5125,ae=5126,Xs=5126,uu={int8:Za,int16:qo,int32:Yr,uint8:jr,uint16:It,uint32:Fo,float:ae,float32:Xs},hs=35048,ia=35040,po={dynamic:hs,stream:ia,static:35044},oc=be.flatten,kc=be.shape,qu=35044,Dc=35040,jl=5121,Ku=5126,lu=[];lu[5120]=1,lu[5122]=2,lu[5124]=4,lu[5121]=1,lu[5123]=2,lu[5125]=4,lu[5126]=4;function $u(B){return Yi[Object.prototype.toString.call(B)]|0}function _(B,me){for(var ze=0;ze<me.length;++ze)B[ze]=me[ze]}function T(B,me,ze,zt,cr,Dt,nr){for(var nt=0,yr=0;yr<ze;++yr)for(var Be=0;Be<zt;++Be)B[nt++]=me[cr*yr+Dt*Be+nr]}function F(B,me,ze,zt){var cr=0,Dt={};function nr(ht){this.id=cr++,this.buffer=B.createBuffer(),this.type=ht,this.usage=qu,this.byteLength=0,this.dimension=1,this.dtype=jl,this.persistentData=null,ze.profile&&(this.stats={size:0})}nr.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},nr.prototype.destroy=function(){Ur(this)};var nt=[];function yr(ht,Wt){var xr=nt.pop();return xr||(xr=new nr(ht)),xr.bind(),Ir(xr,Wt,Dc,0,1,!1),xr}function Be(ht){nt.push(ht)}function Pr(ht,Wt,xr){ht.byteLength=Wt.byteLength,B.bufferData(ht.type,Wt,xr)}function Ir(ht,Wt,xr,Nr,pr,Or){var Kr;if(ht.usage=xr,Array.isArray(Wt)){if(ht.dtype=Nr||Ku,Wt.length>0){var Bn;if(Array.isArray(Wt[0])){Kr=kc(Wt);for(var rr=1,ar=1;ar<Kr.length;++ar)rr*=Kr[ar];ht.dimension=rr,Bn=oc(Wt,Kr,ht.dtype),Pr(ht,Bn,xr),Or?ht.persistentData=Bn:Lt.freeType(Bn)}else if(typeof Wt[0]=="number"){ht.dimension=pr;var xn=Lt.allocType(ht.dtype,Wt.length);_(xn,Wt),Pr(ht,xn,xr),Or?ht.persistentData=xn:Lt.freeType(xn)}else ye(Wt[0])?(ht.dimension=Wt[0].length,ht.dtype=Nr||$u(Wt[0])||Ku,Bn=oc(Wt,[Wt.length,Wt[0].length],ht.dtype),Pr(ht,Bn,xr),Or?ht.persistentData=Bn:Lt.freeType(Bn)):de.raise("invalid buffer data")}}else if(ye(Wt))ht.dtype=Nr||$u(Wt),ht.dimension=pr,Pr(ht,Wt,xr),Or&&(ht.persistentData=new Uint8Array(new Uint8Array(Wt.buffer)));else if(Ds(Wt)){Kr=Wt.shape;var Vr=Wt.stride,Ar=Wt.offset,Gr=0,Jr=0,vi=0,ii=0;Kr.length===1?(Gr=Kr[0],Jr=1,vi=Vr[0],ii=0):Kr.length===2?(Gr=Kr[0],Jr=Kr[1],vi=Vr[0],ii=Vr[1]):de.raise("invalid shape"),ht.dtype=Nr||$u(Wt.data)||Ku,ht.dimension=Jr;var Wr=Lt.allocType(ht.dtype,Gr*Jr);T(Wr,Wt.data,Gr,Jr,vi,ii,Ar),Pr(ht,Wr,xr),Or?ht.persistentData=Wr:Lt.freeType(Wr)}else Wt instanceof ArrayBuffer?(ht.dtype=jl,ht.dimension=pr,Pr(ht,Wt,xr),Or&&(ht.persistentData=new Uint8Array(new Uint8Array(Wt)))):de.raise("invalid buffer data")}function Ur(ht){me.bufferCount--,zt(ht);var Wt=ht.buffer;de(Wt,"buffer must not be deleted already"),B.deleteBuffer(Wt),ht.buffer=null,delete Dt[ht.id]}function Er(ht,Wt,xr,Nr){me.bufferCount++;var pr=new nr(Wt);Dt[pr.id]=pr;function Or(rr){var ar=qu,xn=null,Vr=0,Ar=0,Gr=1;return Array.isArray(rr)||ye(rr)||Ds(rr)||rr instanceof ArrayBuffer?xn=rr:typeof rr=="number"?Vr=rr|0:rr&&(de.type(rr,"object","buffer arguments must be an object, a number or an array"),"data"in rr&&(de(xn===null||Array.isArray(xn)||ye(xn)||Ds(xn),"invalid data for buffer"),xn=rr.data),"usage"in rr&&(de.parameter(rr.usage,po,"invalid buffer usage"),ar=po[rr.usage]),"type"in rr&&(de.parameter(rr.type,uu,"invalid buffer type"),Ar=uu[rr.type]),"dimension"in rr&&(de.type(rr.dimension,"number","invalid dimension"),Gr=rr.dimension|0),"length"in rr&&(de.nni(Vr,"buffer length must be a nonnegative integer"),Vr=rr.length|0)),pr.bind(),xn?Ir(pr,xn,ar,Ar,Gr,Nr):(Vr&&B.bufferData(pr.type,Vr,ar),pr.dtype=Ar||jl,pr.usage=ar,pr.dimension=Gr,pr.byteLength=Vr),ze.profile&&(pr.stats.size=pr.byteLength*lu[pr.dtype]),Or}function Kr(rr,ar){de(ar+rr.byteLength<=pr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+rr.byteLength+" starting from offset "+ar+" to a buffer of size "+pr.byteLength),B.bufferSubData(pr.type,ar,rr)}function Bn(rr,ar){var xn=(ar||0)|0,Vr;if(pr.bind(),ye(rr)||rr instanceof ArrayBuffer)Kr(rr,xn);else if(Array.isArray(rr)){if(rr.length>0)if(typeof rr[0]=="number"){var Ar=Lt.allocType(pr.dtype,rr.length);_(Ar,rr),Kr(Ar,xn),Lt.freeType(Ar)}else if(Array.isArray(rr[0])||ye(rr[0])){Vr=kc(rr);var Gr=oc(rr,Vr,pr.dtype);Kr(Gr,xn),Lt.freeType(Gr)}else de.raise("invalid buffer data")}else if(Ds(rr)){Vr=rr.shape;var Jr=rr.stride,vi=0,ii=0,Wr=0,an=0;Vr.length===1?(vi=Vr[0],ii=1,Wr=Jr[0],an=0):Vr.length===2?(vi=Vr[0],ii=Vr[1],Wr=Jr[0],an=Jr[1]):de.raise("invalid shape");var Jn=Array.isArray(rr.data)?pr.dtype:$u(rr.data),fi=Lt.allocType(Jn,vi*ii);T(fi,rr.data,vi,ii,Wr,an,rr.offset),Kr(fi,xn),Lt.freeType(fi)}else de.raise("invalid data for buffer subdata");return Or}return xr||Or(ht),Or._reglType="buffer",Or._buffer=pr,Or.subdata=Bn,ze.profile&&(Or.stats=pr.stats),Or.destroy=function(){Ur(pr)},Or}function Tr(){Q(Dt).forEach(function(ht){ht.buffer=B.createBuffer(),B.bindBuffer(ht.type,ht.buffer),B.bufferData(ht.type,ht.persistentData||ht.byteLength,ht.usage)})}return ze.profile&&(me.getTotalBufferSize=function(){var ht=0;return Object.keys(Dt).forEach(function(Wt){ht+=Dt[Wt].stats.size}),ht}),{create:Er,createStream:yr,destroyStream:Be,clear:function(){Q(Dt).forEach(Ur),nt.forEach(Ur)},getBuffer:function(ht){return ht&&ht._buffer instanceof nr?ht._buffer:null},restore:Tr,_initBuffer:Ir}}var R=0,K=0,xe=1,We=1,dt=4,mt=4,fr={points:R,point:K,lines:xe,line:We,triangles:dt,triangle:mt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},br=0,Pn=1,ci=4,ei=5120,Gi=5121,ua=5122,Aa=5123,Ui=5124,Po=5125,Ss=34963,xl=35040,rf=35044;function Qu(B,me,ze,zt){var cr={},Dt=0,nr={uint8:Gi,uint16:Aa};me.oes_element_index_uint&&(nr.uint32=Po);function nt(Tr){this.id=Dt++,cr[this.id]=this,this.buffer=Tr,this.primType=ci,this.vertCount=0,this.type=0}nt.prototype.bind=function(){this.buffer.bind()};var yr=[];function Be(Tr){var ht=yr.pop();return ht||(ht=new nt(ze.create(null,Ss,!0,!1)._buffer)),Ir(ht,Tr,xl,-1,-1,0,0),ht}function Pr(Tr){yr.push(Tr)}function Ir(Tr,ht,Wt,xr,Nr,pr,Or){Tr.buffer.bind();var Kr;if(ht){var Bn=Or;!Or&&(!ye(ht)||Ds(ht)&&!ye(ht.data))&&(Bn=me.oes_element_index_uint?Po:Aa),ze._initBuffer(Tr.buffer,ht,Wt,Bn,3)}else B.bufferData(Ss,pr,Wt),Tr.buffer.dtype=Kr||Gi,Tr.buffer.usage=Wt,Tr.buffer.dimension=3,Tr.buffer.byteLength=pr;if(Kr=Or,!Or){switch(Tr.buffer.dtype){case Gi:case ei:Kr=Gi;break;case Aa:case ua:Kr=Aa;break;case Po:case Ui:Kr=Po;break;default:de.raise("unsupported type for element array")}Tr.buffer.dtype=Kr}Tr.type=Kr,de(Kr!==Po||!!me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var rr=Nr;rr<0&&(rr=Tr.buffer.byteLength,Kr===Aa?rr>>=1:Kr===Po&&(rr>>=2)),Tr.vertCount=rr;var ar=xr;if(xr<0){ar=ci;var xn=Tr.buffer.dimension;xn===1&&(ar=br),xn===2&&(ar=Pn),xn===3&&(ar=ci)}Tr.primType=ar}function Ur(Tr){zt.elementsCount--,de(Tr.buffer!==null,"must not double destroy elements"),delete cr[Tr.id],Tr.buffer.destroy(),Tr.buffer=null}function Er(Tr,ht){var Wt=ze.create(null,Ss,!0),xr=new nt(Wt._buffer);zt.elementsCount++;function Nr(pr){if(!pr)Wt(),xr.primType=ci,xr.vertCount=0,xr.type=Gi;else if(typeof pr=="number")Wt(pr),xr.primType=ci,xr.vertCount=pr|0,xr.type=Gi;else{var Or=null,Kr=rf,Bn=-1,rr=-1,ar=0,xn=0;Array.isArray(pr)||ye(pr)||Ds(pr)?Or=pr:(de.type(pr,"object","invalid arguments for elements"),"data"in pr&&(Or=pr.data,de(Array.isArray(Or)||ye(Or)||Ds(Or),"invalid data for element buffer")),"usage"in pr&&(de.parameter(pr.usage,po,"invalid element buffer usage"),Kr=po[pr.usage]),"primitive"in pr&&(de.parameter(pr.primitive,fr,"invalid element buffer primitive"),Bn=fr[pr.primitive]),"count"in pr&&(de(typeof pr.count=="number"&&pr.count>=0,"invalid vertex count for elements"),rr=pr.count|0),"type"in pr&&(de.parameter(pr.type,nr,"invalid buffer type"),xn=nr[pr.type]),"length"in pr?ar=pr.length|0:(ar=rr,xn===Aa||xn===ua?ar*=2:(xn===Po||xn===Ui)&&(ar*=4))),Ir(xr,Or,Kr,Bn,rr,ar,xn)}return Nr}return Nr(Tr),Nr._reglType="elements",Nr._elements=xr,Nr.subdata=function(pr,Or){return Wt.subdata(pr,Or),Nr},Nr.destroy=function(){Ur(xr)},Nr}return{create:Er,createStream:Be,destroyStream:Pr,getElements:function(Tr){return typeof Tr=="function"&&Tr._elements instanceof nt?Tr._elements:null},clear:function(){Q(cr).forEach(Ur)}}}var Fc=new Float32Array(1),Iu=new Uint32Array(Fc.buffer),_u=5123;function yo(B){for(var me=Lt.allocType(_u,B.length),ze=0;ze<B.length;++ze)if(isNaN(B[ze]))me[ze]=65535;else if(B[ze]===Infinity)me[ze]=31744;else if(B[ze]===-Infinity)me[ze]=64512;else{Fc[0]=B[ze];var zt=Iu[0],cr=zt>>>31<<15,Dt=(zt<<1>>>24)-127,nr=zt>>13&(1<<10)-1;if(Dt<-24)me[ze]=cr;else if(Dt<-14){var nt=-14-Dt;me[ze]=cr+(nr+(1<<10)>>nt)}else Dt>15?me[ze]=cr+31744:me[ze]=cr+(Dt+15<<10)+nr}return me}function la(B){return Array.isArray(B)||ye(B)}var bh=function(B){return!(B&B-1)&&!!B},Eh=34467,ao=3553,Vf=34067,xu=34069,Fs=6408,Bc=6406,bl=6407,xa=6409,Vl=6410,sc=32854,rs=32855,Gf=36194,Sh=32819,Ch=32820,nf=33635,El=34042,Bo=6402,Ou=34041,Ju=35904,No=35906,Gl=36193,el=33776,Ys=33777,af=33778,of=33779,sf=35986,tl=35987,uc=34798,Nc=35840,uf=35841,zc=35842,Ah=35843,Uc=36196,Sl=5121,lf=5123,cf=5125,Ru=5126,ff=10242,Hf=10243,wh=10497,Hl=33071,np=33648,ns=10240,ja=10241,lc=9728,Wl=9729,cu=9984,ki=9985,Ma=9986,Bs=9987,hf=33170,Cl=4352,pf=4353,ip=4354,ap=34046,Zc=3317,cc=37440,rl=37441,Io=37443,fc=37444,hc=33984,Xa=[cu,Ma,ki,Bs],vn=[0,xa,Vl,bl,Fs],eo={};eo[xa]=eo[Bc]=eo[Bo]=1,eo[Ou]=eo[Vl]=2,eo[bl]=eo[Ju]=3,eo[Fs]=eo[No]=4;function nl(B){return"[object "+B+"]"}var il=nl("HTMLCanvasElement"),bu=nl("OffscreenCanvas"),Ns=nl("CanvasRenderingContext2D"),Wf=nl("ImageBitmap"),qr=nl("HTMLImageElement"),df=nl("HTMLVideoElement"),Xf=Object.keys(Yi).concat([il,bu,Ns,Wf,qr,df]),Lu=[];Lu[Sl]=1,Lu[Ru]=4,Lu[Gl]=2,Lu[lf]=2,Lu[cf]=4;var Ba=[];Ba[sc]=2,Ba[rs]=2,Ba[Gf]=2,Ba[Ou]=4,Ba[el]=.5,Ba[Ys]=.5,Ba[af]=1,Ba[of]=1,Ba[sf]=.5,Ba[tl]=1,Ba[uc]=1,Ba[Nc]=.5,Ba[uf]=.25,Ba[zc]=.5,Ba[Ah]=.25,Ba[Uc]=.5;function zs(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function vf(B){if(!Array.isArray(B))return!1;var me=B.length;return!(me===0||!la(B[0]))}function ku(B){return Object.prototype.toString.call(B)}function Is(B){return ku(B)===il}function _o(B){return ku(B)===bu}function Th(B){return ku(B)===Ns}function da(B){return ku(B)===Wf}function Yf(B){return ku(B)===qr}function Mh(B){return ku(B)===df}function qs(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(me&&B&&B.getContext)}function Os(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(me&&B&&"src"in B&&"crossOrigin"in B)}function Ii(B){if(!B)return!1;if(qs(B)||Os(B))return!0;var me=ku(B);return Xf.indexOf(me)>=0?!0:zs(B)||vf(B)||Ds(B)}function Eu(B){return Yi[Object.prototype.toString.call(B)]|0}function ca(B,me){var ze=me.length;switch(B.type){case Sl:case lf:case cf:case Ru:var zt=Lt.allocType(B.type,ze);zt.set(me),B.data=zt;break;case Gl:B.data=yo(me);break;default:de.raise("unsupported texture type, must specify a typed array")}}function oo(B,me){return Lt.allocType(B.type===Gl?Ru:B.type,me)}function Us(B,me){B.type===Gl?(B.data=yo(me),Lt.freeType(me)):B.data=me}function fu(B,me,ze,zt,cr,Dt){for(var nr=B.width,nt=B.height,yr=B.channels,Be=nr*nt*yr,Pr=oo(B,Be),Ir=0,Ur=0;Ur<nt;++Ur)for(var Er=0;Er<nr;++Er)for(var Tr=0;Tr<yr;++Tr)Pr[Ir++]=me[ze*Er+zt*Ur+cr*Tr+Dt];Us(B,Pr)}function Zs(B,me,ze,zt,cr,Dt){var nr;if(typeof Ba[B]!="undefined"?nr=Ba[B]:nr=eo[B]*Lu[me],Dt&&(nr*=6),cr){for(var nt=0,yr=ze;yr>=1;)nt+=nr*yr*yr,yr/=2;return nt}else return nr*ze*zt}function ps(B,me,ze,zt,cr,Dt,nr){var nt={"don't care":Cl,"dont care":Cl,nice:ip,fast:pf},yr={repeat:wh,clamp:Hl,mirror:np},Be={nearest:lc,linear:Wl},Pr=g({mipmap:Bs,"nearest mipmap nearest":cu,"linear mipmap nearest":ki,"nearest mipmap linear":Ma,"linear mipmap linear":Bs},Be),Ir={none:0,browser:fc},Ur={uint8:Sl,rgba4:Sh,rgb565:nf,"rgb5 a1":Ch},Er={alpha:Bc,luminance:xa,"luminance alpha":Vl,rgb:bl,rgba:Fs,rgba4:sc,"rgb5 a1":rs,rgb565:Gf},Tr={};me.ext_srgb&&(Er.srgb=Ju,Er.srgba=No),me.oes_texture_float&&(Ur.float32=Ur.float=Ru),me.oes_texture_half_float&&(Ur.float16=Ur["half float"]=Gl),me.webgl_depth_texture&&(g(Er,{depth:Bo,"depth stencil":Ou}),g(Ur,{uint16:lf,uint32:cf,"depth stencil":El})),me.webgl_compressed_texture_s3tc&&g(Tr,{"rgb s3tc dxt1":el,"rgba s3tc dxt1":Ys,"rgba s3tc dxt3":af,"rgba s3tc dxt5":of}),me.webgl_compressed_texture_atc&&g(Tr,{"rgb atc":sf,"rgba atc explicit alpha":tl,"rgba atc interpolated alpha":uc}),me.webgl_compressed_texture_pvrtc&&g(Tr,{"rgb pvrtc 4bppv1":Nc,"rgb pvrtc 2bppv1":uf,"rgba pvrtc 4bppv1":zc,"rgba pvrtc 2bppv1":Ah}),me.webgl_compressed_texture_etc1&&(Tr["rgb etc1"]=Uc);var ht=Array.prototype.slice.call(B.getParameter(Eh)||new Uint32Array(0));Object.keys(Tr).forEach(function(we){var jt=Tr[we];ht.indexOf(jt)>=0&&(Er[we]=jt)});var Wt=Object.keys(Er);ze.textureFormats=Wt;var xr=[];Object.keys(Er).forEach(function(we){var jt=Er[we];xr[jt]=we});var Nr=[];Object.keys(Ur).forEach(function(we){var jt=Ur[we];Nr[jt]=we});var pr=[];Object.keys(Be).forEach(function(we){var jt=Be[we];pr[jt]=we});var Or=[];Object.keys(Pr).forEach(function(we){var jt=Pr[we];Or[jt]=we});var Kr=[];Object.keys(yr).forEach(function(we){var jt=yr[we];Kr[jt]=we});var Bn=Wt.reduce(function(we,jt){var At=Er[jt];return At===xa||At===Bc||At===xa||At===Vl||At===Bo||At===Ou||me.ext_srgb&&(At===Ju||At===No)?we[At]=At:At===rs||jt.indexOf("rgba")>=0?we[At]=Fs:we[At]=bl,we},{});function rr(){this.internalformat=Fs,this.format=Fs,this.type=Sl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=fc,this.width=0,this.height=0,this.channels=0}function ar(we,jt){we.internalformat=jt.internalformat,we.format=jt.format,we.type=jt.type,we.compressed=jt.compressed,we.premultiplyAlpha=jt.premultiplyAlpha,we.flipY=jt.flipY,we.unpackAlignment=jt.unpackAlignment,we.colorSpace=jt.colorSpace,we.width=jt.width,we.height=jt.height,we.channels=jt.channels}function xn(we,jt){if(!(typeof jt!="object"||!jt)){if("premultiplyAlpha"in jt&&(de.type(jt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),we.premultiplyAlpha=jt.premultiplyAlpha),"flipY"in jt&&(de.type(jt.flipY,"boolean","invalid texture flip"),we.flipY=jt.flipY),"alignment"in jt&&(de.oneOf(jt.alignment,[1,2,4,8],"invalid texture unpack alignment"),we.unpackAlignment=jt.alignment),"colorSpace"in jt&&(de.parameter(jt.colorSpace,Ir,"invalid colorSpace"),we.colorSpace=Ir[jt.colorSpace]),"type"in jt){var At=jt.type;de(me.oes_texture_float||!(At==="float"||At==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),de(me.oes_texture_half_float||!(At==="half float"||At==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),de(me.webgl_depth_texture||!(At==="uint16"||At==="uint32"||At==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),de.parameter(At,Ur,"invalid texture type"),we.type=Ur[At]}var hn=we.width,Oi=we.height,Se=we.channels,ie=!1;"shape"in jt?(de(Array.isArray(jt.shape)&&jt.shape.length>=2,"shape must be an array"),hn=jt.shape[0],Oi=jt.shape[1],jt.shape.length===3&&(Se=jt.shape[2],de(Se>0&&Se<=4,"invalid number of channels"),ie=!0),de(hn>=0&&hn<=ze.maxTextureSize,"invalid width"),de(Oi>=0&&Oi<=ze.maxTextureSize,"invalid height")):("radius"in jt&&(hn=Oi=jt.radius,de(hn>=0&&hn<=ze.maxTextureSize,"invalid radius")),"width"in jt&&(hn=jt.width,de(hn>=0&&hn<=ze.maxTextureSize,"invalid width")),"height"in jt&&(Oi=jt.height,de(Oi>=0&&Oi<=ze.maxTextureSize,"invalid height")),"channels"in jt&&(Se=jt.channels,de(Se>0&&Se<=4,"invalid number of channels"),ie=!0)),we.width=hn|0,we.height=Oi|0,we.channels=Se|0;var Ze=!1;if("format"in jt){var ft=jt.format;de(me.webgl_depth_texture||!(ft==="depth"||ft==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),de.parameter(ft,Er,"invalid texture format");var Rt=we.internalformat=Er[ft];we.format=Bn[Rt],ft in Ur&&("type"in jt||(we.type=Ur[ft])),ft in Tr&&(we.compressed=!0),Ze=!0}!ie&&Ze?we.channels=eo[we.format]:ie&&!Ze?we.channels!==vn[we.format]&&(we.format=we.internalformat=vn[we.channels]):Ze&&ie&&de(we.channels===eo[we.format],"number of channels inconsistent with specified format")}}function Vr(we){B.pixelStorei(cc,we.flipY),B.pixelStorei(rl,we.premultiplyAlpha),B.pixelStorei(Io,we.colorSpace),B.pixelStorei(Zc,we.unpackAlignment)}function Ar(){rr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Gr(we,jt){var At=null;if(Ii(jt)?At=jt:jt&&(de.type(jt,"object","invalid pixel data type"),xn(we,jt),"x"in jt&&(we.xOffset=jt.x|0),"y"in jt&&(we.yOffset=jt.y|0),Ii(jt.data)&&(At=jt.data)),de(!we.compressed||At instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),jt.copy){de(!At,"can not specify copy and data field for the same texture");var hn=cr.viewportWidth,Oi=cr.viewportHeight;we.width=we.width||hn-we.xOffset,we.height=we.height||Oi-we.yOffset,we.needsCopy=!0,de(we.xOffset>=0&&we.xOffset<hn&&we.yOffset>=0&&we.yOffset<Oi&&we.width>0&&we.width<=hn&&we.height>0&&we.height<=Oi,"copy texture read out of bounds")}else if(!At)we.width=we.width||1,we.height=we.height||1,we.channels=we.channels||4;else if(ye(At))we.channels=we.channels||4,we.data=At,!("type"in jt)&&we.type===Sl&&(we.type=Eu(At));else if(zs(At))we.channels=we.channels||4,ca(we,At),we.alignment=1,we.needsFree=!0;else if(Ds(At)){var Se=At.data;!Array.isArray(Se)&&we.type===Sl&&(we.type=Eu(Se));var ie=At.shape,Ze=At.stride,ft,Rt,$e,Fe,st,_e;ie.length===3?($e=ie[2],_e=Ze[2]):(de(ie.length===2,"invalid ndarray pixel data, must be 2 or 3D"),$e=1,_e=1),ft=ie[0],Rt=ie[1],Fe=Ze[0],st=Ze[1],we.alignment=1,we.width=ft,we.height=Rt,we.channels=$e,we.format=we.internalformat=vn[$e],we.needsFree=!0,fu(we,Se,Fe,st,_e,At.offset)}else if(qs(At)||Is(At)||_o(At)||Th(At))qs(At)||Is(At)||_o(At)?we.element=At:we.element=At.canvas,we.width=we.element.width,we.height=we.element.height,we.channels=4;else if(da(At))we.element=At,we.width=At.width,we.height=At.height,we.channels=4;else if(Yf(At))we.element=At,we.width=At.naturalWidth,we.height=At.naturalHeight,we.channels=4;else if(Os(At))we.element=At,we.width=At.width,we.height=At.height,we.channels=4;else if(Mh(At))we.element=At,we.width=At.videoWidth,we.height=At.videoHeight,we.channels=4;else if(vf(At)){var Ve=we.width||At[0].length,Ce=we.height||At.length,vt=we.channels;la(At[0][0])?vt=vt||At[0][0].length:vt=vt||1;for(var Tt=be.shape(At),dr=1,zr=0;zr<Tt.length;++zr)dr*=Tt[zr];var Br=oo(we,dr);be.flatten(At,Tt,"",Br),Us(we,Br),we.alignment=1,we.width=Ve,we.height=Ce,we.channels=vt,we.format=we.internalformat=vn[vt],we.needsFree=!0}we.type===Ru?de(ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):we.type===Gl&&de(ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Jr(we,jt,At){var hn=we.element,Oi=we.data,Se=we.internalformat,ie=we.format,Ze=we.type,ft=we.width,Rt=we.height;Vr(we),hn?B.texImage2D(jt,At,ie,ie,Ze,hn):we.compressed?B.compressedTexImage2D(jt,At,Se,ft,Rt,0,Oi):we.needsCopy?(zt(),B.copyTexImage2D(jt,At,ie,we.xOffset,we.yOffset,ft,Rt,0)):B.texImage2D(jt,At,ie,ft,Rt,0,ie,Ze,Oi||null)}function vi(we,jt,At,hn,Oi){var Se=we.element,ie=we.data,Ze=we.internalformat,ft=we.format,Rt=we.type,$e=we.width,Fe=we.height;Vr(we),Se?B.texSubImage2D(jt,Oi,At,hn,ft,Rt,Se):we.compressed?B.compressedTexSubImage2D(jt,Oi,At,hn,Ze,$e,Fe,ie):we.needsCopy?(zt(),B.copyTexSubImage2D(jt,Oi,At,hn,we.xOffset,we.yOffset,$e,Fe)):B.texSubImage2D(jt,Oi,At,hn,$e,Fe,ft,Rt,ie)}var ii=[];function Wr(){return ii.pop()||new Ar}function an(we){we.needsFree&&Lt.freeType(we.data),Ar.call(we),ii.push(we)}function Jn(){rr.call(this),this.genMipmaps=!1,this.mipmapHint=Cl,this.mipmask=0,this.images=Array(16)}function fi(we,jt,At){var hn=we.images[0]=Wr();we.mipmask=1,hn.width=we.width=jt,hn.height=we.height=At,hn.channels=we.channels=4}function Di(we,jt){var At=null;if(Ii(jt))At=we.images[0]=Wr(),ar(At,we),Gr(At,jt),we.mipmask=1;else if(xn(we,jt),Array.isArray(jt.mipmap))for(var hn=jt.mipmap,Oi=0;Oi<hn.length;++Oi)At=we.images[Oi]=Wr(),ar(At,we),At.width>>=Oi,At.height>>=Oi,Gr(At,hn[Oi]),we.mipmask|=1<<Oi;else At=we.images[0]=Wr(),ar(At,we),Gr(At,jt),we.mipmask=1;ar(we,we.images[0]),we.compressed&&(we.internalformat===el||we.internalformat===Ys||we.internalformat===af||we.internalformat===of)&&de(we.width%4==0&&we.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ro(we,jt){for(var At=we.images,hn=0;hn<At.length;++hn){if(!At[hn])return;Jr(At[hn],jt,hn)}}var no=[];function Fi(){var we=no.pop()||new Jn;rr.call(we),we.mipmask=0;for(var jt=0;jt<16;++jt)we.images[jt]=null;return we}function gs(we){for(var jt=we.images,At=0;At<jt.length;++At)jt[At]&&an(jt[At]),jt[At]=null;no.push(we)}function Ga(){this.minFilter=lc,this.magFilter=lc,this.wrapS=Hl,this.wrapT=Hl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Cl}function jo(we,jt){if("min"in jt){var At=jt.min;de.parameter(At,Pr),we.minFilter=Pr[At],Xa.indexOf(we.minFilter)>=0&&!("faces"in jt)&&(we.genMipmaps=!0)}if("mag"in jt){var hn=jt.mag;de.parameter(hn,Be),we.magFilter=Be[hn]}var Oi=we.wrapS,Se=we.wrapT;if("wrap"in jt){var ie=jt.wrap;typeof ie=="string"?(de.parameter(ie,yr),Oi=Se=yr[ie]):Array.isArray(ie)&&(de.parameter(ie[0],yr),de.parameter(ie[1],yr),Oi=yr[ie[0]],Se=yr[ie[1]])}else{if("wrapS"in jt){var Ze=jt.wrapS;de.parameter(Ze,yr),Oi=yr[Ze]}if("wrapT"in jt){var ft=jt.wrapT;de.parameter(ft,yr),Se=yr[ft]}}if(we.wrapS=Oi,we.wrapT=Se,"anisotropic"in jt){var Rt=jt.anisotropic;de(typeof Rt=="number"&&Rt>=1&&Rt<=ze.maxAnisotropic,"aniso samples must be between 1 and "),we.anisotropic=jt.anisotropic}if("mipmap"in jt){var $e=!1;switch(typeof jt.mipmap){case"string":de.parameter(jt.mipmap,nt,"invalid mipmap hint"),we.mipmapHint=nt[jt.mipmap],we.genMipmaps=!0,$e=!0;break;case"boolean":$e=we.genMipmaps=jt.mipmap;break;case"object":de(Array.isArray(jt.mipmap),"invalid mipmap type"),we.genMipmaps=!1,$e=!0;break;default:de.raise("invalid mipmap type")}$e&&!("min"in jt)&&(we.minFilter=cu)}}function vo(we,jt){B.texParameteri(jt,ja,we.minFilter),B.texParameteri(jt,ns,we.magFilter),B.texParameteri(jt,ff,we.wrapS),B.texParameteri(jt,Hf,we.wrapT),me.ext_texture_filter_anisotropic&&B.texParameteri(jt,ap,we.anisotropic),we.genMipmaps&&(B.hint(hf,we.mipmapHint),B.generateMipmap(jt))}var Qo=0,Ro={},us=ze.maxTextureUnits,so=Array(us).map(function(){return null});function mi(we){rr.call(this),this.mipmask=0,this.internalformat=Fs,this.id=Qo++,this.refCount=1,this.target=we,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ga,nr.profile&&(this.stats={size:0})}function Vo(we){B.activeTexture(hc),B.bindTexture(we.target,we.texture)}function Qi(){var we=so[0];we?B.bindTexture(we.target,we.texture):B.bindTexture(ao,null)}function So(we){var jt=we.texture;de(jt,"must not double destroy texture");var At=we.unit,hn=we.target;At>=0&&(B.activeTexture(hc+At),B.bindTexture(hn,null),so[At]=null),B.deleteTexture(jt),we.texture=null,we.params=null,we.pixels=null,we.refCount=0,delete Ro[we.id],Dt.textureCount--}g(mi.prototype,{bind:function(){var we=this;we.bindCount+=1;var jt=we.unit;if(jt<0){for(var At=0;At<us;++At){var hn=so[At];if(hn){if(hn.bindCount>0)continue;hn.unit=-1}so[At]=we,jt=At;break}jt>=us&&de.raise("insufficient number of texture units"),nr.profile&&Dt.maxTextureUnits<jt+1&&(Dt.maxTextureUnits=jt+1),we.unit=jt,B.activeTexture(hc+jt),B.bindTexture(we.target,we.texture)}return jt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&So(this)}});function ri(we,jt){var At=new mi(ao);Ro[At.id]=At,Dt.textureCount++;function hn(ie,Ze){var ft=At.texInfo;Ga.call(ft);var Rt=Fi();return typeof ie=="number"?typeof Ze=="number"?fi(Rt,ie|0,Ze|0):fi(Rt,ie|0,ie|0):ie?(de.type(ie,"object","invalid arguments to regl.texture"),jo(ft,ie),Di(Rt,ie)):fi(Rt,1,1),ft.genMipmaps&&(Rt.mipmask=(Rt.width<<1)-1),At.mipmask=Rt.mipmask,ar(At,Rt),de.texture2D(ft,Rt,ze),At.internalformat=Rt.internalformat,hn.width=Rt.width,hn.height=Rt.height,Vo(At),ro(Rt,ao),vo(ft,ao),Qi(),gs(Rt),nr.profile&&(At.stats.size=Zs(At.internalformat,At.type,Rt.width,Rt.height,ft.genMipmaps,!1)),hn.format=xr[At.internalformat],hn.type=Nr[At.type],hn.mag=pr[ft.magFilter],hn.min=Or[ft.minFilter],hn.wrapS=Kr[ft.wrapS],hn.wrapT=Kr[ft.wrapT],hn}function Oi(ie,Ze,ft,Rt){de(!!ie,"must specify image data");var $e=Ze|0,Fe=ft|0,st=Rt|0,_e=Wr();return ar(_e,At),_e.width=0,_e.height=0,Gr(_e,ie),_e.width=_e.width||(At.width>>st)-$e,_e.height=_e.height||(At.height>>st)-Fe,de(At.type===_e.type&&At.format===_e.format&&At.internalformat===_e.internalformat,"incompatible format for texture.subimage"),de($e>=0&&Fe>=0&&$e+_e.width<=At.width&&Fe+_e.height<=At.height,"texture.subimage write out of bounds"),de(At.mipmask&1<<st,"missing mipmap data"),de(_e.data||_e.element||_e.needsCopy,"missing image data"),Vo(At),vi(_e,ao,$e,Fe,st),Qi(),an(_e),hn}function Se(ie,Ze){var ft=ie|0,Rt=Ze|0||ft;if(ft===At.width&&Rt===At.height)return hn;hn.width=At.width=ft,hn.height=At.height=Rt,Vo(At);for(var $e=0;At.mipmask>>$e;++$e){var Fe=ft>>$e,st=Rt>>$e;if(!Fe||!st)break;B.texImage2D(ao,$e,At.format,Fe,st,0,At.format,At.type,null)}return Qi(),nr.profile&&(At.stats.size=Zs(At.internalformat,At.type,ft,Rt,!1,!1)),hn}return hn(we,jt),hn.subimage=Oi,hn.resize=Se,hn._reglType="texture2d",hn._texture=At,nr.profile&&(hn.stats=At.stats),hn.destroy=function(){At.decRef()},hn}function In(we,jt,At,hn,Oi,Se){var ie=new mi(Vf);Ro[ie.id]=ie,Dt.cubeCount++;var Ze=new Array(6);function ft(Fe,st,_e,Ve,Ce,vt){var Tt,dr=ie.texInfo;for(Ga.call(dr),Tt=0;Tt<6;++Tt)Ze[Tt]=Fi();if(typeof Fe=="number"||!Fe){var zr=Fe|0||1;for(Tt=0;Tt<6;++Tt)fi(Ze[Tt],zr,zr)}else if(typeof Fe=="object")if(st)Di(Ze[0],Fe),Di(Ze[1],st),Di(Ze[2],_e),Di(Ze[3],Ve),Di(Ze[4],Ce),Di(Ze[5],vt);else if(jo(dr,Fe),xn(ie,Fe),"faces"in Fe){var Br=Fe.faces;for(de(Array.isArray(Br)&&Br.length===6,"cube faces must be a length 6 array"),Tt=0;Tt<6;++Tt)de(typeof Br[Tt]=="object"&&!!Br[Tt],"invalid input for cube map face"),ar(Ze[Tt],ie),Di(Ze[Tt],Br[Tt])}else for(Tt=0;Tt<6;++Tt)Di(Ze[Tt],Fe);else de.raise("invalid arguments to cube map");for(ar(ie,Ze[0]),de.optional(function(){ze.npotTextureCube||de(bh(ie.width)&&bh(ie.height),"your browser does not support non power or two texture dimensions")}),dr.genMipmaps?ie.mipmask=(Ze[0].width<<1)-1:ie.mipmask=Ze[0].mipmask,de.textureCube(ie,dr,Ze,ze),ie.internalformat=Ze[0].internalformat,ft.width=Ze[0].width,ft.height=Ze[0].height,Vo(ie),Tt=0;Tt<6;++Tt)ro(Ze[Tt],xu+Tt);for(vo(dr,Vf),Qi(),nr.profile&&(ie.stats.size=Zs(ie.internalformat,ie.type,ft.width,ft.height,dr.genMipmaps,!0)),ft.format=xr[ie.internalformat],ft.type=Nr[ie.type],ft.mag=pr[dr.magFilter],ft.min=Or[dr.minFilter],ft.wrapS=Kr[dr.wrapS],ft.wrapT=Kr[dr.wrapT],Tt=0;Tt<6;++Tt)gs(Ze[Tt]);return ft}function Rt(Fe,st,_e,Ve,Ce){de(!!st,"must specify image data"),de(typeof Fe=="number"&&Fe===(Fe|0)&&Fe>=0&&Fe<6,"invalid face");var vt=_e|0,Tt=Ve|0,dr=Ce|0,zr=Wr();return ar(zr,ie),zr.width=0,zr.height=0,Gr(zr,st),zr.width=zr.width||(ie.width>>dr)-vt,zr.height=zr.height||(ie.height>>dr)-Tt,de(ie.type===zr.type&&ie.format===zr.format&&ie.internalformat===zr.internalformat,"incompatible format for texture.subimage"),de(vt>=0&&Tt>=0&&vt+zr.width<=ie.width&&Tt+zr.height<=ie.height,"texture.subimage write out of bounds"),de(ie.mipmask&1<<dr,"missing mipmap data"),de(zr.data||zr.element||zr.needsCopy,"missing image data"),Vo(ie),vi(zr,xu+Fe,vt,Tt,dr),Qi(),an(zr),ft}function $e(Fe){var st=Fe|0;if(st!==ie.width){ft.width=ie.width=st,ft.height=ie.height=st,Vo(ie);for(var _e=0;_e<6;++_e)for(var Ve=0;ie.mipmask>>Ve;++Ve)B.texImage2D(xu+_e,Ve,ie.format,st>>Ve,st>>Ve,0,ie.format,ie.type,null);return Qi(),nr.profile&&(ie.stats.size=Zs(ie.internalformat,ie.type,ft.width,ft.height,!1,!0)),ft}}return ft(we,jt,At,hn,Oi,Se),ft.subimage=Rt,ft.resize=$e,ft._reglType="textureCube",ft._texture=ie,nr.profile&&(ft.stats=ie.stats),ft.destroy=function(){ie.decRef()},ft}function Zi(){for(var we=0;we<us;++we)B.activeTexture(hc+we),B.bindTexture(ao,null),so[we]=null;Q(Ro).forEach(So),Dt.cubeCount=0,Dt.textureCount=0}nr.profile&&(Dt.getTotalTextureSize=function(){var we=0;return Object.keys(Ro).forEach(function(jt){we+=Ro[jt].stats.size}),we});function Co(){for(var we=0;we<us;++we){var jt=so[we];jt&&(jt.bindCount=0,jt.unit=-1,so[we]=null)}Q(Ro).forEach(function(At){At.texture=B.createTexture(),B.bindTexture(At.target,At.texture);for(var hn=0;hn<32;++hn)if((At.mipmask&1<<hn)!=0)if(At.target===ao)B.texImage2D(ao,hn,At.internalformat,At.width>>hn,At.height>>hn,0,At.internalformat,At.type,null);else for(var Oi=0;Oi<6;++Oi)B.texImage2D(xu+Oi,hn,At.internalformat,At.width>>hn,At.height>>hn,0,At.internalformat,At.type,null);vo(At.texInfo,At.target)})}function zl(){for(var we=0;we<us;++we){var jt=so[we];jt&&(jt.bindCount=0,jt.unit=-1,so[we]=null),B.activeTexture(hc+we),B.bindTexture(ao,null),B.bindTexture(Vf,null)}}return{create2D:ri,createCube:In,clear:Zi,getTexture:function(we){return null},restore:Co,refresh:zl}}var js=36161,On=32854,Cn=32855,pc=36194,ds=33189,Su=36168,Ko=34041,ba=35907,mf=34836,jc=34842,oa=34843,ka=[];ka[On]=2,ka[Cn]=2,ka[pc]=2,ka[ds]=2,ka[Su]=1,ka[Ko]=4,ka[ba]=4,ka[mf]=16,ka[jc]=8,ka[oa]=6;function qf(B,me,ze){return ka[B]*me*ze}var al=function(B,me,ze,zt,cr){var Dt={rgba4:On,rgb565:pc,"rgb5 a1":Cn,depth:ds,stencil:Su,"depth stencil":Ko};me.ext_srgb&&(Dt.srgba=ba),me.ext_color_buffer_half_float&&(Dt.rgba16f=jc,Dt.rgb16f=oa),me.webgl_color_buffer_float&&(Dt.rgba32f=mf);var nr=[];Object.keys(Dt).forEach(function(Er){var Tr=Dt[Er];nr[Tr]=Er});var nt=0,yr={};function Be(Er){this.id=nt++,this.refCount=1,this.renderbuffer=Er,this.format=On,this.width=0,this.height=0,cr.profile&&(this.stats={size:0})}Be.prototype.decRef=function(){--this.refCount<=0&&Pr(this)};function Pr(Er){var Tr=Er.renderbuffer;de(Tr,"must not double destroy renderbuffer"),B.bindRenderbuffer(js,null),B.deleteRenderbuffer(Tr),Er.renderbuffer=null,Er.refCount=0,delete yr[Er.id],zt.renderbufferCount--}function Ir(Er,Tr){var ht=new Be(B.createRenderbuffer());yr[ht.id]=ht,zt.renderbufferCount++;function Wt(Nr,pr){var Or=0,Kr=0,Bn=On;if(typeof Nr=="object"&&Nr){var rr=Nr;if("shape"in rr){var ar=rr.shape;de(Array.isArray(ar)&&ar.length>=2,"invalid renderbuffer shape"),Or=ar[0]|0,Kr=ar[1]|0}else"radius"in rr&&(Or=Kr=rr.radius|0),"width"in rr&&(Or=rr.width|0),"height"in rr&&(Kr=rr.height|0);"format"in rr&&(de.parameter(rr.format,Dt,"invalid renderbuffer format"),Bn=Dt[rr.format])}else typeof Nr=="number"?(Or=Nr|0,typeof pr=="number"?Kr=pr|0:Kr=Or):Nr?de.raise("invalid arguments to renderbuffer constructor"):Or=Kr=1;if(de(Or>0&&Kr>0&&Or<=ze.maxRenderbufferSize&&Kr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),!(Or===ht.width&&Kr===ht.height&&Bn===ht.format))return Wt.width=ht.width=Or,Wt.height=ht.height=Kr,ht.format=Bn,B.bindRenderbuffer(js,ht.renderbuffer),B.renderbufferStorage(js,Bn,Or,Kr),de(B.getError()===0,"invalid render buffer format"),cr.profile&&(ht.stats.size=qf(ht.format,ht.width,ht.height)),Wt.format=nr[ht.format],Wt}function xr(Nr,pr){var Or=Nr|0,Kr=pr|0||Or;return Or===ht.width&&Kr===ht.height||(de(Or>0&&Kr>0&&Or<=ze.maxRenderbufferSize&&Kr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),Wt.width=ht.width=Or,Wt.height=ht.height=Kr,B.bindRenderbuffer(js,ht.renderbuffer),B.renderbufferStorage(js,ht.format,Or,Kr),de(B.getError()===0,"invalid render buffer format"),cr.profile&&(ht.stats.size=qf(ht.format,ht.width,ht.height))),Wt}return Wt(Er,Tr),Wt.resize=xr,Wt._reglType="renderbuffer",Wt._renderbuffer=ht,cr.profile&&(Wt.stats=ht.stats),Wt.destroy=function(){ht.decRef()},Wt}cr.profile&&(zt.getTotalRenderbufferSize=function(){var Er=0;return Object.keys(yr).forEach(function(Tr){Er+=yr[Tr].stats.size}),Er});function Ur(){Q(yr).forEach(function(Er){Er.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(js,Er.renderbuffer),B.renderbufferStorage(js,Er.format,Er.width,Er.height)}),B.bindRenderbuffer(js,null)}return{create:Ir,clear:function(){Q(yr).forEach(Pr)},restore:Ur}},Ks=36160,Cu=36161,Oo=3553,ol=34069,Au=36064,Al=36096,sl=36128,dc=33306,gf=36053,wl=36054,Tl=36055,Ph=36057,Ml=36061,Xl=36193,yf=5121,Du=5126,Cs=6407,_f=6408,vc=6402,Ih=[Cs,_f],Yl=[];Yl[_f]=4,Yl[Cs]=3;var l=[];l[yf]=1,l[Du]=4,l[Xl]=2;var h=32854,c=32855,d=36194,E=33189,w=36168,M=34041,L=35907,U=34836,Y=34842,oe=34843,fe=[h,c,d,L,Y,oe,U],pe={};pe[gf]="complete",pe[wl]="incomplete attachment",pe[Ph]="incomplete dimensions",pe[Tl]="incomplete, missing attachment",pe[Ml]="unsupported";function Re(B,me,ze,zt,cr,Dt){var nr={cur:null,next:null,dirty:!1,setFBO:null},nt=["rgba"],yr=["rgba4","rgb565","rgb5 a1"];me.ext_srgb&&yr.push("srgba"),me.ext_color_buffer_half_float&&yr.push("rgba16f","rgb16f"),me.webgl_color_buffer_float&&yr.push("rgba32f");var Be=["uint8"];me.oes_texture_half_float&&Be.push("half float","float16"),me.oes_texture_float&&Be.push("float","float32");function Pr(Ar,Gr,Jr){this.target=Ar,this.texture=Gr,this.renderbuffer=Jr;var vi=0,ii=0;Gr?(vi=Gr.width,ii=Gr.height):Jr&&(vi=Jr.width,ii=Jr.height),this.width=vi,this.height=ii}function Ir(Ar){Ar&&(Ar.texture&&Ar.texture._texture.decRef(),Ar.renderbuffer&&Ar.renderbuffer._renderbuffer.decRef())}function Ur(Ar,Gr,Jr){if(!!Ar)if(Ar.texture){var vi=Ar.texture._texture,ii=Math.max(1,vi.width),Wr=Math.max(1,vi.height);de(ii===Gr&&Wr===Jr,"inconsistent width/height for supplied texture"),vi.refCount+=1}else{var an=Ar.renderbuffer._renderbuffer;de(an.width===Gr&&an.height===Jr,"inconsistent width/height for renderbuffer"),an.refCount+=1}}function Er(Ar,Gr){Gr&&(Gr.texture?B.framebufferTexture2D(Ks,Ar,Gr.target,Gr.texture._texture.texture,0):B.framebufferRenderbuffer(Ks,Ar,Cu,Gr.renderbuffer._renderbuffer.renderbuffer))}function Tr(Ar){var Gr=Oo,Jr=null,vi=null,ii=Ar;typeof Ar=="object"&&(ii=Ar.data,"target"in Ar&&(Gr=Ar.target|0)),de.type(ii,"function","invalid attachment data");var Wr=ii._reglType;return Wr==="texture2d"?(Jr=ii,de(Gr===Oo)):Wr==="textureCube"?(Jr=ii,de(Gr>=ol&&Gr<ol+6,"invalid cube map target")):Wr==="renderbuffer"?(vi=ii,Gr=Cu):de.raise("invalid regl object for attachment"),new Pr(Gr,Jr,vi)}function ht(Ar,Gr,Jr,vi,ii){if(Jr){var Wr=zt.create2D({width:Ar,height:Gr,format:vi,type:ii});return Wr._texture.refCount=0,new Pr(Oo,Wr,null)}else{var an=cr.create({width:Ar,height:Gr,format:vi});return an._renderbuffer.refCount=0,new Pr(Cu,null,an)}}function Wt(Ar){return Ar&&(Ar.texture||Ar.renderbuffer)}function xr(Ar,Gr,Jr){Ar&&(Ar.texture?Ar.texture.resize(Gr,Jr):Ar.renderbuffer&&Ar.renderbuffer.resize(Gr,Jr),Ar.width=Gr,Ar.height=Jr)}var Nr=0,pr={};function Or(){this.id=Nr++,pr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Kr(Ar){Ar.colorAttachments.forEach(Ir),Ir(Ar.depthAttachment),Ir(Ar.stencilAttachment),Ir(Ar.depthStencilAttachment)}function Bn(Ar){var Gr=Ar.framebuffer;de(Gr,"must not double destroy framebuffer"),B.deleteFramebuffer(Gr),Ar.framebuffer=null,Dt.framebufferCount--,delete pr[Ar.id]}function rr(Ar){var Gr;B.bindFramebuffer(Ks,Ar.framebuffer);var Jr=Ar.colorAttachments;for(Gr=0;Gr<Jr.length;++Gr)Er(Au+Gr,Jr[Gr]);for(Gr=Jr.length;Gr<ze.maxColorAttachments;++Gr)B.framebufferTexture2D(Ks,Au+Gr,Oo,null,0);B.framebufferTexture2D(Ks,dc,Oo,null,0),B.framebufferTexture2D(Ks,Al,Oo,null,0),B.framebufferTexture2D(Ks,sl,Oo,null,0),Er(Al,Ar.depthAttachment),Er(sl,Ar.stencilAttachment),Er(dc,Ar.depthStencilAttachment);var vi=B.checkFramebufferStatus(Ks);!B.isContextLost()&&vi!==gf&&de.raise("framebuffer configuration not supported, status = "+pe[vi]),B.bindFramebuffer(Ks,nr.next?nr.next.framebuffer:null),nr.cur=nr.next,B.getError()}function ar(Ar,Gr){var Jr=new Or;Dt.framebufferCount++;function vi(Wr,an){var Jn;de(nr.next!==Jr,"can not update framebuffer which is currently in use");var fi=0,Di=0,ro=!0,no=!0,Fi=null,gs=!0,Ga="rgba",jo="uint8",vo=1,Qo=null,Ro=null,us=null,so=!1;if(typeof Wr=="number")fi=Wr|0,Di=an|0||fi;else if(!Wr)fi=Di=1;else{de.type(Wr,"object","invalid arguments for framebuffer");var mi=Wr;if("shape"in mi){var Vo=mi.shape;de(Array.isArray(Vo)&&Vo.length>=2,"invalid shape for framebuffer"),fi=Vo[0],Di=Vo[1]}else"radius"in mi&&(fi=Di=mi.radius),"width"in mi&&(fi=mi.width),"height"in mi&&(Di=mi.height);("color"in mi||"colors"in mi)&&(Fi=mi.color||mi.colors,Array.isArray(Fi)&&de(Fi.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),Fi||("colorCount"in mi&&(vo=mi.colorCount|0,de(vo>0,"invalid color buffer count")),"colorTexture"in mi&&(gs=!!mi.colorTexture,Ga="rgba4"),"colorType"in mi&&(jo=mi.colorType,gs?(de(me.oes_texture_float||!(jo==="float"||jo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),de(me.oes_texture_half_float||!(jo==="half float"||jo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):jo==="half float"||jo==="float16"?(de(me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ga="rgba16f"):(jo==="float"||jo==="float32")&&(de(me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ga="rgba32f"),de.oneOf(jo,Be,"invalid color type")),"colorFormat"in mi&&(Ga=mi.colorFormat,nt.indexOf(Ga)>=0?gs=!0:yr.indexOf(Ga)>=0?gs=!1:de.optional(function(){gs?de.oneOf(mi.colorFormat,nt,"invalid color format for texture"):de.oneOf(mi.colorFormat,yr,"invalid color format for renderbuffer")}))),("depthTexture"in mi||"depthStencilTexture"in mi)&&(so=!!(mi.depthTexture||mi.depthStencilTexture),de(!so||me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in mi&&(typeof mi.depth=="boolean"?ro=mi.depth:(Qo=mi.depth,no=!1)),"stencil"in mi&&(typeof mi.stencil=="boolean"?no=mi.stencil:(Ro=mi.stencil,ro=!1)),"depthStencil"in mi&&(typeof mi.depthStencil=="boolean"?ro=no=mi.depthStencil:(us=mi.depthStencil,ro=!1,no=!1))}var Qi=null,So=null,ri=null,In=null;if(Array.isArray(Fi))Qi=Fi.map(Tr);else if(Fi)Qi=[Tr(Fi)];else for(Qi=new Array(vo),Jn=0;Jn<vo;++Jn)Qi[Jn]=ht(fi,Di,gs,Ga,jo);de(me.webgl_draw_buffers||Qi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),de(Qi.length<=ze.maxColorAttachments,"too many color attachments, not supported"),fi=fi||Qi[0].width,Di=Di||Qi[0].height,Qo?So=Tr(Qo):ro&&!no&&(So=ht(fi,Di,so,"depth","uint32")),Ro?ri=Tr(Ro):no&&!ro&&(ri=ht(fi,Di,!1,"stencil","uint8")),us?In=Tr(us):!Qo&&!Ro&&no&&ro&&(In=ht(fi,Di,so,"depth stencil","depth stencil")),de(!!Qo+!!Ro+!!us<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Zi=null;for(Jn=0;Jn<Qi.length;++Jn)if(Ur(Qi[Jn],fi,Di),de(!Qi[Jn]||Qi[Jn].texture&&Ih.indexOf(Qi[Jn].texture._texture.format)>=0||Qi[Jn].renderbuffer&&fe.indexOf(Qi[Jn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Jn+" is invalid"),Qi[Jn]&&Qi[Jn].texture){var Co=Yl[Qi[Jn].texture._texture.format]*l[Qi[Jn].texture._texture.type];Zi===null?Zi=Co:de(Zi===Co,"all color attachments much have the same number of bits per pixel.")}return Ur(So,fi,Di),de(!So||So.texture&&So.texture._texture.format===vc||So.renderbuffer&&So.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Ur(ri,fi,Di),de(!ri||ri.renderbuffer&&ri.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Ur(In,fi,Di),de(!In||In.texture&&In.texture._texture.format===M||In.renderbuffer&&In.renderbuffer._renderbuffer.format===M,"invalid depth-stencil attachment for framebuffer object"),Kr(Jr),Jr.width=fi,Jr.height=Di,Jr.colorAttachments=Qi,Jr.depthAttachment=So,Jr.stencilAttachment=ri,Jr.depthStencilAttachment=In,vi.color=Qi.map(Wt),vi.depth=Wt(So),vi.stencil=Wt(ri),vi.depthStencil=Wt(In),vi.width=Jr.width,vi.height=Jr.height,rr(Jr),vi}function ii(Wr,an){de(nr.next!==Jr,"can not resize a framebuffer which is currently in use");var Jn=Math.max(Wr|0,1),fi=Math.max(an|0||Jn,1);if(Jn===Jr.width&&fi===Jr.height)return vi;for(var Di=Jr.colorAttachments,ro=0;ro<Di.length;++ro)xr(Di[ro],Jn,fi);return xr(Jr.depthAttachment,Jn,fi),xr(Jr.stencilAttachment,Jn,fi),xr(Jr.depthStencilAttachment,Jn,fi),Jr.width=vi.width=Jn,Jr.height=vi.height=fi,rr(Jr),vi}return vi(Ar,Gr),g(vi,{resize:ii,_reglType:"framebuffer",_framebuffer:Jr,destroy:function(){Bn(Jr),Kr(Jr)},use:function(Wr){nr.setFBO({framebuffer:vi},Wr)}})}function xn(Ar){var Gr=Array(6);function Jr(ii){var Wr;de(Gr.indexOf(nr.next)<0,"can not update framebuffer which is currently in use");var an={color:null},Jn=0,fi=null,Di="rgba",ro="uint8",no=1;if(typeof ii=="number")Jn=ii|0;else if(!ii)Jn=1;else{de.type(ii,"object","invalid arguments for framebuffer");var Fi=ii;if("shape"in Fi){var gs=Fi.shape;de(Array.isArray(gs)&&gs.length>=2,"invalid shape for framebuffer"),de(gs[0]===gs[1],"cube framebuffer must be square"),Jn=gs[0]}else"radius"in Fi&&(Jn=Fi.radius|0),"width"in Fi?(Jn=Fi.width|0,"height"in Fi&&de(Fi.height===Jn,"must be square")):"height"in Fi&&(Jn=Fi.height|0);("color"in Fi||"colors"in Fi)&&(fi=Fi.color||Fi.colors,Array.isArray(fi)&&de(fi.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),fi||("colorCount"in Fi&&(no=Fi.colorCount|0,de(no>0,"invalid color buffer count")),"colorType"in Fi&&(de.oneOf(Fi.colorType,Be,"invalid color type"),ro=Fi.colorType),"colorFormat"in Fi&&(Di=Fi.colorFormat,de.oneOf(Fi.colorFormat,nt,"invalid color format for texture"))),"depth"in Fi&&(an.depth=Fi.depth),"stencil"in Fi&&(an.stencil=Fi.stencil),"depthStencil"in Fi&&(an.depthStencil=Fi.depthStencil)}var Ga;if(fi)if(Array.isArray(fi))for(Ga=[],Wr=0;Wr<fi.length;++Wr)Ga[Wr]=fi[Wr];else Ga=[fi];else{Ga=Array(no);var jo={radius:Jn,format:Di,type:ro};for(Wr=0;Wr<no;++Wr)Ga[Wr]=zt.createCube(jo)}for(an.color=Array(Ga.length),Wr=0;Wr<Ga.length;++Wr){var vo=Ga[Wr];de(typeof vo=="function"&&vo._reglType==="textureCube","invalid cube map"),Jn=Jn||vo.width,de(vo.width===Jn&&vo.height===Jn,"invalid cube map shape"),an.color[Wr]={target:ol,data:Ga[Wr]}}for(Wr=0;Wr<6;++Wr){for(var Qo=0;Qo<Ga.length;++Qo)an.color[Qo].target=ol+Wr;Wr>0&&(an.depth=Gr[0].depth,an.stencil=Gr[0].stencil,an.depthStencil=Gr[0].depthStencil),Gr[Wr]?Gr[Wr](an):Gr[Wr]=ar(an)}return g(Jr,{width:Jn,height:Jn,color:Ga})}function vi(ii){var Wr,an=ii|0;if(de(an>0&&an<=ze.maxCubeMapSize,"invalid radius for cube fbo"),an===Jr.width)return Jr;var Jn=Jr.color;for(Wr=0;Wr<Jn.length;++Wr)Jn[Wr].resize(an);for(Wr=0;Wr<6;++Wr)Gr[Wr].resize(an);return Jr.width=Jr.height=an,Jr}return Jr(Ar),g(Jr,{faces:Gr,resize:vi,_reglType:"framebufferCube",destroy:function(){Gr.forEach(function(ii){ii.destroy()})}})}function Vr(){nr.cur=null,nr.next=null,nr.dirty=!0,Q(pr).forEach(function(Ar){Ar.framebuffer=B.createFramebuffer(),rr(Ar)})}return g(nr,{getFramebuffer:function(Ar){if(typeof Ar=="function"&&Ar._reglType==="framebuffer"){var Gr=Ar._framebuffer;if(Gr instanceof Or)return Gr}return null},create:ar,createCube:xn,clear:function(){Q(pr).forEach(Bn)},restore:Vr})}var Ie=5126,Xe=34962,Ae=34963,Ye=["attributes","elements","offset","count","primitive","instances"];function it(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ie,this.offset=0,this.stride=0,this.divisor=0}function Et(B,me,ze,zt,cr,Dt,nr){for(var nt=ze.maxAttributes,yr=new Array(nt),Be=0;Be<nt;++Be)yr[Be]=new it;var Pr=0,Ir={},Ur={Record:it,scope:{},state:yr,currentVAO:null,targetVAO:null,restore:Tr()?Kr:function(){},createVAO:Bn,getVAO:Wt,destroyBuffer:Er,setVAO:Tr()?xr:Nr,clear:Tr()?pr:function(){}};function Er(rr){for(var ar=0;ar<yr.length;++ar){var xn=yr[ar];xn.buffer===rr&&(B.disableVertexAttribArray(ar),xn.buffer=null)}}function Tr(){return me.oes_vertex_array_object}function ht(){return me.angle_instanced_arrays}function Wt(rr){return typeof rr=="function"&&rr._vao?rr._vao:null}function xr(rr){if(rr!==Ur.currentVAO){var ar=Tr();rr?ar.bindVertexArrayOES(rr.vao):ar.bindVertexArrayOES(null),Ur.currentVAO=rr}}function Nr(rr){if(rr!==Ur.currentVAO){if(rr)rr.bindAttrs();else{for(var ar=ht(),xn=0;xn<yr.length;++xn){var Vr=yr[xn];Vr.buffer?(B.enableVertexAttribArray(xn),Vr.buffer.bind(),B.vertexAttribPointer(xn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offfset),ar&&Vr.divisor&&ar.vertexAttribDivisorANGLE(xn,Vr.divisor)):(B.disableVertexAttribArray(xn),B.vertexAttrib4f(xn,Vr.x,Vr.y,Vr.z,Vr.w))}nr.elements?B.bindBuffer(Ae,nr.elements.buffer.buffer):B.bindBuffer(Ae,null)}Ur.currentVAO=rr}}function pr(){Q(Ir).forEach(function(rr){rr.destroy()})}function Or(){this.id=++Pr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var rr=Tr();rr?this.vao=rr.createVertexArrayOES():this.vao=null,Ir[this.id]=this,this.buffers=[]}Or.prototype.bindAttrs=function(){for(var rr=ht(),ar=this.attributes,xn=0;xn<ar.length;++xn){var Vr=ar[xn];Vr.buffer?(B.enableVertexAttribArray(xn),B.bindBuffer(Xe,Vr.buffer.buffer),B.vertexAttribPointer(xn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offset),rr&&Vr.divisor&&rr.vertexAttribDivisorANGLE(xn,Vr.divisor)):(B.disableVertexAttribArray(xn),B.vertexAttrib4f(xn,Vr.x,Vr.y,Vr.z,Vr.w))}for(var Ar=ar.length;Ar<nt;++Ar)B.disableVertexAttribArray(Ar);var Gr=Dt.getElements(this.elements);Gr?B.bindBuffer(Ae,Gr.buffer.buffer):B.bindBuffer(Ae,null)},Or.prototype.refresh=function(){var rr=Tr();rr&&(rr.bindVertexArrayOES(this.vao),this.bindAttrs(),Ur.currentVAO=null,rr.bindVertexArrayOES(null))},Or.prototype.destroy=function(){if(this.vao){var rr=Tr();this===Ur.currentVAO&&(Ur.currentVAO=null,rr.bindVertexArrayOES(null)),rr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ir[this.id]&&(delete Ir[this.id],zt.vaoCount-=1)};function Kr(){var rr=Tr();rr&&Q(Ir).forEach(function(ar){ar.refresh()})}function Bn(rr){var ar=new Or;zt.vaoCount+=1;function xn(Vr){var Ar;if(Array.isArray(Vr))Ar=Vr,ar.elements&&ar.ownsElements&&ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1,ar.offset=0,ar.count=0,ar.instances=-1,ar.primitive=4;else{if(de(typeof Vr=="object","invalid arguments for create vao"),de("attributes"in Vr,"must specify attributes for vao"),Vr.elements){var Gr=Vr.elements;ar.ownsElements?typeof Gr=="function"&&Gr._reglType==="elements"?(ar.elements.destroy(),ar.ownsElements=!1):(ar.elements(Gr),ar.ownsElements=!1):Dt.getElements(Vr.elements)?(ar.elements=Vr.elements,ar.ownsElements=!1):(ar.elements=Dt.create(Vr.elements),ar.ownsElements=!0)}else ar.elements=null,ar.ownsElements=!1;Ar=Vr.attributes,ar.offset=0,ar.count=-1,ar.instances=-1,ar.primitive=4,ar.elements&&(ar.count=ar.elements._elements.vertCount,ar.primitive=ar.elements._elements.primType),"offset"in Vr&&(ar.offset=Vr.offset|0),"count"in Vr&&(ar.count=Vr.count|0),"instances"in Vr&&(ar.instances=Vr.instances|0),"primitive"in Vr&&(de(Vr.primitive in fr,"bad primitive type: "+Vr.primitive),ar.primitive=fr[Vr.primitive]),de.optional(function(){for(var ro=Object.keys(Vr),no=0;no<ro.length;++no)de(Ye.indexOf(ro[no])>=0,'invalid option for vao: "'+ro[no]+'" valid options are '+Ye)}),de(Array.isArray(Ar),"attributes must be an array")}de(Ar.length<nt,"too many attributes"),de(Ar.length>0,"must specify at least one attribute");var Jr={},vi=ar.attributes;vi.length=Ar.length;for(var ii=0;ii<Ar.length;++ii){var Wr=Ar[ii],an=vi[ii]=new it,Jn=Wr.data||Wr;if(Array.isArray(Jn)||ye(Jn)||Ds(Jn)){var fi;ar.buffers[ii]&&(fi=ar.buffers[ii],ye(Jn)&&fi._buffer.byteLength>=Jn.byteLength?fi.subdata(Jn):(fi.destroy(),ar.buffers[ii]=null)),ar.buffers[ii]||(fi=ar.buffers[ii]=cr.create(Wr,Xe,!1,!0)),an.buffer=cr.getBuffer(fi),an.size=an.buffer.dimension|0,an.normalized=!1,an.type=an.buffer.dtype,an.offset=0,an.stride=0,an.divisor=0,an.state=1,Jr[ii]=1}else cr.getBuffer(Wr)?(an.buffer=cr.getBuffer(Wr),an.size=an.buffer.dimension|0,an.normalized=!1,an.type=an.buffer.dtype,an.offset=0,an.stride=0,an.divisor=0,an.state=1):cr.getBuffer(Wr.buffer)?(an.buffer=cr.getBuffer(Wr.buffer),an.size=(+Wr.size||an.buffer.dimension)|0,an.normalized=!!Wr.normalized||!1,"type"in Wr?(de.parameter(Wr.type,uu,"invalid buffer type"),an.type=uu[Wr.type]):an.type=an.buffer.dtype,an.offset=(Wr.offset||0)|0,an.stride=(Wr.stride||0)|0,an.divisor=(Wr.divisor||0)|0,an.state=1,de(an.size>=1&&an.size<=4,"size must be between 1 and 4"),de(an.offset>=0,"invalid offset"),de(an.stride>=0&&an.stride<=255,"stride must be between 0 and 255"),de(an.divisor>=0,"divisor must be positive"),de(!an.divisor||!!me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Wr?(de(ii>0,"first attribute must not be a constant"),an.x=+Wr.x||0,an.y=+Wr.y||0,an.z=+Wr.z||0,an.w=+Wr.w||0,an.state=2):de(!1,"invalid attribute spec for location "+ii)}for(var Di=0;Di<ar.buffers.length;++Di)!Jr[Di]&&ar.buffers[Di]&&(ar.buffers[Di].destroy(),ar.buffers[Di]=null);return ar.refresh(),xn}return xn.destroy=function(){for(var Vr=0;Vr<ar.buffers.length;++Vr)ar.buffers[Vr]&&ar.buffers[Vr].destroy();ar.buffers.length=0,ar.ownsElements&&(ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1),ar.destroy()},xn._vao=ar,xn._reglType="vao",xn(rr)}return Ur}var Xt=35632,Nt=35633,tr=35718,mr=35721;function Dr(B,me,ze,zt){var cr={},Dt={};function nr(ht,Wt,xr,Nr){this.name=ht,this.id=Wt,this.location=xr,this.info=Nr}function nt(ht,Wt){for(var xr=0;xr<ht.length;++xr)if(ht[xr].id===Wt.id){ht[xr].location=Wt.location;return}ht.push(Wt)}function yr(ht,Wt,xr){var Nr=ht===Xt?cr:Dt,pr=Nr[Wt];if(!pr){var Or=me.str(Wt);pr=B.createShader(ht),B.shaderSource(pr,Or),B.compileShader(pr),de.shaderError(B,pr,Or,ht,xr),Nr[Wt]=pr}return pr}var Be={},Pr=[],Ir=0;function Ur(ht,Wt){this.id=Ir++,this.fragId=ht,this.vertId=Wt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,zt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Er(ht,Wt,xr){var Nr,pr,Or=yr(Xt,ht.fragId),Kr=yr(Nt,ht.vertId),Bn=ht.program=B.createProgram();if(B.attachShader(Bn,Or),B.attachShader(Bn,Kr),xr)for(Nr=0;Nr<xr.length;++Nr){var rr=xr[Nr];B.bindAttribLocation(Bn,rr[0],rr[1])}B.linkProgram(Bn),de.linkError(B,Bn,me.str(ht.fragId),me.str(ht.vertId),Wt);var ar=B.getProgramParameter(Bn,tr);zt.profile&&(ht.stats.uniformsCount=ar);var xn=ht.uniforms;for(Nr=0;Nr<ar;++Nr)if(pr=B.getActiveUniform(Bn,Nr),pr)if(pr.size>1)for(var Vr=0;Vr<pr.size;++Vr){var Ar=pr.name.replace("[0]","["+Vr+"]");nt(xn,new nr(Ar,me.id(Ar),B.getUniformLocation(Bn,Ar),pr))}else nt(xn,new nr(pr.name,me.id(pr.name),B.getUniformLocation(Bn,pr.name),pr));var Gr=B.getProgramParameter(Bn,mr);zt.profile&&(ht.stats.attributesCount=Gr);var Jr=ht.attributes;for(Nr=0;Nr<Gr;++Nr)pr=B.getActiveAttrib(Bn,Nr),pr&&nt(Jr,new nr(pr.name,me.id(pr.name),B.getAttribLocation(Bn,pr.name),pr))}zt.profile&&(ze.getMaxUniformsCount=function(){var ht=0;return Pr.forEach(function(Wt){Wt.stats.uniformsCount>ht&&(ht=Wt.stats.uniformsCount)}),ht},ze.getMaxAttributesCount=function(){var ht=0;return Pr.forEach(function(Wt){Wt.stats.attributesCount>ht&&(ht=Wt.stats.attributesCount)}),ht});function Tr(){cr={},Dt={};for(var ht=0;ht<Pr.length;++ht)Er(Pr[ht],null,Pr[ht].attributes.map(function(Wt){return[Wt.location,Wt.name]}))}return{clear:function(){var ht=B.deleteShader.bind(B);Q(cr).forEach(ht),cr={},Q(Dt).forEach(ht),Dt={},Pr.forEach(function(Wt){B.deleteProgram(Wt.program)}),Pr.length=0,Be={},ze.shaderCount=0},program:function(ht,Wt,xr,Nr){de.command(ht>=0,"missing vertex shader",xr),de.command(Wt>=0,"missing fragment shader",xr);var pr=Be[Wt];pr||(pr=Be[Wt]={});var Or=pr[ht];if(Or&&(Or.refCount++,!Nr))return Or;var Kr=new Ur(Wt,ht);return ze.shaderCount++,Er(Kr,xr,Nr),Or||(pr[ht]=Kr),Pr.push(Kr),g(Kr,{destroy:function(){if(Kr.refCount--,Kr.refCount<=0){B.deleteProgram(Kr.program);var Bn=Pr.indexOf(Kr);Pr.splice(Bn,1),ze.shaderCount--}pr[Kr.vertId].refCount<=0&&(B.deleteShader(Dt[Kr.vertId]),delete Dt[Kr.vertId],delete Be[Kr.fragId][Kr.vertId]),Object.keys(Be[Kr.fragId]).length||(B.deleteShader(cr[Kr.fragId]),delete cr[Kr.fragId],delete Be[Kr.fragId])}})},restore:Tr,shader:yr,frag:-1,vert:-1}}var sr=6408,Qr=5121,Rn=3333,kn=5126;function Fn(B,me,ze,zt,cr,Dt,nr){function nt(Pr){var Ir;me.next===null?(de(cr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ir=Qr):(de(me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ir=me.next.colorAttachments[0].texture._texture.type,de.optional(function(){Dt.oes_texture_float?(de(Ir===Qr||Ir===kn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ir===kn&&de(nr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):de(Ir===Qr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Ur=0,Er=0,Tr=zt.framebufferWidth,ht=zt.framebufferHeight,Wt=null;ye(Pr)?Wt=Pr:Pr&&(de.type(Pr,"object","invalid arguments to regl.read()"),Ur=Pr.x|0,Er=Pr.y|0,de(Ur>=0&&Ur<zt.framebufferWidth,"invalid x offset for regl.read"),de(Er>=0&&Er<zt.framebufferHeight,"invalid y offset for regl.read"),Tr=(Pr.width||zt.framebufferWidth-Ur)|0,ht=(Pr.height||zt.framebufferHeight-Er)|0,Wt=Pr.data||null),Wt&&(Ir===Qr?de(Wt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ir===kn&&de(Wt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),de(Tr>0&&Tr+Ur<=zt.framebufferWidth,"invalid width for read pixels"),de(ht>0&&ht+Er<=zt.framebufferHeight,"invalid height for read pixels"),ze();var xr=Tr*ht*4;return Wt||(Ir===Qr?Wt=new Uint8Array(xr):Ir===kn&&(Wt=Wt||new Float32Array(xr))),de.isTypedArray(Wt,"data buffer for regl.read() must be a typedarray"),de(Wt.byteLength>=xr,"data buffer for regl.read() too small"),B.pixelStorei(Rn,4),B.readPixels(Ur,Er,Tr,ht,sr,Ir,Wt),Wt}function yr(Pr){var Ir;return me.setFBO({framebuffer:Pr.framebuffer},function(){Ir=nt(Pr)}),Ir}function Be(Pr){return!Pr||!("framebuffer"in Pr)?nt(Pr):yr(Pr)}return Be}function Ai(B){return Array.prototype.slice.call(B)}function un(B){return Ai(B).join("")}function Sn(){var B=0,me=[],ze=[];function zt(Ir){for(var Ur=0;Ur<ze.length;++Ur)if(ze[Ur]===Ir)return me[Ur];var Er="g"+B++;return me.push(Er),ze.push(Ir),Er}function cr(){var Ir=[];function Ur(){Ir.push.apply(Ir,Ai(arguments))}var Er=[];function Tr(){var ht="v"+B++;return Er.push(ht),arguments.length>0&&(Ir.push(ht,"="),Ir.push.apply(Ir,Ai(arguments)),Ir.push(";")),ht}return g(Ur,{def:Tr,toString:function(){return un([Er.length>0?"var "+Er.join(",")+";":"",un(Ir)])}})}function Dt(){var Ir=cr(),Ur=cr(),Er=Ir.toString,Tr=Ur.toString;function ht(Wt,xr){Ur(Wt,xr,"=",Ir.def(Wt,xr),";")}return g(function(){Ir.apply(Ir,Ai(arguments))},{def:Ir.def,entry:Ir,exit:Ur,save:ht,set:function(Wt,xr,Nr){ht(Wt,xr),Ir(Wt,xr,"=",Nr,";")},toString:function(){return Er()+Tr()}})}function nr(){var Ir=un(arguments),Ur=Dt(),Er=Dt(),Tr=Ur.toString,ht=Er.toString;return g(Ur,{then:function(){return Ur.apply(Ur,Ai(arguments)),this},else:function(){return Er.apply(Er,Ai(arguments)),this},toString:function(){var Wt=ht();return Wt&&(Wt="else{"+Wt+"}"),un(["if(",Ir,"){",Tr(),"}",Wt])}})}var nt=cr(),yr={};function Be(Ir,Ur){var Er=[];function Tr(){var pr="a"+Er.length;return Er.push(pr),pr}Ur=Ur||0;for(var ht=0;ht<Ur;++ht)Tr();var Wt=Dt(),xr=Wt.toString,Nr=yr[Ir]=g(Wt,{arg:Tr,toString:function(){return un(["function(",Er.join(),"){",xr(),"}"])}});return Nr}function Pr(){var Ir=['"use strict";',nt,"return {"];Object.keys(yr).forEach(function(ht){Ir.push('"',ht,'":',yr[ht].toString(),",")}),Ir.push("}");var Ur=un(Ir).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Er=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Tr=Er?le.Function.apply(null,me.concat(Ur)):Function.apply(null,me.concat(Ur));return Tr.apply(null,ze)}return{global:nt,link:zt,block:cr,proc:Be,scope:Dt,cond:nr,compile:Pr}}var Qn="xyzw".split(""),Xn=5121,Yn=1,di=2,jn=0,Tn=1,qi=2,Ya=3,ni=4,zo=5,Va=6,to="dither",is="blend.enable",vs="blend.color",Fu="blend.equation",as="blend.func",Vs="depth.enable",As="depth.func",Vc="depth.range",Pl="depth.mask",Bu="colorMask",ql="cull.enable",mc="cull.face",$s="frontFace",Il="lineWidth",wu="polygonOffset.enable",xo="polygonOffset.offset",Nu="sample.alpha",ul="sample.enable",$o="sample.coverage",ea="stencil.enable",Uo="stencil.mask",ms="stencil.func",zu="stencil.opFront",gc="stencil.opBack",Kl="scissor.enable",xf="scissor.box",Qs="viewport",yc="profile",Js="framebuffer",Ol="vert",Gc="frag",hu="elements",bo="primitive",Hc="count",Kf="offset",Oh="instances",$f="vao",op="Width",sp="Height",ws=Js+op,bf=Js+sp,Rl=Qs+op,qp=Qs+sp,pu="drawingBuffer",_c=pu+op,Kp=pu+sp,kd=[as,Fu,ms,zu,gc,$o,Qs,xf,xo],Ef=34962,up=34963,os=35632,ss=35633,Qf=3553,Rh=34067,Sf=2884,Jf=3042,Iv=3024,Zo=2960,lp=2929,cp=3089,du=32823,fp=32926,Lh=32928,hp=5126,Ll=35664,kl=35665,$l=35666,Cf=5124,eh=35667,ll=35668,Wc=35669,Af=35670,th=35671,xc=35672,Xc=35673,eu=35674,wf=35675,vu=35676,Tf=35678,rh=35680,kh=4,Dl=1028,Yc=1029,$p=2304,Dh=2305,Fh=32775,Dd=32776,Qp=519,mu=7680,pp=0,nh=1,Mf=32774,cl=513,Jp=36160,ed=36064,Fl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Pf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],qc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ql={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},If={frag:os,vert:ss},dp={cw:$p,ccw:Dh};function Bh(B){return Array.isArray(B)||ye(B)||Ds(B)}function vp(B){return B.sort(function(me,ze){return me===Qs?-1:ze===Qs?1:me<ze?-1:1})}function va(B,me,ze,zt){this.thisDep=B,this.contextDep=me,this.propDep=ze,this.append=zt}function bc(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function Eo(B){return new va(!1,!1,!1,B)}function tu(B,me){var ze=B.type;if(ze===jn){var zt=B.data.length;return new va(!0,zt>=1,zt>=2,me)}else if(ze===ni){var cr=B.data;return new va(cr.thisDep,cr.contextDep,cr.propDep,me)}else{if(ze===zo)return new va(!1,!1,!1,me);if(ze===Va){for(var Dt=!1,nr=!1,nt=!1,yr=0;yr<B.data.length;++yr){var Be=B.data[yr];if(Be.type===Tn)nt=!0;else if(Be.type===qi)nr=!0;else if(Be.type===Ya)Dt=!0;else if(Be.type===jn){Dt=!0;var Pr=Be.data;Pr>=1&&(nr=!0),Pr>=2&&(nt=!0)}else Be.type===ni&&(Dt=Dt||Be.data.thisDep,nr=nr||Be.data.contextDep,nt=nt||Be.data.propDep)}return new va(Dt,nr,nt,me)}else return new va(ze===Ya,ze===qi,ze===Tn,me)}}var mp=new va(!1,!1,!1,function(){});function Nh(B,me,ze,zt,cr,Dt,nr,nt,yr,Be,Pr,Ir,Ur,Er,Tr){var ht=Be.Record,Wt={add:32774,subtract:32778,"reverse subtract":32779};ze.ext_blend_minmax&&(Wt.min=Fh,Wt.max=Dd);var xr=ze.angle_instanced_arrays,Nr=ze.webgl_draw_buffers,pr=ze.oes_vertex_array_object,Or={dirty:!0,profile:Tr.profile},Kr={},Bn=[],rr={},ar={};function xn(Se){return Se.replace(".","_")}function Vr(Se,ie,Ze){var ft=xn(Se);Bn.push(Se),Kr[ft]=Or[ft]=!!Ze,rr[ft]=ie}function Ar(Se,ie,Ze){var ft=xn(Se);Bn.push(Se),Array.isArray(Ze)?(Or[ft]=Ze.slice(),Kr[ft]=Ze.slice()):Or[ft]=Kr[ft]=Ze,ar[ft]=ie}Vr(to,Iv),Vr(is,Jf),Ar(vs,"blendColor",[0,0,0,0]),Ar(Fu,"blendEquationSeparate",[Mf,Mf]),Ar(as,"blendFuncSeparate",[nh,pp,nh,pp]),Vr(Vs,lp,!0),Ar(As,"depthFunc",cl),Ar(Vc,"depthRange",[0,1]),Ar(Pl,"depthMask",!0),Ar(Bu,Bu,[!0,!0,!0,!0]),Vr(ql,Sf),Ar(mc,"cullFace",Yc),Ar($s,$s,Dh),Ar(Il,Il,1),Vr(wu,du),Ar(xo,"polygonOffset",[0,0]),Vr(Nu,fp),Vr(ul,Lh),Ar($o,"sampleCoverage",[1,!1]),Vr(ea,Zo),Ar(Uo,"stencilMask",-1),Ar(ms,"stencilFunc",[Qp,0,-1]),Ar(zu,"stencilOpSeparate",[Dl,mu,mu,mu]),Ar(gc,"stencilOpSeparate",[Yc,mu,mu,mu]),Vr(Kl,cp),Ar(xf,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Ar(Qs,Qs,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Gr={gl:B,context:Ur,strings:me,next:Kr,current:Or,draw:Ir,elements:Dt,buffer:cr,shader:Pr,attributes:Be.state,vao:Be,uniforms:yr,framebuffer:nt,extensions:ze,timer:Er,isBufferArgs:Bh},Jr={primTypes:fr,compareFuncs:qc,blendFuncs:Fl,blendEquations:Wt,stencilOps:Ql,glTypes:uu,orientationType:dp};de.optional(function(){Gr.isArrayLike=la}),Nr&&(Jr.backBuffer=[Yc],Jr.drawBuffer=Ge(zt.maxDrawbuffers,function(Se){return Se===0?[0]:Ge(Se,function(ie){return ed+ie})}));var vi=0;function ii(){var Se=Sn(),ie=Se.link,Ze=Se.global;Se.id=vi++,Se.batchId="0";var ft=ie(Gr),Rt=Se.shared={props:"a0"};Object.keys(Gr).forEach(function(Ve){Rt[Ve]=Ze.def(ft,".",Ve)}),de.optional(function(){Se.CHECK=ie(de),Se.commandStr=de.guessCommand(),Se.command=ie(Se.commandStr),Se.assert=function(Ve,Ce,vt){Ve("if(!(",Ce,"))",this.CHECK,".commandRaise(",ie(vt),",",this.command,");")},Jr.invalidBlendCombinations=Pf});var $e=Se.next={},Fe=Se.current={};Object.keys(ar).forEach(function(Ve){Array.isArray(Or[Ve])&&($e[Ve]=Ze.def(Rt.next,".",Ve),Fe[Ve]=Ze.def(Rt.current,".",Ve))});var st=Se.constants={};Object.keys(Jr).forEach(function(Ve){st[Ve]=Ze.def(JSON.stringify(Jr[Ve]))}),Se.invoke=function(Ve,Ce){switch(Ce.type){case jn:var vt=["this",Rt.context,Rt.props,Se.batchId];return Ve.def(ie(Ce.data),".call(",vt.slice(0,Math.max(Ce.data.length+1,4)),")");case Tn:return Ve.def(Rt.props,Ce.data);case qi:return Ve.def(Rt.context,Ce.data);case Ya:return Ve.def("this",Ce.data);case ni:return Ce.data.append(Se,Ve),Ce.data.ref;case zo:return Ce.data.toString();case Va:return Ce.data.map(function(Tt){return Se.invoke(Ve,Tt)})}},Se.attribCache={};var _e={};return Se.scopeAttrib=function(Ve){var Ce=me.id(Ve);if(Ce in _e)return _e[Ce];var vt=Be.scope[Ce];vt||(vt=Be.scope[Ce]=new ht);var Tt=_e[Ce]=ie(vt);return Tt},Se}function Wr(Se){var ie=Se.static,Ze=Se.dynamic,ft;if(yc in ie){var Rt=!!ie[yc];ft=Eo(function(Fe,st){return Rt}),ft.enable=Rt}else if(yc in Ze){var $e=Ze[yc];ft=tu($e,function(Fe,st){return Fe.invoke(st,$e)})}return ft}function an(Se,ie){var Ze=Se.static,ft=Se.dynamic;if(Js in Ze){var Rt=Ze[Js];return Rt?(Rt=nt.getFramebuffer(Rt),de.command(Rt,"invalid framebuffer object"),Eo(function(Fe,st){var _e=Fe.link(Rt),Ve=Fe.shared;st.set(Ve.framebuffer,".next",_e);var Ce=Ve.context;return st.set(Ce,"."+ws,_e+".width"),st.set(Ce,"."+bf,_e+".height"),_e})):Eo(function(Fe,st){var _e=Fe.shared;st.set(_e.framebuffer,".next","null");var Ve=_e.context;return st.set(Ve,"."+ws,Ve+"."+_c),st.set(Ve,"."+bf,Ve+"."+Kp),"null"})}else if(Js in ft){var $e=ft[Js];return tu($e,function(Fe,st){var _e=Fe.invoke(st,$e),Ve=Fe.shared,Ce=Ve.framebuffer,vt=st.def(Ce,".getFramebuffer(",_e,")");de.optional(function(){Fe.assert(st,"!"+_e+"||"+vt,"invalid framebuffer object")}),st.set(Ce,".next",vt);var Tt=Ve.context;return st.set(Tt,"."+ws,vt+"?"+vt+".width:"+Tt+"."+_c),st.set(Tt,"."+bf,vt+"?"+vt+".height:"+Tt+"."+Kp),vt})}else return null}function Jn(Se,ie,Ze){var ft=Se.static,Rt=Se.dynamic;function $e(_e){if(_e in ft){var Ve=ft[_e];de.commandType(Ve,"object","invalid "+_e,Ze.commandStr);var Ce=!0,vt=Ve.x|0,Tt=Ve.y|0,dr,zr;return"width"in Ve?(dr=Ve.width|0,de.command(dr>=0,"invalid "+_e,Ze.commandStr)):Ce=!1,"height"in Ve?(zr=Ve.height|0,de.command(zr>=0,"invalid "+_e,Ze.commandStr)):Ce=!1,new va(!Ce&&ie&&ie.thisDep,!Ce&&ie&&ie.contextDep,!Ce&&ie&&ie.propDep,function(Fr,En){var cn=Fr.shared.context,bn=dr;"width"in Ve||(bn=En.def(cn,".",ws,"-",vt));var yn=zr;return"height"in Ve||(yn=En.def(cn,".",bf,"-",Tt)),[vt,Tt,bn,yn]})}else if(_e in Rt){var Br=Rt[_e],rn=tu(Br,function(Fr,En){var cn=Fr.invoke(En,Br);de.optional(function(){Fr.assert(En,cn+"&&typeof "+cn+'==="object"',"invalid "+_e)});var bn=Fr.shared.context,yn=En.def(cn,".x|0"),pn=En.def(cn,".y|0"),$n=En.def('"width" in ',cn,"?",cn,".width|0:","(",bn,".",ws,"-",yn,")"),ma=En.def('"height" in ',cn,"?",cn,".height|0:","(",bn,".",bf,"-",pn,")");return de.optional(function(){Fr.assert(En,$n+">=0&&"+ma+">=0","invalid "+_e)}),[yn,pn,$n,ma]});return ie&&(rn.thisDep=rn.thisDep||ie.thisDep,rn.contextDep=rn.contextDep||ie.contextDep,rn.propDep=rn.propDep||ie.propDep),rn}else return ie?new va(ie.thisDep,ie.contextDep,ie.propDep,function(Fr,En){var cn=Fr.shared.context;return[0,0,En.def(cn,".",ws),En.def(cn,".",bf)]}):null}var Fe=$e(Qs);if(Fe){var st=Fe;Fe=new va(Fe.thisDep,Fe.contextDep,Fe.propDep,function(_e,Ve){var Ce=st.append(_e,Ve),vt=_e.shared.context;return Ve.set(vt,"."+Rl,Ce[2]),Ve.set(vt,"."+qp,Ce[3]),Ce})}return{viewport:Fe,scissor_box:$e(xf)}}function fi(Se,ie){var Ze=Se.static,ft=typeof Ze[Gc]=="string"&&typeof Ze[Ol]=="string";if(ft){if(Object.keys(ie.dynamic).length>0)return null;var Rt=ie.static,$e=Object.keys(Rt);if($e.length>0&&typeof Rt[$e[0]]=="number"){for(var Fe=[],st=0;st<$e.length;++st)de(typeof Rt[$e[st]]=="number","must specify all vertex attribute locations when using vaos"),Fe.push([Rt[$e[st]]|0,$e[st]]);return Fe}}return null}function Di(Se,ie,Ze){var ft=Se.static,Rt=Se.dynamic;function $e(Ce){if(Ce in ft){var vt=me.id(ft[Ce]);de.optional(function(){Pr.shader(If[Ce],vt,de.guessCommand())});var Tt=Eo(function(){return vt});return Tt.id=vt,Tt}else if(Ce in Rt){var dr=Rt[Ce];return tu(dr,function(zr,Br){var rn=zr.invoke(Br,dr),Fr=Br.def(zr.shared.strings,".id(",rn,")");return de.optional(function(){Br(zr.shared.shader,".shader(",If[Ce],",",Fr,",",zr.command,");")}),Fr})}return null}var Fe=$e(Gc),st=$e(Ol),_e=null,Ve;return bc(Fe)&&bc(st)?(_e=Pr.program(st.id,Fe.id,null,Ze),Ve=Eo(function(Ce,vt){return Ce.link(_e)})):Ve=new va(Fe&&Fe.thisDep||st&&st.thisDep,Fe&&Fe.contextDep||st&&st.contextDep,Fe&&Fe.propDep||st&&st.propDep,function(Ce,vt){var Tt=Ce.shared.shader,dr;Fe?dr=Fe.append(Ce,vt):dr=vt.def(Tt,".",Gc);var zr;st?zr=st.append(Ce,vt):zr=vt.def(Tt,".",Ol);var Br=Tt+".program("+zr+","+dr;return de.optional(function(){Br+=","+Ce.command}),vt.def(Br+")")}),{frag:Fe,vert:st,progVar:Ve,program:_e}}function ro(Se,ie){var Ze=Se.static,ft=Se.dynamic,Rt={},$e=!1;function Fe(){if($f in Ze){var En=Ze[$f];return En!==null&&Be.getVAO(En)===null&&(En=Be.createVAO(En)),$e=!0,Rt.vao=En,Eo(function(bn){var yn=Be.getVAO(En);return yn?bn.link(yn):"null"})}else if($f in ft){$e=!0;var cn=ft[$f];return tu(cn,function(bn,yn){var pn=bn.invoke(yn,cn);return yn.def(bn.shared.vao+".getVAO("+pn+")")})}return null}var st=Fe(),_e=!1;function Ve(){if(hu in Ze){var En=Ze[hu];if(Rt.elements=En,Bh(En)){var cn=Rt.elements=Dt.create(En,!0);En=Dt.getElements(cn),_e=!0}else En&&(En=Dt.getElements(En),_e=!0,de.command(En,"invalid elements",ie.commandStr));var bn=Eo(function(pn,$n){if(En){var ma=pn.link(En);return pn.ELEMENTS=ma,ma}return pn.ELEMENTS=null,null});return bn.value=En,bn}else if(hu in ft){_e=!0;var yn=ft[hu];return tu(yn,function(pn,$n){var ma=pn.shared,Jo=ma.isBufferArgs,Da=ma.elements,fa=pn.invoke($n,yn),fl=$n.def("null"),Rs=$n.def(Jo,"(",fa,")"),hl=pn.cond(Rs).then(fl,"=",Da,".createStream(",fa,");").else(fl,"=",Da,".getElements(",fa,");");return de.optional(function(){pn.assert(hl.else,"!"+fa+"||"+fl,"invalid elements")}),$n.entry(hl),$n.exit(pn.cond(Rs).then(Da,".destroyStream(",fl,");")),pn.ELEMENTS=fl,fl})}else if($e)return new va(st.thisDep,st.contextDep,st.propDep,function(pn,$n){return $n.def(pn.shared.vao+".currentVAO?"+pn.shared.elements+".getElements("+pn.shared.vao+".currentVAO.elements):null")});return null}var Ce=Ve();function vt(){if(bo in Ze){var En=Ze[bo];return Rt.primitive=En,de.commandParameter(En,fr,"invalid primitve",ie.commandStr),Eo(function(bn,yn){return fr[En]})}else if(bo in ft){var cn=ft[bo];return tu(cn,function(bn,yn){var pn=bn.constants.primTypes,$n=bn.invoke(yn,cn);return de.optional(function(){bn.assert(yn,$n+" in "+pn,"invalid primitive, must be one of "+Object.keys(fr))}),yn.def(pn,"[",$n,"]")})}else{if(_e)return bc(Ce)?Ce.value?Eo(function(bn,yn){return yn.def(bn.ELEMENTS,".primType")}):Eo(function(){return kh}):new va(Ce.thisDep,Ce.contextDep,Ce.propDep,function(bn,yn){var pn=bn.ELEMENTS;return yn.def(pn,"?",pn,".primType:",kh)});if($e)return new va(st.thisDep,st.contextDep,st.propDep,function(bn,yn){return yn.def(bn.shared.vao+".currentVAO?"+bn.shared.vao+".currentVAO.primitive:"+kh)})}return null}function Tt(En,cn){if(En in Ze){var bn=Ze[En]|0;return cn?Rt.offset=bn:Rt.instances=bn,de.command(!cn||bn>=0,"invalid "+En,ie.commandStr),Eo(function(pn,$n){return cn&&(pn.OFFSET=bn),bn})}else if(En in ft){var yn=ft[En];return tu(yn,function(pn,$n){var ma=pn.invoke($n,yn);return cn&&(pn.OFFSET=ma,de.optional(function(){pn.assert($n,ma+">=0","invalid "+En)})),ma})}else if(cn){if(_e)return Eo(function(pn,$n){return pn.OFFSET=0,0});if($e)return new va(st.thisDep,st.contextDep,st.propDep,function(pn,$n){return $n.def(pn.shared.vao+".currentVAO?"+pn.shared.vao+".currentVAO.offset:0")})}else if($e)return new va(st.thisDep,st.contextDep,st.propDep,function(pn,$n){return $n.def(pn.shared.vao+".currentVAO?"+pn.shared.vao+".currentVAO.instances:-1")});return null}var dr=Tt(Kf,!0);function zr(){if(Hc in Ze){var En=Ze[Hc]|0;return Rt.count=En,de.command(typeof En=="number"&&En>=0,"invalid vertex count",ie.commandStr),Eo(function(){return En})}else if(Hc in ft){var cn=ft[Hc];return tu(cn,function($n,ma){var Jo=$n.invoke(ma,cn);return de.optional(function(){$n.assert(ma,"typeof "+Jo+'==="number"&&'+Jo+">=0&&"+Jo+"===("+Jo+"|0)","invalid vertex count")}),Jo})}else if(_e)if(bc(Ce)){if(Ce)return dr?new va(dr.thisDep,dr.contextDep,dr.propDep,function($n,ma){var Jo=ma.def($n.ELEMENTS,".vertCount-",$n.OFFSET);return de.optional(function(){$n.assert(ma,Jo+">=0","invalid vertex offset/element buffer too small")}),Jo}):Eo(function($n,ma){return ma.def($n.ELEMENTS,".vertCount")});var bn=Eo(function(){return-1});return de.optional(function(){bn.MISSING=!0}),bn}else{var yn=new va(Ce.thisDep||dr.thisDep,Ce.contextDep||dr.contextDep,Ce.propDep||dr.propDep,function($n,ma){var Jo=$n.ELEMENTS;return $n.OFFSET?ma.def(Jo,"?",Jo,".vertCount-",$n.OFFSET,":-1"):ma.def(Jo,"?",Jo,".vertCount:-1")});return de.optional(function(){yn.DYNAMIC=!0}),yn}else if($e){var pn=new va(st.thisDep,st.contextDep,st.propDep,function($n,ma){return ma.def($n.shared.vao,".currentVAO?",$n.shared.vao,".currentVAO.count:-1")});return pn}return null}var Br=vt(),rn=zr(),Fr=Tt(Oh,!1);return{elements:Ce,primitive:Br,count:rn,instances:Fr,offset:dr,vao:st,vaoActive:$e,elementsActive:_e,static:Rt}}function no(Se,ie){var Ze=Se.static,ft=Se.dynamic,Rt={};return Bn.forEach(function($e){var Fe=xn($e);function st(_e,Ve){if($e in Ze){var Ce=_e(Ze[$e]);Rt[Fe]=Eo(function(){return Ce})}else if($e in ft){var vt=ft[$e];Rt[Fe]=tu(vt,function(Tt,dr){return Ve(Tt,dr,Tt.invoke(dr,vt))})}}switch($e){case ql:case is:case to:case ea:case Vs:case Kl:case wu:case Nu:case ul:case Pl:return st(function(_e){return de.commandType(_e,"boolean",$e,ie.commandStr),_e},function(_e,Ve,Ce){return de.optional(function(){_e.assert(Ve,"typeof "+Ce+'==="boolean"',"invalid flag "+$e,_e.commandStr)}),Ce});case As:return st(function(_e){return de.commandParameter(_e,qc,"invalid "+$e,ie.commandStr),qc[_e]},function(_e,Ve,Ce){var vt=_e.constants.compareFuncs;return de.optional(function(){_e.assert(Ve,Ce+" in "+vt,"invalid "+$e+", must be one of "+Object.keys(qc))}),Ve.def(vt,"[",Ce,"]")});case Vc:return st(function(_e){return de.command(la(_e)&&_e.length===2&&typeof _e[0]=="number"&&typeof _e[1]=="number"&&_e[0]<=_e[1],"depth range is 2d array",ie.commandStr),_e},function(_e,Ve,Ce){de.optional(function(){_e.assert(Ve,_e.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===2&&typeof "+Ce+'[0]==="number"&&typeof '+Ce+'[1]==="number"&&'+Ce+"[0]<="+Ce+"[1]","depth range must be a 2d array")});var vt=Ve.def("+",Ce,"[0]"),Tt=Ve.def("+",Ce,"[1]");return[vt,Tt]});case as:return st(function(_e){de.commandType(_e,"object","blend.func",ie.commandStr);var Ve="srcRGB"in _e?_e.srcRGB:_e.src,Ce="srcAlpha"in _e?_e.srcAlpha:_e.src,vt="dstRGB"in _e?_e.dstRGB:_e.dst,Tt="dstAlpha"in _e?_e.dstAlpha:_e.dst;return de.commandParameter(Ve,Fl,Fe+".srcRGB",ie.commandStr),de.commandParameter(Ce,Fl,Fe+".srcAlpha",ie.commandStr),de.commandParameter(vt,Fl,Fe+".dstRGB",ie.commandStr),de.commandParameter(Tt,Fl,Fe+".dstAlpha",ie.commandStr),de.command(Pf.indexOf(Ve+", "+vt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ve+", "+vt+")",ie.commandStr),[Fl[Ve],Fl[vt],Fl[Ce],Fl[Tt]]},function(_e,Ve,Ce){var vt=_e.constants.blendFuncs;de.optional(function(){_e.assert(Ve,Ce+"&&typeof "+Ce+'==="object"',"invalid blend func, must be an object")});function Tt(cn,bn){var yn=Ve.def('"',cn,bn,'" in ',Ce,"?",Ce,".",cn,bn,":",Ce,".",cn);return de.optional(function(){_e.assert(Ve,yn+" in "+vt,"invalid "+$e+"."+cn+bn+", must be one of "+Object.keys(Fl))}),yn}var dr=Tt("src","RGB"),zr=Tt("dst","RGB");de.optional(function(){var cn=_e.constants.invalidBlendCombinations;_e.assert(Ve,cn+".indexOf("+dr+'+", "+'+zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Br=Ve.def(vt,"[",dr,"]"),rn=Ve.def(vt,"[",Tt("src","Alpha"),"]"),Fr=Ve.def(vt,"[",zr,"]"),En=Ve.def(vt,"[",Tt("dst","Alpha"),"]");return[Br,Fr,rn,En]});case Fu:return st(function(_e){if(typeof _e=="string")return de.commandParameter(_e,Wt,"invalid "+$e,ie.commandStr),[Wt[_e],Wt[_e]];if(typeof _e=="object")return de.commandParameter(_e.rgb,Wt,$e+".rgb",ie.commandStr),de.commandParameter(_e.alpha,Wt,$e+".alpha",ie.commandStr),[Wt[_e.rgb],Wt[_e.alpha]];de.commandRaise("invalid blend.equation",ie.commandStr)},function(_e,Ve,Ce){var vt=_e.constants.blendEquations,Tt=Ve.def(),dr=Ve.def(),zr=_e.cond("typeof ",Ce,'==="string"');return de.optional(function(){function Br(rn,Fr,En){_e.assert(rn,En+" in "+vt,"invalid "+Fr+", must be one of "+Object.keys(Wt))}Br(zr.then,$e,Ce),_e.assert(zr.else,Ce+"&&typeof "+Ce+'==="object"',"invalid "+$e),Br(zr.else,$e+".rgb",Ce+".rgb"),Br(zr.else,$e+".alpha",Ce+".alpha")}),zr.then(Tt,"=",dr,"=",vt,"[",Ce,"];"),zr.else(Tt,"=",vt,"[",Ce,".rgb];",dr,"=",vt,"[",Ce,".alpha];"),Ve(zr),[Tt,dr]});case vs:return st(function(_e){return de.command(la(_e)&&_e.length===4,"blend.color must be a 4d array",ie.commandStr),Ge(4,function(Ve){return+_e[Ve]})},function(_e,Ve,Ce){return de.optional(function(){_e.assert(Ve,_e.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","blend.color must be a 4d array")}),Ge(4,function(vt){return Ve.def("+",Ce,"[",vt,"]")})});case Uo:return st(function(_e){return de.commandType(_e,"number",Fe,ie.commandStr),_e|0},function(_e,Ve,Ce){return de.optional(function(){_e.assert(Ve,"typeof "+Ce+'==="number"',"invalid stencil.mask")}),Ve.def(Ce,"|0")});case ms:return st(function(_e){de.commandType(_e,"object",Fe,ie.commandStr);var Ve=_e.cmp||"keep",Ce=_e.ref||0,vt="mask"in _e?_e.mask:-1;return de.commandParameter(Ve,qc,$e+".cmp",ie.commandStr),de.commandType(Ce,"number",$e+".ref",ie.commandStr),de.commandType(vt,"number",$e+".mask",ie.commandStr),[qc[Ve],Ce,vt]},function(_e,Ve,Ce){var vt=_e.constants.compareFuncs;de.optional(function(){function Br(){_e.assert(Ve,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Br(Ce+"&&typeof ",Ce,'==="object"'),Br('!("cmp" in ',Ce,")||(",Ce,".cmp in ",vt,")")});var Tt=Ve.def('"cmp" in ',Ce,"?",vt,"[",Ce,".cmp]",":",mu),dr=Ve.def(Ce,".ref|0"),zr=Ve.def('"mask" in ',Ce,"?",Ce,".mask|0:-1");return[Tt,dr,zr]});case zu:case gc:return st(function(_e){de.commandType(_e,"object",Fe,ie.commandStr);var Ve=_e.fail||"keep",Ce=_e.zfail||"keep",vt=_e.zpass||"keep";return de.commandParameter(Ve,Ql,$e+".fail",ie.commandStr),de.commandParameter(Ce,Ql,$e+".zfail",ie.commandStr),de.commandParameter(vt,Ql,$e+".zpass",ie.commandStr),[$e===gc?Yc:Dl,Ql[Ve],Ql[Ce],Ql[vt]]},function(_e,Ve,Ce){var vt=_e.constants.stencilOps;de.optional(function(){_e.assert(Ve,Ce+"&&typeof "+Ce+'==="object"',"invalid "+$e)});function Tt(dr){return de.optional(function(){_e.assert(Ve,'!("'+dr+'" in '+Ce+")||("+Ce+"."+dr+" in "+vt+")","invalid "+$e+"."+dr+", must be one of "+Object.keys(Ql))}),Ve.def('"',dr,'" in ',Ce,"?",vt,"[",Ce,".",dr,"]:",mu)}return[$e===gc?Yc:Dl,Tt("fail"),Tt("zfail"),Tt("zpass")]});case xo:return st(function(_e){de.commandType(_e,"object",Fe,ie.commandStr);var Ve=_e.factor|0,Ce=_e.units|0;return de.commandType(Ve,"number",Fe+".factor",ie.commandStr),de.commandType(Ce,"number",Fe+".units",ie.commandStr),[Ve,Ce]},function(_e,Ve,Ce){de.optional(function(){_e.assert(Ve,Ce+"&&typeof "+Ce+'==="object"',"invalid "+$e)});var vt=Ve.def(Ce,".factor|0"),Tt=Ve.def(Ce,".units|0");return[vt,Tt]});case mc:return st(function(_e){var Ve=0;return _e==="front"?Ve=Dl:_e==="back"&&(Ve=Yc),de.command(!!Ve,Fe,ie.commandStr),Ve},function(_e,Ve,Ce){return de.optional(function(){_e.assert(Ve,Ce+'==="front"||'+Ce+'==="back"',"invalid cull.face")}),Ve.def(Ce,'==="front"?',Dl,":",Yc)});case Il:return st(function(_e){return de.command(typeof _e=="number"&&_e>=zt.lineWidthDims[0]&&_e<=zt.lineWidthDims[1],"invalid line width, must be a positive number between "+zt.lineWidthDims[0]+" and "+zt.lineWidthDims[1],ie.commandStr),_e},function(_e,Ve,Ce){return de.optional(function(){_e.assert(Ve,"typeof "+Ce+'==="number"&&'+Ce+">="+zt.lineWidthDims[0]+"&&"+Ce+"<="+zt.lineWidthDims[1],"invalid line width")}),Ce});case $s:return st(function(_e){return de.commandParameter(_e,dp,Fe,ie.commandStr),dp[_e]},function(_e,Ve,Ce){return de.optional(function(){_e.assert(Ve,Ce+'==="cw"||'+Ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ve.def(Ce+'==="cw"?'+$p+":"+Dh)});case Bu:return st(function(_e){return de.command(la(_e)&&_e.length===4,"color.mask must be length 4 array",ie.commandStr),_e.map(function(Ve){return!!Ve})},function(_e,Ve,Ce){return de.optional(function(){_e.assert(Ve,_e.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","invalid color.mask")}),Ge(4,function(vt){return"!!"+Ce+"["+vt+"]"})});case $o:return st(function(_e){de.command(typeof _e=="object"&&_e,Fe,ie.commandStr);var Ve="value"in _e?_e.value:1,Ce=!!_e.invert;return de.command(typeof Ve=="number"&&Ve>=0&&Ve<=1,"sample.coverage.value must be a number between 0 and 1",ie.commandStr),[Ve,Ce]},function(_e,Ve,Ce){de.optional(function(){_e.assert(Ve,Ce+"&&typeof "+Ce+'==="object"',"invalid sample.coverage")});var vt=Ve.def('"value" in ',Ce,"?+",Ce,".value:1"),Tt=Ve.def("!!",Ce,".invert");return[vt,Tt]})}}),Rt}function Fi(Se,ie){var Ze=Se.static,ft=Se.dynamic,Rt={};return Object.keys(Ze).forEach(function($e){var Fe=Ze[$e],st;if(typeof Fe=="number"||typeof Fe=="boolean")st=Eo(function(){return Fe});else if(typeof Fe=="function"){var _e=Fe._reglType;_e==="texture2d"||_e==="textureCube"?st=Eo(function(Ve){return Ve.link(Fe)}):_e==="framebuffer"||_e==="framebufferCube"?(de.command(Fe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+$e+'"',ie.commandStr),st=Eo(function(Ve){return Ve.link(Fe.color[0])})):de.commandRaise('invalid data for uniform "'+$e+'"',ie.commandStr)}else la(Fe)?st=Eo(function(Ve){var Ce=Ve.global.def("[",Ge(Fe.length,function(vt){return de.command(typeof Fe[vt]=="number"||typeof Fe[vt]=="boolean","invalid uniform "+$e,Ve.commandStr),Fe[vt]}),"]");return Ce}):de.commandRaise('invalid or missing data for uniform "'+$e+'"',ie.commandStr);st.value=Fe,Rt[$e]=st}),Object.keys(ft).forEach(function($e){var Fe=ft[$e];Rt[$e]=tu(Fe,function(st,_e){return st.invoke(_e,Fe)})}),Rt}function gs(Se,ie){var Ze=Se.static,ft=Se.dynamic,Rt={};return Object.keys(Ze).forEach(function($e){var Fe=Ze[$e],st=me.id($e),_e=new ht;if(Bh(Fe))_e.state=Yn,_e.buffer=cr.getBuffer(cr.create(Fe,Ef,!1,!0)),_e.type=0;else{var Ve=cr.getBuffer(Fe);if(Ve)_e.state=Yn,_e.buffer=Ve,_e.type=0;else if(de.command(typeof Fe=="object"&&Fe,"invalid data for attribute "+$e,ie.commandStr),"constant"in Fe){var Ce=Fe.constant;_e.buffer="null",_e.state=di,typeof Ce=="number"?_e.x=Ce:(de.command(la(Ce)&&Ce.length>0&&Ce.length<=4,"invalid constant for attribute "+$e,ie.commandStr),Qn.forEach(function(Fr,En){En<Ce.length&&(_e[Fr]=Ce[En])}))}else{Bh(Fe.buffer)?Ve=cr.getBuffer(cr.create(Fe.buffer,Ef,!1,!0)):Ve=cr.getBuffer(Fe.buffer),de.command(!!Ve,'missing buffer for attribute "'+$e+'"',ie.commandStr);var vt=Fe.offset|0;de.command(vt>=0,'invalid offset for attribute "'+$e+'"',ie.commandStr);var Tt=Fe.stride|0;de.command(Tt>=0&&Tt<256,'invalid stride for attribute "'+$e+'", must be integer betweeen [0, 255]',ie.commandStr);var dr=Fe.size|0;de.command(!("size"in Fe)||dr>0&&dr<=4,'invalid size for attribute "'+$e+'", must be 1,2,3,4',ie.commandStr);var zr=!!Fe.normalized,Br=0;"type"in Fe&&(de.commandParameter(Fe.type,uu,"invalid type for attribute "+$e,ie.commandStr),Br=uu[Fe.type]);var rn=Fe.divisor|0;de.optional(function(){"divisor"in Fe&&(de.command(rn===0||xr,'cannot specify divisor for attribute "'+$e+'", instancing not supported',ie.commandStr),de.command(rn>=0,'invalid divisor for attribute "'+$e+'"',ie.commandStr));var Fr=ie.commandStr,En=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Fe).forEach(function(cn){de.command(En.indexOf(cn)>=0,'unknown parameter "'+cn+'" for attribute pointer "'+$e+'" (valid parameters are '+En+")",Fr)})}),_e.buffer=Ve,_e.state=Yn,_e.size=dr,_e.normalized=zr,_e.type=Br||Ve.dtype,_e.offset=vt,_e.stride=Tt,_e.divisor=rn}}Rt[$e]=Eo(function(Fr,En){var cn=Fr.attribCache;if(st in cn)return cn[st];var bn={isStream:!1};return Object.keys(_e).forEach(function(yn){bn[yn]=_e[yn]}),_e.buffer&&(bn.buffer=Fr.link(_e.buffer),bn.type=bn.type||bn.buffer+".dtype"),cn[st]=bn,bn})}),Object.keys(ft).forEach(function($e){var Fe=ft[$e];function st(_e,Ve){var Ce=_e.invoke(Ve,Fe),vt=_e.shared,Tt=_e.constants,dr=vt.isBufferArgs,zr=vt.buffer;de.optional(function(){_e.assert(Ve,Ce+"&&(typeof "+Ce+'==="object"||typeof '+Ce+'==="function")&&('+dr+"("+Ce+")||"+zr+".getBuffer("+Ce+")||"+zr+".getBuffer("+Ce+".buffer)||"+dr+"("+Ce+'.buffer)||("constant" in '+Ce+"&&(typeof "+Ce+'.constant==="number"||'+vt.isArrayLike+"("+Ce+".constant))))",'invalid dynamic attribute "'+$e+'"')});var Br={isStream:Ve.def(!1)},rn=new ht;rn.state=Yn,Object.keys(rn).forEach(function(bn){Br[bn]=Ve.def(""+rn[bn])});var Fr=Br.buffer,En=Br.type;Ve("if(",dr,"(",Ce,")){",Br.isStream,"=true;",Fr,"=",zr,".createStream(",Ef,",",Ce,");",En,"=",Fr,".dtype;","}else{",Fr,"=",zr,".getBuffer(",Ce,");","if(",Fr,"){",En,"=",Fr,".dtype;",'}else if("constant" in ',Ce,"){",Br.state,"=",di,";","if(typeof "+Ce+'.constant === "number"){',Br[Qn[0]],"=",Ce,".constant;",Qn.slice(1).map(function(bn){return Br[bn]}).join("="),"=0;","}else{",Qn.map(function(bn,yn){return Br[bn]+"="+Ce+".constant.length>"+yn+"?"+Ce+".constant["+yn+"]:0;"}).join(""),"}}else{","if(",dr,"(",Ce,".buffer)){",Fr,"=",zr,".createStream(",Ef,",",Ce,".buffer);","}else{",Fr,"=",zr,".getBuffer(",Ce,".buffer);","}",En,'="type" in ',Ce,"?",Tt.glTypes,"[",Ce,".type]:",Fr,".dtype;",Br.normalized,"=!!",Ce,".normalized;");function cn(bn){Ve(Br[bn],"=",Ce,".",bn,"|0;")}return cn("size"),cn("offset"),cn("stride"),cn("divisor"),Ve("}}"),Ve.exit("if(",Br.isStream,"){",zr,".destroyStream(",Fr,");","}"),Br}Rt[$e]=tu(Fe,st)}),Rt}function Ga(Se){var ie=Se.static,Ze=Se.dynamic,ft={};return Object.keys(ie).forEach(function(Rt){var $e=ie[Rt];ft[Rt]=Eo(function(Fe,st){return typeof $e=="number"||typeof $e=="boolean"?""+$e:Fe.link($e)})}),Object.keys(Ze).forEach(function(Rt){var $e=Ze[Rt];ft[Rt]=tu($e,function(Fe,st){return Fe.invoke(st,$e)})}),ft}function jo(Se,ie,Ze,ft,Rt){var $e=Se.static,Fe=Se.dynamic;de.optional(function(){var cn=[Js,Ol,Gc,hu,bo,Kf,Hc,Oh,yc,$f].concat(Bn);function bn(yn){Object.keys(yn).forEach(function(pn){de.command(cn.indexOf(pn)>=0,'unknown parameter "'+pn+'"',Rt.commandStr)})}bn($e),bn(Fe)});var st=fi(Se,ie),_e=an(Se,Rt),Ve=Jn(Se,_e,Rt),Ce=ro(Se,Rt),vt=no(Se,Rt),Tt=Di(Se,Rt,st);function dr(cn){var bn=Ve[cn];bn&&(vt[cn]=bn)}dr(Qs),dr(xn(xf));var zr=Object.keys(vt).length>0,Br={framebuffer:_e,draw:Ce,shader:Tt,state:vt,dirty:zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Br.profile=Wr(Se,Rt),Br.uniforms=Fi(Ze,Rt),Br.drawVAO=Br.scopeVAO=Ce.vao,!Br.drawVAO&&Tt.program&&!st&&ze.angle_instanced_arrays&&Ce.static.elements){var rn=!0,Fr=Tt.program.attributes.map(function(cn){var bn=ie.static[cn];return rn=rn&&!!bn,bn});if(rn&&Fr.length>0){var En=Be.getVAO(Be.createVAO({attributes:Fr,elements:Ce.static.elements}));Br.drawVAO=new va(null,null,null,function(cn,bn){return cn.link(En)}),Br.useVAO=!0}}return st?Br.useVAO=!0:Br.attributes=gs(ie,Rt),Br.context=Ga(ft,Rt),Br}function vo(Se,ie,Ze){var ft=Se.shared,Rt=ft.context,$e=Se.scope();Object.keys(Ze).forEach(function(Fe){ie.save(Rt,"."+Fe);var st=Ze[Fe],_e=st.append(Se,ie);Array.isArray(_e)?$e(Rt,".",Fe,"=[",_e.join(),"];"):$e(Rt,".",Fe,"=",_e,";")}),ie($e)}function Qo(Se,ie,Ze,ft){var Rt=Se.shared,$e=Rt.gl,Fe=Rt.framebuffer,st;Nr&&(st=ie.def(Rt.extensions,".webgl_draw_buffers"));var _e=Se.constants,Ve=_e.drawBuffer,Ce=_e.backBuffer,vt;Ze?vt=Ze.append(Se,ie):vt=ie.def(Fe,".next"),ft||ie("if(",vt,"!==",Fe,".cur){"),ie("if(",vt,"){",$e,".bindFramebuffer(",Jp,",",vt,".framebuffer);"),Nr&&ie(st,".drawBuffersWEBGL(",Ve,"[",vt,".colorAttachments.length]);"),ie("}else{",$e,".bindFramebuffer(",Jp,",null);"),Nr&&ie(st,".drawBuffersWEBGL(",Ce,");"),ie("}",Fe,".cur=",vt,";"),ft||ie("}")}function Ro(Se,ie,Ze){var ft=Se.shared,Rt=ft.gl,$e=Se.current,Fe=Se.next,st=ft.current,_e=ft.next,Ve=Se.cond(st,".dirty");Bn.forEach(function(Ce){var vt=xn(Ce);if(!(vt in Ze.state)){var Tt,dr;if(vt in Fe){Tt=Fe[vt],dr=$e[vt];var zr=Ge(Or[vt].length,function(rn){return Ve.def(Tt,"[",rn,"]")});Ve(Se.cond(zr.map(function(rn,Fr){return rn+"!=="+dr+"["+Fr+"]"}).join("||")).then(Rt,".",ar[vt],"(",zr,");",zr.map(function(rn,Fr){return dr+"["+Fr+"]="+rn}).join(";"),";"))}else{Tt=Ve.def(_e,".",vt);var Br=Se.cond(Tt,"!==",st,".",vt);Ve(Br),vt in rr?Br(Se.cond(Tt).then(Rt,".enable(",rr[vt],");").else(Rt,".disable(",rr[vt],");"),st,".",vt,"=",Tt,";"):Br(Rt,".",ar[vt],"(",Tt,");",st,".",vt,"=",Tt,";")}}}),Object.keys(Ze.state).length===0&&Ve(st,".dirty=false;"),ie(Ve)}function us(Se,ie,Ze,ft){var Rt=Se.shared,$e=Se.current,Fe=Rt.current,st=Rt.gl;vp(Object.keys(Ze)).forEach(function(_e){var Ve=Ze[_e];if(!(ft&&!ft(Ve))){var Ce=Ve.append(Se,ie);if(rr[_e]){var vt=rr[_e];bc(Ve)?Ce?ie(st,".enable(",vt,");"):ie(st,".disable(",vt,");"):ie(Se.cond(Ce).then(st,".enable(",vt,");").else(st,".disable(",vt,");")),ie(Fe,".",_e,"=",Ce,";")}else if(la(Ce)){var Tt=$e[_e];ie(st,".",ar[_e],"(",Ce,");",Ce.map(function(dr,zr){return Tt+"["+zr+"]="+dr}).join(";"),";")}else ie(st,".",ar[_e],"(",Ce,");",Fe,".",_e,"=",Ce,";")}})}function so(Se,ie){xr&&(Se.instancing=ie.def(Se.shared.extensions,".angle_instanced_arrays"))}function mi(Se,ie,Ze,ft,Rt){var $e=Se.shared,Fe=Se.stats,st=$e.current,_e=$e.timer,Ve=Ze.profile;function Ce(){var cn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return cn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var vt,Tt;function dr(cn){vt=ie.def(),cn(vt,"=",Ce(),";"),typeof Rt=="string"?cn(Fe,".count+=",Rt,";"):cn(Fe,".count++;"),Er&&(ft?(Tt=ie.def(),cn(Tt,"=",_e,".getNumPendingQueries();")):cn(_e,".beginQuery(",Fe,");"))}function zr(cn){cn(Fe,".cpuTime+=",Ce(),"-",vt,";"),Er&&(ft?cn(_e,".pushScopeStats(",Tt,",",_e,".getNumPendingQueries(),",Fe,");"):cn(_e,".endQuery();"))}function Br(cn){var bn=ie.def(st,".profile");ie(st,".profile=",cn,";"),ie.exit(st,".profile=",bn,";")}var rn;if(Ve){if(bc(Ve)){Ve.enable?(dr(ie),zr(ie.exit),Br("true")):Br("false");return}rn=Ve.append(Se,ie),Br(rn)}else rn=ie.def(st,".profile");var Fr=Se.block();dr(Fr),ie("if(",rn,"){",Fr,"}");var En=Se.block();zr(En),ie.exit("if(",rn,"){",En,"}")}function Vo(Se,ie,Ze,ft,Rt){var $e=Se.shared;function Fe(_e){switch(_e){case Ll:case eh:case th:return 2;case kl:case ll:case xc:return 3;case $l:case Wc:case Xc:return 4;default:return 1}}function st(_e,Ve,Ce){var vt=$e.gl,Tt=ie.def(_e,".location"),dr=ie.def($e.attributes,"[",Tt,"]"),zr=Ce.state,Br=Ce.buffer,rn=[Ce.x,Ce.y,Ce.z,Ce.w],Fr=["buffer","normalized","offset","stride"];function En(){ie("if(!",dr,".buffer){",vt,".enableVertexAttribArray(",Tt,");}");var bn=Ce.type,yn;if(Ce.size?yn=ie.def(Ce.size,"||",Ve):yn=Ve,ie("if(",dr,".type!==",bn,"||",dr,".size!==",yn,"||",Fr.map(function($n){return dr+"."+$n+"!=="+Ce[$n]}).join("||"),"){",vt,".bindBuffer(",Ef,",",Br,".buffer);",vt,".vertexAttribPointer(",[Tt,yn,bn,Ce.normalized,Ce.stride,Ce.offset],");",dr,".type=",bn,";",dr,".size=",yn,";",Fr.map(function($n){return dr+"."+$n+"="+Ce[$n]+";"}).join(""),"}"),xr){var pn=Ce.divisor;ie("if(",dr,".divisor!==",pn,"){",Se.instancing,".vertexAttribDivisorANGLE(",[Tt,pn],");",dr,".divisor=",pn,";}")}}function cn(){ie("if(",dr,".buffer){",vt,".disableVertexAttribArray(",Tt,");",dr,".buffer=null;","}if(",Qn.map(function(bn,yn){return dr+"."+bn+"!=="+rn[yn]}).join("||"),"){",vt,".vertexAttrib4f(",Tt,",",rn,");",Qn.map(function(bn,yn){return dr+"."+bn+"="+rn[yn]+";"}).join(""),"}")}zr===Yn?En():zr===di?cn():(ie("if(",zr,"===",Yn,"){"),En(),ie("}else{"),cn(),ie("}"))}ft.forEach(function(_e){var Ve=_e.name,Ce=Ze.attributes[Ve],vt;if(Ce){if(!Rt(Ce))return;vt=Ce.append(Se,ie)}else{if(!Rt(mp))return;var Tt=Se.scopeAttrib(Ve);de.optional(function(){Se.assert(ie,Tt+".state","missing attribute "+Ve)}),vt={},Object.keys(new ht).forEach(function(dr){vt[dr]=ie.def(Tt,".",dr)})}st(Se.link(_e),Fe(_e.info.type),vt)})}function Qi(Se,ie,Ze,ft,Rt,$e){for(var Fe=Se.shared,st=Fe.gl,_e,Ve=0;Ve<ft.length;++Ve){var Ce=ft[Ve],vt=Ce.name,Tt=Ce.info.type,dr=Ze.uniforms[vt],zr=Se.link(Ce),Br=zr+".location",rn;if(dr){if(!Rt(dr))continue;if(bc(dr)){var Fr=dr.value;if(de.command(Fr!==null&&typeof Fr!="undefined",'missing uniform "'+vt+'"',Se.commandStr),Tt===Tf||Tt===rh){de.command(typeof Fr=="function"&&(Tt===Tf&&(Fr._reglType==="texture2d"||Fr._reglType==="framebuffer")||Tt===rh&&(Fr._reglType==="textureCube"||Fr._reglType==="framebufferCube")),"invalid texture for uniform "+vt,Se.commandStr);var En=Se.link(Fr._texture||Fr.color[0]._texture);ie(st,".uniform1i(",Br,",",En+".bind());"),ie.exit(En,".unbind();")}else if(Tt===eu||Tt===wf||Tt===vu){de.optional(function(){de.command(la(Fr),"invalid matrix for uniform "+vt,Se.commandStr),de.command(Tt===eu&&Fr.length===4||Tt===wf&&Fr.length===9||Tt===vu&&Fr.length===16,"invalid length for matrix uniform "+vt,Se.commandStr)});var cn=Se.global.def("new Float32Array(["+Array.prototype.slice.call(Fr)+"])"),bn=2;Tt===wf?bn=3:Tt===vu&&(bn=4),ie(st,".uniformMatrix",bn,"fv(",Br,",false,",cn,");")}else{switch(Tt){case hp:de.commandType(Fr,"number","uniform "+vt,Se.commandStr),_e="1f";break;case Ll:de.command(la(Fr)&&Fr.length===2,"uniform "+vt,Se.commandStr),_e="2f";break;case kl:de.command(la(Fr)&&Fr.length===3,"uniform "+vt,Se.commandStr),_e="3f";break;case $l:de.command(la(Fr)&&Fr.length===4,"uniform "+vt,Se.commandStr),_e="4f";break;case Af:de.commandType(Fr,"boolean","uniform "+vt,Se.commandStr),_e="1i";break;case Cf:de.commandType(Fr,"number","uniform "+vt,Se.commandStr),_e="1i";break;case th:de.command(la(Fr)&&Fr.length===2,"uniform "+vt,Se.commandStr),_e="2i";break;case eh:de.command(la(Fr)&&Fr.length===2,"uniform "+vt,Se.commandStr),_e="2i";break;case xc:de.command(la(Fr)&&Fr.length===3,"uniform "+vt,Se.commandStr),_e="3i";break;case ll:de.command(la(Fr)&&Fr.length===3,"uniform "+vt,Se.commandStr),_e="3i";break;case Xc:de.command(la(Fr)&&Fr.length===4,"uniform "+vt,Se.commandStr),_e="4i";break;case Wc:de.command(la(Fr)&&Fr.length===4,"uniform "+vt,Se.commandStr),_e="4i";break}ie(st,".uniform",_e,"(",Br,",",la(Fr)?Array.prototype.slice.call(Fr):Fr,");")}continue}else rn=dr.append(Se,ie)}else{if(!Rt(mp))continue;rn=ie.def(Fe.uniforms,"[",me.id(vt),"]")}Tt===Tf?(de(!Array.isArray(rn),"must specify a scalar prop for textures"),ie("if(",rn,"&&",rn,'._reglType==="framebuffer"){',rn,"=",rn,".color[0];","}")):Tt===rh&&(de(!Array.isArray(rn),"must specify a scalar prop for cube maps"),ie("if(",rn,"&&",rn,'._reglType==="framebufferCube"){',rn,"=",rn,".color[0];","}")),de.optional(function(){function Rs(Mu,Ec){Se.assert(ie,Mu,'bad data or missing for uniform "'+vt+'".  '+Ec)}function hl(Mu){de(!Array.isArray(rn),"must not specify an array type for uniform"),Rs("typeof "+rn+'==="'+Mu+'"',"invalid type, expected "+Mu)}function Tu(Mu,Ec){Array.isArray(rn)?de(rn.length===Mu,"must have length "+Mu):Rs(Fe.isArrayLike+"("+rn+")&&"+rn+".length==="+Mu,"invalid vector, should have length "+Mu,Se.commandStr)}function _p(Mu){de(!Array.isArray(rn),"must not specify a value type"),Rs("typeof "+rn+'==="function"&&'+rn+'._reglType==="texture'+(Mu===Qf?"2d":"Cube")+'"',"invalid texture type",Se.commandStr)}switch(Tt){case Cf:hl("number");break;case eh:Tu(2,"number");break;case ll:Tu(3,"number");break;case Wc:Tu(4,"number");break;case hp:hl("number");break;case Ll:Tu(2,"number");break;case kl:Tu(3,"number");break;case $l:Tu(4,"number");break;case Af:hl("boolean");break;case th:Tu(2,"boolean");break;case xc:Tu(3,"boolean");break;case Xc:Tu(4,"boolean");break;case eu:Tu(4,"number");break;case wf:Tu(9,"number");break;case vu:Tu(16,"number");break;case Tf:_p(Qf);break;case rh:_p(Rh);break}});var yn=1;switch(Tt){case Tf:case rh:var pn=ie.def(rn,"._texture");ie(st,".uniform1i(",Br,",",pn,".bind());"),ie.exit(pn,".unbind();");continue;case Cf:case Af:_e="1i";break;case eh:case th:_e="2i",yn=2;break;case ll:case xc:_e="3i",yn=3;break;case Wc:case Xc:_e="4i",yn=4;break;case hp:_e="1f";break;case Ll:_e="2f",yn=2;break;case kl:_e="3f",yn=3;break;case $l:_e="4f",yn=4;break;case eu:_e="Matrix2fv";break;case wf:_e="Matrix3fv";break;case vu:_e="Matrix4fv";break}if(_e.charAt(0)==="M"){ie(st,".uniform",_e,"(",Br,",");var $n=Math.pow(Tt-eu+2,2),ma=Se.global.def("new Float32Array(",$n,")");Array.isArray(rn)?ie("false,(",Ge($n,function(Rs){return ma+"["+Rs+"]="+rn[Rs]}),",",ma,")"):ie("false,(Array.isArray(",rn,")||",rn," instanceof Float32Array)?",rn,":(",Ge($n,function(Rs){return ma+"["+Rs+"]="+rn+"["+Rs+"]"}),",",ma,")"),ie(");")}else if(yn>1){for(var Jo=[],Da=[],fa=0;fa<yn;++fa)Array.isArray(rn)?Da.push(rn[fa]):Da.push(ie.def(rn+"["+fa+"]")),$e&&Jo.push(ie.def());$e&&ie("if(!",Se.batchId,"||",Jo.map(function(Rs,hl){return Rs+"!=="+Da[hl]}).join("||"),"){",Jo.map(function(Rs,hl){return Rs+"="+Da[hl]+";"}).join("")),ie(st,".uniform",_e,"(",Br,",",Da.join(","),");"),$e&&ie("}")}else{if(de(!Array.isArray(rn),"uniform value must not be an array"),$e){var fl=ie.def();ie("if(!",Se.batchId,"||",fl,"!==",rn,"){",fl,"=",rn,";")}ie(st,".uniform",_e,"(",Br,",",rn,");"),$e&&ie("}")}}}function So(Se,ie,Ze,ft){var Rt=Se.shared,$e=Rt.gl,Fe=Rt.draw,st=ft.draw;function _e(){var yn=st.elements,pn,$n=ie;return yn?((yn.contextDep&&ft.contextDynamic||yn.propDep)&&($n=Ze),pn=yn.append(Se,$n),st.elementsActive&&$n("if("+pn+")"+$e+".bindBuffer("+up+","+pn+".buffer.buffer);")):(pn=$n.def(),$n(pn,"=",Fe,".",hu,";","if(",pn,"){",$e,".bindBuffer(",up,",",pn,".buffer.buffer);}","else if(",Rt.vao,".currentVAO){",pn,"=",Se.shared.elements+".getElements("+Rt.vao,".currentVAO.elements);",pr?"":"if("+pn+")"+$e+".bindBuffer("+up+","+pn+".buffer.buffer);","}")),pn}function Ve(){var yn=st.count,pn,$n=ie;return yn?((yn.contextDep&&ft.contextDynamic||yn.propDep)&&($n=Ze),pn=yn.append(Se,$n),de.optional(function(){yn.MISSING&&Se.assert(ie,"false","missing vertex count"),yn.DYNAMIC&&Se.assert($n,pn+">=0","missing vertex count")})):(pn=$n.def(Fe,".",Hc),de.optional(function(){Se.assert($n,pn+">=0","missing vertex count")})),pn}var Ce=_e();function vt(yn){var pn=st[yn];return pn?pn.contextDep&&ft.contextDynamic||pn.propDep?pn.append(Se,Ze):pn.append(Se,ie):ie.def(Fe,".",yn)}var Tt=vt(bo),dr=vt(Kf),zr=Ve();if(typeof zr=="number"){if(zr===0)return}else Ze("if(",zr,"){"),Ze.exit("}");var Br,rn;xr&&(Br=vt(Oh),rn=Se.instancing);var Fr=Ce+".type",En=st.elements&&bc(st.elements)&&!st.vaoActive;function cn(){function yn(){Ze(rn,".drawElementsInstancedANGLE(",[Tt,zr,Fr,dr+"<<(("+Fr+"-"+Xn+")>>1)",Br],");")}function pn(){Ze(rn,".drawArraysInstancedANGLE(",[Tt,dr,zr,Br],");")}Ce&&Ce!=="null"?En?yn():(Ze("if(",Ce,"){"),yn(),Ze("}else{"),pn(),Ze("}")):pn()}function bn(){function yn(){Ze($e+".drawElements("+[Tt,zr,Fr,dr+"<<(("+Fr+"-"+Xn+")>>1)"]+");")}function pn(){Ze($e+".drawArrays("+[Tt,dr,zr]+");")}Ce&&Ce!=="null"?En?yn():(Ze("if(",Ce,"){"),yn(),Ze("}else{"),pn(),Ze("}")):pn()}xr&&(typeof Br!="number"||Br>=0)?typeof Br=="string"?(Ze("if(",Br,">0){"),cn(),Ze("}else if(",Br,"<0){"),bn(),Ze("}")):cn():bn()}function ri(Se,ie,Ze,ft,Rt){var $e=ii(),Fe=$e.proc("body",Rt);return de.optional(function(){$e.commandStr=ie.commandStr,$e.command=$e.link(ie.commandStr)}),xr&&($e.instancing=Fe.def($e.shared.extensions,".angle_instanced_arrays")),Se($e,Fe,Ze,ft),$e.compile().body}function In(Se,ie,Ze,ft){so(Se,ie),Ze.useVAO?Ze.drawVAO?ie(Se.shared.vao,".setVAO(",Ze.drawVAO.append(Se,ie),");"):ie(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(ie(Se.shared.vao,".setVAO(null);"),Vo(Se,ie,Ze,ft.attributes,function(){return!0})),Qi(Se,ie,Ze,ft.uniforms,function(){return!0},!1),So(Se,ie,ie,Ze)}function Zi(Se,ie){var Ze=Se.proc("draw",1);so(Se,Ze),vo(Se,Ze,ie.context),Qo(Se,Ze,ie.framebuffer),Ro(Se,Ze,ie),us(Se,Ze,ie.state),mi(Se,Ze,ie,!1,!0);var ft=ie.shader.progVar.append(Se,Ze);if(Ze(Se.shared.gl,".useProgram(",ft,".program);"),ie.shader.program)In(Se,Ze,ie,ie.shader.program);else{Ze(Se.shared.vao,".setVAO(null);");var Rt=Se.global.def("{}"),$e=Ze.def(ft,".id"),Fe=Ze.def(Rt,"[",$e,"]");Ze(Se.cond(Fe).then(Fe,".call(this,a0);").else(Fe,"=",Rt,"[",$e,"]=",Se.link(function(st){return ri(In,Se,ie,st,1)}),"(",ft,");",Fe,".call(this,a0);"))}Object.keys(ie.state).length>0&&Ze(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ze(Se.shared.vao,".setVAO(null);")}function Co(Se,ie,Ze,ft){Se.batchId="a1",so(Se,ie);function Rt(){return!0}Vo(Se,ie,Ze,ft.attributes,Rt),Qi(Se,ie,Ze,ft.uniforms,Rt,!1),So(Se,ie,ie,Ze)}function zl(Se,ie,Ze,ft){so(Se,ie);var Rt=Ze.contextDep,$e=ie.def(),Fe="a0",st="a1",_e=ie.def();Se.shared.props=_e,Se.batchId=$e;var Ve=Se.scope(),Ce=Se.scope();ie(Ve.entry,"for(",$e,"=0;",$e,"<",st,";++",$e,"){",_e,"=",Fe,"[",$e,"];",Ce,"}",Ve.exit);function vt(Fr){return Fr.contextDep&&Rt||Fr.propDep}function Tt(Fr){return!vt(Fr)}if(Ze.needsContext&&vo(Se,Ce,Ze.context),Ze.needsFramebuffer&&Qo(Se,Ce,Ze.framebuffer),us(Se,Ce,Ze.state,vt),Ze.profile&&vt(Ze.profile)&&mi(Se,Ce,Ze,!1,!0),ft)Ze.useVAO?Ze.drawVAO?vt(Ze.drawVAO)?Ce(Se.shared.vao,".setVAO(",Ze.drawVAO.append(Se,Ce),");"):Ve(Se.shared.vao,".setVAO(",Ze.drawVAO.append(Se,Ve),");"):Ve(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(Ve(Se.shared.vao,".setVAO(null);"),Vo(Se,Ve,Ze,ft.attributes,Tt),Vo(Se,Ce,Ze,ft.attributes,vt)),Qi(Se,Ve,Ze,ft.uniforms,Tt,!1),Qi(Se,Ce,Ze,ft.uniforms,vt,!0),So(Se,Ve,Ce,Ze);else{var dr=Se.global.def("{}"),zr=Ze.shader.progVar.append(Se,Ce),Br=Ce.def(zr,".id"),rn=Ce.def(dr,"[",Br,"]");Ce(Se.shared.gl,".useProgram(",zr,".program);","if(!",rn,"){",rn,"=",dr,"[",Br,"]=",Se.link(function(Fr){return ri(Co,Se,Ze,Fr,2)}),"(",zr,");}",rn,".call(this,a0[",$e,"],",$e,");")}}function we(Se,ie){var Ze=Se.proc("batch",2);Se.batchId="0",so(Se,Ze);var ft=!1,Rt=!0;Object.keys(ie.context).forEach(function(dr){ft=ft||ie.context[dr].propDep}),ft||(vo(Se,Ze,ie.context),Rt=!1);var $e=ie.framebuffer,Fe=!1;$e?($e.propDep?ft=Fe=!0:$e.contextDep&&ft&&(Fe=!0),Fe||Qo(Se,Ze,$e)):Qo(Se,Ze,null),ie.state.viewport&&ie.state.viewport.propDep&&(ft=!0);function st(dr){return dr.contextDep&&ft||dr.propDep}Ro(Se,Ze,ie),us(Se,Ze,ie.state,function(dr){return!st(dr)}),(!ie.profile||!st(ie.profile))&&mi(Se,Ze,ie,!1,"a1"),ie.contextDep=ft,ie.needsContext=Rt,ie.needsFramebuffer=Fe;var _e=ie.shader.progVar;if(_e.contextDep&&ft||_e.propDep)zl(Se,Ze,ie,null);else{var Ve=_e.append(Se,Ze);if(Ze(Se.shared.gl,".useProgram(",Ve,".program);"),ie.shader.program)zl(Se,Ze,ie,ie.shader.program);else{Ze(Se.shared.vao,".setVAO(null);");var Ce=Se.global.def("{}"),vt=Ze.def(Ve,".id"),Tt=Ze.def(Ce,"[",vt,"]");Ze(Se.cond(Tt).then(Tt,".call(this,a0,a1);").else(Tt,"=",Ce,"[",vt,"]=",Se.link(function(dr){return ri(zl,Se,ie,dr,2)}),"(",Ve,");",Tt,".call(this,a0,a1);"))}}Object.keys(ie.state).length>0&&Ze(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ze(Se.shared.vao,".setVAO(null);")}function jt(Se,ie){var Ze=Se.proc("scope",3);Se.batchId="a2";var ft=Se.shared,Rt=ft.current;vo(Se,Ze,ie.context),ie.framebuffer&&ie.framebuffer.append(Se,Ze),vp(Object.keys(ie.state)).forEach(function(Fe){var st=ie.state[Fe],_e=st.append(Se,Ze);la(_e)?_e.forEach(function(Ve,Ce){Ze.set(Se.next[Fe],"["+Ce+"]",Ve)}):Ze.set(ft.next,"."+Fe,_e)}),mi(Se,Ze,ie,!0,!0),[hu,Kf,Hc,Oh,bo].forEach(function(Fe){var st=ie.draw[Fe];!st||Ze.set(ft.draw,"."+Fe,""+st.append(Se,Ze))}),Object.keys(ie.uniforms).forEach(function(Fe){var st=ie.uniforms[Fe].append(Se,Ze);Array.isArray(st)&&(st="["+st.join()+"]"),Ze.set(ft.uniforms,"["+me.id(Fe)+"]",st)}),Object.keys(ie.attributes).forEach(function(Fe){var st=ie.attributes[Fe].append(Se,Ze),_e=Se.scopeAttrib(Fe);Object.keys(new ht).forEach(function(Ve){Ze.set(_e,"."+Ve,st[Ve])})}),ie.scopeVAO&&Ze.set(ft.vao,".targetVAO",ie.scopeVAO.append(Se,Ze));function $e(Fe){var st=ie.shader[Fe];st&&Ze.set(ft.shader,"."+Fe,st.append(Se,Ze))}$e(Ol),$e(Gc),Object.keys(ie.state).length>0&&(Ze(Rt,".dirty=true;"),Ze.exit(Rt,".dirty=true;")),Ze("a1(",Se.shared.context,",a0,",Se.batchId,");")}function At(Se){if(!(typeof Se!="object"||la(Se))){for(var ie=Object.keys(Se),Ze=0;Ze<ie.length;++Ze)if(nn.isDynamic(Se[ie[Ze]]))return!0;return!1}}function hn(Se,ie,Ze){var ft=ie.static[Ze];if(!ft||!At(ft))return;var Rt=Se.global,$e=Object.keys(ft),Fe=!1,st=!1,_e=!1,Ve=Se.global.def("{}");$e.forEach(function(vt){var Tt=ft[vt];if(nn.isDynamic(Tt)){typeof Tt=="function"&&(Tt=ft[vt]=nn.unbox(Tt));var dr=tu(Tt,null);Fe=Fe||dr.thisDep,_e=_e||dr.propDep,st=st||dr.contextDep}else{switch(Rt(Ve,".",vt,"="),typeof Tt){case"number":Rt(Tt);break;case"string":Rt('"',Tt,'"');break;case"object":Array.isArray(Tt)&&Rt("[",Tt.join(),"]");break;default:Rt(Se.link(Tt));break}Rt(";")}});function Ce(vt,Tt){$e.forEach(function(dr){var zr=ft[dr];if(!!nn.isDynamic(zr)){var Br=vt.invoke(Tt,zr);Tt(Ve,".",dr,"=",Br,";")}})}ie.dynamic[Ze]=new nn.DynamicVariable(ni,{thisDep:Fe,contextDep:st,propDep:_e,ref:Ve,append:Ce}),delete ie.static[Ze]}function Oi(Se,ie,Ze,ft,Rt){var $e=ii();$e.stats=$e.link(Rt),Object.keys(ie.static).forEach(function(st){hn($e,ie,st)}),kd.forEach(function(st){hn($e,Se,st)});var Fe=jo(Se,ie,Ze,ft,$e);return Zi($e,Fe),jt($e,Fe),we($e,Fe),g($e.compile(),{destroy:function(){Fe.shader.program.destroy()}})}return{next:Kr,current:Or,procs:function(){var Se=ii(),ie=Se.proc("poll"),Ze=Se.proc("refresh"),ft=Se.block();ie(ft),Ze(ft);var Rt=Se.shared,$e=Rt.gl,Fe=Rt.next,st=Rt.current;ft(st,".dirty=false;"),Qo(Se,ie),Qo(Se,Ze,null,!0);var _e;xr&&(_e=Se.link(xr)),ze.oes_vertex_array_object&&Ze(Se.link(ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ve=0;Ve<zt.maxAttributes;++Ve){var Ce=Ze.def(Rt.attributes,"[",Ve,"]"),vt=Se.cond(Ce,".buffer");vt.then($e,".enableVertexAttribArray(",Ve,");",$e,".bindBuffer(",Ef,",",Ce,".buffer.buffer);",$e,".vertexAttribPointer(",Ve,",",Ce,".size,",Ce,".type,",Ce,".normalized,",Ce,".stride,",Ce,".offset);").else($e,".disableVertexAttribArray(",Ve,");",$e,".vertexAttrib4f(",Ve,",",Ce,".x,",Ce,".y,",Ce,".z,",Ce,".w);",Ce,".buffer=null;"),Ze(vt),xr&&Ze(_e,".vertexAttribDivisorANGLE(",Ve,",",Ce,".divisor);")}return Ze(Se.shared.vao,".currentVAO=null;",Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"),Object.keys(rr).forEach(function(Tt){var dr=rr[Tt],zr=ft.def(Fe,".",Tt),Br=Se.block();Br("if(",zr,"){",$e,".enable(",dr,")}else{",$e,".disable(",dr,")}",st,".",Tt,"=",zr,";"),Ze(Br),ie("if(",zr,"!==",st,".",Tt,"){",Br,"}")}),Object.keys(ar).forEach(function(Tt){var dr=ar[Tt],zr=Or[Tt],Br,rn,Fr=Se.block();if(Fr($e,".",dr,"("),la(zr)){var En=zr.length;Br=Se.global.def(Fe,".",Tt),rn=Se.global.def(st,".",Tt),Fr(Ge(En,function(cn){return Br+"["+cn+"]"}),");",Ge(En,function(cn){return rn+"["+cn+"]="+Br+"["+cn+"];"}).join("")),ie("if(",Ge(En,function(cn){return Br+"["+cn+"]!=="+rn+"["+cn+"]"}).join("||"),"){",Fr,"}")}else Br=ft.def(Fe,".",Tt),rn=ft.def(st,".",Tt),Fr(Br,");",st,".",Tt,"=",Br,";"),ie("if(",Br,"!==",rn,"){",Fr,"}");Ze(Fr)}),Se.compile()}(),compile:Oi}}function Fd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Bd=34918,Nd=34919,gp=35007,zd=function(B,me){if(!me.ext_disjoint_timer_query)return null;var ze=[];function zt(){return ze.pop()||me.ext_disjoint_timer_query.createQueryEXT()}function cr(xr){ze.push(xr)}var Dt=[];function nr(xr){var Nr=zt();me.ext_disjoint_timer_query.beginQueryEXT(gp,Nr),Dt.push(Nr),Er(Dt.length-1,Dt.length,xr)}function nt(){me.ext_disjoint_timer_query.endQueryEXT(gp)}function yr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Be=[];function Pr(){return Be.pop()||new yr}function Ir(xr){Be.push(xr)}var Ur=[];function Er(xr,Nr,pr){var Or=Pr();Or.startQueryIndex=xr,Or.endQueryIndex=Nr,Or.sum=0,Or.stats=pr,Ur.push(Or)}var Tr=[],ht=[];function Wt(){var xr,Nr,pr=Dt.length;if(pr!==0){ht.length=Math.max(ht.length,pr+1),Tr.length=Math.max(Tr.length,pr+1),Tr[0]=0,ht[0]=0;var Or=0;for(xr=0,Nr=0;Nr<Dt.length;++Nr){var Kr=Dt[Nr];me.ext_disjoint_timer_query.getQueryObjectEXT(Kr,Nd)?(Or+=me.ext_disjoint_timer_query.getQueryObjectEXT(Kr,Bd),cr(Kr)):Dt[xr++]=Kr,Tr[Nr+1]=Or,ht[Nr+1]=xr}for(Dt.length=xr,xr=0,Nr=0;Nr<Ur.length;++Nr){var Bn=Ur[Nr],rr=Bn.startQueryIndex,ar=Bn.endQueryIndex;Bn.sum+=Tr[ar]-Tr[rr];var xn=ht[rr],Vr=ht[ar];Vr===xn?(Bn.stats.gpuTime+=Bn.sum/1e6,Ir(Bn)):(Bn.startQueryIndex=xn,Bn.endQueryIndex=Vr,Ur[xr++]=Bn)}Ur.length=xr}}return{beginQuery:nr,endQuery:nt,pushScopeStats:Er,update:Wt,getNumPendingQueries:function(){return Dt.length},clear:function(){ze.push.apply(ze,Dt);for(var xr=0;xr<ze.length;xr++)me.ext_disjoint_timer_query.deleteQueryEXT(ze[xr]);Dt.length=0,ze.length=0},restore:function(){Dt.length=0,ze.length=0}}},Ud=16384,Bl=256,td=1024,rd=34962,ih="webglcontextlost",Pa="webglcontextrestored",zh=1,Nl=2,Of=3;function yp(B,me){for(var ze=0;ze<B.length;++ze)if(B[ze]===me)return ze;return-1}function nd(B){var me=ge(B);if(!me)return null;var ze=me.gl,zt=ze.getContextAttributes(),cr=ze.isContextLost(),Dt=Pe(ze,me);if(!Dt)return null;var nr=cs(),nt=Fd(),yr=Dt.extensions,Be=zd(ze,yr),Pr=Wa(),Ir=ze.drawingBufferWidth,Ur=ze.drawingBufferHeight,Er={tick:0,time:0,viewportWidth:Ir,viewportHeight:Ur,framebufferWidth:Ir,framebufferHeight:Ur,drawingBufferWidth:Ir,drawingBufferHeight:Ur,pixelRatio:me.pixelRatio},Tr={},ht={elements:null,primitive:4,count:-1,offset:0,instances:-1},Wt=Lc(ze,yr),xr=F(ze,nt,me,Or),Nr=Qu(ze,yr,xr,nt),pr=Et(ze,yr,Wt,nt,xr,Nr,ht);function Or(ri){return pr.destroyBuffer(ri)}var Kr=Dr(ze,nr,nt,me),Bn=ps(ze,yr,Wt,function(){xn.procs.poll()},Er,nt,me),rr=al(ze,yr,Wt,nt,me),ar=Re(ze,yr,Wt,Bn,rr,nt),xn=Nh(ze,nr,yr,Wt,xr,Nr,Bn,ar,Tr,pr,Kr,ht,Er,Be,me),Vr=Fn(ze,ar,xn.procs.poll,Er,zt,yr,Wt),Ar=xn.next,Gr=ze.canvas,Jr=[],vi=[],ii=[],Wr=[me.onDestroy],an=null;function Jn(){if(Jr.length===0){Be&&Be.update(),an=null;return}an=wi.next(Jn),so();for(var ri=Jr.length-1;ri>=0;--ri){var In=Jr[ri];In&&In(Er,null,0)}ze.flush(),Be&&Be.update()}function fi(){!an&&Jr.length>0&&(an=wi.next(Jn))}function Di(){an&&(wi.cancel(Jn),an=null)}function ro(ri){ri.preventDefault(),cr=!0,Di(),vi.forEach(function(In){In()})}function no(ri){ze.getError(),cr=!1,Dt.restore(),Kr.restore(),xr.restore(),Bn.restore(),rr.restore(),ar.restore(),pr.restore(),Be&&Be.restore(),xn.procs.refresh(),fi(),ii.forEach(function(In){In()})}var Fi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Fi&&Gr&&(Gr.addEventListener(ih,ro,!1),Gr.addEventListener(Pa,no,!1));function gs(){Jr.length=0,Di(),!Fi&&Gr&&(Gr.removeEventListener(ih,ro),Gr.removeEventListener(Pa,no)),Kr.clear(),ar.clear(),rr.clear(),pr.clear(),Bn.clear(),Nr.clear(),xr.clear(),Be&&Be.clear(),Wr.forEach(function(ri){ri()})}function Ga(ri){de(!!ri,"invalid args to regl({...})"),de.type(ri,"object","invalid args to regl({...})");function In($e){var Fe=g({},$e);delete Fe.uniforms,delete Fe.attributes,delete Fe.context,delete Fe.vao,"stencil"in Fe&&Fe.stencil.op&&(Fe.stencil.opBack=Fe.stencil.opFront=Fe.stencil.op,delete Fe.stencil.op);function st(_e){if(_e in Fe){var Ve=Fe[_e];delete Fe[_e],Object.keys(Ve).forEach(function(Ce){Fe[_e+"."+Ce]=Ve[Ce]})}}return st("blend"),st("depth"),st("cull"),st("stencil"),st("polygonOffset"),st("scissor"),st("sample"),"vao"in $e&&(Fe.vao=$e.vao),Fe}function Zi($e,Fe){var st={},_e={};return Object.keys($e).forEach(function(Ve){var Ce=$e[Ve];if(nn.isDynamic(Ce)){_e[Ve]=nn.unbox(Ce,Ve);return}else if(Fe&&Array.isArray(Ce)){for(var vt=0;vt<Ce.length;++vt)if(nn.isDynamic(Ce[vt])){_e[Ve]=nn.unbox(Ce,Ve);return}}st[Ve]=Ce}),{dynamic:_e,static:st}}var Co=Zi(ri.context||{},!0),zl=Zi(ri.uniforms||{},!0),we=Zi(ri.attributes||{},!1),jt=Zi(In(ri),!1),At={gpuTime:0,cpuTime:0,count:0},hn=xn.compile(jt,we,zl,Co,At),Oi=hn.draw,Se=hn.batch,ie=hn.scope,Ze=[];function ft($e){for(;Ze.length<$e;)Ze.push(null);return Ze}function Rt($e,Fe){var st;if(cr&&de.raise("context lost"),typeof $e=="function")return ie.call(this,null,$e,0);if(typeof Fe=="function")if(typeof $e=="number")for(st=0;st<$e;++st)ie.call(this,null,Fe,st);else if(Array.isArray($e))for(st=0;st<$e.length;++st)ie.call(this,$e[st],Fe,st);else return ie.call(this,$e,Fe,0);else if(typeof $e=="number"){if($e>0)return Se.call(this,ft($e|0),$e|0)}else if(Array.isArray($e)){if($e.length)return Se.call(this,$e,$e.length)}else return Oi.call(this,$e)}return g(Rt,{stats:At,destroy:function(){hn.destroy()}})}var jo=ar.setFBO=Ga({framebuffer:nn.define.call(null,zh,"framebuffer")});function vo(ri,In){var Zi=0;xn.procs.poll();var Co=In.color;Co&&(ze.clearColor(+Co[0]||0,+Co[1]||0,+Co[2]||0,+Co[3]||0),Zi|=Ud),"depth"in In&&(ze.clearDepth(+In.depth),Zi|=Bl),"stencil"in In&&(ze.clearStencil(In.stencil|0),Zi|=td),de(!!Zi,"called regl.clear with no buffer specified"),ze.clear(Zi)}function Qo(ri){if(de(typeof ri=="object"&&ri,"regl.clear() takes an object as input"),"framebuffer"in ri)if(ri.framebuffer&&ri.framebuffer_reglType==="framebufferCube")for(var In=0;In<6;++In)jo(g({framebuffer:ri.framebuffer.faces[In]},ri),vo);else jo(ri,vo);else vo(null,ri)}function Ro(ri){de.type(ri,"function","regl.frame() callback must be a function"),Jr.push(ri);function In(){var Zi=yp(Jr,ri);de(Zi>=0,"cannot cancel a frame twice");function Co(){var zl=yp(Jr,Co);Jr[zl]=Jr[Jr.length-1],Jr.length-=1,Jr.length<=0&&Di()}Jr[Zi]=Co}return fi(),{cancel:In}}function us(){var ri=Ar.viewport,In=Ar.scissor_box;ri[0]=ri[1]=In[0]=In[1]=0,Er.viewportWidth=Er.framebufferWidth=Er.drawingBufferWidth=ri[2]=In[2]=ze.drawingBufferWidth,Er.viewportHeight=Er.framebufferHeight=Er.drawingBufferHeight=ri[3]=In[3]=ze.drawingBufferHeight}function so(){Er.tick+=1,Er.time=Vo(),us(),xn.procs.poll()}function mi(){Bn.refresh(),us(),xn.procs.refresh(),Be&&Be.update()}function Vo(){return(Wa()-Pr)/1e3}mi();function Qi(ri,In){de.type(In,"function","listener callback must be a function");var Zi;switch(ri){case"frame":return Ro(In);case"lost":Zi=vi;break;case"restore":Zi=ii;break;case"destroy":Zi=Wr;break;default:de.raise("invalid event, must be one of frame,lost,restore,destroy")}return Zi.push(In),{cancel:function(){for(var Co=0;Co<Zi.length;++Co)if(Zi[Co]===In){Zi[Co]=Zi[Zi.length-1],Zi.pop();return}}}}var So=g(Ga,{clear:Qo,prop:nn.define.bind(null,zh),context:nn.define.bind(null,Nl),this:nn.define.bind(null,Of),draw:Ga({}),buffer:function(ri){return xr.create(ri,rd,!1,!1)},elements:function(ri){return Nr.create(ri,!1)},texture:Bn.create2D,cube:Bn.createCube,renderbuffer:rr.create,framebuffer:ar.create,framebufferCube:ar.createCube,vao:pr.createVAO,attributes:zt,frame:Ro,on:Qi,limits:Wt,hasExtension:function(ri){return Wt.extensions.indexOf(ri.toLowerCase())>=0},read:Vr,destroy:gs,_gl:ze,_refresh:mi,poll:function(){so(),Be&&Be.update()},now:Vo,stats:nt});return me.onDone(null,So),So}return nd})},77412:function(Ot){function J(N,le){for(var ye=-1,g=N==null?0:N.length;++ye<g&&le(N[ye],ye,N)!==!1;);return N}Ot.exports=J},47443:function(Ot,J,N){var le=N(42118);function ye(g,ve){var V=g==null?0:g.length;return!!V&&le(g,ve,0)>-1}Ot.exports=ye},1196:function(Ot){function J(N,le,ye){for(var g=-1,ve=N==null?0:N.length;++g<ve;)if(ye(le,N[g]))return!0;return!1}Ot.exports=J},62663:function(Ot){function J(N,le,ye,g){var ve=-1,V=N==null?0:N.length;for(g&&V&&(ye=N[++ve]);++ve<V;)ye=le(ye,N[ve],ve,N);return ye}Ot.exports=J},49029:function(Ot){var J=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function N(le){return le.match(J)||[]}Ot.exports=N},44037:function(Ot,J,N){var le=N(98363),ye=N(3674);function g(ve,V){return ve&&le(V,ye(V),ve)}Ot.exports=g},63886:function(Ot,J,N){var le=N(98363),ye=N(81704);function g(ve,V){return ve&&le(V,ye(V),ve)}Ot.exports=g},29750:function(Ot){function J(N,le,ye){return N===N&&(ye!==void 0&&(N=N<=ye?N:ye),le!==void 0&&(N=N>=le?N:le)),N}Ot.exports=J},85990:function(Ot,J,N){var le=N(46384),ye=N(77412),g=N(34865),ve=N(44037),V=N(63886),ce=N(64626),ue=N(278),Ne=N(18805),se=N(1911),at=N(58234),Le=N(46904),ut=N(64160),Ht=N(43824),ur=N(29148),Pt=N(38517),Jt=N(1469),kt=N(44144),pt=N(56688),gt=N(13218),er=N(72928),q=N(3674),Qt=N(81704),xt=1,rt=2,wt=4,et="[object Arguments]",$t="[object Array]",Sr="[object Boolean]",kr="[object Date]",en="[object Error]",Te="[object Function]",qe="[object GeneratorFunction]",ke="[object Map]",Mt="[object Number]",yt="[object Object]",Zt="[object RegExp]",qt="[object Set]",Cr="[object String]",qn="[object Symbol]",fn="[object WeakMap]",Hi="[object ArrayBuffer]",Zn="[object DataView]",Hn="[object Float32Array]",pi="[object Float64Array]",Kn="[object Int8Array]",ui="[object Int16Array]",ra="[object Int32Array]",Ri="[object Uint8Array]",bi="[object Uint8ClampedArray]",Ni="[object Uint16Array]",aa="[object Uint32Array]",Ei={};Ei[et]=Ei[$t]=Ei[Hi]=Ei[Zn]=Ei[Sr]=Ei[kr]=Ei[Hn]=Ei[pi]=Ei[Kn]=Ei[ui]=Ei[ra]=Ei[ke]=Ei[Mt]=Ei[yt]=Ei[Zt]=Ei[qt]=Ei[Cr]=Ei[qn]=Ei[Ri]=Ei[bi]=Ei[Ni]=Ei[aa]=!0,Ei[en]=Ei[Te]=Ei[fn]=!1;function _a(An,_i,Bi,Wi,za,de){var Nn,Ua=_i&xt,ls=_i&rt,Vt=_i&wt;if(Bi&&(Nn=za?Bi(An,Wi,za,de):Bi(An)),Nn!==void 0)return Nn;if(!gt(An))return An;var or=Jt(An);if(or){if(Nn=Ht(An),!Ua)return ue(An,Nn)}else{var wr=ut(An),I=wr==Te||wr==qe;if(kt(An))return ce(An,Ua);if(wr==yt||wr==et||I&&!za){if(Nn=ls||I?{}:Pt(An),!Ua)return ls?se(An,V(Nn,An)):Ne(An,ve(Nn,An))}else{if(!Ei[wr])return za?An:{};Nn=ur(An,wr,Ua)}}de||(de=new le);var ir=de.get(An);if(ir)return ir;de.set(An,Nn),er(An)?An.forEach(function(Wn){Nn.add(_a(Wn,_i,Bi,Wn,An,de))}):pt(An)&&An.forEach(function(Wn,nn){Nn.set(nn,_a(Wn,_i,Bi,nn,An,de))});var Dn=Vt?ls?Le:at:ls?Qt:q,li=or?void 0:Dn(An);return ye(li||An,function(Wn,nn){li&&(nn=Wn,Wn=An[nn]),g(Nn,nn,_a(Wn,_i,Bi,nn,An,de))}),Nn}Ot.exports=_a},41848:function(Ot){function J(N,le,ye,g){for(var ve=N.length,V=ye+(g?1:-1);g?V--:++V<ve;)if(le(N[V],V,N))return V;return-1}Ot.exports=J},42118:function(Ot,J,N){var le=N(41848),ye=N(62722),g=N(42351);function ve(V,ce,ue){return ce===ce?g(V,ce,ue):le(V,ye,ue)}Ot.exports=ve},25588:function(Ot,J,N){var le=N(64160),ye=N(37005),g="[object Map]";function ve(V){return ye(V)&&le(V)==g}Ot.exports=ve},62722:function(Ot){function J(N){return N!==N}Ot.exports=J},29221:function(Ot,J,N){var le=N(64160),ye=N(37005),g="[object Set]";function ve(V){return ye(V)&&le(V)==g}Ot.exports=ve},40371:function(Ot){function J(N){return function(le){return le==null?void 0:le[N]}}Ot.exports=J},18674:function(Ot){function J(N){return function(le){return N==null?void 0:N[le]}}Ot.exports=J},45652:function(Ot,J,N){var le=N(88668),ye=N(47443),g=N(1196),ve=N(74757),V=N(23593),ce=N(21814),ue=200;function Ne(se,at,Le){var ut=-1,Ht=ye,ur=se.length,Pt=!0,Jt=[],kt=Jt;if(Le)Pt=!1,Ht=g;else if(ur>=ue){var pt=at?null:V(se);if(pt)return ce(pt);Pt=!1,Ht=ve,kt=new le}else kt=at?[]:Jt;e:for(;++ut<ur;){var gt=se[ut],er=at?at(gt):gt;if(gt=Le||gt!==0?gt:0,Pt&&er===er){for(var q=kt.length;q--;)if(kt[q]===er)continue e;at&&kt.push(er),Jt.push(gt)}else Ht(kt,er,Le)||(kt!==Jt&&kt.push(er),Jt.push(gt))}return Jt}Ot.exports=Ne},57157:function(Ot,J,N){var le=N(74318);function ye(g,ve){var V=ve?le(g.buffer):g.buffer;return new g.constructor(V,g.byteOffset,g.byteLength)}Ot.exports=ye},93147:function(Ot){var J=/\w*$/;function N(le){var ye=new le.constructor(le.source,J.exec(le));return ye.lastIndex=le.lastIndex,ye}Ot.exports=N},40419:function(Ot,J,N){var le=N(62705),ye=le?le.prototype:void 0,g=ye?ye.valueOf:void 0;function ve(V){return g?Object(g.call(V)):{}}Ot.exports=ve},18805:function(Ot,J,N){var le=N(98363),ye=N(99551);function g(ve,V){return le(ve,ye(ve),V)}Ot.exports=g},1911:function(Ot,J,N){var le=N(98363),ye=N(51442);function g(ve,V){return le(ve,ye(ve),V)}Ot.exports=g},98805:function(Ot,J,N){var le=N(40180),ye=N(62689),g=N(83140),ve=N(79833);function V(ce){return function(ue){ue=ve(ue);var Ne=ye(ue)?g(ue):void 0,se=Ne?Ne[0]:ue.charAt(0),at=Ne?le(Ne,1).join(""):ue.slice(1);return se[ce]()+at}}Ot.exports=V},35393:function(Ot,J,N){var le=N(62663),ye=N(53816),g=N(58748),ve="['\u2019]",V=RegExp(ve,"g");function ce(ue){return function(Ne){return le(g(ye(Ne).replace(V,"")),ue,"")}}Ot.exports=ce},23593:function(Ot,J,N){var le=N(58525),ye=N(50308),g=N(21814),ve=1/0,V=le&&1/g(new le([,-0]))[1]==ve?function(ce){return new le(ce)}:ye;Ot.exports=V},69389:function(Ot,J,N){var le=N(18674),ye={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},g=le(ye);Ot.exports=g},46904:function(Ot,J,N){var le=N(68866),ye=N(51442),g=N(81704);function ve(V){return le(V,g,ye)}Ot.exports=ve},51442:function(Ot,J,N){var le=N(62488),ye=N(85924),g=N(99551),ve=N(70479),V=Object.getOwnPropertySymbols,ce=V?function(ue){for(var Ne=[];ue;)le(Ne,g(ue)),ue=ye(ue);return Ne}:ve;Ot.exports=ce},93157:function(Ot){var J=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function N(le){return J.test(le)}Ot.exports=N},43824:function(Ot){var J=Object.prototype,N=J.hasOwnProperty;function le(ye){var g=ye.length,ve=new ye.constructor(g);return g&&typeof ye[0]=="string"&&N.call(ye,"index")&&(ve.index=ye.index,ve.input=ye.input),ve}Ot.exports=le},29148:function(Ot,J,N){var le=N(74318),ye=N(57157),g=N(93147),ve=N(40419),V=N(77133),ce="[object Boolean]",ue="[object Date]",Ne="[object Map]",se="[object Number]",at="[object RegExp]",Le="[object Set]",ut="[object String]",Ht="[object Symbol]",ur="[object ArrayBuffer]",Pt="[object DataView]",Jt="[object Float32Array]",kt="[object Float64Array]",pt="[object Int8Array]",gt="[object Int16Array]",er="[object Int32Array]",q="[object Uint8Array]",Qt="[object Uint8ClampedArray]",xt="[object Uint16Array]",rt="[object Uint32Array]";function wt(et,$t,Sr){var kr=et.constructor;switch($t){case ur:return le(et);case ce:case ue:return new kr(+et);case Pt:return ye(et,Sr);case Jt:case kt:case pt:case gt:case er:case q:case Qt:case xt:case rt:return V(et,Sr);case Ne:return new kr;case se:case ut:return new kr(et);case at:return g(et);case Le:return new kr;case Ht:return ve(et)}}Ot.exports=wt},42351:function(Ot){function J(N,le,ye){for(var g=ye-1,ve=N.length;++g<ve;)if(N[g]===le)return g;return-1}Ot.exports=J},2757:function(Ot){var J="\\ud800-\\udfff",N="\\u0300-\\u036f",le="\\ufe20-\\ufe2f",ye="\\u20d0-\\u20ff",g=N+le+ye,ve="\\u2700-\\u27bf",V="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",ue="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ne="\\u2000-\\u206f",se=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",at="A-Z\\xc0-\\xd6\\xd8-\\xde",Le="\\ufe0e\\ufe0f",ut=ce+ue+Ne+se,Ht="['\u2019]",ur="["+ut+"]",Pt="["+g+"]",Jt="\\d+",kt="["+ve+"]",pt="["+V+"]",gt="[^"+J+ut+Jt+ve+V+at+"]",er="\\ud83c[\\udffb-\\udfff]",q="(?:"+Pt+"|"+er+")",Qt="[^"+J+"]",xt="(?:\\ud83c[\\udde6-\\uddff]){2}",rt="[\\ud800-\\udbff][\\udc00-\\udfff]",wt="["+at+"]",et="\\u200d",$t="(?:"+pt+"|"+gt+")",Sr="(?:"+wt+"|"+gt+")",kr="(?:"+Ht+"(?:d|ll|m|re|s|t|ve))?",en="(?:"+Ht+"(?:D|LL|M|RE|S|T|VE))?",Te=q+"?",qe="["+Le+"]?",ke="(?:"+et+"(?:"+[Qt,xt,rt].join("|")+")"+qe+Te+")*",Mt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",yt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Zt=qe+Te+ke,qt="(?:"+[kt,xt,rt].join("|")+")"+Zt,Cr=RegExp([wt+"?"+pt+"+"+kr+"(?="+[ur,wt,"$"].join("|")+")",Sr+"+"+en+"(?="+[ur,wt+$t,"$"].join("|")+")",wt+"?"+$t+"+"+kr,wt+"+"+en,yt,Mt,Jt,qt].join("|"),"g");function qn(fn){return fn.match(Cr)||[]}Ot.exports=qn},68929:function(Ot,J,N){var le=N(48403),ye=N(35393),g=ye(function(ve,V,ce){return V=V.toLowerCase(),ve+(ce?le(V):V)});Ot.exports=g},48403:function(Ot,J,N){var le=N(79833),ye=N(11700);function g(ve){return ye(le(ve).toLowerCase())}Ot.exports=g},74691:function(Ot,J,N){var le=N(29750),ye=N(14841);function g(ve,V,ce){return ce===void 0&&(ce=V,V=void 0),ce!==void 0&&(ce=ye(ce),ce=ce===ce?ce:0),V!==void 0&&(V=ye(V),V=V===V?V:0),le(ye(ve),V,ce)}Ot.exports=g},50361:function(Ot,J,N){var le=N(85990),ye=1,g=4;function ve(V){return le(V,ye|g)}Ot.exports=ve},53816:function(Ot,J,N){var le=N(69389),ye=N(79833),g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ve="\\u0300-\\u036f",V="\\ufe20-\\ufe2f",ce="\\u20d0-\\u20ff",ue=ve+V+ce,Ne="["+ue+"]",se=RegExp(Ne,"g");function at(Le){return Le=ye(Le),Le&&Le.replace(g,le).replace(se,"")}Ot.exports=at},56688:function(Ot,J,N){var le=N(25588),ye=N(7518),g=N(31167),ve=g&&g.isMap,V=ve?ye(ve):le;Ot.exports=V},14293:function(Ot){function J(N){return N==null}Ot.exports=J},81763:function(Ot,J,N){var le=N(44239),ye=N(37005),g="[object Number]";function ve(V){return typeof V=="number"||ye(V)&&le(V)==g}Ot.exports=ve},72928:function(Ot,J,N){var le=N(29221),ye=N(7518),g=N(31167),ve=g&&g.isSet,V=ve?ye(ve):le;Ot.exports=V},47037:function(Ot,J,N){var le=N(44239),ye=N(1469),g=N(37005),ve="[object String]";function V(ce){return typeof ce=="string"||!ye(ce)&&g(ce)&&le(ce)==ve}Ot.exports=V},52353:function(Ot){function J(N){return N===void 0}Ot.exports=J},30236:function(Ot,J,N){var le=N(42980),ye=N(21463),g=ye(function(ve,V,ce,ue){le(ve,V,ce,ue)});Ot.exports=g},50308:function(Ot){function J(){}Ot.exports=J},44908:function(Ot,J,N){var le=N(45652);function ye(g){return g&&g.length?le(g):[]}Ot.exports=ye},11700:function(Ot,J,N){var le=N(98805),ye=le("toUpperCase");Ot.exports=ye},58748:function(Ot,J,N){var le=N(49029),ye=N(93157),g=N(79833),ve=N(2757);function V(ce,ue,Ne){return ce=g(ce),ue=Ne?void 0:ue,ue===void 0?ye(ce)?ve(ce):le(ce):ce.match(ue)||[]}Ot.exports=V},6158:function(Ot){(function(J,N){Ot.exports=N()})(this,function(){"use strict";var J,N,le;function ye(g,ve){if(!J)J=ve;else if(!N)N=ve;else{var V="var sharedChunk = {}; ("+J+")(sharedChunk); ("+N+")(sharedChunk);",ce={};J(ce),le=ve(ce),typeof window!="undefined"&&(le.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}return ye(["exports"],function(g){"use strict";function ve(t,o){return t(o={exports:{}},o.exports),o.exports}var V=ce;function ce(t,o,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=u,this.p2y=p}ce.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ce.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ce.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ce.prototype.solveCurveX=function(t,o){var u,p,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var P=this.sampleCurveDerivativeX(y);if(Math.abs(P)<1e-6)break;y-=b/P}if((y=t)<(u=0))return u;if(y>(p=1))return p;for(;u<p;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:p=y,y=.5*(p-u)+u}return y},ce.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var ue=Ne;function Ne(t,o){this.x=t,this.y=o}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,o){var u=Math.cos(t),p=Math.sin(t),y=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(t){return t instanceof Ne?t:Array.isArray(t)?new Ne(t[0],t[1]):t};var se=typeof self!="undefined"?self:{},at=Math.pow(2,53)-1;function Le(t,o,u,p){var y=new V(t,o,u,p);return function(b){return y.solve(b)}}var ut=Le(.25,.1,.25,1);function Ht(t,o,u){return Math.min(u,Math.max(o,t))}function ur(t,o,u){var p=u-o,y=((t-o)%p+p)%p+o;return y===o?u:y}function Pt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)t[S]=b[S]}return t}var Jt=1;function kt(){return Jt++}function pt(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function gt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function er(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function q(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Qt(t,o,u){var p={};for(var y in t)p[y]=o.call(u||this,t[y],y,t);return p}function xt(t,o,u){var p={};for(var y in t)o.call(u||this,t[y],y,t)&&(p[y]=t[y]);return p}function rt(t){return Array.isArray(t)?t.map(rt):typeof t=="object"&&t?Qt(t,rt):t}var wt={};function et(t){wt[t]||(typeof console!="undefined"&&console.warn(t),wt[t]=!0)}function $t(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Sr(t){for(var o=0,u=0,p=t.length,y=p-1,b=void 0,S=void 0;u<p;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function kr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function en(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,y,b,S){var P=b||S;return o[y]=!P||P.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var Te=null;function qe(t){if(Te==null){var o=t.navigator?t.navigator.userAgent:null;Te=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Te}function ke(t){try{var o=se[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var Mt,yt,Zt,qt,Cr=se.performance&&se.performance.now?se.performance.now.bind(se.performance):Date.now.bind(Date),qn=se.requestAnimationFrame||se.mozRequestAnimationFrame||se.webkitRequestAnimationFrame||se.msRequestAnimationFrame,fn=se.cancelAnimationFrame||se.mozCancelAnimationFrame||se.webkitCancelAnimationFrame||se.msCancelAnimationFrame,Hi={now:Cr,frame:function(t){var o=qn(t);return{cancel:function(){return fn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=se.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return Mt||(Mt=se.document.createElement("a")),Mt.href=t,Mt.href},hardwareConcurrency:se.navigator&&se.navigator.hardwareConcurrency||4,get devicePixelRatio(){return se.devicePixelRatio},get prefersReducedMotion(){return!!se.matchMedia&&(yt==null&&(yt=se.matchMedia("(prefers-reduced-motion: reduce)")),yt.matches)}},Zn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Hn={supported:!1,testSupport:function(t){!pi&&qt&&(Kn?ui(t):Zt=t)}},pi=!1,Kn=!1;function ui(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,qt),t.isContextLost())return;Hn.supported=!0}catch(u){}t.deleteTexture(o),pi=!0}se.document&&((qt=se.document.createElement("img")).onload=function(){Zt&&ui(Zt),Zt=null,Kn=!0},qt.onerror=function(){pi=!0,Zt=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ra="01",Ri=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function bi(t){return t.indexOf("mapbox:")===0}Ri.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ra,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Ri.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ri.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Ri.prototype.normalizeStyleURL=function(t,o){if(!bi(t))return t;var u=_a(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ri.prototype.normalizeGlyphsURL=function(t,o){if(!bi(t))return t;var u=_a(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ri.prototype.normalizeSourceURL=function(t,o){if(!bi(t))return t;var u=_a(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Ri.prototype.normalizeSpriteURL=function(t,o,u,p){var y=_a(t);return bi(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||p)):(y.path+=""+o+u,An(y))},Ri.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!bi(t))return t;var u=_a(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Hi.devicePixelRatio>=2||o===512?"@2x":"")+(Hn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var P=S[b].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(u.params)||Zn.ACCESS_TOKEN;return Zn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Ri.prototype.canonicalizeTileURL=function(t,o){var u=_a(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(p+="?"+y.join("&")),p},Ri.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&bi(o),p=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];aa(S)?p.push(this.canonicalizeTileURL(S,u)):p.push(S)}return p},Ri.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=_a(Zn.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!Zn.REQUIRE_ACCESS_TOKEN)return An(t);if(!(o=o||Zn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),An(t)};var Ni=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function aa(t){return Ni.test(t)}var Ei=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _a(t){var o=t.match(Ei);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function An(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function _i(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(se.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var Bi=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Bi.prototype.getStorageKey=function(t){var o,u=_i(Zn.ACCESS_TOKEN);return o=u&&u.u?se.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,y){return String.fromCharCode(Number("0x"+y))})):Zn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},Bi.prototype.fetchEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var p=se.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var y=se.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){et("Unable to read from LocalStorage")}},Bi.prototype.saveEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{se.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&se.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){et("Unable to write to LocalStorage")}},Bi.prototype.processRequests=function(t){},Bi.prototype.postEvent=function(t,o,u,p){var y=this;if(Zn.EVENTS_URL){var b=_a(Zn.EVENTS_URL);b.params.push("access_token="+(p||Zn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ra,userId:this.anonId},P=o?Pt(S,o):S,k={url:An(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=Ea(k,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(p)})}},Bi.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Wi,za,de=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,y,b){this.skuToken=y,(Zn.EVENTS_URL&&b||Zn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return bi(S)||aa(S)}))&&this.queueRequest({id:p,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),gt(this.anonId)||(this.anonId=pt()),this.postEvent(S,{skuToken:this.skuToken},function(P){P||b&&(p.success[b]=!0)},u))}},o}(Bi),Nn=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){Zn.EVENTS_URL&&Zn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return bi(y)||aa(y)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=_i(Zn.ACCESS_TOKEN),b=y?y.u:Zn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;gt(this.anonId)||(this.anonId=pt(),S=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),z=new Date(P),j=(P-this.eventData.lastSuccess)/864e5;S=S||j>=1||j<-1||k.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(H){H||(p.eventData.lastSuccess=P,p.eventData.tokenU=b)},u)}},o}(Bi)),Ua=Nn.postTurnstileEvent.bind(Nn),ls=new de,Vt=ls.postMapLoadEvent.bind(ls),or=500,wr=50;function I(){se.caches&&!Wi&&(Wi=se.caches.open("mapbox-tiles"))}function ir(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Dn,li=1/0;function Wn(){return Dn==null&&(Dn=se.OffscreenCanvas&&new se.OffscreenCanvas(1,1).getContext("2d")&&typeof se.createImageBitmap=="function"),Dn}var nn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(nn);var wi=function(t){function o(u,p,y){p===401&&aa(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=p,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ti=kr()?function(){return self.worker&&self.worker.referrer}:function(){return(se.location.protocol==="blob:"?se.parent:se).location.href},Wa,cs,ha=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ti())&&!/^\w+:/.test(u))){if(se.fetch&&se.Request&&se.AbortController&&se.Request.prototype.hasOwnProperty("signal"))return function(p,y){var b,S=new se.AbortController,P=new se.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Ti(),signal:S.signal}),k=!1,z=!1,j=(b=P.url).indexOf("sku=")>0&&aa(b);p.type==="json"&&P.headers.set("Accept","application/json");var H=function(ne,Me,Oe){if(!z){if(ne&&ne.message!=="SecurityError"&&et(ne),Me&&Oe)return ee(Me);var Ke=Date.now();se.fetch(P).then(function(je){if(je.ok){var He=j?je.clone():null;return ee(je,He,Ke)}return y(new wi(je.statusText,je.status,p.url))}).catch(function(je){je.code!==20&&y(new Error(je.message))})}},ee=function(ne,Me,Oe){(p.type==="arrayBuffer"?ne.arrayBuffer():p.type==="json"?ne.json():ne.text()).then(function(Ke){z||(Me&&Oe&&function(je,He,tt){if(I(),Wi){var Gt={status:He.status,statusText:He.statusText,headers:new se.Headers};He.headers.forEach(function(hr,Rr){return Gt.headers.set(Rr,hr)});var Yt=en(He.headers.get("Cache-Control")||"");Yt["no-store"]||(Yt["max-age"]&&Gt.headers.set("Expires",new Date(tt+1e3*Yt["max-age"]).toUTCString()),new Date(Gt.headers.get("Expires")).getTime()-tt<42e4||function(hr,Rr){if(za===void 0)try{new Response(new ReadableStream),za=!0}catch($r){za=!1}za?Rr(hr.body):hr.blob().then(Rr)}(He,function(hr){var Rr=new se.Response(hr,Gt);I(),Wi&&Wi.then(function($r){return $r.put(ir(je.url),Rr)}).catch(function($r){return et($r.message)})}))}}(P,Me,Oe),k=!0,y(null,Ke,ne.headers.get("Cache-Control"),ne.headers.get("Expires")))}).catch(function(Ke){z||y(new Error(Ke.message))})};return j?function(ne,Me){if(I(),!Wi)return Me(null);var Oe=ir(ne.url);Wi.then(function(Ke){Ke.match(Oe).then(function(je){var He=function(tt){if(!tt)return!1;var Gt=new Date(tt.headers.get("Expires")||0),Yt=en(tt.headers.get("Cache-Control")||"");return Gt>Date.now()&&!Yt["no-cache"]}(je);Ke.delete(Oe),He&&Ke.put(Oe,je.clone()),Me(null,je,He)}).catch(Me)}).catch(Me)}(P,H):H(null,null),{cancel:function(){z=!0,k||S.abort()}}}(t,o);if(kr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(p,y){var b=new se.XMLHttpRequest;for(var S in b.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(b.responseType="arraybuffer"),p.headers)b.setRequestHeader(S,p.headers[S]);return p.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=p.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var P=b.response;if(p.type==="json")try{P=JSON.parse(b.response)}catch(k){return y(k)}y(null,P,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new wi(b.statusText,b.status,p.url))},b.send(p.body),{cancel:function(){return b.abort()}}}(t,o)},wa=function(t,o){return ha(Pt(t,{type:"arrayBuffer"}),o)},Ea=function(t,o){return ha(Pt(t,{method:"POST"}),o)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Wa=[],cs=0;var $=function(t,o){if(Hn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),cs>=Zn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return Wa.push(u),u}cs++;var p=!1,y=function(){if(!p)for(p=!0,cs--;Wa.length&&cs<Zn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Wa.shift();S.cancelled||(S.cancel=$(S.requestParameters,S.callback).cancel)}},b=wa(t,function(S,P,k,z){y(),S?o(S):P&&(Wn()?function(j,H){var ee=new se.Blob([new Uint8Array(j)],{type:"image/png"});se.createImageBitmap(ee).then(function(ne){H(null,ne)}).catch(function(ne){H(new Error("Could not load image because of "+ne.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,o):function(j,H,ee,ne){var Me=new se.Image,Oe=se.URL;Me.onload=function(){H(null,Me),Oe.revokeObjectURL(Me.src),Me.onload=null,se.requestAnimationFrame(function(){Me.src=G})},Me.onerror=function(){return H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ke=new se.Blob([new Uint8Array(j)],{type:"image/png"});Me.cacheControl=ee,Me.expires=ne,Me.src=j.byteLength?Oe.createObjectURL(Ke):G}(P,o,k,z))});return{cancel:function(){b.cancel(),y()}}};function re(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ge(t,o,u){if(u&&u[t]){var p=u[t].indexOf(o);p!==-1&&u[t].splice(p,1)}}var Pe=function(t,o){o===void 0&&(o={}),Pt(this,o),this.type=t},Ge=function(t){function o(u,p){p===void 0&&(p={}),t.call(this,"error",Pt({error:u},p))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Pe),ot=function(){};ot.prototype.on=function(t,o){return this._listeners=this._listeners||{},re(t,o,this._listeners),this},ot.prototype.off=function(t,o){return ge(t,o,this._listeners),ge(t,o,this._oneTimeListeners),this},ot.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},re(t,o,this._oneTimeListeners),this},ot.prototype.fire=function(t,o){typeof t=="string"&&(t=new Pe(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var p=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<y.length;p+=1)y[p].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var P=S[b];ge(u,P,this._oneTimeListeners),P.call(this,t)}var k=this._eventedParent;k&&(Pt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof Ge&&console.error(t.error);return this},ot.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},ot.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},De=function(t,o,u,p){this.message=(t?t+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function _t(t){var o=t.value;return o?[new De(t.key,o,"constants have been deprecated as of v8")]:[]}function vr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)t[S]=b[S]}return t}function Bt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ut(t){if(Array.isArray(t))return t.map(Ut);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Ut(t[u]);return o}return Bt(t)}var gr=function(t){function o(u,p){t.call(this,p),this.message=p,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),_n=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var y=p[u];this.bindings[y[0]]=y[1]}};_n.prototype.concat=function(t){return new _n(this,t)},_n.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},_n.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var ln={kind:"null"},Lt={kind:"number"},sn={kind:"string"},Zr={kind:"boolean"},Hr={kind:"color"},oi={kind:"object"},tn={kind:"value"},Si={kind:"collator"},$i={kind:"formatted"},yi={kind:"resolvedImage"};function Mi(t,o){return{kind:"array",itemType:t,N:o}}function xi(t){if(t.kind==="array"){var o=xi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ti=[ln,Lt,sn,Zr,Hr,$i,oi,Mi(tn),yi];function Vi(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Vi(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,p=ti;u<p.length;u+=1)if(!Vi(p[u],o))return null}}return"Expected "+xi(t)+" but found "+xi(o)+" instead."}function Ta(t,o){return o.some(function(u){return u.kind===t.kind})}function na(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Pi=ve(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(P){return(P=Math.round(P))<0?0:P>255?255:P}function y(P){return p(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function b(P){return(k=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:k>1?1:k;var k}function S(P,k,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?P+(k-P)*z*6:2*z<1?k:3*z<2?P+(k-P)*(2/3-z)*6:P}try{o.parseCSSColor=function(P){var k,z=P.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(k=parseInt(z.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:z.length===7&&(k=parseInt(z.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var j=z.indexOf("("),H=z.indexOf(")");if(j!==-1&&H+1===z.length){var ee=z.substr(0,j),ne=z.substr(j+1,H-(j+1)).split(","),Me=1;switch(ee){case"rgba":if(ne.length!==4)return null;Me=b(ne.pop());case"rgb":return ne.length!==3?null:[y(ne[0]),y(ne[1]),y(ne[2]),Me];case"hsla":if(ne.length!==4)return null;Me=b(ne.pop());case"hsl":if(ne.length!==3)return null;var Oe=(parseFloat(ne[0])%360+360)%360/360,Ke=b(ne[1]),je=b(ne[2]),He=je<=.5?je*(Ke+1):je+Ke-je*Ke,tt=2*je-He;return[p(255*S(tt,He,Oe+1/3)),p(255*S(tt,He,Oe)),p(255*S(tt,He,Oe-1/3)),Me];default:return null}}return null}}catch(P){}}).parseCSSColor,zi=function(t,o,u,p){p===void 0&&(p=1),this.r=t,this.g=o,this.b=u,this.a=p};zi.parse=function(t){if(t){if(t instanceof zi)return t;if(typeof t=="string"){var o=Pi(t);if(o)return new zi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},zi.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},zi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},zi.black=new zi(0,0,0,1),zi.white=new zi(1,1,1,1),zi.transparent=new zi(0,0,0,0),zi.red=new zi(1,0,0,1);var Ra=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ra.prototype.compare=function(t,o){return this.collator.compare(t,o)},Ra.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ou=function(t,o,u,p,y){this.text=t,this.image=o,this.scale=u,this.fontStack=p,this.textColor=y},Sa=function(t){this.sections=t};Sa.fromString=function(t){return new Sa([new ou(t,null,null,null,null)])},Sa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Sa.factory=function(t){return t instanceof Sa?t:Sa.fromString(t)},Sa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Sa.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(y)}}return t};var Ca=function(t){this.name=t.name,this.available=t.available};function Es(t,o,u,p){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,o,u,p]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function fs(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof zi||t instanceof Ra||t instanceof Sa||t instanceof Ca)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!fs(u[o]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!fs(t[p]))return!1;return!0}return!1}function Ji(t){if(t===null)return ln;if(typeof t=="string")return sn;if(typeof t=="boolean")return Zr;if(typeof t=="number")return Lt;if(t instanceof zi)return Hr;if(t instanceof Ra)return Si;if(t instanceof Sa)return $i;if(t instanceof Ca)return yi;if(Array.isArray(t)){for(var o,u=t.length,p=0,y=t;p<y.length;p+=1){var b=Ji(y[p]);if(o){if(o===b)continue;o=tn;break}o=b}return Mi(o||tn,u)}return oi}function Xu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof zi||t instanceof Sa||t instanceof Ca?t.toString():JSON.stringify(t)}Ca.prototype.toString=function(){return this.name},Ca.fromString=function(t){return t?new Ca({name:t,available:!1}):null},Ca.prototype.serialize=function(){return["image",this.name]};var fo=function(t,o){this.type=t,this.value=o};fo.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!fs(t[1]))return o.error("invalid value");var u=t[1],p=Ji(u),y=o.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new fo(p,u)},fo.prototype.evaluate=function(){return this.value},fo.prototype.eachChild=function(){},fo.prototype.outputDefined=function(){return!0},fo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof zi?["rgba"].concat(this.value.toArray()):this.value instanceof Sa?this.value.serialize():this.value};var La=function(t){this.name="ExpressionEvaluationError",this.message=t};La.prototype.toJSON=function(){return this.message};var $a={string:sn,number:Lt,boolean:Zr,object:oi},Xi=function(t,o){this.type=t,this.args=o};Xi.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,p=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var P=t[1];if(typeof P!="string"||!(P in $a)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=$a[P],p++}else b=tn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],p++}u=Mi(b,S)}else u=$a[y];for(var k=[];p<t.length;p++){var z=o.parse(t[p],p,tn);if(!z)return null;k.push(z)}return new Xi(u,k)},Xi.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Vi(this.type,Ji(u)))return u;if(o===this.args.length-1)throw new La("Expected value to be of type "+xi(this.type)+", but found "+xi(Ji(u))+" instead.")}return null},Xi.prototype.eachChild=function(t){this.args.forEach(t)},Xi.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Xi.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Ho=function(t){this.type=$i,this.sections=t};Ho.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var P=null;if(S["font-scale"]&&!(P=o.parse(S["font-scale"],1,Lt)))return null;var k=null;if(S["text-font"]&&!(k=o.parse(S["text-font"],1,Mi(sn))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Hr)))return null;var j=p[p.length-1];j.scale=P,j.font=k,j.textColor=z}else{var H=o.parse(t[b],1,tn);if(!H)return null;var ee=H.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:H,scale:null,font:null,textColor:null})}}return new Ho(p)},Ho.prototype.evaluate=function(t){return new Sa(this.sections.map(function(o){var u=o.content.evaluate(t);return Ji(u)===yi?new ou("",u,null,null,null):new ou(Xu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Ho.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t.push(p.content.serialize());var y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),t.push(y)}return t};var Wo=function(t){this.type=yi,this.input=t};Wo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,sn);return u?new Wo(u):o.error("No image name provided.")},Wo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=Ca.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Wo.prototype.eachChild=function(t){t(this.input)},Wo.prototype.outputDefined=function(){return!1},Wo.prototype.serialize=function(){return["image",this.input.serialize()]};var Yu={"to-boolean":Zr,"to-color":Hr,"to-number":Lt,"to-string":sn},go=function(t,o){this.type=t,this.args=o};go.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var p=Yu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,tn);if(!S)return null;y.push(S)}return new go(p,y)},go.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,p=0,y=this.args;p<y.length;p+=1){if(u=null,(o=y[p].evaluate(t))instanceof zi)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":Es(o[0],o[1],o[2],o[3])))return new zi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new La(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,P=0,k=this.args;P<k.length;P+=1){if((S=k[P].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new La("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Sa.fromString(Xu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ca.fromString(Xu(this.args[0].evaluate(t))):Xu(this.args[0].evaluate(t))},go.prototype.eachChild=function(t){this.args.forEach(t)},go.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},go.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ho([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Xo=["Unknown","Point","LineString","Polygon"],pa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};pa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},pa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Xo[this.feature.type]:this.feature.type:null},pa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},pa.prototype.canonicalID=function(){return this.canonical},pa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},pa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=zi.parse(t)),o};var ho=function(t,o,u,p){this.name=t,this.type=o,this._evaluate=u,this.args=p};ho.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ho.prototype.eachChild=function(t){this.args.forEach(t)},ho.prototype.outputDefined=function(){return!1},ho.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},ho.parse=function(t,o){var u,p=t[0],y=ho.definitions[p];if(!y)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,P=S.filter(function(Vn){var mn=Vn[0];return!Array.isArray(mn)||mn.length===t.length-1}),k=null,z=0,j=P;z<j.length;z+=1){var H=j[z],ee=H[0],ne=H[1];k=new Xs(o.registry,o.path,null,o.scope);for(var Me=[],Oe=!1,Ke=1;Ke<t.length;Ke++){var je=t[Ke],He=Array.isArray(ee)?ee[Ke-1]:ee.type,tt=k.parse(je,1+Me.length,He);if(!tt){Oe=!0;break}Me.push(tt)}if(!Oe)if(Array.isArray(ee)&&ee.length!==Me.length)k.error("Expected "+ee.length+" arguments, but found "+Me.length+" instead.");else{for(var Gt=0;Gt<Me.length;Gt++){var Yt=Array.isArray(ee)?ee[Gt]:ee.type,hr=Me[Gt];k.concat(Gt+1).checkSubtype(Yt,hr.type)}if(k.errors.length===0)return new ho(p,b,ne,Me)}}if(P.length===1)(u=o.errors).push.apply(u,k.errors);else{for(var Rr=(P.length?P:S).map(function(Vn){var mn;return mn=Vn[0],Array.isArray(mn)?"("+mn.map(xi).join(", ")+")":"("+xi(mn.type)+"...)"}).join(" | "),$r=[],zn=1;zn<t.length;zn++){var dn=o.parse(t[zn],1+$r.length);if(!dn)return null;$r.push(xi(dn.type))}o.error("Expected arguments of type "+Rr+", but found ("+$r.join(", ")+") instead.")}return null},ho.register=function(t,o){for(var u in ho.definitions=o,o)t[u]=ho};var Yo=function(t,o,u){this.type=Si,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Qa(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function su(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Lc(t,o){var u=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(p*y*8192)]}function Ds(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function Q(t,o){for(var u,p,y,b,S,P,k,z=!1,j=0,H=o.length;j<H;j++)for(var ee=o[j],ne=0,Me=ee.length;ne<Me-1;ne++){if((b=(u=t)[0]-(p=ee[ne])[0])*(k=u[1]-(y=ee[ne+1])[1])-(P=u[0]-y[0])*(S=u[1]-p[1])==0&&b*P<=0&&S*k<=0)return!1;Ds(t,ee[ne],ee[ne+1])&&(z=!z)}return z}function be(t,o){for(var u=0;u<o.length;u++)if(Q(t,o[u]))return!0;return!1}function Je(t,o,u,p){var y=p[0]-u[0],b=p[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),P=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&P<0||S<0&&P>0}function Ft(t,o,u){for(var p=0,y=u;p<y.length;p+=1)for(var b=y[p],S=0;S<b.length-1;++S)if((H=[(j=b[S+1])[0]-(z=b[S])[0],j[1]-z[1]])[0]*(ee=[(k=o)[0]-(P=t)[0],k[1]-P[1]])[1]-H[1]*ee[0]!=0&&Je(P,k,z,j)&&Je(z,j,P,k))return!0;var P,k,z,j,H,ee;return!1}function Lr(t,o){for(var u=0;u<t.length;++u)if(!Q(t[u],o))return!1;for(var p=0;p<t.length-1;++p)if(Ft(t[p],t[p+1],o))return!1;return!0}function lt(t,o){for(var u=0;u<o.length;u++)if(Lr(t,o[u]))return!0;return!1}function Ct(t,o,u){for(var p=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var P=Lc(t[y][S],u);Qa(o,P),b.push(P)}p.push(b)}return p}function Ja(t,o,u){for(var p=[],y=0;y<t.length;y++){var b=Ct(t[y],o,u);p.push(b)}return p}function Yi(t,o,u,p){if(t[0]<u[0]||t[0]>u[2]){var y=.5*p,b=t[0]-u[0]>y?-p:u[0]-t[0]>y?p:0;b===0&&(b=t[0]-u[2]>y?-p:u[2]-t[0]>y?p:0),t[0]+=b}Qa(o,t)}function Za(t,o,u,p){for(var y=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],S=[],P=0,k=t;P<k.length;P+=1)for(var z=0,j=k[P];z<j.length;z+=1){var H=j[z],ee=[H.x+b[0],H.y+b[1]];Yi(ee,o,u,y),S.push(ee)}return S}function qo(t,o,u,p){for(var y,b=8192*Math.pow(2,p.z),S=[8192*p.x,8192*p.y],P=[],k=0,z=t;k<z.length;k+=1){for(var j=[],H=0,ee=z[k];H<ee.length;H+=1){var ne=ee[H],Me=[ne.x+S[0],ne.y+S[1]];Qa(o,Me),j.push(Me)}P.push(j)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Oe=0,Ke=P;Oe<Ke.length;Oe+=1)for(var je=0,He=Ke[Oe];je<He.length;je+=1)Yi(He[je],o,u,b)}return P}Yo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Zr);if(!p)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Zr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,sn))?null:new Yo(p,y,b)},Yo.prototype.evaluate=function(t){return new Ra(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Yo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Yo.prototype.outputDefined=function(){return!1},Yo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Yr=function(t,o){this.type=Zr,this.geojson=t,this.geometries=o};function jr(t){if(t instanceof ho&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Yr)return!1;var o=!0;return t.eachChild(function(u){o&&!jr(u)&&(o=!1)}),o}function It(t){if(t instanceof ho&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!It(u)&&(o=!1)}),o}function Fo(t,o){if(t instanceof ho&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(p){u&&!Fo(p,o)&&(u=!1)}),u}Yr.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(fs(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Yr(u,u.features[p].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Yr(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Yr(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Yr.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ct(u.coordinates,y,b),P=Za(o.geometry(),p,y,b);if(!su(p,y))return!1;for(var k=0,z=P;k<z.length;k+=1)if(!Q(z[k],S))return!1}if(u.type==="MultiPolygon"){var j=Ja(u.coordinates,y,b),H=Za(o.geometry(),p,y,b);if(!su(p,y))return!1;for(var ee=0,ne=H;ee<ne.length;ee+=1)if(!be(ne[ee],j))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ct(u.coordinates,y,b),P=qo(o.geometry(),p,y,b);if(!su(p,y))return!1;for(var k=0,z=P;k<z.length;k+=1)if(!Lr(z[k],S))return!1}if(u.type==="MultiPolygon"){var j=Ja(u.coordinates,y,b),H=qo(o.geometry(),p,y,b);if(!su(p,y))return!1;for(var ee=0,ne=H;ee<ne.length;ee+=1)if(!lt(ne[ee],j))return!1}return!0}(t,this.geometries)}return!1},Yr.prototype.eachChild=function(){},Yr.prototype.outputDefined=function(){return!0},Yr.prototype.serialize=function(){return["within",this.geojson]};var ae=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};ae.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new ae(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},ae.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},ae.prototype.eachChild=function(){},ae.prototype.outputDefined=function(){return!1},ae.prototype.serialize=function(){return["var",this.name]};var Xs=function(t,o,u,p,y){o===void 0&&(o=[]),p===void 0&&(p=new _n),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=p,this.errors=y,this.expectedType=u};function uu(t,o){for(var u,p=t.length-1,y=0,b=p,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===p||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new La("Input is not a number.");b=S-1}return 0}Xs.prototype.parse=function(t,o,u,p,y){return y===void 0&&(y={}),o?this.concat(o,u,p)._parse(t,y):this._parse(t,y)},Xs.prototype._parse=function(t,o){function u(z,j,H){return H==="assert"?new Xi(j,[z]):H==="coerce"?new go(j,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[p];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,P=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||P.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(S,P))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof fo)&&b.type.kind!=="resolvedImage"&&function z(j){if(j instanceof ae)return z(j.boundExpression);if(j instanceof ho&&j.name==="error"||j instanceof Yo||j instanceof Yr)return!1;var H=j instanceof go||j instanceof Xi,ee=!0;return j.eachChild(function(ne){ee=H?ee&&z(ne):ee&&ne instanceof fo}),!!ee&&jr(j)&&Fo(j,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var k=new pa;try{b=new fo(b.type,b.evaluate(k))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Xs.prototype.concat=function(t,o,u){var p=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Xs(this.registry,p,o||null,y,this.errors)},Xs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new gr(p,t))},Xs.prototype.checkSubtype=function(t,o){var u=Vi(t,o);return u&&this.error(u),u};var hs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var p=0,y=u;p<y.length;p+=1){var b=y[p],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ia(t,o,u){return t*(1-u)+o*u}hs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Lt);if(!u)return null;var p=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],P=t[b+1],k=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(p.length&&p[p.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var j=o.parse(P,z,y);if(!j)return null;y=y||j.type,p.push([S,j])}return new hs(y,u,p)},hs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;return p>=o[y-1]?u[y-1].evaluate(t):u[uu(o,p)].evaluate(t)},hs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},hs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},hs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var po=Object.freeze({__proto__:null,number:ia,color:function(t,o,u){return new zi(ia(t.r,o.r,u),ia(t.g,o.g,u),ia(t.b,o.b,u),ia(t.a,o.a,u))},array:function(t,o,u){return t.map(function(p,y){return ia(p,o[y],u)})}}),oc=6/29*3*(6/29),kc=Math.PI/180,qu=180/Math.PI;function Dc(t){return t>.008856451679035631?Math.pow(t,1/3):t/oc+4/29}function jl(t){return t>6/29?t*t*t:oc*(t-4/29)}function Ku(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function lu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $u(t){var o=lu(t.r),u=lu(t.g),p=lu(t.b),y=Dc((.4124564*o+.3575761*u+.1804375*p)/.95047),b=Dc((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-Dc((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,p=isNaN(t.b)?o:o-t.b/200;return o=1*jl(o),u=.95047*jl(u),p=1.08883*jl(p),new zi(Ku(3.2404542*u-1.5371385*o-.4985314*p),Ku(-.969266*u+1.8760108*o+.041556*p),Ku(.0556434*u-.2040259*o+1.0572252*p),t.alpha)}function T(t,o,u){var p=o-t;return t+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var F={forward:$u,reverse:_,interpolate:function(t,o,u){return{l:ia(t.l,o.l,u),a:ia(t.a,o.a,u),b:ia(t.b,o.b,u),alpha:ia(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=$u(t),u=o.l,p=o.a,y=o.b,b=Math.atan2(y,p)*qu;return{h:b<0?b+360:b,c:Math.sqrt(p*p+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*kc,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:T(t.h,o.h,u),c:ia(t.c,o.c,u),l:ia(t.l,o.l,u),alpha:ia(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:F,hcl:R}),xe=function(t,o,u,p,y){this.type=t,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var P=S[b],k=P[1];this.labels.push(P[0]),this.outputs.push(k)}};function We(t,o,u,p){var y=p-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}xe.interpolationFactor=function(t,o,u,p){var y=0;if(t.name==="exponential")y=We(o,t.base,u,p);else if(t.name==="linear")y=We(o,1,u,p);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new V(b[0],b[1],b[2],b[3]).solve(We(o,1,u,p))}return y},xe.parse=function(t,o){var u=t[0],p=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var S=p[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var P=p.slice(1);if(P.length!==4||P.some(function(Ke){return typeof Ke!="number"||Ke<0||Ke>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:P}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Lt)))return null;var k=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Hr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var j=0;j<b.length;j+=2){var H=b[j],ee=b[j+1],ne=j+3,Me=j+4;if(typeof H!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ne);if(k.length&&k[k.length-1][0]>=H)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ne);var Oe=o.parse(ee,Me,z);if(!Oe)return null;z=z||Oe.type,k.push([H,Oe])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new xe(z,u,p,y,k):o.error("Type "+xi(z)+" is not interpolatable.")},xe.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;if(p>=o[y-1])return u[y-1].evaluate(t);var b=uu(o,p),S=xe.interpolationFactor(this.interpolation,p,o[b],o[b+1]),P=u[b].evaluate(t),k=u[b+1].evaluate(t);return this.operator==="interpolate"?po[this.type.kind.toLowerCase()](P,k,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(P),R.forward(k),S)):F.reverse(F.interpolate(F.forward(P),F.forward(k),S))},xe.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},xe.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},xe.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var dt=function(t,o){this.type=t,this.args=o};dt.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var P=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,y.push(P)}var k=p&&y.some(function(z){return Vi(p,z.type)});return new dt(k?tn:u,y)},dt.prototype.evaluate=function(t){for(var o,u=null,p=0,y=0,b=this.args;y<b.length&&(p++,(u=b[y].evaluate(t))&&u instanceof Ca&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);y+=1);return u},dt.prototype.eachChild=function(t){this.args.forEach(t)},dt.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},dt.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var mt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};mt.prototype.evaluate=function(t){return this.result.evaluate(t)},mt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},mt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],p=1;p<t.length-1;p+=2){var y=t[p];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",p);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var b=o.parse(t[p+1],p+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new mt(u,S):null},mt.prototype.outputDefined=function(){return this.result.outputDefined()},mt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var fr=function(t,o,u){this.type=t,this.index=o,this.input=u};fr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Lt),p=o.parse(t[2],2,Mi(o.expectedType||tn));return u&&p?new fr(p.type.itemType,u,p):null},fr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new La("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new La("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new La("Array index must be an integer, but found "+o+" instead.");return u[o]},fr.prototype.eachChild=function(t){t(this.index),t(this.input)},fr.prototype.outputDefined=function(){return!1},fr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var br=function(t,o){this.type=Zr,this.needle=t,this.haystack=o};br.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,tn),p=o.parse(t[2],2,tn);return u&&p?Ta(u.type,[Zr,sn,Lt,ln,tn])?new br(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(u.type)+" instead"):null},br.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!na(o,["boolean","string","number","null"]))throw new La("Expected first argument to be of type boolean, string, number or null, but found "+xi(Ji(o))+" instead.");if(!na(u,["string","array"]))throw new La("Expected second argument to be of type array or string, but found "+xi(Ji(u))+" instead.");return u.indexOf(o)>=0},br.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},br.prototype.outputDefined=function(){return!0},br.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Pn=function(t,o,u){this.type=Lt,this.needle=t,this.haystack=o,this.fromIndex=u};Pn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,tn),p=o.parse(t[2],2,tn);if(!u||!p)return null;if(!Ta(u.type,[Zr,sn,Lt,ln,tn]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Lt);return y?new Pn(u,p,y):null}return new Pn(u,p)},Pn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!na(o,["boolean","string","number","null"]))throw new La("Expected first argument to be of type boolean, string, number or null, but found "+xi(Ji(o))+" instead.");if(!na(u,["string","array"]))throw new La("Expected second argument to be of type array or string, but found "+xi(Ji(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return u.indexOf(o,p)}return u.indexOf(o)},Pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Pn.prototype.outputDefined=function(){return!1},Pn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ci=function(t,o,u,p,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=p,this.outputs=y,this.otherwise=b};ci.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var P=t[S],k=t[S+1];Array.isArray(P)||(P=[P]);var z=o.concat(S);if(P.length===0)return z.error("Expected at least one branch label.");for(var j=0,H=P;j<H.length;j+=1){var ee=H[j];if(typeof ee!="number"&&typeof ee!="string")return z.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,Ji(ee)))return null}else u=Ji(ee);if(y[String(ee)]!==void 0)return z.error("Branch labels must be unique.");y[String(ee)]=b.length}var ne=o.parse(k,S,p);if(!ne)return null;p=p||ne.type,b.push(ne)}var Me=o.parse(t[1],1,tn);if(!Me)return null;var Oe=o.parse(t[t.length-1],t.length-1,p);return Oe?Me.type.kind!=="value"&&o.concat(1).checkSubtype(u,Me.type)?null:new ci(u,p,Me,y,b,Oe):null},ci.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(Ji(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ci.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ci.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ci.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],p={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(H=p[this.cases[S]])===void 0?(p[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[H][1].push(S)}for(var P=function(ne){return t.inputType.kind==="number"?Number(ne):ne},k=0,z=u;k<z.length;k+=1){var j=z[k],H=j[0],ee=j[1];o.push(ee.length===1?P(ee[0]):ee.map(P)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var ei=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};ei.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Zr);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;p.push([b,S]),u=u||S.type}var P=o.parse(t[t.length-1],t.length-1,u);return P?new ei(u,p,P):null},ei.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];if(p[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},ei.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];t(p[0]),t(y)}t(this.otherwise)},ei.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},ei.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Gi=function(t,o,u,p){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=p};function ua(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Aa(t,o,u,p){return p.compare(o,u)===0}function Ui(t,o,u){var p=t!=="=="&&t!=="!=";return function(){function y(b,S,P){this.type=Zr,this.lhs=b,this.rhs=S,this.collator=P,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var P=b[0],k=S.parse(b[1],1,tn);if(!k)return null;if(!ua(P,k.type))return S.concat(1).error('"'+P+`" comparisons are not supported for type '`+xi(k.type)+"'.");var z=S.parse(b[2],2,tn);if(!z)return null;if(!ua(P,z.type))return S.concat(2).error('"'+P+`" comparisons are not supported for type '`+xi(z.type)+"'.");if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+xi(k.type)+"' and '"+xi(z.type)+"'.");p&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new Xi(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new Xi(k.type,[z])));var j=null;if(b.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(j=S.parse(b[3],3,Si)))return null}return new y(k,z,j)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),P=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){var k=Ji(S),z=Ji(P);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new La('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+z.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var j=Ji(S),H=Ji(P);if(j.kind!=="string"||H.kind!=="string")return o(b,S,P)}return this.collator?u(b,S,P,this.collator.evaluate(b)):o(b,S,P)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Gi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,tn),p=o.parse(t[2],2,Lt);if(!u||!p)return null;if(!Ta(u.type,[Mi(tn),sn,tn]))return o.error("Expected first argument to be of type array or string, but found "+xi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Lt);return y?new Gi(u.type,u,p,y):null}return new Gi(u.type,u,p)},Gi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!na(o,["string","array"]))throw new La("Expected first argument to be of type array or string, but found "+xi(Ji(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return o.slice(u,p)}return o.slice(u)},Gi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Gi.prototype.outputDefined=function(){return!1},Gi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Po=Ui("==",function(t,o,u){return o===u},Aa),Ss=Ui("!=",function(t,o,u){return o!==u},function(t,o,u,p){return!Aa(0,o,u,p)}),xl=Ui("<",function(t,o,u){return o<u},function(t,o,u,p){return p.compare(o,u)<0}),rf=Ui(">",function(t,o,u){return o>u},function(t,o,u,p){return p.compare(o,u)>0}),Qu=Ui("<=",function(t,o,u){return o<=u},function(t,o,u,p){return p.compare(o,u)<=0}),Fc=Ui(">=",function(t,o,u){return o>=u},function(t,o,u,p){return p.compare(o,u)>=0}),Iu=function(t,o,u,p,y){this.type=sn,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y};Iu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Lt);if(!u)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var y=null;if(p.locale&&!(y=o.parse(p.locale,1,sn)))return null;var b=null;if(p.currency&&!(b=o.parse(p.currency,1,sn)))return null;var S=null;if(p["min-fraction-digits"]&&!(S=o.parse(p["min-fraction-digits"],1,Lt)))return null;var P=null;return p["max-fraction-digits"]&&!(P=o.parse(p["max-fraction-digits"],1,Lt))?null:new Iu(u,y,b,S,P)},Iu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Iu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Iu.prototype.outputDefined=function(){return!1},Iu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var _u=function(t){this.type=Lt,this.input=t};_u.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+xi(u.type)+" instead."):new _u(u):null},_u.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new La("Expected value to be of type string or array, but found "+xi(Ji(o))+" instead.")},_u.prototype.eachChild=function(t){t(this.input)},_u.prototype.outputDefined=function(){return!1},_u.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var yo={"==":Po,"!=":Ss,">":rf,"<":xl,">=":Fc,"<=":Qu,array:Xi,at:fr,boolean:Xi,case:ei,coalesce:dt,collator:Yo,format:Ho,image:Wo,in:br,"index-of":Pn,interpolate:xe,"interpolate-hcl":xe,"interpolate-lab":xe,length:_u,let:mt,literal:fo,match:ci,number:Xi,"number-format":Iu,object:Xi,slice:Gi,step:hs,string:Xi,"to-boolean":go,"to-color":go,"to-number":go,"to-string":go,var:ae,within:Yr};function la(t,o){var u=o[0],p=o[1],y=o[2],b=o[3];u=u.evaluate(t),p=p.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,P=Es(u,p,y,S);if(P)throw new La(P);return new zi(u/255*S,p/255*S,y/255*S,S)}function bh(t,o){return t in o}function Eh(t,o){var u=o[t];return u===void 0?null:u}function ao(t){return{type:t}}function Vf(t){return{result:"success",value:t}}function xu(t){return{result:"error",value:t}}function Fs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Bc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function bl(t){return!!t.expression&&t.expression.interpolated}function xa(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Vl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function sc(t){return t}function rs(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Gf(t,o,u,p,y){return rs(typeof u===y?p[u]:void 0,t.default,o.default)}function Sh(t,o,u){if(xa(u)!=="number")return rs(t.default,o.default);var p=t.stops.length;if(p===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[p-1][0])return t.stops[p-1][1];var y=uu(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function Ch(t,o,u){var p=t.base!==void 0?t.base:1;if(xa(u)!=="number")return rs(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=uu(t.stops.map(function(H){return H[0]}),u),S=function(H,ee,ne,Me){var Oe=Me-ne,Ke=H-ne;return Oe===0?0:ee===1?Ke/Oe:(Math.pow(ee,Ke)-1)/(Math.pow(ee,Oe)-1)}(u,p,t.stops[b][0],t.stops[b+1][0]),P=t.stops[b][1],k=t.stops[b+1][1],z=po[o.type]||sc;if(t.colorSpace&&t.colorSpace!=="rgb"){var j=K[t.colorSpace];z=function(H,ee){return j.reverse(j.interpolate(j.forward(H),j.forward(ee),S))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var H=[],ee=arguments.length;ee--;)H[ee]=arguments[ee];var ne=P.evaluate.apply(void 0,H),Me=k.evaluate.apply(void 0,H);if(ne!==void 0&&Me!==void 0)return z(ne,Me,S)}}:z(P,k,S)}function nf(t,o,u){return o.type==="color"?u=zi.parse(u):o.type==="formatted"?u=Sa.fromString(u.toString()):o.type==="resolvedImage"?u=Ca.fromString(u.toString()):xa(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),rs(u,t.default,o.default)}ho.register(yo,{error:[{kind:"error"},[sn],function(t,o){throw new La(o[0].evaluate(t))}],typeof:[sn,[tn],function(t,o){return xi(Ji(o[0].evaluate(t)))}],"to-rgba":[Mi(Lt,4),[Hr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Hr,[Lt,Lt,Lt],la],rgba:[Hr,[Lt,Lt,Lt,Lt],la],has:{type:Zr,overloads:[[[sn],function(t,o){return bh(o[0].evaluate(t),t.properties())}],[[sn,oi],function(t,o){var u=o[1];return bh(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:tn,overloads:[[[sn],function(t,o){return Eh(o[0].evaluate(t),t.properties())}],[[sn,oi],function(t,o){var u=o[1];return Eh(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[tn,[sn],function(t,o){return Eh(o[0].evaluate(t),t.featureState||{})}],properties:[oi,[],function(t){return t.properties()}],"geometry-type":[sn,[],function(t){return t.geometryType()}],id:[tn,[],function(t){return t.id()}],zoom:[Lt,[],function(t){return t.globals.zoom}],"heatmap-density":[Lt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Lt,[],function(t){return t.globals.lineProgress||0}],accumulated:[tn,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Lt,ao(Lt),function(t,o){for(var u=0,p=0,y=o;p<y.length;p+=1)u+=y[p].evaluate(t);return u}],"*":[Lt,ao(Lt),function(t,o){for(var u=1,p=0,y=o;p<y.length;p+=1)u*=y[p].evaluate(t);return u}],"-":{type:Lt,overloads:[[[Lt,Lt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Lt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Lt,[Lt,Lt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Lt,[Lt,Lt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Lt,[],function(){return Math.LN2}],pi:[Lt,[],function(){return Math.PI}],e:[Lt,[],function(){return Math.E}],"^":[Lt,[Lt,Lt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Lt,[Lt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Lt,[Lt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Lt,[Lt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Lt,[Lt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Lt,[Lt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Lt,[Lt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Lt,[Lt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Lt,[Lt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Lt,[Lt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Lt,[Lt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Lt,ao(Lt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Lt,ao(Lt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Lt,[Lt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Lt,[Lt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Lt,[Lt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Lt,[Lt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Zr,[sn,tn],function(t,o){var u=o[0],p=o[1];return t.properties()[u.value]===p.value}],"filter-id-==":[Zr,[tn],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Zr,[sn],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Zr,[sn,tn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Zr,[tn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<y}],"filter->":[Zr,[sn,tn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>b}],"filter-id->":[Zr,[tn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>y}],"filter-<=":[Zr,[sn,tn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Zr,[tn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<=y}],"filter->=":[Zr,[sn,tn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Zr,[tn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>=y}],"filter-has":[Zr,[tn],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Zr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Zr,[Mi(sn)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Zr,[Mi(tn)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Zr,[sn,Mi(tn)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Zr,[sn,Mi(tn)],function(t,o){var u=o[0],p=o[1];return function(y,b,S,P){for(;S<=P;){var k=S+P>>1;if(b[k]===y)return!0;b[k]>y?P=k-1:S=k+1}return!1}(t.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[ao(Zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(t))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[ao(Zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(t))return!0;return!1}]]},"!":[Zr,[Zr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Zr,[sn],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[sn,[sn],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[sn,[sn],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[sn,ao(tn),function(t,o){return o.map(function(u){return Xu(u.evaluate(t))}).join("")}],"resolved-locale":[sn,[Si],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var El=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new pa,this._defaultValue=o?function(u){return u.type==="color"&&Vl(u.default)?new zi(0,0,0,0):u.type==="color"?zi.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Bo(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in yo}function Ou(t,o){var u=new Xs(yo,[],o?function(y){var b={color:Hr,string:sn,number:Lt,enum:sn,boolean:Zr,formatted:$i,resolvedImage:yi};return y.type==="array"?Mi(b[y.value]||tn,y.length):b[y.type]}(o):void 0),p=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Vf(new El(p,o)):xu(u.errors)}El.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},El.prototype.evaluate=function(t,o,u,p,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new La("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Ju=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!It(o.expression)};Ju.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},Ju.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)};var No=function(t,o,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!It(o.expression),this.interpolationType=p};function Gl(t,o){if((t=Ou(t,o)).result==="error")return t;var u=t.value.expression,p=jr(u);if(!p&&!Fs(o))return xu([new gr("","data expressions not supported")]);var y=Fo(u,["zoom"]);if(!y&&!Bc(o))return xu([new gr("","zoom expressions not supported")]);var b=function S(P){var k=null;if(P instanceof mt)k=S(P.result);else if(P instanceof dt)for(var z=0,j=P.args;z<j.length&&!(k=S(j[z]));z+=1);else(P instanceof hs||P instanceof xe)&&P.input instanceof ho&&P.input.name==="zoom"&&(k=P);return k instanceof gr||P.eachChild(function(H){var ee=S(H);ee instanceof gr?k=ee:!k&&ee?k=new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&ee&&k!==ee&&(k=new gr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(u);return b||y?b instanceof gr?xu([b]):b instanceof xe&&!bl(o)?xu([new gr("",'"interpolate" expressions cannot be used with this property')]):Vf(b?new No(p?"camera":"composite",t.value,b.labels,b instanceof xe?b.interpolation:void 0):new Ju(p?"constant":"source",t.value)):xu([new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}No.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},No.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)},No.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?xe.interpolationFactor(this.interpolationType,t,o,u):0};var el=function(t,o){this._parameters=t,this._specification=o,vr(this,function u(p,y){var b,S,P,k=y.type==="color",z=p.stops&&typeof p.stops[0][0]=="object",j=z||!(z||p.property!==void 0),H=p.type||(bl(y)?"exponential":"interval");if(k&&((p=vr({},p)).stops&&(p.stops=p.stops.map(function(dn){return[dn[0],zi.parse(dn[1])]})),p.default=zi.parse(p.default?p.default:y.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!K[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(H==="exponential")b=Ch;else if(H==="interval")b=Sh;else if(H==="categorical"){b=Gf,S=Object.create(null);for(var ee=0,ne=p.stops;ee<ne.length;ee+=1){var Me=ne[ee];S[Me[0]]=Me[1]}P=typeof p.stops[0][0]}else{if(H!=="identity")throw new Error('Unknown function type "'+H+'"');b=nf}if(z){for(var Oe={},Ke=[],je=0;je<p.stops.length;je++){var He=p.stops[je],tt=He[0].zoom;Oe[tt]===void 0&&(Oe[tt]={zoom:tt,type:p.type,property:p.property,default:p.default,stops:[]},Ke.push(tt)),Oe[tt].stops.push([He[0].value,He[1]])}for(var Gt=[],Yt=0,hr=Ke;Yt<hr.length;Yt+=1){var Rr=hr[Yt];Gt.push([Oe[Rr].zoom,u(Oe[Rr],y)])}var $r={name:"linear"};return{kind:"composite",interpolationType:$r,interpolationFactor:xe.interpolationFactor.bind(void 0,$r),zoomStops:Gt.map(function(dn){return dn[0]}),evaluate:function(dn,Vn){var mn=dn.zoom;return Ch({stops:Gt,base:p.base},y,mn).evaluate(mn,Vn)}}}if(j){var zn=H==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:zn,interpolationFactor:xe.interpolationFactor.bind(void 0,zn),zoomStops:p.stops.map(function(dn){return dn[0]}),evaluate:function(dn){return b(p,y,dn.zoom,S,P)}}}return{kind:"source",evaluate:function(dn,Vn){var mn=Vn&&Vn.properties?Vn.properties[p.property]:void 0;return mn===void 0?rs(p.default,y.default):b(p,y,mn,S,P)}}}(this._parameters,this._specification))};function Ys(t){var o=t.key,u=t.value,p=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,P=[],k=xa(u);if(k!=="object")return[new De(o,u,"object expected, "+k+" found")];for(var z in u){var j=z.split(".")[0],H=p[j]||p["*"],ee=void 0;if(y[j])ee=y[j];else if(p[j])ee=ki;else if(y["*"])ee=y["*"];else{if(!p["*"]){P.push(new De(o,u[z],'unknown property "'+z+'"'));continue}ee=ki}P=P.concat(ee({key:(o&&o+".")+z,value:u[z],valueSpec:H,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var ne in p)y[ne]||p[ne].required&&p[ne].default===void 0&&u[ne]===void 0&&P.push(new De(o,u,'missing required property "'+ne+'"'));return P}function af(t){var o=t.value,u=t.valueSpec,p=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||ki;if(xa(o)!=="array")return[new De(b,o,"array expected, "+xa(o)+" found")];if(u.length&&o.length!==u.length)return[new De(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new De(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var P={type:u.value,values:u.values};y.$version<7&&(P.function=u.function),xa(u.value)==="object"&&(P=u.value);for(var k=[],z=0;z<o.length;z++)k=k.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:P,style:p,styleSpec:y,key:b+"["+z+"]"}));return k}function of(t){var o=t.key,u=t.value,p=t.valueSpec,y=xa(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new De(o,u,"number expected, "+y+" found")]:"minimum"in p&&u<p.minimum?[new De(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new De(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function sf(t){var o,u,p,y=t.valueSpec,b=Bt(t.value.type),S={},P=b!=="categorical"&&t.value.property===void 0,k=!P,z=xa(t.value.stops)==="array"&&xa(t.value.stops[0])==="array"&&xa(t.value.stops[0][0])==="object",j=Ys({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ne){if(b==="identity")return[new De(ne.key,ne.value,'identity function may not have a "stops" property')];var Me=[],Oe=ne.value;return Me=Me.concat(af({key:ne.key,value:Oe,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:H})),xa(Oe)==="array"&&Oe.length===0&&Me.push(new De(ne.key,Oe,"array must have at least one stop")),Me},default:function(ne){return ki({key:ne.key,value:ne.value,valueSpec:y,style:ne.style,styleSpec:ne.styleSpec})}}});return b==="identity"&&P&&j.push(new De(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||j.push(new De(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!bl(t.valueSpec)&&j.push(new De(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!Fs(t.valueSpec)?j.push(new De(t.key,t.value,"property functions not supported")):P&&!Bc(t.valueSpec)&&j.push(new De(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||j.push(new De(t.key,t.value,'"property" property is required')),j;function H(ne){var Me=[],Oe=ne.value,Ke=ne.key;if(xa(Oe)!=="array")return[new De(Ke,Oe,"array expected, "+xa(Oe)+" found")];if(Oe.length!==2)return[new De(Ke,Oe,"array length 2 expected, length "+Oe.length+" found")];if(z){if(xa(Oe[0])!=="object")return[new De(Ke,Oe,"object expected, "+xa(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new De(Ke,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new De(Ke,Oe,"object stop key must have value")];if(p&&p>Bt(Oe[0].zoom))return[new De(Ke,Oe[0].zoom,"stop zoom values must appear in ascending order")];Bt(Oe[0].zoom)!==p&&(p=Bt(Oe[0].zoom),u=void 0,S={}),Me=Me.concat(Ys({key:Ke+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:of,value:ee}}))}else Me=Me.concat(ee({key:Ke+"[0]",value:Oe[0],valueSpec:{},style:ne.style,styleSpec:ne.styleSpec},Oe));return Bo(Ut(Oe[1]))?Me.concat([new De(Ke+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Me.concat(ki({key:Ke+"[1]",value:Oe[1],valueSpec:y,style:ne.style,styleSpec:ne.styleSpec}))}function ee(ne,Me){var Oe=xa(ne.value),Ke=Bt(ne.value),je=ne.value!==null?ne.value:Me;if(o){if(Oe!==o)return[new De(ne.key,je,Oe+" stop domain type must match previous stop domain type "+o)]}else o=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new De(ne.key,je,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&b!=="categorical"){var He="number expected, "+Oe+" found";return Fs(y)&&b===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(ne.key,je,He)]}return b!=="categorical"||Oe!=="number"||isFinite(Ke)&&Math.floor(Ke)===Ke?b!=="categorical"&&Oe==="number"&&u!==void 0&&Ke<u?[new De(ne.key,je,"stop domain values must appear in ascending order")]:(u=Ke,b==="categorical"&&Ke in S?[new De(ne.key,je,"stop domain values must be unique")]:(S[Ke]=!0,[])):[new De(ne.key,je,"integer expected, found "+Ke)]}}function tl(t){var o=(t.expressionContext==="property"?Gl:Ou)(Ut(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(p){return new De(""+t.key+p.key,t.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new De(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!It(u))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!It(u))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Fo(u,["zoom","feature-state"]))return[new De(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!jr(u))return[new De(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uc(t){var o=t.key,u=t.value,p=t.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Bt(u))===-1&&y.push(new De(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Bt(u))===-1&&y.push(new De(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Nc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var p=u[o];if(!Nc(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}el.deserialize=function(t){return new el(t._parameters,t._specification)},el.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var uf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Nc(t)||(t=Uc(t));var o=Ou(t,uf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,y){return o.value.evaluate(u,p,{},y)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var y=1;y<p.length;y++)if(u(p[y]))return!0;return!1}(t)}}function Ah(t,o){return t<o?-1:t>o?1:0}function Uc(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Sl(t[1],t[2],"=="):u==="!="?Ru(Sl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Sl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(Uc))):u==="all"?["all"].concat(t.slice(1).map(Uc)):u==="none"?["all"].concat(t.slice(1).map(Uc).map(Ru)):u==="in"?lf(t[1],t.slice(2)):u==="!in"?Ru(lf(t[1],t.slice(2))):u==="has"?cf(t[1]):u==="!has"?Ru(cf(t[1])):u!=="within"||t}function Sl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function lf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(Ah)]]:["filter-in-small",t,["literal",o]]}}function cf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ru(t){return["!",t]}function ff(t){return Nc(Ut(t.value))?tl(vr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,y=u.key;if(xa(p)!=="array")return[new De(y,p,"array expected, "+xa(p)+" found")];var b,S=u.styleSpec,P=[];if(p.length<1)return[new De(y,p,"filter array must have at least 1 element")];switch(P=P.concat(uc({key:y+"[0]",value:p[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Bt(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Bt(p[1])==="$type"&&P.push(new De(y,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&P.push(new De(y,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(b=xa(p[1]))!=="string"&&P.push(new De(y+"[1]",p[1],"string expected, "+b+" found"));for(var k=2;k<p.length;k++)b=xa(p[k]),Bt(p[1])==="$type"?P=P.concat(uc({key:y+"["+k+"]",value:p[k],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&P.push(new De(y+"["+k+"]",p[k],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<p.length;z++)P=P.concat(o({key:y+"["+z+"]",value:p[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=xa(p[1]),p.length!==2?P.push(new De(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="string"&&P.push(new De(y+"[1]",p[1],"string expected, "+b+" found"));break;case"within":b=xa(p[1]),p.length!==2?P.push(new De(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="object"&&P.push(new De(y+"[1]",p[1],"object expected, "+b+" found"))}return P}(t)}function Hf(t,o){var u=t.key,p=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,P=y[o+"_"+t.layerType];if(!P)return[];var k=S.match(/^(.*)-transition$/);if(o==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return ki({key:u,value:b,valueSpec:y.transition,style:p,styleSpec:y});var z,j=t.valueSpec||P[S];if(!j)return[new De(u,b,'unknown property "'+S+'"')];if(xa(b)==="string"&&Fs(j)&&!j.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new De(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var H=[];return t.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&H.push(new De(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Vl(Ut(b))&&Bt(b.type)==="identity"&&H.push(new De(u,b,'"text-font" does not support identity functions'))),H.concat(ki({key:t.key,value:b,valueSpec:j,style:p,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function wh(t){return Hf(t,"paint")}function Hl(t){return Hf(t,"layout")}function np(t){var o=[],u=t.value,p=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new De(p,u,'either "type" or "ref" is required'));var S,P=Bt(u.type),k=Bt(u.ref);if(u.id)for(var z=Bt(u.id),j=0;j<t.arrayIndex;j++){var H=y.layers[j];Bt(H.id)===z&&o.push(new De(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+H.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in u&&o.push(new De(p,u[Me],'"'+Me+'" is prohibited for ref layers'))}),y.layers.forEach(function(Me){Bt(Me.id)===k&&(S=Me)}),S?S.ref?o.push(new De(p,u.ref,"ref cannot reference another ref layer")):P=Bt(S.type):o.push(new De(p,u.ref,'ref layer "'+k+'" not found'));else if(P!=="background")if(u.source){var ee=y.sources&&y.sources[u.source],ne=ee&&Bt(ee.type);ee?ne==="vector"&&P==="raster"?o.push(new De(p,u.source,'layer "'+u.id+'" requires a raster source')):ne==="raster"&&P!=="raster"?o.push(new De(p,u.source,'layer "'+u.id+'" requires a vector source')):ne!=="vector"||u["source-layer"]?ne==="raster-dem"&&P!=="hillshade"?o.push(new De(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!u.paint||!u.paint["line-gradient"]||ne==="geojson"&&ee.lineMetrics||o.push(new De(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new De(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new De(p,u.source,'source "'+u.source+'" not found'))}else o.push(new De(p,u,'missing required property "source"'));return o=o.concat(Ys({key:p,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ki({key:p+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:ff,layout:function(Me){return Ys({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return Hl(vr({layerType:P},Oe))}}})},paint:function(Me){return Ys({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return wh(vr({layerType:P},Oe))}}})}}}))}function ns(t){var o=t.value,u=t.key,p=xa(o);return p!=="string"?[new De(u,o,"string expected, "+p+" found")]:[]}var ja={promoteId:function(t){var o=t.key,u=t.value;if(xa(u)==="string")return ns({key:o,value:u});var p=[];for(var y in u)p.push.apply(p,ns({key:o+"."+y,value:u[y]}));return p}};function lc(t){var o=t.value,u=t.key,p=t.styleSpec,y=t.style;if(!o.type)return[new De(u,o,'"type" is required')];var b,S=Bt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return Ys({key:u,value:o,valueSpec:p["source_"+S.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:ja});case"geojson":if(b=Ys({key:u,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:ja}),o.cluster)for(var P in o.clusterProperties){var k=o.clusterProperties[P],z=k[0],j=typeof z=="string"?[z,["accumulated"],["get",P]]:z;b.push.apply(b,tl({key:u+"."+P+".map",value:k[1],expressionContext:"cluster-map"})),b.push.apply(b,tl({key:u+"."+P+".reduce",value:j,expressionContext:"cluster-reduce"}))}return b;case"video":return Ys({key:u,value:o,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return Ys({key:u,value:o,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new De(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function Wl(t){var o=t.value,u=t.styleSpec,p=u.light,y=t.style,b=[],S=xa(o);if(o===void 0)return b;if(S!=="object")return b.concat([new De("light",o,"object expected, "+S+" found")]);for(var P in o){var k=P.match(/^(.*)-transition$/);b=b.concat(k&&p[k[1]]&&p[k[1]].transition?ki({key:P,value:o[P],valueSpec:u.transition,style:y,styleSpec:u}):p[P]?ki({key:P,value:o[P],valueSpec:p[P],style:y,styleSpec:u}):[new De(P,o[P],'unknown property "'+P+'"')])}return b}var cu={"*":function(){return[]},array:af,boolean:function(t){var o=t.value,u=t.key,p=xa(o);return p!=="boolean"?[new De(u,o,"boolean expected, "+p+" found")]:[]},number:of,color:function(t){var o=t.key,u=t.value,p=xa(u);return p!=="string"?[new De(o,u,"color expected, "+p+" found")]:Pi(u)===null?[new De(o,u,'color expected, "'+u+'" found')]:[]},constants:_t,enum:uc,filter:ff,function:sf,layer:np,object:Ys,source:lc,light:Wl,string:ns,formatted:function(t){return ns(t).length===0?[]:tl(t)},resolvedImage:function(t){return ns(t).length===0?[]:tl(t)}};function ki(t){var o=t.value,u=t.valueSpec,p=t.styleSpec;return u.expression&&Vl(Bt(o))?sf(t):u.expression&&Bo(Ut(o))?tl(t):u.type&&cu[u.type]?cu[u.type](t):Ys(vr({},t,{valueSpec:u.type?p[u.type]:u}))}function Ma(t){var o=t.value,u=t.key,p=ns(t);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new De(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new De(u,o,'"glyphs" url must include a "{range}" token'))),p}function Bs(t,o){o===void 0&&(o=he);var u=[];return u=u.concat(ki({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),t.constants&&(u=u.concat(_t({key:"constants",value:t.constants,style:t,styleSpec:o}))),hf(u)}function hf(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function Cl(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return hf(t.apply(this,o))}}Bs.source=Cl(lc),Bs.light=Cl(Wl),Bs.layer=Cl(np),Bs.filter=Cl(ff),Bs.paintProperty=Cl(wh),Bs.layoutProperty=Cl(Hl);var pf=Bs,ip=pf.light,ap=pf.paintProperty,Zc=pf.layoutProperty;function cc(t,o){var u=!1;if(o&&o.length)for(var p=0,y=o;p<y.length;p+=1)t.fire(new Ge(new Error(y[p].message))),u=!0;return u}var rl=Io;function Io(t,o,u){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],P=y[3+b+1];p.push(S===P?null:y.subarray(S,P))}var k=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],k),this.bboxes=y.subarray(k),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var j=u/o*t;this.min=-j,this.max=t+j}Io.prototype.insert=function(t,o,u,p,y){this._forEachCell(o,u,p,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)},Io.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Io.prototype._insertCell=function(t,o,u,p,y,b){this.cells[y].push(b)},Io.prototype.query=function(t,o,u,p,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=p&&!y)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(t,o,u,p,this._queryCell,P,{},y),P},Io.prototype._queryCell=function(t,o,u,p,y,b,S,P){var k=this.cells[y];if(k!==null)for(var z=this.keys,j=this.bboxes,H=0;H<k.length;H++){var ee=k[H];if(S[ee]===void 0){var ne=4*ee;(P?P(j[ne+0],j[ne+1],j[ne+2],j[ne+3]):t<=j[ne+2]&&o<=j[ne+3]&&u>=j[ne+0]&&p>=j[ne+1])?(S[ee]=!0,b.push(z[ee])):S[ee]=!1}}},Io.prototype._forEachCell=function(t,o,u,p,y,b,S,P){for(var k=this._convertToCellCoord(t),z=this._convertToCellCoord(o),j=this._convertToCellCoord(u),H=this._convertToCellCoord(p),ee=k;ee<=j;ee++)for(var ne=z;ne<=H;ne++){var Me=this.d*ne+ee;if((!P||P(this._convertFromCellCoord(ee),this._convertFromCellCoord(ne),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(ne+1)))&&y.call(this,t,o,u,p,Me,b,S,P))return}},Io.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Io.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Io.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var P=t[S];y[3+S]=b,y.set(P,b),b+=P.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var fc=se.ImageData,hc=se.ImageBitmap,Xa={};function vn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),Xa[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var eo in vn("Object",Object),rl.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},rl.deserialize=function(t){return new rl(t.buffer)},vn("Grid",rl),vn("Color",zi),vn("Error",Error),vn("ResolvedImage",Ca),vn("StylePropertyFunction",el),vn("StyleExpression",El,{omit:["_evaluator"]}),vn("ZoomDependentExpression",No),vn("ZoomConstantExpression",Ju),vn("CompoundExpression",ho,{omit:["_evaluate"]}),yo)yo[eo]._classRegistryKey||vn("Expression_"+eo,yo[eo]);function nl(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function il(t){return hc&&t instanceof hc}function bu(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(nl(t)||il(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof fc)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],y=0,b=t;y<b.length;y+=1)p.push(bu(b[y],o));return p}if(typeof t=="object"){var S=t.constructor,P=S._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(Xa[P].omit.indexOf(z)>=0)){var j=t[z];k[z]=Xa[P].shallow.indexOf(z)>=0?j:bu(j,o)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(k.$name=P),k}throw new Error("can't serialize object of type "+typeof t)}function Ns(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||nl(t)||il(t)||ArrayBuffer.isView(t)||t instanceof fc)return t;if(Array.isArray(t))return t.map(Ns);if(typeof t=="object"){var o=t.$name||"Object",u=Xa[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var p=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var P=t[S];p[S]=Xa[o].shallow.indexOf(S)>=0?P:Ns(P)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var Wf=function(){this.first=!0};Wf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var qr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function df(t){for(var o=0,u=t;o<u.length;o+=1)if(Xf(u[o].charCodeAt(0)))return!0;return!1}function Xf(t){return!(t!==746&&t!==747&&(t<4352||!(qr["Bopomofo Extended"](t)||qr.Bopomofo(t)||qr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||qr["CJK Compatibility Ideographs"](t)||qr["CJK Compatibility"](t)||qr["CJK Radicals Supplement"](t)||qr["CJK Strokes"](t)||!(!qr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||qr["CJK Unified Ideographs Extension A"](t)||qr["CJK Unified Ideographs"](t)||qr["Enclosed CJK Letters and Months"](t)||qr["Hangul Compatibility Jamo"](t)||qr["Hangul Jamo Extended-A"](t)||qr["Hangul Jamo Extended-B"](t)||qr["Hangul Jamo"](t)||qr["Hangul Syllables"](t)||qr.Hiragana(t)||qr["Ideographic Description Characters"](t)||qr.Kanbun(t)||qr["Kangxi Radicals"](t)||qr["Katakana Phonetic Extensions"](t)||qr.Katakana(t)&&t!==12540||!(!qr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!qr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||qr["Unified Canadian Aboriginal Syllabics"](t)||qr["Unified Canadian Aboriginal Syllabics Extended"](t)||qr["Vertical Forms"](t)||qr["Yijing Hexagram Symbols"](t)||qr["Yi Syllables"](t)||qr["Yi Radicals"](t))))}function Lu(t){return!(Xf(t)||function(o){return!!(qr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||qr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||qr["Letterlike Symbols"](o)||qr["Number Forms"](o)||qr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||qr["Control Pictures"](o)&&o!==9251||qr["Optical Character Recognition"](o)||qr["Enclosed Alphanumerics"](o)||qr["Geometric Shapes"](o)||qr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||qr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||qr["CJK Symbols and Punctuation"](o)||qr.Katakana(o)||qr["Private Use Area"](o)||qr["CJK Compatibility Forms"](o)||qr["Small Form Variants"](o)||qr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Ba(t){return t>=1424&&t<=2303||qr["Arabic Presentation Forms-A"](t)||qr["Arabic Presentation Forms-B"](t)}function zs(t,o){return!(!o&&Ba(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||qr.Khmer(t))}function vf(t){for(var o=0,u=t;o<u.length;o+=1)if(Ba(u[o].charCodeAt(0)))return!0;return!1}var ku=null,Is="unavailable",_o=null,Th=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Is="error"),ku&&ku(t)};function da(){Yf.fire(new Pe("pluginStateChange",{pluginStatus:Is,pluginURL:_o}))}var Yf=new ot,Mh=function(){return Is},qs=function(){if(Is!=="deferred"||!_o)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Is="loading",da(),_o&&wa({url:_o},function(t){t?Th(t):(Is="loaded",da())})},Os={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Is==="loaded"||Os.applyArabicShaping!=null},isLoading:function(){return Is==="loading"},setState:function(t){Is=t.pluginStatus,_o=t.pluginURL},isParsed:function(){return Os.applyArabicShaping!=null&&Os.processBidirectionalText!=null&&Os.processStyledBidirectionalText!=null},getPluginURL:function(){return _o}},Ii=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Wf,this.transition={})};Ii.prototype.isSupportedScript=function(t){return function(o,u){for(var p=0,y=o;p<y.length;p+=1)if(!zs(y[p].charCodeAt(0),u))return!1;return!0}(t,Os.isLoaded())},Ii.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ii.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Eu=function(t,o){this.property=t,this.value=o,this.expression=function(u,p){if(Vl(u))return new el(u,p);if(Bo(u)){var y=Gl(u,p);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&p.type==="color"&&(b=zi.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};Eu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Eu.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var ca=function(t){this.property=t,this.value=new Eu(t,void 0)};ca.prototype.transitioned=function(t,o){return new Us(this.property,this.value,o,Pt({},t.transition,this.transition),t.now)},ca.prototype.untransitioned=function(){return new Us(this.property,this.value,null,{},0)};var oo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};oo.prototype.getValue=function(t){return rt(this._values[t].value.value)},oo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ca(this._values[t].property)),this._values[t].value=new Eu(this._values[t].property,o===null?void 0:rt(o))},oo.prototype.getTransition=function(t){return rt(this._values[t].transition)},oo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ca(this._values[t].property)),this._values[t].transition=rt(o)||void 0},oo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y);var b=this.getTransition(p);b!==void 0&&(t[p+"-transition"]=b)}return t},oo.prototype.transitioned=function(t,o){for(var u=new fu(this._properties),p=0,y=Object.keys(this._values);p<y.length;p+=1){var b=y[p];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},oo.prototype.untransitioned=function(){for(var t=new fu(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];t._values[p]=this._values[p].untransitioned()}return t};var Us=function(t,o,u,p,y){this.property=t,this.value=o,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};Us.prototype.possiblyEvaluate=function(t,o,u){var p=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(t,o,u);var S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(P){if(P<=0)return 0;if(P>=1)return 1;var k=P*P,z=k*P;return 4*(P<.5?z:3*(P-k)+z-.75)}(S))}return y};var fu=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};fu.prototype.possiblyEvaluate=function(t,o,u){for(var p=new js(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p},fu.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Zs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Zs.prototype.getValue=function(t){return rt(this._values[t].value)},Zs.prototype.setValue=function(t,o){this._values[t]=new Eu(this._values[t].property,o===null?void 0:rt(o))},Zs.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y)}return t},Zs.prototype.possiblyEvaluate=function(t,o,u){for(var p=new js(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p};var ps=function(t,o,u){this.property=t,this.value=o,this.parameters=u};ps.prototype.isConstant=function(){return this.value.kind==="constant"},ps.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},ps.prototype.evaluate=function(t,o,u,p){return this.property.evaluate(this.value,this.parameters,t,o,u,p)};var js=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};js.prototype.get=function(t){return this._values[t]};var On=function(t){this.specification=t};On.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},On.prototype.interpolate=function(t,o,u){var p=po[this.specification.type];return p?p(t,o,u):t};var Cn=function(t,o){this.specification=t,this.overrides=o};Cn.prototype.possiblyEvaluate=function(t,o,u,p){return new ps(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,p)}:t.expression,o)},Cn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new ps(this,{kind:"constant",value:void 0},t.parameters);var p=po[this.specification.type];return p?new ps(this,{kind:"constant",value:p(t.value.value,o.value.value,u)},t.parameters):t},Cn.prototype.evaluate=function(t,o,u,p,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,p,y,b)};var pc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,y,b){if(u.value===void 0)return new ps(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var S=u.expression.evaluate(p,null,{},y,b),P=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(P,P,P,p);return new ps(this,{kind:"constant",value:k},p)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new ps(this,{kind:"constant",value:z},p)}return new ps(this,u.expression,p)},o.prototype.evaluate=function(u,p,y,b,S,P){if(u.kind==="source"){var k=u.evaluate(p,y,b,S,P);return this._calculate(k,k,k,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},y,b),u.evaluate({zoom:Math.floor(p.zoom)},y,b),u.evaluate({zoom:Math.floor(p.zoom)+1},y,b),p):u.value},o.prototype._calculate=function(u,p,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:y,to:p}},o.prototype.interpolate=function(u){return u},o}(Cn),ds=function(t){this.specification=t};ds.prototype.possiblyEvaluate=function(t,o,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,p);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Ii(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Ii(Math.floor(o.zoom),o)),t.expression.evaluate(new Ii(Math.floor(o.zoom+1),o)),o)}},ds.prototype._calculate=function(t,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},ds.prototype.interpolate=function(t){return t};var Su=function(t){this.specification=t};Su.prototype.possiblyEvaluate=function(t,o,u,p){return!!t.expression.evaluate(o,null,{},u,p)},Su.prototype.interpolate=function(){return!1};var Ko=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new Eu(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new ca(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};vn("DataDrivenProperty",Cn),vn("DataConstantProperty",On),vn("CrossFadedDataDrivenProperty",pc),vn("CrossFadedProperty",ds),vn("ColorRampProperty",Su);var ba=function(t){function o(u,p){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new Zs(p.layout)),p.paint)){for(var y in this._transitionablePaint=new oo(p.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new js(p.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,y){y===void 0&&(y={}),p!=null&&this._validate(Zc,"layers."+this.id+".layout."+u,u,p,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return q(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,y){if(y===void 0&&(y={}),p!=null&&this._validate(ap,"layers."+this.id+".paint."+u,u,p,y))return!1;if(q(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",P=b.value.isDataDriven(),k=b.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||P||S||this._handleOverridablePaintPropertyUpdate(u,k,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),xt(u,function(p,y){return!(p===void 0||y==="layout"&&!Object.keys(p).length||y==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&cc(this,u.call(pf,{key:p,layerType:this.type,objectKey:y,value:b,styleSpec:he,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof ps&&Fs(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(ot),mf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},jc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},oa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ka(t,o){o===void 0&&(o=1);var u=0,p=0;return{members:t.map(function(y){var b=mf[y.type].BYTES_PER_ELEMENT,S=u=qf(u,Math.max(o,b)),P=y.components||1;return p=Math.max(p,b),u+=b*P,{name:y.name,type:y.type,components:P,offset:S}}),size:qf(u,Math.max(p,o)),alignment:o}}function qf(t,o){return Math.ceil(t/o)*o}oa.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},oa.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},oa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},oa.prototype.clear=function(){this.length=0},oa.prototype.resize=function(t){this.reserve(t),this.length=t},oa.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},oa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var al=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.int16[b+0]=p,this.int16[b+1]=y,u},o}(oa);al.prototype.bytesPerElement=4,vn("StructArrayLayout2i4",al);var Ks=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var P=4*u;return this.int16[P+0]=p,this.int16[P+1]=y,this.int16[P+2]=b,this.int16[P+3]=S,u},o}(oa);Ks.prototype.bytesPerElement=8,vn("StructArrayLayout4i8",Ks);var Cu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,p,y,b,S,P)},o.prototype.emplace=function(u,p,y,b,S,P,k){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=k,u},o}(oa);Cu.prototype.bytesPerElement=12,vn("StructArrayLayout2i4i12",Cu);var Oo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,p,y,b,S,P)},o.prototype.emplace=function(u,p,y,b,S,P,k){var z=4*u,j=8*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.uint8[j+4]=b,this.uint8[j+5]=S,this.uint8[j+6]=P,this.uint8[j+7]=k,u},o}(oa);Oo.prototype.bytesPerElement=8,vn("StructArrayLayout2i4ub8",Oo);var ol=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.float32[b+0]=p,this.float32[b+1]=y,u},o}(oa);ol.prototype.bytesPerElement=8,vn("StructArrayLayout2f8",ol);var Au=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,j,H){var ee=this.length;return this.resize(ee+1),this.emplace(ee,u,p,y,b,S,P,k,z,j,H)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,j,H,ee){var ne=10*u;return this.uint16[ne+0]=p,this.uint16[ne+1]=y,this.uint16[ne+2]=b,this.uint16[ne+3]=S,this.uint16[ne+4]=P,this.uint16[ne+5]=k,this.uint16[ne+6]=z,this.uint16[ne+7]=j,this.uint16[ne+8]=H,this.uint16[ne+9]=ee,u},o}(oa);Au.prototype.bytesPerElement=20,vn("StructArrayLayout10ui20",Au);var Al=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,j,H,ee,ne){var Me=this.length;return this.resize(Me+1),this.emplace(Me,u,p,y,b,S,P,k,z,j,H,ee,ne)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,j,H,ee,ne,Me){var Oe=12*u;return this.int16[Oe+0]=p,this.int16[Oe+1]=y,this.int16[Oe+2]=b,this.int16[Oe+3]=S,this.uint16[Oe+4]=P,this.uint16[Oe+5]=k,this.uint16[Oe+6]=z,this.uint16[Oe+7]=j,this.int16[Oe+8]=H,this.int16[Oe+9]=ee,this.int16[Oe+10]=ne,this.int16[Oe+11]=Me,u},o}(oa);Al.prototype.bytesPerElement=24,vn("StructArrayLayout4i4ui4i24",Al);var sl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.float32[S+0]=p,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(oa);sl.prototype.bytesPerElement=12,vn("StructArrayLayout3f12",sl);var dc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(oa);dc.prototype.bytesPerElement=4,vn("StructArrayLayout1ul4",dc);var gf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,j){var H=this.length;return this.resize(H+1),this.emplace(H,u,p,y,b,S,P,k,z,j)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,j,H){var ee=10*u,ne=5*u;return this.int16[ee+0]=p,this.int16[ee+1]=y,this.int16[ee+2]=b,this.int16[ee+3]=S,this.int16[ee+4]=P,this.int16[ee+5]=k,this.uint32[ne+3]=z,this.uint16[ee+8]=j,this.uint16[ee+9]=H,u},o}(oa);gf.prototype.bytesPerElement=20,vn("StructArrayLayout6i1ul2ui20",gf);var wl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,p,y,b,S,P)},o.prototype.emplace=function(u,p,y,b,S,P,k){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=k,u},o}(oa);wl.prototype.bytesPerElement=12,vn("StructArrayLayout2i2i2i12",wl);var Tl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S){var P=this.length;return this.resize(P+1),this.emplace(P,u,p,y,b,S)},o.prototype.emplace=function(u,p,y,b,S,P){var k=4*u,z=8*u;return this.float32[k+0]=p,this.float32[k+1]=y,this.float32[k+2]=b,this.int16[z+6]=S,this.int16[z+7]=P,u},o}(oa);Tl.prototype.bytesPerElement=16,vn("StructArrayLayout2f1f2i16",Tl);var Ph=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var P=12*u,k=3*u;return this.uint8[P+0]=p,this.uint8[P+1]=y,this.float32[k+1]=b,this.float32[k+2]=S,u},o}(oa);Ph.prototype.bytesPerElement=12,vn("StructArrayLayout2ub2f12",Ph);var Ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.uint16[S+0]=p,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(oa);Ml.prototype.bytesPerElement=6,vn("StructArrayLayout3ui6",Ml);var Xl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,j,H,ee,ne,Me,Oe,Ke,je,He){var tt=this.length;return this.resize(tt+1),this.emplace(tt,u,p,y,b,S,P,k,z,j,H,ee,ne,Me,Oe,Ke,je,He)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,j,H,ee,ne,Me,Oe,Ke,je,He,tt){var Gt=24*u,Yt=12*u,hr=48*u;return this.int16[Gt+0]=p,this.int16[Gt+1]=y,this.uint16[Gt+2]=b,this.uint16[Gt+3]=S,this.uint32[Yt+2]=P,this.uint32[Yt+3]=k,this.uint32[Yt+4]=z,this.uint16[Gt+10]=j,this.uint16[Gt+11]=H,this.uint16[Gt+12]=ee,this.float32[Yt+7]=ne,this.float32[Yt+8]=Me,this.uint8[hr+36]=Oe,this.uint8[hr+37]=Ke,this.uint8[hr+38]=je,this.uint32[Yt+10]=He,this.int16[Gt+22]=tt,u},o}(oa);Xl.prototype.bytesPerElement=48,vn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xl);var yf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,j,H,ee,ne,Me,Oe,Ke,je,He,tt,Gt,Yt,hr,Rr,$r,zn,dn,Vn,mn,Li){var ai=this.length;return this.resize(ai+1),this.emplace(ai,u,p,y,b,S,P,k,z,j,H,ee,ne,Me,Oe,Ke,je,He,tt,Gt,Yt,hr,Rr,$r,zn,dn,Vn,mn,Li)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,j,H,ee,ne,Me,Oe,Ke,je,He,tt,Gt,Yt,hr,Rr,$r,zn,dn,Vn,mn,Li,ai){var Mn=34*u,ji=17*u;return this.int16[Mn+0]=p,this.int16[Mn+1]=y,this.int16[Mn+2]=b,this.int16[Mn+3]=S,this.int16[Mn+4]=P,this.int16[Mn+5]=k,this.int16[Mn+6]=z,this.int16[Mn+7]=j,this.uint16[Mn+8]=H,this.uint16[Mn+9]=ee,this.uint16[Mn+10]=ne,this.uint16[Mn+11]=Me,this.uint16[Mn+12]=Oe,this.uint16[Mn+13]=Ke,this.uint16[Mn+14]=je,this.uint16[Mn+15]=He,this.uint16[Mn+16]=tt,this.uint16[Mn+17]=Gt,this.uint16[Mn+18]=Yt,this.uint16[Mn+19]=hr,this.uint16[Mn+20]=Rr,this.uint16[Mn+21]=$r,this.uint16[Mn+22]=zn,this.uint32[ji+12]=dn,this.float32[ji+13]=Vn,this.float32[ji+14]=mn,this.float32[ji+15]=Li,this.float32[ji+16]=ai,u},o}(oa);yf.prototype.bytesPerElement=68,vn("StructArrayLayout8i15ui1ul4f68",yf);var Du=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(oa);Du.prototype.bytesPerElement=4,vn("StructArrayLayout1f4",Du);var Cs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.int16[S+0]=p,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(oa);Cs.prototype.bytesPerElement=6,vn("StructArrayLayout3i6",Cs);var _f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=4*u;return this.uint32[2*u+0]=p,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(oa);_f.prototype.bytesPerElement=8,vn("StructArrayLayout1ul2ui8",_f);var vc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.uint16[b+0]=p,this.uint16[b+1]=y,u},o}(oa);vc.prototype.bytesPerElement=4,vn("StructArrayLayout2ui4",vc);var Ih=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(oa);Ih.prototype.bytesPerElement=2,vn("StructArrayLayout1ui2",Ih);var Yl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var P=4*u;return this.float32[P+0]=p,this.float32[P+1]=y,this.float32[P+2]=b,this.float32[P+3]=S,u},o}(oa);Yl.prototype.bytesPerElement=16,vn("StructArrayLayout4f16",Yl);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new ue(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(jc);l.prototype.size=20;var h=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(gf);vn("CollisionBoxArray",h);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(jc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(Xl);vn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(jc);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(yf);vn("SymbolInstanceArray",w);var M=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(Du);vn("GlyphOffsetArray",M);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(Cs);vn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(jc);U.prototype.size=8;var Y=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(_f);vn("FeatureIndexArray",Y);var oe=ka([{name:"a_pos",components:2,type:"Int16"}],4).members,fe=function(t){t===void 0&&(t=[]),this.segments=t};function pe(t,o){return 256*(t=Ht(Math.floor(t),0,255))+Ht(Math.floor(o),0,255)}fe.prototype.prepareSegment=function(t,o,u,p){var y=this.segments[this.segments.length-1];return t>fe.MAX_VERTEX_ARRAY_LENGTH&&et("Max vertices per segment is "+fe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>fe.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y},fe.prototype.get=function(){return this.segments},fe.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var p in u.vaos)u.vaos[p].destroy()}},fe.simpleSegment=function(t,o,u,p){return new fe([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},fe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vn("SegmentVector",fe);var Re=ka([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ie=ve(function(t){t.exports=function(o,u){var p,y,b,S,P,k,z,j;for(y=o.length-(p=3&o.length),b=u,P=3432918353,k=461845907,j=0;j<y;)z=255&o.charCodeAt(j)|(255&o.charCodeAt(++j))<<8|(255&o.charCodeAt(++j))<<16|(255&o.charCodeAt(++j))<<24,++j,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,p){case 3:z^=(255&o.charCodeAt(j+2))<<16;case 2:z^=(255&o.charCodeAt(j+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(j)))*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Xe=ve(function(t){t.exports=function(o,u){for(var p,y=o.length,b=u^y,S=0;y>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ae=Ie,Ye=Xe;Ae.murmur3=Ie,Ae.murmur2=Ye;var it=function(){this.ids=[],this.positions=[],this.indexed=!1};it.prototype.add=function(t,o,u,p){this.ids.push(Xt(t)),this.positions.push(o,u,p)},it.prototype.getPositions=function(t){for(var o=Xt(t),u=0,p=this.ids.length-1;u<p;){var y=u+p>>1;this.ids[y]>=o?p=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},it.serialize=function(t,o){var u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function y(b,S,P,k){for(;P<k;){for(var z=b[P+k>>1],j=P-1,H=k+1;;){do j++;while(b[j]<z);do H--;while(b[H]>z);if(j>=H)break;Nt(b,j,H),Nt(S,3*j,3*H),Nt(S,3*j+1,3*H+1),Nt(S,3*j+2,3*H+2)}H-P<k-H?(y(b,S,P,H),P=H+1):(y(b,S,H+1,k),k=H)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},it.deserialize=function(t){var o=new it;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var Et=Math.pow(2,53)-1;function Xt(t){var o=+t;return!isNaN(o)&&o<=Et?o:Ae(String(t))}function Nt(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}vn("FeaturePositionMap",it);var tr=function(t,o){this.gl=t.gl,this.location=o},mr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(tr),Dr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(tr),sr=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(tr),Qr=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(tr),Rn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(tr),kn=function(t){function o(u,p){t.call(this,u,p),this.current=zi.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(tr),Fn=new Float32Array(16),Ai=function(t){function o(u,p){t.call(this,u,p),this.current=Fn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(tr);function un(t){return[pe(255*t.r,255*t.g),pe(255*t.b,255*t.a)]}var Sn=function(t,o,u){this.value=t,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};Sn.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},Sn.prototype.getBinding=function(t,o,u){return this.type==="color"?new kn(t,o):new Dr(t,o)};var Qn=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Qn.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},Qn.prototype.setUniform=function(t,o,u,p){var y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},Qn.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Rn(t,o):new Dr(t,o)};var Xn=function(t,o,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};Xn.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Ii(0),o,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},Xn.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,o,y)},Xn.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var p=un(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,p[0],p[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Xn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Yn=function(t,o,u,p,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Yn.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.expression.evaluate(new Ii(this.zoom),o,{},p,[],y),S=this.expression.evaluate(new Ii(this.zoom+1),o,{},p,[],y),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,b,S)},Yn.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:this.zoom},u,p),b=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,o,y,b)},Yn.prototype._setPaintValue=function(t,o,u,p){if(this.type==="color")for(var y=un(u),b=un(p),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var P=t;P<o;P++)this.paintVertexArray.emplace(P,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},Yn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Yn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Yn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=Ht(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)},Yn.prototype.getBinding=function(t,o,u){return new Dr(t,o)};var di=function(t,o,u,p,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};di.prototype.populatePaintArray=function(t,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],u)},di.prototype.updatePaintArray=function(t,o,u,p,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},di.prototype._setPaintValues=function(t,o,u,p){if(p&&u){var y=p[u.min],b=p[u.mid],S=p[u.max];if(y&&b&&S)for(var P=t;P<o;P++)this.zoomInPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},di.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Re.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Re.members,this.expression.isStateDependent))},di.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var jn=function(t,o,u){this.binders={},this._buffers=[];var p=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof ps&&Fs(b.property.specification)){var S=qi(y,t.type),P=b.value,k=b.property.specification.type,z=b.property.useIntegerZoom,j=b.property.specification["property-type"],H=j==="cross-faded"||j==="cross-faded-data-driven";if(P.kind==="constant")this.binders[y]=H?new Qn(P.value,S):new Sn(P.value,S,k),p.push("/u_"+y);else if(P.kind==="source"||H){var ee=Ya(y,k,"source");this.binders[y]=H?new di(P,k,z,o,ee,t.id):new Xn(P,S,k,ee),p.push("/a_"+y)}else{var ne=Ya(y,k,"composite");this.binders[y]=new Yn(P,S,k,z,o,ne),p.push("/z_"+y)}}}this.cacheKey=p.sort().join("")};jn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof Xn||o instanceof Yn?o.maxValue:0},jn.prototype.populatePaintArrays=function(t,o,u,p,y){for(var b in this.binders){var S=this.binders[b];(S instanceof Xn||S instanceof Yn||S instanceof di)&&S.populatePaintArray(t,o,u,p,y)}},jn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var p=this.binders[u];p instanceof Qn&&p.setConstantPatternPositions(t,o)}},jn.prototype.updatePaintArrays=function(t,o,u,p,y){var b=!1;for(var S in t)for(var P=0,k=o.getPositions(S);P<k.length;P+=1){var z=k[P],j=u.feature(z.index);for(var H in this.binders){var ee=this.binders[H];if((ee instanceof Xn||ee instanceof Yn||ee instanceof di)&&ee.expression.isStateDependent===!0){var ne=p.paint.get(H);ee.expression=ne.value,ee.updatePaintArray(z.start,z.end,j,t[S],y),b=!0}}}return b},jn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof Sn||u instanceof Qn)&&t.push.apply(t,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},jn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Xn||u instanceof Yn)for(var p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof di)for(var y=0;y<Re.members.length;y++)t.push(Re.members[y].name)}return t},jn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Sn||u instanceof Qn||u instanceof Yn)for(var p=0,y=u.uniformNames;p<y.length;p+=1)t.push(y[p])}return t},jn.prototype.getPaintVertexBuffers=function(){return this._buffers},jn.prototype.getUniforms=function(t,o){var u=[];for(var p in this.binders){var y=this.binders[p];if(y instanceof Sn||y instanceof Qn||y instanceof Yn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var P=S[b];if(o[P]){var k=y.getBinding(t,o[P],P);u.push({name:P,property:p,binding:k})}}}return u},jn.prototype.setUniforms=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],P=S.name,k=S.property;this.binders[k].setUniform(S.binding,p,u.get(k),P)}},jn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof di){var p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof Xn||u instanceof Yn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},jn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof Xn||u instanceof Yn||u instanceof di)&&u.upload(t)}this.updatePaintBuffers()},jn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof Xn||o instanceof Yn||o instanceof di)&&o.destroy()}};var Tn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,y=t;p<y.length;p+=1){var b=y[p];this.programConfigurations[b.id]=new jn(b,o,u)}this.needsUpload=!1,this._featureMap=new it,this._bufferOffset=0};function qi(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Ya(t,o,u){var p={color:{source:ol,composite:Yl},number:{source:Du,composite:ol}},y=function(b){return{"line-pattern":{source:Au,composite:Au},"fill-pattern":{source:Au,composite:Au},"fill-extrusion-pattern":{source:Au,composite:Au}}[b]}(t);return y&&y[u]||p[o][u]}Tn.prototype.populatePaintArrays=function(t,o,u,p,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,p,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Tn.prototype.updatePaintArrays=function(t,o,u,p){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,p)||this.needsUpload}},Tn.prototype.get=function(t){return this.programConfigurations[t]},Tn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Tn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},vn("ConstantBinder",Sn),vn("CrossFadedConstantBinder",Qn),vn("SourceExpressionBinder",Xn),vn("CrossFadedCompositeBinder",di),vn("CompositeExpressionBinder",Yn),vn("ProgramConfiguration",jn,{omit:["_buffers"]}),vn("ProgramConfigurationSet",Tn);var ni=Math.pow(2,14)-1,zo=-ni-1;function Va(t){for(var o=8192/t.extent,u=t.loadGeometry(),p=0;p<u.length;p++)for(var y=u[p],b=0;b<y.length;b++){var S=y[b],P=Math.round(S.x*o),k=Math.round(S.y*o);S.x=Ht(P,zo,ni),S.y=Ht(k,zo,ni),(P<S.x||P>S.x+1||k<S.y||k>S.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function to(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Va(t):[]}}function is(t,o,u,p,y){t.emplaceBack(2*o+(p+1)/2,2*u+(y+1)/2)}var vs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new al,this.indexArray=new Ml,this.segments=new fe,this.programConfigurations=new Tn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Fu(t,o){for(var u=0;u<t.length;u++)if($s(o,t[u]))return!0;for(var p=0;p<o.length;p++)if($s(t,o[p]))return!0;return!!Vc(t,o)}function as(t,o,u){return!!$s(t,o)||!!Bu(o,t,u)}function Vs(t,o){if(t.length===1)return mc(o,t[0]);for(var u=0;u<o.length;u++)for(var p=o[u],y=0;y<p.length;y++)if($s(t,p[y]))return!0;for(var b=0;b<t.length;b++)if(mc(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(Vc(t,o[S]))return!0;return!1}function As(t,o,u){if(t.length>1){if(Vc(t,o))return!0;for(var p=0;p<o.length;p++)if(Bu(o[p],t,u))return!0}for(var y=0;y<t.length;y++)if(Bu(t[y],o,u))return!0;return!1}function Vc(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var p=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(Pl(p,y,o[b],o[b+1]))return!0;return!1}function Pl(t,o,u,p){return $t(t,u,p)!==$t(o,u,p)&&$t(t,o,u)!==$t(t,o,p)}function Bu(t,o,u){var p=u*u;if(o.length===1)return t.distSqr(o[0])<p;for(var y=1;y<o.length;y++)if(ql(t,o[y-1],o[y])<p)return!0;return!1}function ql(t,o,u){var p=o.distSqr(u);if(p===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/p;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function mc(t,o){for(var u,p,y,b=!1,S=0;S<t.length;S++)for(var P=0,k=(u=t[S]).length-1;P<u.length;k=P++)(p=u[P]).y>o.y!=(y=u[k]).y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(b=!b);return b}function $s(t,o){for(var u=!1,p=0,y=t.length-1;p<t.length;y=p++){var b=t[p],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function Il(t,o,u){var p=u[0],y=u[2];if(t.x<p.x&&o.x<p.x||t.x>y.x&&o.x>y.x||t.y<p.y&&o.y<p.y||t.y>y.y&&o.y>y.y)return!1;var b=$t(t,o,u[0]);return b!==$t(t,o,u[1])||b!==$t(t,o,u[2])||b!==$t(t,o,u[3])}function wu(t,o,u){var p=o.paint.get(t).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(t)}function xo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Nu(t,o,u,p,y){if(!o[0]&&!o[1])return t;var b=ue.convert(o)._mult(y);u==="viewport"&&b._rotate(-p);for(var S=[],P=0;P<t.length;P++)S.push(t[P].sub(b));return S}vs.prototype.populate=function(t,o,u){var p=this.layers[0],y=[],b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(var S=0,P=t;S<P.length;S+=1){var k=P[S],z=k.feature,j=k.id,H=k.index,ee=k.sourceLayerIndex,ne=this.layers[0]._featureFilter.needGeometry,Me=to(z,ne);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),Me,u)){var Oe=b?b.evaluate(Me,{},u):void 0,Ke={id:j,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:H,geometry:ne?Me.geometry:Va(z),patterns:{},sortKey:Oe};y.push(Ke)}}b&&y.sort(function($r,zn){return $r.sortKey-zn.sortKey});for(var je=0,He=y;je<He.length;je+=1){var tt=He[je],Gt=tt.geometry,Yt=tt.index,hr=tt.sourceLayerIndex,Rr=t[Yt].feature;this.addFeature(tt,Gt,Yt,u),o.featureIndex.insert(Rr,Gt,Yt,hr,this.index)}},vs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},vs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},vs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},vs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oe),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},vs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},vs.prototype.addFeature=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,P=b[y];S<P.length;S+=1){var k=P[S],z=k.x,j=k.y;if(!(z<0||z>=8192||j<0||j>=8192)){var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ee=H.vertexLength;is(this.layoutVertexArray,z,j,-1,-1),is(this.layoutVertexArray,z,j,1,-1),is(this.layoutVertexArray,z,j,1,1),is(this.layoutVertexArray,z,j,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),H.vertexLength+=4,H.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)},vn("CircleBucket",vs,{omit:["layers"]});var ul=new Ko({"circle-sort-key":new Cn(he.layout_circle["circle-sort-key"])}),$o={paint:new Ko({"circle-radius":new Cn(he.paint_circle["circle-radius"]),"circle-color":new Cn(he.paint_circle["circle-color"]),"circle-blur":new Cn(he.paint_circle["circle-blur"]),"circle-opacity":new Cn(he.paint_circle["circle-opacity"]),"circle-translate":new On(he.paint_circle["circle-translate"]),"circle-translate-anchor":new On(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cn(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cn(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cn(he.paint_circle["circle-stroke-opacity"])}),layout:ul},ea=typeof Float32Array!="undefined"?Float32Array:Array;function Uo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ms(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],P=o[4],k=o[5],z=o[6],j=o[7],H=o[8],ee=o[9],ne=o[10],Me=o[11],Oe=o[12],Ke=o[13],je=o[14],He=o[15],tt=u[0],Gt=u[1],Yt=u[2],hr=u[3];return t[0]=tt*p+Gt*P+Yt*H+hr*Oe,t[1]=tt*y+Gt*k+Yt*ee+hr*Ke,t[2]=tt*b+Gt*z+Yt*ne+hr*je,t[3]=tt*S+Gt*j+Yt*Me+hr*He,t[4]=(tt=u[4])*p+(Gt=u[5])*P+(Yt=u[6])*H+(hr=u[7])*Oe,t[5]=tt*y+Gt*k+Yt*ee+hr*Ke,t[6]=tt*b+Gt*z+Yt*ne+hr*je,t[7]=tt*S+Gt*j+Yt*Me+hr*He,t[8]=(tt=u[8])*p+(Gt=u[9])*P+(Yt=u[10])*H+(hr=u[11])*Oe,t[9]=tt*y+Gt*k+Yt*ee+hr*Ke,t[10]=tt*b+Gt*z+Yt*ne+hr*je,t[11]=tt*S+Gt*j+Yt*Me+hr*He,t[12]=(tt=u[12])*p+(Gt=u[13])*P+(Yt=u[14])*H+(hr=u[15])*Oe,t[13]=tt*y+Gt*k+Yt*ee+hr*Ke,t[14]=tt*b+Gt*z+Yt*ne+hr*je,t[15]=tt*S+Gt*j+Yt*Me+hr*He,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var zu,gc=ms;function Kl(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*p+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*p+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*p+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*p+u[7]*y+u[11]*b+u[15]*S,t}zu=new ea(3),ea!=Float32Array&&(zu[0]=0,zu[1]=0,zu[2]=0),function(){var t=new ea(4);ea!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var xf=(function(){var t=new ea(2);ea!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,$o)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new vs(u)},o.prototype.queryRadius=function(u){var p=u;return wu("circle-radius",this,p)+wu("circle-stroke-width",this,p)+xo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,P,k,z){for(var j=Nu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,k),H=this.paint.get("circle-radius").evaluate(p,y)+this.paint.get("circle-stroke-width").evaluate(p,y),ee=this.paint.get("circle-pitch-alignment")==="map",ne=ee?j:function(Rr,$r){return Rr.map(function(zn){return Qs(zn,$r)})}(j,z),Me=ee?H*k:H,Oe=0,Ke=b;Oe<Ke.length;Oe+=1)for(var je=0,He=Ke[Oe];je<He.length;je+=1){var tt=He[je],Gt=ee?tt:Qs(tt,z),Yt=Me,hr=Kl([],[tt.x,tt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Yt*=hr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Yt*=P.cameraToCenterDistance/hr[3]),as(ne,Gt,Yt))return!0}return!1},o}(ba));function Qs(t,o){var u=Kl([],[t.x,t.y,0,1],o);return new ue(u[0]/u[3],u[1]/u[3])}var yc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(vs);function Js(t,o,u,p){var y=o.width,b=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==y*b*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=p,t}function Ol(t,o,u){var p=o.width,y=o.height;if(p!==t.width||y!==t.height){var b=Js({},{width:p,height:y},u);Gc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,y)},u),t.width=p,t.height=y,t.data=b.data}}function Gc(t,o,u,p,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||p.x>o.width-y.width||p.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,P=o.data,k=0;k<y.height;k++)for(var z=((u.y+k)*t.width+u.x)*b,j=((p.y+k)*o.width+p.x)*b,H=0;H<y.width*b;H++)P[j+H]=S[z+H];return o}vn("HeatmapBucket",yc,{omit:["layers"]});var hu=function(t,o){Js(this,t,1,o)};hu.prototype.resize=function(t){Ol(this,t,1)},hu.prototype.clone=function(){return new hu({width:this.width,height:this.height},new Uint8Array(this.data))},hu.copy=function(t,o,u,p,y){Gc(t,o,u,p,y,1)};var bo=function(t,o){Js(this,t,4,o)};bo.prototype.resize=function(t){Ol(this,t,4)},bo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},bo.prototype.clone=function(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))},bo.copy=function(t,o,u,p,y){Gc(t,o,u,p,y,4)},vn("AlphaImage",hu),vn("RGBAImage",bo);var Hc={paint:new Ko({"heatmap-radius":new Cn(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cn(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Su(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(he.paint_heatmap["heatmap-opacity"])})};function Kf(t){var o={},u=t.resolution||256,p=t.clips?t.clips.length:1,y=t.image||new bo({width:u,height:p}),b=function(Me,Oe,Ke){o[t.evaluationKey]=Ke;var je=t.expression.evaluate(o);y.data[Me+Oe+0]=Math.floor(255*je.r/je.a),y.data[Me+Oe+1]=Math.floor(255*je.g/je.a),y.data[Me+Oe+2]=Math.floor(255*je.b/je.a),y.data[Me+Oe+3]=Math.floor(255*je.a)};if(t.clips)for(var S=0,P=0;S<p;++S,P+=4*u)for(var k=0,z=0;k<u;k++,z+=4){var j=k/(u-1),H=t.clips[S];b(P,z,H.start*(1-j)+H.end*j)}else for(var ee=0,ne=0;ee<u;ee++,ne+=4)b(0,ne,ee/(u-1));return y}var Oh=function(t){function o(u){t.call(this,u,Hc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new yc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Kf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(ba),$f={paint:new Ko({"hillshade-illumination-direction":new On(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(he.paint_hillshade["hillshade-accent-color"])})},op=function(t){function o(u){t.call(this,u,$f)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(ba),sp=ka([{name:"a_pos",components:2,type:"Int16"}],4).members,ws=Rl,bf=Rl;function Rl(t,o,u){u=u||2;var p,y,b,S,P,k,z,j=o&&o.length,H=j?o[0]*u:t.length,ee=qp(t,0,H,u,!0),ne=[];if(!ee||ee.next===ee.prev)return ne;if(j&&(ee=function(Oe,Ke,je,He){var tt,Gt,Yt,hr=[];for(tt=0,Gt=Ke.length;tt<Gt;tt++)(Yt=qp(Oe,Ke[tt]*He,tt<Gt-1?Ke[tt+1]*He:Oe.length,He,!1))===Yt.next&&(Yt.steiner=!0),hr.push(Sf(Yt));for(hr.sort(os),tt=0;tt<hr.length;tt++)ss(hr[tt],je),je=pu(je,je.next);return je}(t,o,ee,u)),t.length>80*u){p=b=t[0],y=S=t[1];for(var Me=u;Me<H;Me+=u)(P=t[Me])<p&&(p=P),(k=t[Me+1])<y&&(y=k),P>b&&(b=P),k>S&&(S=k);z=(z=Math.max(b-p,S-y))!==0?1/z:0}return _c(ee,ne,u,p,y,z),ne}function qp(t,o,u,p,y){var b,S;if(y===Cf(t,o,u,p)>0)for(b=o;b<u;b+=p)S=Ll(b,t[b],t[b+1],S);else for(b=u-p;b>=o;b-=p)S=Ll(b,t[b],t[b+1],S);return S&&lp(S,S.next)&&(kl(S),S=S.next),S}function pu(t,o){if(!t)return t;o||(o=t);var u,p=t;do if(u=!1,p.steiner||!lp(p,p.next)&&Zo(p.prev,p,p.next)!==0)p=p.next;else{if(kl(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function _c(t,o,u,p,y,b,S){if(t){!S&&b&&function(j,H,ee,ne){var Me=j;do Me.z===null&&(Me.z=Rh(Me.x,Me.y,H,ee,ne)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==j);Me.prevZ.nextZ=null,Me.prevZ=null,function(Oe){var Ke,je,He,tt,Gt,Yt,hr,Rr,$r=1;do{for(je=Oe,Oe=null,Gt=null,Yt=0;je;){for(Yt++,He=je,hr=0,Ke=0;Ke<$r&&(hr++,He=He.nextZ);Ke++);for(Rr=$r;hr>0||Rr>0&&He;)hr!==0&&(Rr===0||!He||je.z<=He.z)?(tt=je,je=je.nextZ,hr--):(tt=He,He=He.nextZ,Rr--),Gt?Gt.nextZ=tt:Oe=tt,tt.prevZ=Gt,Gt=tt;je=He}Gt.nextZ=null,$r*=2}while(Yt>1)}(Me)}(t,p,y,b);for(var P,k,z=t;t.prev!==t.next;)if(P=t.prev,k=t.next,b?kd(t,p,y,b):Kp(t))o.push(P.i/u),o.push(t.i/u),o.push(k.i/u),kl(t),t=k.next,z=k.next;else if((t=k)===z){S?S===1?_c(t=Ef(pu(t),o,u),o,u,p,y,b,2):S===2&&up(t,o,u,p,y,b):_c(pu(t),o,u,p,y,b,1);break}}}function Kp(t){var o=t.prev,u=t,p=t.next;if(Zo(o,u,p)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(Jf(o.x,o.y,u.x,u.y,p.x,p.y,y.x,y.y)&&Zo(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function kd(t,o,u,p){var y=t.prev,b=t,S=t.next;if(Zo(y,b,S)>=0)return!1;for(var P=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,k=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=Rh(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,p),j=Rh(P,k,o,u,p),H=t.prevZ,ee=t.nextZ;H&&H.z>=z&&ee&&ee.z<=j;){if(H!==t.prev&&H!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,H.x,H.y)&&Zo(H.prev,H,H.next)>=0||(H=H.prevZ,ee!==t.prev&&ee!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Zo(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;H&&H.z>=z;){if(H!==t.prev&&H!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,H.x,H.y)&&Zo(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;ee&&ee.z<=j;){if(ee!==t.prev&&ee!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Zo(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Ef(t,o,u){var p=t;do{var y=p.prev,b=p.next.next;!lp(y,b)&&cp(y,p,p.next,b)&&Lh(y,b)&&Lh(b,y)&&(o.push(y.i/u),o.push(p.i/u),o.push(b.i/u),kl(p),kl(p.next),p=t=b),p=p.next}while(p!==t);return pu(p)}function up(t,o,u,p,y,b){var S=t;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&Iv(S,P)){var k=hp(S,P);return S=pu(S,S.next),k=pu(k,k.next),_c(S,o,u,p,y,b),void _c(k,o,u,p,y,b)}P=P.next}S=S.next}while(S!==t)}function os(t,o){return t.x-o.x}function ss(t,o){if(o=function(p,y){var b,S=y,P=p.x,k=p.y,z=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var j=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(j<=P&&j>z){if(z=j,j===P){if(k===S.y)return S;if(k===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(P===z)return b;var H,ee=b,ne=b.x,Me=b.y,Oe=1/0;S=b;do P>=S.x&&S.x>=ne&&P!==S.x&&Jf(k<Me?P:z,k,ne,Me,k<Me?z:P,k,S.x,S.y)&&(H=Math.abs(k-S.y)/(P-S.x),Lh(S,p)&&(H<Oe||H===Oe&&(S.x>b.x||S.x===b.x&&Qf(b,S)))&&(b=S,Oe=H)),S=S.next;while(S!==ee);return b}(t,o)){var u=hp(o,t);pu(o,o.next),pu(u,u.next)}}function Qf(t,o){return Zo(t.prev,t,o.prev)<0&&Zo(o.next,t,t.next)<0}function Rh(t,o,u,p,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Sf(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function Jf(t,o,u,p,y,b,S,P){return(y-S)*(o-P)-(t-S)*(b-P)>=0&&(t-S)*(p-P)-(u-S)*(o-P)>=0&&(u-S)*(b-P)-(y-S)*(p-P)>=0}function Iv(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,p){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&cp(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Lh(t,o)&&Lh(o,t)&&function(u,p){var y=u,b=!1,S=(u.x+p.x)/2,P=(u.y+p.y)/2;do y.y>P!=y.next.y>P&&y.next.y!==y.y&&S<(y.next.x-y.x)*(P-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Zo(t.prev,t,o.prev)||Zo(t,o.prev,o))||lp(t,o)&&Zo(t.prev,t,t.next)>0&&Zo(o.prev,o,o.next)>0)}function Zo(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function lp(t,o){return t.x===o.x&&t.y===o.y}function cp(t,o,u,p){var y=fp(Zo(t,o,u)),b=fp(Zo(t,o,p)),S=fp(Zo(u,p,t)),P=fp(Zo(u,p,o));return y!==b&&S!==P||!(y!==0||!du(t,u,o))||!(b!==0||!du(t,p,o))||!(S!==0||!du(u,t,p))||!(P!==0||!du(u,o,p))}function du(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function fp(t){return t>0?1:t<0?-1:0}function Lh(t,o){return Zo(t.prev,t,t.next)<0?Zo(t,o,t.next)>=0&&Zo(t,t.prev,o)>=0:Zo(t,o,t.prev)<0||Zo(t,t.next,o)<0}function hp(t,o){var u=new $l(t.i,t.x,t.y),p=new $l(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,p.next=u,u.prev=p,b.next=p,p.prev=b,p}function Ll(t,o,u,p){var y=new $l(t,o,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function kl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $l(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Cf(t,o,u,p){for(var y=0,b=o,S=u-p;b<u;b+=p)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function eh(t,o,u,p,y){(function b(S,P,k,z,j){for(;z>k;){if(z-k>600){var H=z-k+1,ee=P-k+1,ne=Math.log(H),Me=.5*Math.exp(2*ne/3),Oe=.5*Math.sqrt(ne*Me*(H-Me)/H)*(ee-H/2<0?-1:1);b(S,P,Math.max(k,Math.floor(P-ee*Me/H+Oe)),Math.min(z,Math.floor(P+(H-ee)*Me/H+Oe)),j)}var Ke=S[P],je=k,He=z;for(ll(S,k,P),j(S[z],Ke)>0&&ll(S,k,z);je<He;){for(ll(S,je,He),je++,He--;j(S[je],Ke)<0;)je++;for(;j(S[He],Ke)>0;)He--}j(S[k],Ke)===0?ll(S,k,He):ll(S,++He,z),He<=P&&(k=He+1),P<=He&&(z=He-1)}})(t,o,u||0,p||t.length-1,y||Wc)}function ll(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}function Wc(t,o){return t<o?-1:t>o?1:0}function Af(t,o){var u=t.length;if(u<=1)return[t];for(var p,y,b=[],S=0;S<u;S++){var P=Sr(t[S]);P!==0&&(t[S].area=Math.abs(P),y===void 0&&(y=P<0),y===P<0?(p&&b.push(p),p=[t[S]]):p.push(t[S]))}if(p&&b.push(p),o>1)for(var k=0;k<b.length;k++)b[k].length<=o||(eh(b[k],o,1,b[k].length-1,th),b[k]=b[k].slice(0,o));return b}function th(t,o){return o.area-t.area}function xc(t,o,u){for(var p=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var P=S[b].paint.get(t+"-pattern");P.isConstant()||(y=!0);var k=P.constantOr(null);k&&(y=!0,p[k.to]=!0,p[k.from]=!0)}return y}function Xc(t,o,u,p,y){for(var b=y.patternDependencies,S=0,P=o;S<P.length;S+=1){var k=P[S],z=k.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var j=z.evaluate({zoom:p-1},u,{},y.availableImages),H=z.evaluate({zoom:p},u,{},y.availableImages),ee=z.evaluate({zoom:p+1},u,{},y.availableImages);H=H&&H.name?H.name:H,ee=ee&&ee.name?ee.name:ee,b[j=j&&j.name?j.name:j]=!0,b[H]=!0,b[ee]=!0,u.patterns[k.id]={min:j,mid:H,max:ee}}}return u}Rl.deviation=function(t,o,u,p){var y=o&&o.length,b=Math.abs(Cf(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,P=o.length;S<P;S++)b-=Math.abs(Cf(t,o[S]*u,S<P-1?o[S+1]*u:t.length,u));var k=0;for(S=0;S<p.length;S+=3){var z=p[S]*u,j=p[S+1]*u,H=p[S+2]*u;k+=Math.abs((t[z]-t[H])*(t[j+1]-t[z+1])-(t[z]-t[j])*(t[H+1]-t[z+1]))}return b===0&&k===0?0:Math.abs((k-b)/b)},Rl.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(p+=t[y-1].length)}return u},ws.default=bf;var eu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new al,this.indexArray=new Ml,this.indexArray2=new vc,this.programConfigurations=new Tn(t.layers,t.zoom),this.segments=new fe,this.segments2=new fe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};eu.prototype.populate=function(t,o,u){this.hasPattern=xc("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],k=P.feature,z=P.id,j=P.index,H=P.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,ne=to(k,ee);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),ne,u)){var Me=p?p.evaluate(ne,{},u,o.availableImages):void 0,Oe={id:z,properties:k.properties,type:k.type,sourceLayerIndex:H,index:j,geometry:ee?ne.geometry:Va(k),patterns:{},sortKey:Me};y.push(Oe)}}p&&y.sort(function(Rr,$r){return Rr.sortKey-$r.sortKey});for(var Ke=0,je=y;Ke<je.length;Ke+=1){var He=je[Ke],tt=He.geometry,Gt=He.index,Yt=He.sourceLayerIndex;if(this.hasPattern){var hr=Xc("fill",this.layers,He,this.zoom,o);this.patternFeatures.push(hr)}else this.addFeature(He,tt,Gt,u,{});o.featureIndex.insert(t[Gt].feature,tt,Gt,Yt,this.index)}},eu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},eu.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},eu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},eu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},eu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},eu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},eu.prototype.addFeature=function(t,o,u,p,y){for(var b=0,S=Af(o,500);b<S.length;b+=1){for(var P=S[b],k=0,z=0,j=P;z<j.length;z+=1)k+=j[z].length;for(var H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),ee=H.vertexLength,ne=[],Me=[],Oe=0,Ke=P;Oe<Ke.length;Oe+=1){var je=Ke[Oe];if(je.length!==0){je!==P[0]&&Me.push(ne.length/2);var He=this.segments2.prepareSegment(je.length,this.layoutVertexArray,this.indexArray2),tt=He.vertexLength;this.layoutVertexArray.emplaceBack(je[0].x,je[0].y),this.indexArray2.emplaceBack(tt+je.length-1,tt),ne.push(je[0].x),ne.push(je[0].y);for(var Gt=1;Gt<je.length;Gt++)this.layoutVertexArray.emplaceBack(je[Gt].x,je[Gt].y),this.indexArray2.emplaceBack(tt+Gt-1,tt+Gt),ne.push(je[Gt].x),ne.push(je[Gt].y);He.vertexLength+=je.length,He.primitiveLength+=je.length}}for(var Yt=ws(ne,Me),hr=0;hr<Yt.length;hr+=3)this.indexArray.emplaceBack(ee+Yt[hr],ee+Yt[hr+1],ee+Yt[hr+2]);H.vertexLength+=k,H.primitiveLength+=Yt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},vn("FillBucket",eu,{omit:["layers","patternFeatures"]});var wf=new Ko({"fill-sort-key":new Cn(he.layout_fill["fill-sort-key"])}),vu={paint:new Ko({"fill-antialias":new On(he.paint_fill["fill-antialias"]),"fill-opacity":new Cn(he.paint_fill["fill-opacity"]),"fill-color":new Cn(he.paint_fill["fill-color"]),"fill-outline-color":new Cn(he.paint_fill["fill-outline-color"]),"fill-translate":new On(he.paint_fill["fill-translate"]),"fill-translate-anchor":new On(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new pc(he.paint_fill["fill-pattern"])}),layout:wf},Tf=function(t){function o(u){t.call(this,u,vu)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new eu(u)},o.prototype.queryRadius=function(){return xo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,P,k){return Vs(Nu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,k),b)},o.prototype.isTileClipped=function(){return!0},o}(ba),rh=ka([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,kh=Dl;function Dl(t,o,u,p,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=y,t.readFields(Yc,this,o)}function Yc(t,o,u){t==1?o.id=u.readVarint():t==2?function(p,y){for(var b=p.readVarint()+p.pos;p.pos<b;){var S=y._keys[p.readVarint()],P=y._values[p.readVarint()];y.properties[S]=P}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function $p(t){for(var o,u,p=0,y=0,b=t.length,S=b-1;y<b;S=y++)p+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return p}Dl.types=["Unknown","Point","LineString","Polygon"],Dl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,p=1,y=0,b=0,S=0,P=[];t.pos<u;){if(y<=0){var k=t.readVarint();p=7&k,y=k>>3}if(y--,p===1||p===2)b+=t.readSVarint(),S+=t.readSVarint(),p===1&&(o&&P.push(o),o=[]),o.push(new ue(b,S));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&P.push(o),P},Dl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,p=0,y=0,b=0,S=1/0,P=-1/0,k=1/0,z=-1/0;t.pos<o;){if(p<=0){var j=t.readVarint();u=7&j,p=j>>3}if(p--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>P&&(P=y),(b+=t.readSVarint())<k&&(k=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,k,P,z]},Dl.prototype.toGeoJSON=function(t,o,u){var p,y,b=this.extent*Math.pow(2,u),S=this.extent*t,P=this.extent*o,k=this.loadGeometry(),z=Dl.types[this.type];function j(ne){for(var Me=0;Me<ne.length;Me++){var Oe=ne[Me];ne[Me]=[360*(Oe.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+P)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(p=0;p<k.length;p++)H[p]=k[p][0];j(k=H);break;case 2:for(p=0;p<k.length;p++)j(k[p]);break;case 3:for(k=function(ne){var Me=ne.length;if(Me<=1)return[ne];for(var Oe,Ke,je=[],He=0;He<Me;He++){var tt=$p(ne[He]);tt!==0&&(Ke===void 0&&(Ke=tt<0),Ke===tt<0?(Oe&&je.push(Oe),Oe=[ne[He]]):Oe.push(ne[He]))}return Oe&&je.push(Oe),je}(k),p=0;p<k.length;p++)for(y=0;y<k[p].length;y++)j(k[p][y])}k.length===1?k=k[0]:z="Multi"+z;var ee={type:"Feature",geometry:{type:z,coordinates:k},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var Dh=Fh;function Fh(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Dd,this,o),this.length=this._features.length}function Dd(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(p){for(var y=null,b=p.readVarint()+p.pos;p.pos<b;){var S=p.readVarint()>>3;y=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return y}(u))}function Qp(t,o,u){if(t===3){var p=new Dh(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}Fh.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new kh(this._pbf,o,this.extent,this._keys,this._values)};var mu={VectorTile:function(t,o){this.layers=t.readFields(Qp,{},o)},VectorTileFeature:kh,VectorTileLayer:Dh},pp=mu.VectorTileFeature.types,nh=Math.pow(2,13);function Mf(t,o,u,p,y,b,S,P){t.emplaceBack(o,u,2*Math.floor(p*nh)+S,y*nh*2,b*nh*2,Math.round(P))}var cl=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Cu,this.indexArray=new Ml,this.programConfigurations=new Tn(t.layers,t.zoom),this.segments=new fe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Jp(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}cl.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=xc("fill-extrusion",this.layers,o);for(var p=0,y=t;p<y.length;p+=1){var b=y[p],S=b.feature,P=b.id,k=b.index,z=b.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,H=to(S,j);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),H,u)){var ee={id:P,sourceLayerIndex:z,index:k,geometry:j?H.geometry:Va(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Xc("fill-extrusion",this.layers,ee,this.zoom,o)):this.addFeature(ee,ee.geometry,k,u,{}),o.featureIndex.insert(S,ee.geometry,k,z,this.index,!0)}}},cl.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.features;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},cl.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},cl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},cl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},cl.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},cl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},cl.prototype.addFeature=function(t,o,u,p,y){for(var b=0,S=Af(o,500);b<S.length;b+=1){for(var P=S[b],k=0,z=0,j=P;z<j.length;z+=1)k+=j[z].length;for(var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,ne=P;ee<ne.length;ee+=1){var Me=ne[ee];if(Me.length!==0&&!((ji=Me).every(function(Ci){return Ci.x<0})||ji.every(function(Ci){return Ci.x>8192})||ji.every(function(Ci){return Ci.y<0})||ji.every(function(Ci){return Ci.y>8192})))for(var Oe=0,Ke=0;Ke<Me.length;Ke++){var je=Me[Ke];if(Ke>=1){var He=Me[Ke-1];if(!Jp(je,He)){H.vertexLength+4>fe.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var tt=je.sub(He)._perp()._unit(),Gt=He.dist(je);Oe+Gt>32768&&(Oe=0),Mf(this.layoutVertexArray,je.x,je.y,tt.x,tt.y,0,0,Oe),Mf(this.layoutVertexArray,je.x,je.y,tt.x,tt.y,0,1,Oe),Mf(this.layoutVertexArray,He.x,He.y,tt.x,tt.y,0,0,Oe+=Gt),Mf(this.layoutVertexArray,He.x,He.y,tt.x,tt.y,0,1,Oe);var Yt=H.vertexLength;this.indexArray.emplaceBack(Yt,Yt+2,Yt+1),this.indexArray.emplaceBack(Yt+1,Yt+2,Yt+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+k>fe.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),pp[t.type]==="Polygon"){for(var hr=[],Rr=[],$r=H.vertexLength,zn=0,dn=P;zn<dn.length;zn+=1){var Vn=dn[zn];if(Vn.length!==0){Vn!==P[0]&&Rr.push(hr.length/2);for(var mn=0;mn<Vn.length;mn++){var Li=Vn[mn];Mf(this.layoutVertexArray,Li.x,Li.y,0,0,1,1,0),hr.push(Li.x),hr.push(Li.y)}}}for(var ai=ws(hr,Rr),Mn=0;Mn<ai.length;Mn+=3)this.indexArray.emplaceBack($r+ai[Mn],$r+ai[Mn+2],$r+ai[Mn+1]);H.primitiveLength+=ai.length/3,H.vertexLength+=k}}var ji;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},vn("FillExtrusionBucket",cl,{omit:["layers","features"]});var ed={paint:new Ko({"fill-extrusion-opacity":new On(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cn(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pc(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Cn(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cn(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Fl=function(t){function o(u){t.call(this,u,ed)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new cl(u)},o.prototype.queryRadius=function(){return xo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,P,k,z){var j=Nu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,k),H=this.paint.get("fill-extrusion-height").evaluate(p,y),ee=this.paint.get("fill-extrusion-base").evaluate(p,y),ne=function(Oe,Ke,je,He){for(var tt=[],Gt=0,Yt=Oe;Gt<Yt.length;Gt+=1){var hr=Yt[Gt],Rr=[hr.x,hr.y,0,1];Kl(Rr,Rr,Ke),tt.push(new ue(Rr[0]/Rr[3],Rr[1]/Rr[3]))}return tt}(j,z),Me=function(Oe,Ke,je,He){for(var tt=[],Gt=[],Yt=He[8]*Ke,hr=He[9]*Ke,Rr=He[10]*Ke,$r=He[11]*Ke,zn=He[8]*je,dn=He[9]*je,Vn=He[10]*je,mn=He[11]*je,Li=0,ai=Oe;Li<ai.length;Li+=1){for(var Mn=[],ji=[],Ci=0,ta=ai[Li];Ci<ta.length;Ci+=1){var Gn=ta[Ci],ga=Gn.x,uo=Gn.y,Lo=He[0]*ga+He[4]*uo+He[12],Ao=He[1]*ga+He[5]*uo+He[13],lo=He[2]*ga+He[6]*uo+He[14],ko=He[3]*ga+He[7]*uo+He[15],_s=lo+Rr,xs=ko+$r,ru=Lo+zn,Ts=Ao+dn,nu=lo+Vn,mo=ko+mn,Ms=new ue((Lo+Yt)/xs,(Ao+hr)/xs);Ms.z=_s/xs,Mn.push(Ms);var Ki=new ue(ru/mo,Ts/mo);Ki.z=nu/mo,ji.push(Ki)}tt.push(Mn),Gt.push(ji)}return[tt,Gt]}(b,ee,H,z);return function(Oe,Ke,je){var He=1/0;Vs(je,Ke)&&(He=qc(je,Ke[0]));for(var tt=0;tt<Ke.length;tt++)for(var Gt=Ke[tt],Yt=Oe[tt],hr=0;hr<Gt.length-1;hr++){var Rr=Gt[hr],$r=[Rr,Gt[hr+1],Yt[hr+1],Yt[hr],Rr];Fu(je,$r)&&(He=Math.min(He,qc(je,$r)))}return He!==1/0&&He}(Me[0],Me[1],ne)},o}(ba);function Pf(t,o){return t.x*o.x+t.y*o.y}function qc(t,o){if(t.length===1){for(var u,p=0,y=o[p++];!u||y.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var b=o[p],S=t[0],P=u.sub(y),k=b.sub(y),z=S.sub(y),j=Pf(P,P),H=Pf(P,k),ee=Pf(k,k),ne=Pf(z,P),Me=Pf(z,k),Oe=j*ee-H*H,Ke=(ee*ne-H*Me)/Oe,je=(j*Me-H*ne)/Oe,He=y.z*(1-Ke-je)+u.z*Ke+b.z*je;if(isFinite(He))return He}return 1/0}for(var tt=1/0,Gt=0,Yt=o;Gt<Yt.length;Gt+=1)tt=Math.min(tt,Yt[Gt].z);return tt}var Ql=ka([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,If=ka([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,dp=mu.VectorTileFeature.types,Bh=Math.cos(Math.PI/180*37.5),vp=Math.pow(2,14)/.5,va=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new Oo,this.layoutVertexArray2=new ol,this.indexArray=new Ml,this.programConfigurations=new Tn(t.layers,t.zoom),this.segments=new fe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};va.prototype.populate=function(t,o,u){this.hasPattern=xc("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],k=P.feature,z=P.id,j=P.index,H=P.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,ne=to(k,ee);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),ne,u)){var Me=p?p.evaluate(ne,{},u):void 0,Oe={id:z,properties:k.properties,type:k.type,sourceLayerIndex:H,index:j,geometry:ee?ne.geometry:Va(k),patterns:{},sortKey:Me};y.push(Oe)}}p&&y.sort(function(Rr,$r){return Rr.sortKey-$r.sortKey});for(var Ke=0,je=y;Ke<je.length;Ke+=1){var He=je[Ke],tt=He.geometry,Gt=He.index,Yt=He.sourceLayerIndex;if(this.hasPattern){var hr=Xc("line",this.layers,He,this.zoom,o);this.patternFeatures.push(hr)}else this.addFeature(He,tt,Gt,u,{});o.featureIndex.insert(t[Gt].feature,tt,Gt,Yt,this.index)}},va.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},va.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},va.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},va.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},va.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,If)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ql),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},va.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},va.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},va.prototype.addFeature=function(t,o,u,p,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),P=b.get("line-cap"),k=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var j=0,H=o;j<H.length;j+=1)this.addLine(H[j],t,S,P,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},va.prototype.addLine=function(t,o,u,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=dp[o.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var z=0;z<k-1&&t[z].equals(t[z+1]);)z++;if(!(k<(P?3:2))){u==="bevel"&&(y=1.05);var j,H=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),ne=void 0,Me=void 0,Oe=void 0,Ke=void 0;this.e1=this.e2=-1,P&&(Ke=t[z].sub(j=t[k-2])._unit()._perp());for(var je=z;je<k;je++)if(!(Me=je===k-1?P?t[z+1]:void 0:t[je+1])||!t[je].equals(Me)){Ke&&(Oe=Ke),j&&(ne=j),j=t[je],Ke=Me?Me.sub(j)._unit()._perp():Oe;var He=(Oe=Oe||Ke).add(Ke);He.x===0&&He.y===0||He._unit();var tt=Oe.x*Ke.x+Oe.y*Ke.y,Gt=He.x*Ke.x+He.y*Ke.y,Yt=Gt!==0?1/Gt:1/0,hr=2*Math.sqrt(2-2*Gt),Rr=Gt<Bh&&ne&&Me,$r=Oe.x*Ke.y-Oe.y*Ke.x>0;if(Rr&&je>z){var zn=j.dist(ne);if(zn>2*H){var dn=j.sub(j.sub(ne)._mult(H/zn)._round());this.updateDistance(ne,dn),this.addCurrentVertex(dn,Oe,0,0,ee),ne=dn}}var Vn=ne&&Me,mn=Vn?u:P?"butt":p;if(Vn&&mn==="round"&&(Yt<b?mn="miter":Yt<=2&&(mn="fakeround")),mn==="miter"&&Yt>y&&(mn="bevel"),mn==="bevel"&&(Yt>2&&(mn="flipbevel"),Yt<y&&(mn="miter")),ne&&this.updateDistance(ne,j),mn==="miter")He._mult(Yt),this.addCurrentVertex(j,He,0,0,ee);else if(mn==="flipbevel"){if(Yt>100)He=Ke.mult(-1);else{var Li=Yt*Oe.add(Ke).mag()/Oe.sub(Ke).mag();He._perp()._mult(Li*($r?-1:1))}this.addCurrentVertex(j,He,0,0,ee),this.addCurrentVertex(j,He.mult(-1),0,0,ee)}else if(mn==="bevel"||mn==="fakeround"){var ai=-Math.sqrt(Yt*Yt-1),Mn=$r?ai:0,ji=$r?0:ai;if(ne&&this.addCurrentVertex(j,Oe,Mn,ji,ee),mn==="fakeround")for(var Ci=Math.round(180*hr/Math.PI/20),ta=1;ta<Ci;ta++){var Gn=ta/Ci;if(Gn!==.5){var ga=Gn-.5;Gn+=Gn*ga*(Gn-1)*((1.0904+tt*(tt*(3.55645-1.43519*tt)-3.2452))*ga*ga+(.848013+tt*(.215638*tt-1.06021)))}var uo=Ke.sub(Oe)._mult(Gn)._add(Oe)._unit()._mult($r?-1:1);this.addHalfVertex(j,uo.x,uo.y,!1,$r,0,ee)}Me&&this.addCurrentVertex(j,Ke,-Mn,-ji,ee)}else if(mn==="butt")this.addCurrentVertex(j,He,0,0,ee);else if(mn==="square"){var Lo=ne?1:-1;this.addCurrentVertex(j,He,Lo,Lo,ee)}else mn==="round"&&(ne&&(this.addCurrentVertex(j,Oe,0,0,ee),this.addCurrentVertex(j,Oe,1,1,ee,!0)),Me&&(this.addCurrentVertex(j,Ke,-1,-1,ee,!0),this.addCurrentVertex(j,Ke,0,0,ee)));if(Rr&&je<k-1){var Ao=j.dist(Me);if(Ao>2*H){var lo=j.add(Me.sub(j)._mult(H/Ao)._round());this.updateDistance(j,lo),this.addCurrentVertex(lo,Ke,0,0,ee),j=lo}}}}},va.prototype.addCurrentVertex=function(t,o,u,p,y,b){b===void 0&&(b=!1);var S=o.y*p-o.x,P=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,P,b,!0,-p,y),this.distance>vp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,p,y,b))},va.prototype.addHalfVertex=function(t,o,u,p,y,b,S){var P=.5*(this.lineClips?this.scaledDistance*(vp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),y?this.e2=k:this.e1=k},va.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},va.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},vn("LineBucket",va,{omit:["layers","patternFeatures"]});var bc=new Ko({"line-cap":new On(he.layout_line["line-cap"]),"line-join":new Cn(he.layout_line["line-join"]),"line-miter-limit":new On(he.layout_line["line-miter-limit"]),"line-round-limit":new On(he.layout_line["line-round-limit"]),"line-sort-key":new Cn(he.layout_line["line-sort-key"])}),Eo={paint:new Ko({"line-opacity":new Cn(he.paint_line["line-opacity"]),"line-color":new Cn(he.paint_line["line-color"]),"line-translate":new On(he.paint_line["line-translate"]),"line-translate-anchor":new On(he.paint_line["line-translate-anchor"]),"line-width":new Cn(he.paint_line["line-width"]),"line-gap-width":new Cn(he.paint_line["line-gap-width"]),"line-offset":new Cn(he.paint_line["line-offset"]),"line-blur":new Cn(he.paint_line["line-blur"]),"line-dasharray":new ds(he.paint_line["line-dasharray"]),"line-pattern":new pc(he.paint_line["line-pattern"]),"line-gradient":new Su(he.paint_line["line-gradient"])}),layout:bc},tu=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new Ii(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,y,b){return p=Pt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,u,p,y,b)},o}(Cn))(Eo.paint.properties["line-width"].specification);tu.useIntegerZoom=!0;var mp=function(t){function o(u){t.call(this,u,Eo),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof hs,this.gradientVersion=(this.gradientVersion+1)%at)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=tu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new va(u)},o.prototype.queryRadius=function(u){var p=u,y=Nh(wu("line-width",this,p),wu("line-gap-width",this,p)),b=wu("line-offset",this,p);return y/2+Math.abs(b)+xo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,P,k){var z=Nu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,k),j=k/2*Nh(this.paint.get("line-width").evaluate(p,y),this.paint.get("line-gap-width").evaluate(p,y)),H=this.paint.get("line-offset").evaluate(p,y);return H&&(b=function(ee,ne){for(var Me=[],Oe=new ue(0,0),Ke=0;Ke<ee.length;Ke++){for(var je=ee[Ke],He=[],tt=0;tt<je.length;tt++){var Gt=je[tt],Yt=je[tt+1],hr=tt===0?Oe:Gt.sub(je[tt-1])._unit()._perp(),Rr=tt===je.length-1?Oe:Yt.sub(Gt)._unit()._perp(),$r=hr._add(Rr)._unit();$r._mult(1/($r.x*Rr.x+$r.y*Rr.y)),He.push($r._mult(ne)._add(Gt))}Me.push(He)}return Me}(b,H*k)),function(ee,ne,Me){for(var Oe=0;Oe<ne.length;Oe++){var Ke=ne[Oe];if(ee.length>=3){for(var je=0;je<Ke.length;je++)if($s(ee,Ke[je]))return!0}if(As(ee,Ke,Me))return!0}return!1}(z,b,j)},o.prototype.isTileClipped=function(){return!0},o}(ba);function Nh(t,o){return o>0?o+2*t:t}var Fd=ka([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bd=ka([{name:"a_projected_pos",components:3,type:"Float32"}],4),Nd=(ka([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ka([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),gp=(ka([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ka([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),zd=ka([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ud(t,o,u){return t.sections.forEach(function(p){p.text=function(y,b,S){var P=b.layout.get("text-transform").evaluate(S,{});return P==="uppercase"?y=y.toLocaleUpperCase():P==="lowercase"&&(y=y.toLocaleLowerCase()),Os.applyArabicShaping&&(y=Os.applyArabicShaping(y)),y}(p.text,o,u)}),t}ka([{name:"triangle",components:3,type:"Uint16"}]),ka([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ka([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ka([{type:"Float32",name:"offsetX"}]),ka([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Bl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},td=function(t,o,u,p,y){var b,S,P=8*y-p-1,k=(1<<P)-1,z=k>>1,j=-7,H=u?y-1:0,ee=u?-1:1,ne=t[o+H];for(H+=ee,b=ne&(1<<-j)-1,ne>>=-j,j+=P;j>0;b=256*b+t[o+H],H+=ee,j-=8);for(S=b&(1<<-j)-1,b>>=-j,j+=p;j>0;S=256*S+t[o+H],H+=ee,j-=8);if(b===0)b=1-z;else{if(b===k)return S?NaN:1/0*(ne?-1:1);S+=Math.pow(2,p),b-=z}return(ne?-1:1)*S*Math.pow(2,b-p)},rd=function(t,o,u,p,y,b){var S,P,k,z=8*b-y-1,j=(1<<z)-1,H=j>>1,ee=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=p?0:b-1,Me=p?1:-1,Oe=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(P=isNaN(o)?1:0,S=j):(S=Math.floor(Math.log(o)/Math.LN2),o*(k=Math.pow(2,-S))<1&&(S--,k*=2),(o+=S+H>=1?ee/k:ee*Math.pow(2,1-H))*k>=2&&(S++,k/=2),S+H>=j?(P=0,S=j):S+H>=1?(P=(o*k-1)*Math.pow(2,y),S+=H):(P=o*Math.pow(2,H-1)*Math.pow(2,y),S=0));y>=8;t[u+ne]=255&P,ne+=Me,P/=256,y-=8);for(S=S<<y|P,z+=y;z>0;t[u+ne]=255&S,ne+=Me,S/=256,z-=8);t[u+ne-Me]|=128*Oe},ih=Pa;function Pa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Pa.Varint=0,Pa.Fixed64=1,Pa.Bytes=2,Pa.Fixed32=5;var zh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Nl(t){return t.type===Pa.Bytes?t.readVarint()+t.pos:t.pos+1}function Of(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function yp(t,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var y=u.pos-1;y>=t;y--)u.buf[y+p]=u.buf[y]}function nd(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function B(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function me(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function ze(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function zt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function cr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Dt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function nr(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function nt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function yr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function Be(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Pr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Ir(t,o,u){t===1&&u.readMessage(Ur,o)}function Ur(t,o,u){if(t===3){var p=u.readMessage(Er,{}),y=p.width,b=p.height,S=p.left,P=p.top,k=p.advance;o.push({id:p.id,bitmap:new hu({width:y+6,height:b+6},p.bitmap),metrics:{width:y,height:b,left:S,top:P,advance:k}})}}function Er(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Tr(t){for(var o=0,u=0,p=0,y=t;p<y.length;p+=1){var b=y[p];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Oe,Ke){return Ke.h-Oe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],P=0,k=0,z=0,j=t;z<j.length;z+=1)for(var H=j[z],ee=S.length-1;ee>=0;ee--){var ne=S[ee];if(!(H.w>ne.w||H.h>ne.h)){if(H.x=ne.x,H.y=ne.y,k=Math.max(k,H.y+H.h),P=Math.max(P,H.x+H.w),H.w===ne.w&&H.h===ne.h){var Me=S.pop();ee<S.length&&(S[ee]=Me)}else H.h===ne.h?(ne.x+=H.w,ne.w-=H.w):H.w===ne.w?(ne.y+=H.h,ne.h-=H.h):(S.push({x:ne.x+H.w,y:ne.y,w:ne.w-H.w,h:H.h}),ne.y+=H.h,ne.h-=H.h);break}}return{w:P,h:k,fill:o/(P*k)||0}}Pa.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),y=p>>3,b=this.pos;this.type=7&p,t(y,o,this),this.pos===b&&this.skip(p)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=yr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Pr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=yr(this.buf,this.pos)+4294967296*yr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=yr(this.buf,this.pos)+4294967296*Pr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=td(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=td(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(y,b,S){var P,k,z=S.buf;if(P=(112&(k=z[S.pos++]))>>4,k<128||(P|=(127&(k=z[S.pos++]))<<3,k<128)||(P|=(127&(k=z[S.pos++]))<<10,k<128)||(P|=(127&(k=z[S.pos++]))<<17,k<128)||(P|=(127&(k=z[S.pos++]))<<24,k<128)||(P|=(1&(k=z[S.pos++]))<<31,k<128))return Of(y,P,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&zh?function(u,p,y){return zh.decode(u.subarray(p,y))}(this.buf,o,t):function(u,p,y){for(var b="",S=p;S<y;){var P,k,z,j=u[S],H=null,ee=j>239?4:j>223?3:j>191?2:1;if(S+ee>y)break;ee===1?j<128&&(H=j):ee===2?(192&(P=u[S+1]))==128&&(H=(31&j)<<6|63&P)<=127&&(H=null):ee===3?(k=u[S+2],(192&(P=u[S+1]))==128&&(192&k)==128&&((H=(15&j)<<12|(63&P)<<6|63&k)<=2047||H>=55296&&H<=57343)&&(H=null)):ee===4&&(k=u[S+2],z=u[S+3],(192&(P=u[S+1]))==128&&(192&k)==128&&(192&z)==128&&((H=(15&j)<<18|(63&P)<<12|(63&k)<<6|63&z)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,ee=1):H>65535&&(H-=65536,b+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),b+=String.fromCharCode(H),S+=ee}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Pa.Bytes)return t.push(this.readVarint(o));var u=Nl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSVarint());var o=Nl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Pa.Bytes)return t.push(this.readBoolean());var o=Nl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFloat());var o=Nl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Pa.Bytes)return t.push(this.readDouble());var o=Nl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFixed32());var o=Nl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSFixed32());var o=Nl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFixed64());var o=Nl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSFixed64());var o=Nl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Pa.Varint)for(;this.buf[this.pos++]>127;);else if(o===Pa.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Pa.Fixed32)this.pos+=4;else{if(o!==Pa.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Be(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Be(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Be(this.buf,-1&t,this.pos),Be(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Be(this.buf,-1&t,this.pos),Be(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var p,y;if(o>=0?(p=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,P){P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,P.buf[P.pos]=127&(b>>>=7)}(p,0,u),function(b,S){var P=(7&b)<<4;S.buf[S.pos++]|=P|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(p,y,b){for(var S,P,k=0;k<y.length;k++){if((S=y.charCodeAt(k))>55295&&S<57344){if(!P){S>56319||k+1===y.length?(p[b++]=239,p[b++]=191,p[b++]=189):P=S;continue}if(S<56320){p[b++]=239,p[b++]=191,p[b++]=189,P=S;continue}S=P-55296<<10|S-56320|65536,P=null}else P&&(p[b++]=239,p[b++]=191,p[b++]=189,P=null);S<128?p[b++]=S:(S<2048?p[b++]=S>>6|192:(S<65536?p[b++]=S>>12|224:(p[b++]=S>>18|240,p[b++]=S>>12&63|128),p[b++]=S>>6&63|128),p[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&yp(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),rd(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),rd(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var p=this.pos-u;p>=128&&yp(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,o,u){this.writeTag(t,Pa.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,nd,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,B,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,zt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,me,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,ze,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,cr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Dt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,nr,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,nt,o)},writeBytesField:function(t,o){this.writeTag(t,Pa.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Pa.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Pa.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Pa.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Pa.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Pa.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Pa.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Pa.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Pa.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Pa.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var ht=function(t,o){var u=o.pixelRatio,p=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=p},Wt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Wt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Wt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Wt.tlbr.get=function(){return this.tl.concat(this.br)},Wt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ht.prototype,Wt);var xr=function(t,o){var u={},p={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,p,y);var b=Tr(y),S=new bo({width:b.w||1,height:b.h||1});for(var P in t){var k=t[P],z=u[P].paddedRect;bo.copy(k.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},k.data)}for(var j in o){var H=o[j],ee=p[j].paddedRect,ne=ee.x+1,Me=ee.y+1,Oe=H.data.width,Ke=H.data.height;bo.copy(H.data,S,{x:0,y:0},{x:ne,y:Me},H.data),bo.copy(H.data,S,{x:0,y:Ke-1},{x:ne,y:Me-1},{width:Oe,height:1}),bo.copy(H.data,S,{x:0,y:0},{x:ne,y:Me+Ke},{width:Oe,height:1}),bo.copy(H.data,S,{x:Oe-1,y:0},{x:ne-1,y:Me},{width:1,height:Ke}),bo.copy(H.data,S,{x:0,y:0},{x:ne+Oe,y:Me},{width:1,height:Ke})}this.image=S,this.iconPositions=u,this.patternPositions=p};xr.prototype.addImages=function(t,o,u){for(var p in t){var y=t[p],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[p]=new ht(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},xr.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},xr.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var p=t.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},vn("ImagePosition",ht),vn("ImageAtlas",xr);var Nr={horizontal:1,vertical:2,horizontalOnly:3},pr=function(){this.scale=1,this.fontStack="",this.imageName=null};pr.forText=function(t,o){var u=new pr;return u.scale=t||1,u.fontStack=o,u},pr.forImage=function(t){var o=new pr;return o.imageName=t,o};var Or=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Kr(t,o,u,p,y,b,S,P,k,z,j,H,ee,ne,Me,Oe){var Ke,je=Or.fromFeature(t,y);H===Nr.vertical&&je.verticalizePunctuation();var He=Os.processBidirectionalText,tt=Os.processStyledBidirectionalText;if(He&&je.sections.length===1){Ke=[];for(var Gt=0,Yt=He(je.toString(),Gr(je,z,b,o,p,ne,Me));Gt<Yt.length;Gt+=1){var hr=Yt[Gt],Rr=new Or;Rr.text=hr,Rr.sections=je.sections;for(var $r=0;$r<hr.length;$r++)Rr.sectionIndex.push(0);Ke.push(Rr)}}else if(tt){Ke=[];for(var zn=0,dn=tt(je.text,je.sectionIndex,Gr(je,z,b,o,p,ne,Me));zn<dn.length;zn+=1){var Vn=dn[zn],mn=new Or;mn.text=Vn[0],mn.sectionIndex=Vn[1],mn.sections=je.sections,Ke.push(mn)}}else Ke=function(Mn,ji){for(var Ci=[],ta=Mn.text,Gn=0,ga=0,uo=ji;ga<uo.length;ga+=1){var Lo=uo[ga];Ci.push(Mn.substring(Gn,Lo)),Gn=Lo}return Gn<ta.length&&Ci.push(Mn.substring(Gn,ta.length)),Ci}(je,Gr(je,z,b,o,p,ne,Me));var Li=[],ai={positionedLines:Li,text:je.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(Mn,ji,Ci,ta,Gn,ga,uo,Lo,Ao,lo,ko,_s){for(var xs=0,ru=-17,Ts=0,nu=0,mo=Lo==="right"?1:Lo==="left"?0:.5,Ms=0,Ki=0,Na=Gn;Ki<Na.length;Ki+=1){var Ia=Na[Ki];Ia.trim();var sa=Ia.getMaxScale(),gu=24*(sa-1),Gs={positionedGlyphs:[],lineOffset:0};Mn.positionedLines[Ms]=Gs;var io=Gs.positionedGlyphs,ts=0;if(Ia.length()){for(var Hs=0;Hs<Ia.length();Hs++){var ya=Ia.getSection(Hs),$c=Ia.getSectionIndex(Hs),pl=Ia.getCharCode(Hs),Ul=0,Do=null,Jl=null,dl=null,vl=24,ml=!(Ao===Nr.horizontal||!ko&&!Xf(pl)||ko&&(Bn[pl]||(gl=pl,qr.Arabic(gl)||qr["Arabic Supplement"](gl)||qr["Arabic Extended-A"](gl)||qr["Arabic Presentation Forms-A"](gl)||qr["Arabic Presentation Forms-B"](gl))));if(ya.imageName){var sh=ta[ya.imageName];if(!sh)continue;dl=ya.imageName,Mn.iconsInText=Mn.iconsInText||!0,Jl=sh.paddedRect;var Cc=sh.displaySize;ya.scale=24*ya.scale/_s,Ul=gu+(24-Cc[1]*ya.scale),vl=(Do={width:Cc[0],height:Cc[1],left:1,top:-3,advance:ml?Cc[1]:Cc[0]}).advance;var uh=ml?Cc[0]*ya.scale-24*sa:Cc[1]*ya.scale-24*sa;uh>0&&uh>ts&&(ts=uh)}else{var Zh=Ci[ya.fontStack],lh=Zh&&Zh[pl];if(lh&&lh.rect)Jl=lh.rect,Do=lh.metrics;else{var bp=ji[ya.fontStack],ad=bp&&bp[pl];if(!ad)continue;Do=ad.metrics}Ul=24*(sa-ya.scale)}ml?(Mn.verticalizable=!0,io.push({glyph:pl,imageName:dl,x:xs,y:ru+Ul,vertical:ml,scale:ya.scale,fontStack:ya.fontStack,sectionIndex:$c,metrics:Do,rect:Jl}),xs+=vl*ya.scale+lo):(io.push({glyph:pl,imageName:dl,x:xs,y:ru+Ul,vertical:ml,scale:ya.scale,fontStack:ya.fontStack,sectionIndex:$c,metrics:Do,rect:Jl}),xs+=Do.advance*ya.scale+lo)}io.length!==0&&(Ts=Math.max(xs-lo,Ts),vi(io,0,io.length-1,mo,ts)),xs=0;var od=ga*sa+ts;Gs.lineOffset=Math.max(ts,gu),ru+=od,nu=Math.max(od,nu),++Ms}else ru+=ga,++Ms}var gl,bs=ru- -17,ch=Jr(uo),Qc=ch.horizontalAlign,fh=ch.verticalAlign;(function(jh,Ep,Sp,Cp,sd,Ap,wp,Tp,ud){var W,Mp=(Ep-Sp)*sd;W=Ap!==wp?-Tp*Cp- -17:(-Cp*ud+.5)*wp;for(var hh=0,Vh=jh;hh<Vh.length;hh+=1)for(var Lf=0,Gh=Vh[hh].positionedGlyphs;Lf<Gh.length;Lf+=1){var ph=Gh[Lf];ph.x+=Mp,ph.y+=W}})(Mn.positionedLines,mo,Qc,fh,Ts,nu,ga,bs,Gn.length),Mn.top+=-fh*bs,Mn.bottom=Mn.top+bs,Mn.left+=-Qc*Ts,Mn.right=Mn.left+Ts}(ai,o,u,p,Ke,S,P,k,H,z,ee,Oe),!function(Mn){for(var ji=0,Ci=Mn;ji<Ci.length;ji+=1)if(Ci[ji].positionedGlyphs.length!==0)return!1;return!0}(Li)&&ai}Or.fromFeature=function(t,o){for(var u=new Or,p=0;p<t.sections.length;p++){var y=t.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Or.prototype.length=function(){return this.text.length},Or.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Or.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Or.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Or.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var p=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=p&&Lu(p)&&!Bl[t[u+1]]||y&&Lu(y)&&!Bl[t[u-1]]||!Bl[t[u]]?t[u]:Bl[t[u]]}return o}(this.text)},Or.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Bn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=t&&Bn[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Or.prototype.substring=function(t,o){var u=new Or;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Or.prototype.toString=function(){return this.text},Or.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Or.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(pr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(u)},Or.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(pr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}else et("Can't add FormattedSection with an empty image.")},Or.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rr={};function ar(t,o,u,p,y,b){if(o.imageName){var S=p[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var P=u[o.fontStack],k=P&&P[t];return k?k.metrics.advance*o.scale+y:0}function xn(t,o,u,p){var y=Math.pow(t-o,2);return p?t<o?y/2:2*y:y+Math.abs(u)*u}function Vr(t,o,u){var p=0;return t===10&&(p-=1e4),u&&(p+=150),t!==40&&t!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function Ar(t,o,u,p,y,b){for(var S=null,P=xn(o,u,y,b),k=0,z=p;k<z.length;k+=1){var j=z[k],H=xn(o-j.x,u,y,b)+j.badness;H<=P&&(S=j,P=H)}return{index:t,x:o,priorBreak:S,badness:P}}function Gr(t,o,u,p,y,b,S){if(b!=="point")return[];if(!t)return[];for(var P,k=[],z=function(Ke,je,He,tt,Gt,Yt){for(var hr=0,Rr=0;Rr<Ke.length();Rr++){var $r=Ke.getSection(Rr);hr+=ar(Ke.getCharCode(Rr),$r,tt,Gt,je,Yt)}return hr/Math.max(1,Math.ceil(hr/He))}(t,o,u,p,y,S),j=t.text.indexOf("\u200B")>=0,H=0,ee=0;ee<t.length();ee++){var ne=t.getSection(ee),Me=t.getCharCode(ee);if(Bn[Me]||(H+=ar(Me,ne,p,y,o,S)),ee<t.length()-1){var Oe=!((P=Me)<11904||!(qr["Bopomofo Extended"](P)||qr.Bopomofo(P)||qr["CJK Compatibility Forms"](P)||qr["CJK Compatibility Ideographs"](P)||qr["CJK Compatibility"](P)||qr["CJK Radicals Supplement"](P)||qr["CJK Strokes"](P)||qr["CJK Symbols and Punctuation"](P)||qr["CJK Unified Ideographs Extension A"](P)||qr["CJK Unified Ideographs"](P)||qr["Enclosed CJK Letters and Months"](P)||qr["Halfwidth and Fullwidth Forms"](P)||qr.Hiragana(P)||qr["Ideographic Description Characters"](P)||qr["Kangxi Radicals"](P)||qr["Katakana Phonetic Extensions"](P)||qr.Katakana(P)||qr["Vertical Forms"](P)||qr["Yi Radicals"](P)||qr["Yi Syllables"](P)));(rr[Me]||Oe||ne.imageName)&&k.push(Ar(ee+1,H,z,k,Vr(Me,t.getCharCode(ee+1),Oe&&j),!1))}}return function Ke(je){return je?Ke(je.priorBreak).concat(je.index):[]}(Ar(t.length(),H,z,k,0,!0))}function Jr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function vi(t,o,u,p,y){if(p||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*p,P=o;P<=u;P++)t[P].x-=S,t[P].y+=y}function ii(t,o,u,p,y,b){var S,P=t.image;if(P.content){var k=P.content,z=P.pixelRatio||1;S=[k[0]/z,k[1]/z,P.displaySize[0]-k[2]/z,P.displaySize[1]-k[3]/z]}var j,H,ee,ne,Me=o.left*b,Oe=o.right*b;u==="width"||u==="both"?(ne=y[0]+Me-p[3],H=y[0]+Oe+p[1]):H=(ne=y[0]+(Me+Oe-P.displaySize[0])/2)+P.displaySize[0];var Ke=o.top*b,je=o.bottom*b;return u==="height"||u==="both"?(j=y[1]+Ke-p[0],ee=y[1]+je+p[2]):ee=(j=y[1]+(Ke+je-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:j,right:H,bottom:ee,left:ne,collisionPadding:S}}rr[10]=!0,rr[32]=!0,rr[38]=!0,rr[40]=!0,rr[41]=!0,rr[43]=!0,rr[45]=!0,rr[47]=!0,rr[173]=!0,rr[183]=!0,rr[8203]=!0,rr[8208]=!0,rr[8211]=!0,rr[8231]=!0;var Wr=function(t){function o(u,p,y,b){t.call(this,u,p),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(ue);function an(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ii(t+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,y=u.interpolationType,b=0;b<p.length&&p[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<p.length&&p[S]<t+1;)S++;S=Math.min(p.length-1,S);var P=p[b],k=p[S];return u.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:k,interpolationType:y}:{kind:"camera",minZoom:P,maxZoom:k,minSize:u.evaluate(new Ii(P)),maxSize:u.evaluate(new Ii(k)),interpolationType:y}}function Jn(t,o,u){var p=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ia(y/128,u.upperSize/128,o.uSizeT):p}function fi(t,o){var u=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?Ht(xe.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=ia(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:p}}vn("Anchor",Wr);var Di=Object.freeze({__proto__:null,getSizeData:an,evaluateSizeForFeature:Jn,evaluateSizeForZoom:fi,SIZE_PACK_FACTOR:128});function ro(t,o,u,p,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,P=0;P>-u/2;){if(--S<0)return!1;P-=t[S].dist(b),b=t[S]}P+=t[S].dist(t[S+1]),S++;for(var k=[],z=0;P<u/2;){var j=t[S],H=t[S+1];if(!H)return!1;var ee=t[S-1].angleTo(j)-j.angleTo(H);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:P,angleDelta:ee}),z+=ee;P-k[0].distance>p;)z-=k.shift().angleDelta;if(z>y)return!1;S++,P+=j.dist(H)}return!0}function no(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Fi(t,o,u){return t?.6*o*u:0}function gs(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Ga(t,o,u,p,y,b){for(var S=Fi(u,y,b),P=gs(u,p)*b,k=0,z=no(t)/2,j=0;j<t.length-1;j++){var H=t[j],ee=t[j+1],ne=H.dist(ee);if(k+ne>z){var Me=(z-k)/ne,Oe=ia(H.x,ee.x,Me),Ke=ia(H.y,ee.y,Me),je=new Wr(Oe,Ke,ee.angleTo(H),j);return je._round(),!S||ro(t,je,P,S,o)?je:void 0}k+=ne}}function jo(t,o,u,p,y,b,S,P,k){var z=Fi(p,b,S),j=gs(p,y),H=j*S,ee=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return o-H<o/4&&(o=H+o/4),function ne(Me,Oe,Ke,je,He,tt,Gt,Yt,hr){for(var Rr=tt/2,$r=no(Me),zn=0,dn=Oe-Ke,Vn=[],mn=0;mn<Me.length-1;mn++){for(var Li=Me[mn],ai=Me[mn+1],Mn=Li.dist(ai),ji=ai.angleTo(Li);dn+Ke<zn+Mn;){var Ci=((dn+=Ke)-zn)/Mn,ta=ia(Li.x,ai.x,Ci),Gn=ia(Li.y,ai.y,Ci);if(ta>=0&&ta<hr&&Gn>=0&&Gn<hr&&dn-Rr>=0&&dn+Rr<=$r){var ga=new Wr(ta,Gn,ji,mn);ga._round(),je&&!ro(Me,ga,tt,je,He)||Vn.push(ga)}}zn+=Mn}return Yt||Vn.length||Gt||(Vn=ne(Me,zn/2,Ke,je,He,tt,Gt,!0,hr)),Vn}(t,ee?o/2*P%o:(j/2+2*b)*S*P%o,o,z,u,H,ee,!1,k)}function vo(t,o,u,p,y){for(var b=[],S=0;S<t.length;S++)for(var P=t[S],k=void 0,z=0;z<P.length-1;z++){var j=P[z],H=P[z+1];j.x<o&&H.x<o||(j.x<o?j=new ue(o,j.y+(o-j.x)/(H.x-j.x)*(H.y-j.y))._round():H.x<o&&(H=new ue(o,j.y+(o-j.x)/(H.x-j.x)*(H.y-j.y))._round()),j.y<u&&H.y<u||(j.y<u?j=new ue(j.x+(u-j.y)/(H.y-j.y)*(H.x-j.x),u)._round():H.y<u&&(H=new ue(j.x+(u-j.y)/(H.y-j.y)*(H.x-j.x),u)._round()),j.x>=p&&H.x>=p||(j.x>=p?j=new ue(p,j.y+(p-j.x)/(H.x-j.x)*(H.y-j.y))._round():H.x>=p&&(H=new ue(p,j.y+(p-j.x)/(H.x-j.x)*(H.y-j.y))._round()),j.y>=y&&H.y>=y||(j.y>=y?j=new ue(j.x+(y-j.y)/(H.y-j.y)*(H.x-j.x),y)._round():H.y>=y&&(H=new ue(j.x+(y-j.y)/(H.y-j.y)*(H.x-j.x),y)._round()),k&&j.equals(k[k.length-1])||b.push(k=[j]),k.push(H)))))}return b}function Qo(t,o,u,p){var y=[],b=t.image,S=b.pixelRatio,P=b.paddedRect.w-2,k=b.paddedRect.h-2,z=t.right-t.left,j=t.bottom-t.top,H=b.stretchX||[[0,P]],ee=b.stretchY||[[0,k]],ne=function(ta,Gn){return ta+Gn[1]-Gn[0]},Me=H.reduce(ne,0),Oe=ee.reduce(ne,0),Ke=P-Me,je=k-Oe,He=0,tt=Me,Gt=0,Yt=Oe,hr=0,Rr=Ke,$r=0,zn=je;if(b.content&&p){var dn=b.content;He=Ro(H,0,dn[0]),Gt=Ro(ee,0,dn[1]),tt=Ro(H,dn[0],dn[2]),Yt=Ro(ee,dn[1],dn[3]),hr=dn[0]-He,$r=dn[1]-Gt,Rr=dn[2]-dn[0]-tt,zn=dn[3]-dn[1]-Yt}var Vn=function(ta,Gn,ga,uo){var Lo=so(ta.stretch-He,tt,z,t.left),Ao=mi(ta.fixed-hr,Rr,ta.stretch,Me),lo=so(Gn.stretch-Gt,Yt,j,t.top),ko=mi(Gn.fixed-$r,zn,Gn.stretch,Oe),_s=so(ga.stretch-He,tt,z,t.left),xs=mi(ga.fixed-hr,Rr,ga.stretch,Me),ru=so(uo.stretch-Gt,Yt,j,t.top),Ts=mi(uo.fixed-$r,zn,uo.stretch,Oe),nu=new ue(Lo,lo),mo=new ue(_s,lo),Ms=new ue(_s,ru),Ki=new ue(Lo,ru),Na=new ue(Ao/S,ko/S),Ia=new ue(xs/S,Ts/S),sa=o*Math.PI/180;if(sa){var gu=Math.sin(sa),Gs=Math.cos(sa),io=[Gs,-gu,gu,Gs];nu._matMult(io),mo._matMult(io),Ki._matMult(io),Ms._matMult(io)}var ts=ta.stretch+ta.fixed,Hs=Gn.stretch+Gn.fixed;return{tl:nu,tr:mo,bl:Ki,br:Ms,tex:{x:b.paddedRect.x+1+ts,y:b.paddedRect.y+1+Hs,w:ga.stretch+ga.fixed-ts,h:uo.stretch+uo.fixed-Hs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Na,pixelOffsetBR:Ia,minFontScaleX:Rr/S/z,minFontScaleY:zn/S/j,isSDF:u}};if(p&&(b.stretchX||b.stretchY))for(var mn=us(H,Ke,Me),Li=us(ee,je,Oe),ai=0;ai<mn.length-1;ai++)for(var Mn=mn[ai],ji=mn[ai+1],Ci=0;Ci<Li.length-1;Ci++)y.push(Vn(Mn,Li[Ci],ji,Li[Ci+1]));else y.push(Vn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:k+1}));return y}function Ro(t,o,u){for(var p=0,y=0,b=t;y<b.length;y+=1){var S=b[y];p+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return p}function us(t,o,u){for(var p=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],P=S[0],k=S[1],z=p[p.length-1];p.push({fixed:P-z.stretch,stretch:z.stretch}),p.push({fixed:P-z.stretch,stretch:z.stretch+(k-P)})}return p.push({fixed:o+1,stretch:u}),p}function so(t,o,u,p){return t/o*u+p}function mi(t,o,u,p){return t-o*u/p}var Vo=function(t,o,u,p,y,b,S,P,k,z){if(this.boxStartIndex=t.length,k){var j=b.top,H=b.bottom,ee=b.collisionPadding;ee&&(j-=ee[1],H+=ee[3]);var ne=H-j;ne>0&&(ne=Math.max(10,ne),this.circleDiameter=ne)}else{var Me=b.top*S-P,Oe=b.bottom*S+P,Ke=b.left*S-P,je=b.right*S+P,He=b.collisionPadding;if(He&&(Ke-=He[0]*S,Me-=He[1]*S,je+=He[2]*S,Oe+=He[3]*S),z){var tt=new ue(Ke,Me),Gt=new ue(je,Me),Yt=new ue(Ke,Oe),hr=new ue(je,Oe),Rr=z*Math.PI/180;tt._rotate(Rr),Gt._rotate(Rr),Yt._rotate(Rr),hr._rotate(Rr),Ke=Math.min(tt.x,Gt.x,Yt.x,hr.x),je=Math.max(tt.x,Gt.x,Yt.x,hr.x),Me=Math.min(tt.y,Gt.y,Yt.y,hr.y),Oe=Math.max(tt.y,Gt.y,Yt.y,hr.y)}t.emplaceBack(o.x,o.y,Ke,Me,je,Oe,u,p,y)}this.boxEndIndex=t.length},Qi=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=So),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function So(t,o){return t<o?-1:t>o?1:0}function ri(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,y=1/0,b=-1/0,S=-1/0,P=t[0],k=0;k<P.length;k++){var z=P[k];(!k||z.x<p)&&(p=z.x),(!k||z.y<y)&&(y=z.y),(!k||z.x>b)&&(b=z.x),(!k||z.y>S)&&(S=z.y)}var j=Math.min(b-p,S-y),H=j/2,ee=new Qi([],In);if(j===0)return new ue(p,y);for(var ne=p;ne<b;ne+=j)for(var Me=y;Me<S;Me+=j)ee.push(new Zi(ne+H,Me+H,H,t));for(var Oe=function(He){for(var tt=0,Gt=0,Yt=0,hr=He[0],Rr=0,$r=hr.length,zn=$r-1;Rr<$r;zn=Rr++){var dn=hr[Rr],Vn=hr[zn],mn=dn.x*Vn.y-Vn.x*dn.y;Gt+=(dn.x+Vn.x)*mn,Yt+=(dn.y+Vn.y)*mn,tt+=3*mn}return new Zi(Gt/tt,Yt/tt,0,He)}(t),Ke=ee.length;ee.length;){var je=ee.pop();(je.d>Oe.d||!Oe.d)&&(Oe=je,u&&console.log("found best %d after %d probes",Math.round(1e4*je.d)/1e4,Ke)),je.max-Oe.d<=o||(ee.push(new Zi(je.p.x-(H=je.h/2),je.p.y-H,H,t)),ee.push(new Zi(je.p.x+H,je.p.y-H,H,t)),ee.push(new Zi(je.p.x-H,je.p.y+H,H,t)),ee.push(new Zi(je.p.x+H,je.p.y+H,H,t)),Ke+=4)}return u&&(console.log("num probes: "+Ke),console.log("best distance: "+Oe.d)),Oe.p}function In(t,o){return o.max-t.max}function Zi(t,o,u,p){this.p=new ue(t,o),this.h=u,this.d=function(y,b){for(var S=!1,P=1/0,k=0;k<b.length;k++)for(var z=b[k],j=0,H=z.length,ee=H-1;j<H;ee=j++){var ne=z[j],Me=z[ee];ne.y>y.y!=Me.y>y.y&&y.x<(Me.x-ne.x)*(y.y-ne.y)/(Me.y-ne.y)+ne.x&&(S=!S),P=Math.min(P,ql(y,ne,Me))}return(S?1:-1)*Math.sqrt(P)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}Qi.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Qi.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},Qi.prototype.peek=function(){return this.data[0]},Qi.prototype._up=function(t){for(var o=this.data,u=this.compare,p=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(p,b)>=0)break;o[t]=b,t=y}o[t]=p},Qi.prototype._down=function(t){for(var o=this.data,u=this.compare,p=this.length>>1,y=o[t];t<p;){var b=1+(t<<1),S=o[b],P=b+1;if(P<this.length&&u(o[P],S)<0&&(b=P,S=o[P]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var Co=Number.POSITIVE_INFINITY;function zl(t,o){return o[1]!==Co?function(u,p,y){var b=0,S=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,S]}(t,o[0],o[1]):function(u,p){var y=0,b=0;p<0&&(p=0);var S=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=p;break;case"right":y=-p}return[y,b]}(t,o[0])}function we(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jt(t,o,u,p,y,b,S,P,k,z,j,H,ee,ne,Me){var Oe=function(Gt,Yt,hr,Rr,$r,zn,dn,Vn){for(var mn=Rr.layout.get("text-rotate").evaluate(zn,{})*Math.PI/180,Li=[],ai=0,Mn=Yt.positionedLines;ai<Mn.length;ai+=1)for(var ji=Mn[ai],Ci=0,ta=ji.positionedGlyphs;Ci<ta.length;Ci+=1){var Gn=ta[Ci];if(Gn.rect){var ga=Gn.rect||{},uo=4,Lo=!0,Ao=1,lo=0,ko=($r||Vn)&&Gn.vertical,_s=Gn.metrics.advance*Gn.scale/2;if(Vn&&Yt.verticalizable&&(lo=ji.lineOffset/2-(Gn.imageName?-(24-Gn.metrics.width*Gn.scale)/2:24*(Gn.scale-1))),Gn.imageName){var xs=dn[Gn.imageName];Lo=xs.sdf,uo=1/(Ao=xs.pixelRatio)}var ru=$r?[Gn.x+_s,Gn.y]:[0,0],Ts=$r?[0,0]:[Gn.x+_s+hr[0],Gn.y+hr[1]-lo],nu=[0,0];ko&&(nu=Ts,Ts=[0,0]);var mo=(Gn.metrics.left-uo)*Gn.scale-_s+Ts[0],Ms=(-Gn.metrics.top-uo)*Gn.scale+Ts[1],Ki=mo+ga.w*Gn.scale/Ao,Na=Ms+ga.h*Gn.scale/Ao,Ia=new ue(mo,Ms),sa=new ue(Ki,Ms),gu=new ue(mo,Na),Gs=new ue(Ki,Na);if(ko){var io=new ue(-_s,_s- -17),ts=-Math.PI/2,Hs=12-_s,ya=new ue(22-Hs,-(Gn.imageName?Hs:0)),$c=new(Function.prototype.bind.apply(ue,[null].concat(nu)));Ia._rotateAround(ts,io)._add(ya)._add($c),sa._rotateAround(ts,io)._add(ya)._add($c),gu._rotateAround(ts,io)._add(ya)._add($c),Gs._rotateAround(ts,io)._add(ya)._add($c)}if(mn){var pl=Math.sin(mn),Ul=Math.cos(mn),Do=[Ul,-pl,pl,Ul];Ia._matMult(Do),sa._matMult(Do),gu._matMult(Do),Gs._matMult(Do)}var Jl=new ue(0,0),dl=new ue(0,0);Li.push({tl:Ia,tr:sa,bl:gu,br:Gs,tex:ga,writingMode:Yt.writingMode,glyphOffset:ru,sectionIndex:Gn.sectionIndex,isSDF:Lo,pixelOffsetTL:Jl,pixelOffsetBR:dl,minFontScaleX:0,minFontScaleY:0})}}return Li}(0,u,P,y,b,S,p,t.allowVerticalPlacement),Ke=t.textSizeData,je=null;Ke.kind==="source"?(je=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&et(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ke.kind==="composite"&&((je=[128*ne.compositeTextSizes[0].evaluate(S,{},Me),128*ne.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||je[1]>32640)&&et(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Oe,je,P,b,S,z,o,k.lineStartIndex,k.lineLength,ee,Me);for(var He=0,tt=j;He<tt.length;He+=1)H[tt[He]]=t.text.placedSymbolArray.length-1;return 4*Oe.length}function At(t){for(var o in t)return t[o];return null}function hn(t,o,u,p){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(p.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(p),!1}var Oi=mu.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ie(t,o,u,p,y,b,S,P,k,z,j,H,ee){var ne=P?Math.min(32640,Math.round(P[0])):0,Me=P?Math.min(32640,Math.round(P[1])):0;t.emplaceBack(o,u,Math.round(32*p),Math.round(32*y),b,S,(ne<<1)+(k?1:0),Me,16*z,16*j,256*H,256*ee)}function Ze(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ft(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(vf(u[o].text))return!0;return!1}var Rt=function(t){this.layoutVertexArray=new Al,this.indexArray=new Ml,this.programConfigurations=t,this.segments=new fe,this.dynamicLayoutVertexArray=new sl,this.opacityVertexArray=new dc,this.placedSymbolArray=new d};Rt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Rt.prototype.upload=function(t,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Bd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))},Rt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},vn("SymbolBuffers",Rt);var $e=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new fe,this.collisionVertexArray=new Ph};$e.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Nd.members,!0)},$e.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},vn("CollisionBuffers",$e);var Fe=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Uo([]),this.placementViewportMatrix=Uo([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=an(this.zoom,o["text-size"]),this.iconSizeData=an(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Nr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};Fe.prototype.createArrays=function(){this.text=new Rt(new Tn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Rt(new Tn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new M,this.lineVertexArray=new L,this.symbolInstances=new w},Fe.prototype.calculateGlyphDependencies=function(t,o,u,p,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||p)&&y){var S=Bl[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},Fe.prototype.populate=function(t,o,u){var p=this.layers[0],y=p.layout,b=y.get("text-font"),S=y.get("text-field"),P=y.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof Sa&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,j=y.get("symbol-sort-key");if(this.features=[],k||z){for(var H=o.iconDependencies,ee=o.glyphDependencies,ne=o.availableImages,Me=new Ii(this.zoom),Oe=0,Ke=t;Oe<Ke.length;Oe+=1){var je=Ke[Oe],He=je.feature,tt=je.id,Gt=je.index,Yt=je.sourceLayerIndex,hr=p._featureFilter.needGeometry,Rr=to(He,hr);if(p._featureFilter.filter(Me,Rr,u)){hr||(Rr.geometry=Va(He));var $r=void 0;if(k){var zn=p.getValueAndResolveTokens("text-field",Rr,u,ne),dn=Sa.factory(zn);ft(dn)&&(this.hasRTLText=!0),(!this.hasRTLText||Mh()==="unavailable"||this.hasRTLText&&Os.isParsed())&&($r=Ud(dn,p,Rr))}var Vn=void 0;if(z){var mn=p.getValueAndResolveTokens("icon-image",Rr,u,ne);Vn=mn instanceof Ca?mn:Ca.fromString(mn)}if($r||Vn){var Li=this.sortFeaturesByKey?j.evaluate(Rr,{},u):void 0;if(this.features.push({id:tt,text:$r,icon:Vn,index:Gt,sourceLayerIndex:Yt,geometry:Rr.geometry,properties:He.properties,type:Oi[He.type],sortKey:Li}),Vn&&(H[Vn.name]=!0),$r){var ai=b.evaluate(Rr,{},u).join(","),Mn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Nr.vertical)>=0;for(var ji=0,Ci=$r.sections;ji<Ci.length;ji+=1){var ta=Ci[ji];if(ta.image)H[ta.image.name]=!0;else{var Gn=df($r.toString()),ga=ta.fontStack||ai,uo=ee[ga]=ee[ga]||{};this.calculateGlyphDependencies(ta.text,uo,Mn,this.allowVerticalPlacement,Gn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(Lo){var Ao={},lo={},ko=[],_s=0;function xs(io){ko.push(Lo[io]),_s++}function ru(io,ts,Hs){var ya=lo[io];return delete lo[io],lo[ts]=ya,ko[ya].geometry[0].pop(),ko[ya].geometry[0]=ko[ya].geometry[0].concat(Hs[0]),ya}function Ts(io,ts,Hs){var ya=Ao[ts];return delete Ao[ts],Ao[io]=ya,ko[ya].geometry[0].shift(),ko[ya].geometry[0]=Hs[0].concat(ko[ya].geometry[0]),ya}function nu(io,ts,Hs){var ya=Hs?ts[0][ts[0].length-1]:ts[0][0];return io+":"+ya.x+":"+ya.y}for(var mo=0;mo<Lo.length;mo++){var Ms=Lo[mo],Ki=Ms.geometry,Na=Ms.text?Ms.text.toString():null;if(Na){var Ia=nu(Na,Ki),sa=nu(Na,Ki,!0);if(Ia in lo&&sa in Ao&&lo[Ia]!==Ao[sa]){var gu=Ts(Ia,sa,Ki),Gs=ru(Ia,sa,ko[gu].geometry);delete Ao[Ia],delete lo[sa],lo[nu(Na,ko[Gs].geometry,!0)]=Gs,ko[gu].geometry=null}else Ia in lo?ru(Ia,sa,Ki):sa in Ao?Ts(Ia,sa,Ki):(xs(mo),Ao[Ia]=_s-1,lo[sa]=_s-1)}else xs(mo)}return ko.filter(function(io){return io.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Lo,Ao){return Lo.sortKey-Ao.sortKey})}},Fe.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Fe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Fe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Fe.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Fe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Fe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Fe.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:p},S<o.length-1&&(p+=o[S+1].dist(o[S]));for(var P=t.segment||0;P>=0;P--)b[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:y},P>0&&(y+=o[P-1].dist(o[P]));for(var k=0;k<o.length;k++){var z=b[k];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Fe.prototype.addSymbols=function(t,o,u,p,y,b,S,P,k,z,j,H){for(var ee=t.indexArray,ne=t.layoutVertexArray,Me=t.segments.prepareSegment(4*o.length,ne,ee,this.canOverlap?b.sortKey:void 0),Oe=this.glyphOffsetArray.length,Ke=Me.vertexLength,je=this.allowVerticalPlacement&&S===Nr.vertical?Math.PI/2:0,He=b.text&&b.text.sections,tt=0;tt<o.length;tt++){var Gt=o[tt],Yt=Gt.tl,hr=Gt.tr,Rr=Gt.bl,$r=Gt.br,zn=Gt.tex,dn=Gt.pixelOffsetTL,Vn=Gt.pixelOffsetBR,mn=Gt.minFontScaleX,Li=Gt.minFontScaleY,ai=Gt.glyphOffset,Mn=Gt.isSDF,ji=Gt.sectionIndex,Ci=Me.vertexLength,ta=ai[1];ie(ne,P.x,P.y,Yt.x,ta+Yt.y,zn.x,zn.y,u,Mn,dn.x,dn.y,mn,Li),ie(ne,P.x,P.y,hr.x,ta+hr.y,zn.x+zn.w,zn.y,u,Mn,Vn.x,dn.y,mn,Li),ie(ne,P.x,P.y,Rr.x,ta+Rr.y,zn.x,zn.y+zn.h,u,Mn,dn.x,Vn.y,mn,Li),ie(ne,P.x,P.y,$r.x,ta+$r.y,zn.x+zn.w,zn.y+zn.h,u,Mn,Vn.x,Vn.y,mn,Li),Ze(t.dynamicLayoutVertexArray,P,je),ee.emplaceBack(Ci,Ci+1,Ci+2),ee.emplaceBack(Ci+1,Ci+2,Ci+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ai[0]),tt!==o.length-1&&ji===o[tt+1].sectionIndex||t.programConfigurations.populatePaintArrays(ne.length,b,b.index,{},H,He&&He[ji])}t.placedSymbolArray.emplaceBack(P.x,P.y,Oe,this.glyphOffsetArray.length-Oe,Ke,k,z,P.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,j)},Fe.prototype._addCollisionDebugVertex=function(t,o,u,p,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,y,Math.round(b.x),Math.round(b.y))},Fe.prototype.addCollisionDebugVertices=function(t,o,u,p,y,b,S){var P=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),k=P.vertexLength,z=y.layoutVertexArray,j=y.collisionVertexArray,H=S.anchorX,ee=S.anchorY;this._addCollisionDebugVertex(z,j,b,H,ee,new ue(t,o)),this._addCollisionDebugVertex(z,j,b,H,ee,new ue(u,o)),this._addCollisionDebugVertex(z,j,b,H,ee,new ue(u,p)),this._addCollisionDebugVertex(z,j,b,H,ee,new ue(t,p)),P.vertexLength+=4;var ne=y.indexArray;ne.emplaceBack(k,k+1),ne.emplaceBack(k+1,k+2),ne.emplaceBack(k+2,k+3),ne.emplaceBack(k+3,k),P.primitiveLength+=4},Fe.prototype.addDebugCollisionBoxes=function(t,o,u,p){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},Fe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $e(wl,gp.members,vc),this.iconCollisionBox=new $e(wl,gp.members,vc);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Fe.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,p,y,b,S,P,k){for(var z={},j=o;j<u;j++){var H=t.get(j);z.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},z.textFeatureIndex=H.featureIndex;break}for(var ee=p;ee<y;ee++){var ne=t.get(ee);z.verticalTextBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},z.verticalTextFeatureIndex=ne.featureIndex;break}for(var Me=b;Me<S;Me++){var Oe=t.get(Me);z.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},z.iconFeatureIndex=Oe.featureIndex;break}for(var Ke=P;Ke<k;Ke++){var je=t.get(Ke);z.verticalIconBox={x1:je.x1,y1:je.y1,x2:je.x2,y2:je.y2,anchorPointX:je.anchorPointX,anchorPointY:je.anchorPointY},z.verticalIconFeatureIndex=je.featureIndex;break}return z},Fe.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Fe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Fe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Fe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Fe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Fe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Fe.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},Fe.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),p=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var P=this.symbolInstances.get(S);p.push(0|Math.round(o*P.anchorX+u*P.anchorY)),y.push(P.featureIndex)}return b.sort(function(k,z){return p[k]-p[z]||y[z]-y[k]}),b},Fe.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Fe.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var y=this.symbolInstances.get(p[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,P){b>=0&&P.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},vn("SymbolBucket",Fe,{omit:["layers","collisionBoxArray","features","compareText"]}),Fe.MAX_GLYPHS=65535,Fe.addDynamicAttributes=Ze;var st=new Ko({"symbol-placement":new On(he.layout_symbol["symbol-placement"]),"symbol-spacing":new On(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cn(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new On(he.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cn(he.layout_symbol["icon-size"]),"icon-text-fit":new On(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cn(he.layout_symbol["icon-image"]),"icon-rotate":new Cn(he.layout_symbol["icon-rotate"]),"icon-padding":new On(he.layout_symbol["icon-padding"]),"icon-keep-upright":new On(he.layout_symbol["icon-keep-upright"]),"icon-offset":new Cn(he.layout_symbol["icon-offset"]),"icon-anchor":new Cn(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(he.layout_symbol["text-rotation-alignment"]),"text-field":new Cn(he.layout_symbol["text-field"]),"text-font":new Cn(he.layout_symbol["text-font"]),"text-size":new Cn(he.layout_symbol["text-size"]),"text-max-width":new Cn(he.layout_symbol["text-max-width"]),"text-line-height":new On(he.layout_symbol["text-line-height"]),"text-letter-spacing":new Cn(he.layout_symbol["text-letter-spacing"]),"text-justify":new Cn(he.layout_symbol["text-justify"]),"text-radial-offset":new Cn(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(he.layout_symbol["text-variable-anchor"]),"text-anchor":new Cn(he.layout_symbol["text-anchor"]),"text-max-angle":new On(he.layout_symbol["text-max-angle"]),"text-writing-mode":new On(he.layout_symbol["text-writing-mode"]),"text-rotate":new Cn(he.layout_symbol["text-rotate"]),"text-padding":new On(he.layout_symbol["text-padding"]),"text-keep-upright":new On(he.layout_symbol["text-keep-upright"]),"text-transform":new Cn(he.layout_symbol["text-transform"]),"text-offset":new Cn(he.layout_symbol["text-offset"]),"text-allow-overlap":new On(he.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(he.layout_symbol["text-ignore-placement"]),"text-optional":new On(he.layout_symbol["text-optional"])}),_e={paint:new Ko({"icon-opacity":new Cn(he.paint_symbol["icon-opacity"]),"icon-color":new Cn(he.paint_symbol["icon-color"]),"icon-halo-color":new Cn(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cn(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cn(he.paint_symbol["icon-halo-blur"]),"icon-translate":new On(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new Cn(he.paint_symbol["text-opacity"]),"text-color":new Cn(he.paint_symbol["text-color"],{runtimeType:Hr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Cn(he.paint_symbol["text-halo-color"]),"text-halo-width":new Cn(he.paint_symbol["text-halo-width"]),"text-halo-blur":new Cn(he.paint_symbol["text-halo-blur"]),"text-translate":new On(he.paint_symbol["text-translate"]),"text-translate-anchor":new On(he.paint_symbol["text-translate-anchor"])}),layout:st},Ve=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ln,this.defaultValue=t};Ve.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ve.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ve.prototype.outputDefined=function(){return!1},Ve.prototype.serialize=function(){return null},vn("FormatSectionOverride",Ve,{omit:["defaultValue"]});var Ce=function(t){function o(u){t.call(this,u,_e)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(t.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,P=y;S<P.length;S+=1){var k=P[S];b.indexOf(k)<0&&b.push(k)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,y,b){var S=this.layout.get(u).evaluate(p,{},y,b),P=this._unevaluatedLayout._values[u];return P.isDataDriven()||Bo(P.value)||!S?S:function(k,z){return z.replace(/{([^{}]+)}/g,function(j,H){return H in k?String(k[H]):""})}(p.properties,S)},o.prototype.createBucket=function(u){return new Fe(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=_e.paint.overridableProperties;u<p.length;u+=1){var y=p[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),P=new Ve(S),k=new El(P,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Ju("source",k):new No("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new ps(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var y=u.get("text-field"),b=_e.paint.properties[p],S=!1,P=function(j){for(var H=0,ee=j;H<ee.length;H+=1)if(b.overrides&&b.overrides.hasOverride(ee[H]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof Sa)P(y.value.value.sections);else if(y.value.kind==="source"){var k=function(j){S||(j instanceof fo&&Ji(j.value)===$i?P(j.value.sections):j instanceof Ho?P(j.sections):j.eachChild(k))},z=y.value;z._styleExpression&&k(z._styleExpression.expression)}return S},o}(ba),vt={paint:new Ko({"background-color":new On(he.paint_background["background-color"]),"background-pattern":new ds(he.paint_background["background-pattern"]),"background-opacity":new On(he.paint_background["background-opacity"])})},Tt=function(t){function o(u){t.call(this,u,vt)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(ba),dr={paint:new Ko({"raster-opacity":new On(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new On(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(he.paint_raster["raster-brightness-max"]),"raster-saturation":new On(he.paint_raster["raster-saturation"]),"raster-contrast":new On(he.paint_raster["raster-contrast"]),"raster-resampling":new On(he.paint_raster["raster-resampling"]),"raster-fade-duration":new On(he.paint_raster["raster-fade-duration"])})},zr=function(t){function o(u){t.call(this,u,dr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(ba),Br=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(ba),rn={circle:xf,heatmap:Oh,hillshade:op,fill:Tf,"fill-extrusion":Fl,line:mp,symbol:Ce,background:Tt,raster:zr},Fr=se.HTMLImageElement,En=se.HTMLCanvasElement,cn=se.HTMLVideoElement,bn=se.ImageData,yn=se.ImageBitmap,pn=function(t,o,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,p)};pn.prototype.update=function(t,o,u){var p=t.width,y=t.height,b=!(this.size&&this.size[0]===p&&this.size[1]===y||u),S=this.context,P=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[p,y],t instanceof Fr||t instanceof En||t instanceof cn||t instanceof bn||yn&&t instanceof yn?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,t):P.texImage2D(P.TEXTURE_2D,0,this.format,p,y,0,this.format,P.UNSIGNED_BYTE,t.data);else{var k=u||{x:0,y:0},z=k.x,j=k.y;t instanceof Fr||t instanceof En||t instanceof cn||t instanceof bn||yn&&t instanceof yn?P.texSubImage2D(P.TEXTURE_2D,0,z,j,P.RGBA,P.UNSIGNED_BYTE,t):P.texSubImage2D(P.TEXTURE_2D,0,z,j,p,y,P.RGBA,P.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},pn.prototype.bind=function(t,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},pn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},pn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var $n=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};$n.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},$n.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ma=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},er(["receive","process"],this),this.invoker=new $n(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=kr()?t:se};function Jo(t,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[t*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}ma.prototype.send=function(t,o,u,p,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var P=qe(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:bu(o,P)},P),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:p,sourceMapId:b.mapId})}}},ma.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else kr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},ma.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},ma.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(o.error?p(Ns(o.error)):p(null,Ns(o.data)))}else{var y=!1,b=qe(this.globalScope)?void 0:[],S=o.hasCallback?function(j,H){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:j?bu(j):null,data:bu(H,b)},b)}:function(j){y=!0},P=null,k=Ns(o.data);if(this.parent[o.type])P=this.parent[o.type](o.sourceMapId,k,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");P=this.parent.getWorkerSource(o.sourceMapId,z[0],k.source)[z[1]](k,S)}else S(new Error("Could not find function "+o.type));!y&&P&&P.cancel&&(this.cancelCallbacks[t]=P.cancel)}},ma.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Da=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Da.prototype.setNorthEast=function(t){return this._ne=t instanceof fa?new fa(t.lng,t.lat):fa.convert(t),this},Da.prototype.setSouthWest=function(t){return this._sw=t instanceof fa?new fa(t.lng,t.lat):fa.convert(t),this},Da.prototype.extend=function(t){var o,u,p=this._sw,y=this._ne;if(t instanceof fa)o=t,u=t;else{if(!(t instanceof Da))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Da.convert(t)):this.extend(fa.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return p||y?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new fa(o.lng,o.lat),this._ne=new fa(u.lng,u.lat)),this},Da.prototype.getCenter=function(){return new fa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Da.prototype.getSouthWest=function(){return this._sw},Da.prototype.getNorthEast=function(){return this._ne},Da.prototype.getNorthWest=function(){return new fa(this.getWest(),this.getNorth())},Da.prototype.getSouthEast=function(){return new fa(this.getEast(),this.getSouth())},Da.prototype.getWest=function(){return this._sw.lng},Da.prototype.getSouth=function(){return this._sw.lat},Da.prototype.getEast=function(){return this._ne.lng},Da.prototype.getNorth=function(){return this._ne.lat},Da.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Da.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Da.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Da.prototype.contains=function(t){var o=fa.convert(t),u=o.lng,p=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y},Da.convert=function(t){return!t||t instanceof Da?t:new Da(t)};var fa=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};fa.prototype.wrap=function(){return new fa(ur(this.lng,-180,180),this.lat)},fa.prototype.toArray=function(){return[this.lng,this.lat]},fa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},fa.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,p=t.lat*o,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},fa.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Da(new fa(this.lng-u,this.lat-o),new fa(this.lng+u,this.lat+o))},fa.convert=function(t){if(t instanceof fa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new fa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new fa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var fl=2*Math.PI*63710088e-1;function Rs(t){return fl*Math.cos(t*Math.PI/180)}function hl(t){return(180+t)/360}function Tu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function _p(t,o){return t/Rs(o)}function Mu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Ec=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};Ec.fromLngLat=function(t,o){o===void 0&&(o=0);var u=fa.convert(t);return new Ec(hl(u.lng),Tu(u.lat),_p(o,u.lat))},Ec.prototype.toLngLat=function(){return new fa(360*this.x-180,Mu(this.y))},Ec.prototype.toAltitude=function(){return this.z*Rs(Mu(this.y))},Ec.prototype.meterInMercatorCoordinateUnits=function(){return 1/fl*(t=Mu(this.y),1/Math.cos(t*Math.PI/180));var t};var ah=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=xp(0,t,t,o,u)};ah.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},ah.prototype.url=function(t,o){var u,p,y,b,S,P=(p=this.y,y=this.z,b=Jo(256*(u=this.x),256*(p=Math.pow(2,y)-p-1),y),S=Jo(256*(u+1),256*(p+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),k=function(z,j,H){for(var ee,ne="",Me=z;Me>0;Me--)ne+=(j&(ee=1<<Me-1)?1:0)+(H&ee?2:0);return ne}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",P)},ah.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new ue(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},ah.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Zd=function(t,o){this.wrap=t,this.canonical=o,this.key=xp(t,o.z,o.z,o.x,o.y)},es=function(t,o,u,p,y){this.overscaledZ=t,this.wrap=o,this.canonical=new ah(u,+p,+y),this.key=xp(o,t,u,p,y)};function xp(t,o,u,p,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+p).toString(36)+u.toString(36)+o.toString(36)}es.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},es.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new es(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new es(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},es.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?xp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):xp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},es.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},es.prototype.children=function(t){if(this.overscaledZ>=t)return[new es(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new es(o,this.wrap,o,u,p),new es(o,this.wrap,o,u+1,p),new es(o,this.wrap,o,u,p+1),new es(o,this.wrap,o,u+1,p+1)]},es.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},es.prototype.wrapped=function(){return new es(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},es.prototype.unwrapTo=function(t){return new es(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},es.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},es.prototype.toUnwrapped=function(){return new Zd(this.wrap,this.canonical)},es.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},es.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Ec(t.x-this.wrap,t.y))},vn("CanonicalTileID",ah),vn("OverscaledTileID",es,{omit:["posMatrix"]});var Kc=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return et('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Kc.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},Kc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Kc.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Kc.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Kc.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Kc.prototype.getPixels=function(){return new bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Kc.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var P=-o*this.dim,k=-u*this.dim,z=b;z<S;z++)for(var j=p;j<y;j++)this.data[this._idx(j,z)]=t.data[this._idx(j+P,z+k)]},vn("DEMData",Kc);var Uh=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Uh.prototype.encode=function(t){return this._stringToNumber[t]},Uh.prototype.decode=function(t){return this._numberToString[t]};var id=function(t,o,u,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=p,this.properties=t.properties,this.id=y},jd={geometry:{configurable:!0}};jd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},jd.geometry.set=function(t){this._geometry=t},id.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(id.prototype,jd);var oh=function(){this.state={},this.stateChanges={},this.deletedStates={}};oh.prototype.updateState=function(t,o,u){var p=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},Pt(this.stateChanges[t][p],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==p&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var b in this.deletedStates[t][p]={},this.state[t][p])u[b]||(this.deletedStates[t][p][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][S]===null&&delete this.deletedStates[t][p][S]},oh.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var p=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},oh.prototype.getState=function(t,o){var u=String(o),p=Pt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete p[b]}return p},oh.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},oh.prototype.coalesceChanges=function(t,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var y={};for(var b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Pt(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var P={};if(this.deletedStates[S]===null)for(var k in this.state[S])P[k]={},this.state[S][k]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var j=0,H=Object.keys(this.deletedStates[S][z]);j<H.length;j+=1)delete this.state[S][z][H[j]];P[z]=this.state[S][z]}u[S]=u[S]||{},Pt(u[S],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ee in t)t[ee].setFeatureState(u,o)};var Sc=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new rl(8192,16,0),this.grid3D=new rl(8192,16,0),this.featureIndexArray=new Y,this.promoteId=o};function Ov(t,o,u,p,y){return Qt(t,function(b,S){var P=o instanceof js?o.get(S):null;return P&&P.evaluate?P.evaluate(u,p,y):P})}function Vd(t){for(var o=1/0,u=1/0,p=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var P=S[b];o=Math.min(o,P.x),u=Math.min(u,P.y),p=Math.max(p,P.x),y=Math.max(y,P.y)}return{minX:o,minY:u,maxX:p,maxY:y}}function Rv(t,o){return o-t}Sc.prototype.insert=function(t,o,u,p,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);for(var P=b?this.grid3D:this.grid,k=0;k<o.length;k++){for(var z=o[k],j=[1/0,1/0,-1/0,-1/0],H=0;H<z.length;H++){var ee=z[H];j[0]=Math.min(j[0],ee.x),j[1]=Math.min(j[1],ee.y),j[2]=Math.max(j[2],ee.x),j[3]=Math.max(j[3],ee.y)}j[0]<8192&&j[1]<8192&&j[2]>=0&&j[3]>=0&&P.insert(S,j[0],j[1],j[2],j[3])}},Sc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new mu.VectorTile(new ih(this.rawTileData)).layers,this.sourceLayerCoder=new Uh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Sc.prototype.query=function(t,o,u,p){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,P=zc(b.filter),k=t.queryGeometry,z=t.queryPadding*S,j=Vd(k),H=this.grid.query(j.minX-z,j.minY-z,j.maxX+z,j.maxY+z),ee=Vd(t.cameraQueryGeometry),ne=this.grid3D.query(ee.minX-z,ee.minY-z,ee.maxX+z,ee.maxY+z,function(Gt,Yt,hr,Rr){return function($r,zn,dn,Vn,mn){for(var Li=0,ai=$r;Li<ai.length;Li+=1){var Mn=ai[Li];if(zn<=Mn.x&&dn<=Mn.y&&Vn>=Mn.x&&mn>=Mn.y)return!0}var ji=[new ue(zn,dn),new ue(zn,mn),new ue(Vn,mn),new ue(Vn,dn)];if($r.length>2){for(var Ci=0,ta=ji;Ci<ta.length;Ci+=1)if($s($r,ta[Ci]))return!0}for(var Gn=0;Gn<$r.length-1;Gn++)if(Il($r[Gn],$r[Gn+1],ji))return!0;return!1}(t.cameraQueryGeometry,Gt-z,Yt-z,hr+z,Rr+z)}),Me=0,Oe=ne;Me<Oe.length;Me+=1)H.push(Oe[Me]);H.sort(Rv);for(var Ke,je={},He=function(Gt){var Yt=H[Gt];if(Yt!==Ke){Ke=Yt;var hr=y.featureIndexArray.get(Yt),Rr=null;y.loadMatchingFeature(je,hr.bucketIndex,hr.sourceLayerIndex,hr.featureIndex,P,b.layers,b.availableImages,o,u,p,function($r,zn,dn){return Rr||(Rr=Va($r)),zn.queryIntersectsFeature(k,$r,dn,Rr,y.z,t.transform,S,t.pixelPosMatrix)})}},tt=0;tt<H.length;tt++)He(tt);return je},Sc.prototype.loadMatchingFeature=function(t,o,u,p,y,b,S,P,k,z,j){var H=this.bucketLayerIDs[o];if(!b||function($r,zn){for(var dn=0;dn<$r.length;dn++)if(zn.indexOf($r[dn])>=0)return!0;return!1}(b,H)){var ee=this.sourceLayerCoder.decode(u),ne=this.vtLayers[ee].feature(p);if(y.needGeometry){var Me=to(ne,!0);if(!y.filter(new Ii(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!y.filter(new Ii(this.tileID.overscaledZ),ne))return;for(var Oe=this.getId(ne,ee),Ke=0;Ke<H.length;Ke++){var je=H[Ke];if(!(b&&b.indexOf(je)<0)){var He=P[je];if(He){var tt={};Oe!==void 0&&z&&(tt=z.getState(He.sourceLayer||"_geojsonTileLayer",Oe));var Gt=Pt({},k[je]);Gt.paint=Ov(Gt.paint,He.paint,ne,tt,S),Gt.layout=Ov(Gt.layout,He.layout,ne,tt,S);var Yt=!j||j(ne,He,tt);if(Yt){var hr=new id(ne,this.z,this.x,this.y,Oe);hr.layer=Gt;var Rr=t[je];Rr===void 0&&(Rr=t[je]=[]),Rr.push({featureIndex:p,feature:hr,intersectionZ:Yt})}}}}}},Sc.prototype.lookupSymbolFeatures=function(t,o,u,p,y,b,S,P){var k={};this.loadVTLayers();for(var z=zc(y),j=0,H=t;j<H.length;j+=1)this.loadMatchingFeature(k,u,p,H[j],z,b,S,P,o);return k},Sc.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,y=u[o];p<y.length;p+=1)if(t===y[p])return!0;return!1},Sc.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},vn("FeatureIndex",Sc,{omit:["rawTileData","sourceLayerCoder"]});var ys=function(t,o){this.tileID=t,this.uid=kt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ys.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<Hi.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},ys.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ys.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,j){var H={};if(!j)return H;for(var ee=function(){var Oe=Me[ne],Ke=Oe.layerIds.map(function(tt){return j.getLayer(tt)}).filter(Boolean);if(Ke.length!==0){Oe.layers=Ke,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(tt){return Ke.filter(function(Gt){return Gt.id===tt})[0]}));for(var je=0,He=Ke;je<He.length;je+=1)H[He[je].id]=Oe}},ne=0,Me=z;ne<Me.length;ne+=1)ee();return H}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[p];if(y instanceof Fe){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof Fe&&S.hasRTLText){this.hasRTLText=!0,Os.isLoading()||Os.isLoaded()||Mh()!=="deferred"||qs();break}}for(var P in this.queryPadding=0,this.buckets){var k=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(P).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h},ys.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ys.prototype.getBucket=function(t){return this.buckets[t.id]},ys.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pn(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pn(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},ys.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ys.prototype.queryRenderedFeatures=function(t,o,u,p,y,b,S,P,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:P,params:S,queryPadding:this.queryPadding*k},t,o,u):{}},ys.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),y=o?o.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(b)for(var S=zc(o&&o.filter),P=this.tileID.canonical,k=P.z,z=P.x,j=P.y,H={z:k,x:z,y:j},ee=0;ee<b.length;ee++){var ne=b.feature(ee);if(S.needGeometry){var Me=to(ne,!0);if(!S.filter(new Ii(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new Ii(this.tileID.overscaledZ),ne))continue;var Oe=u.getId(ne,y),Ke=new id(ne,k,z,j,Oe);Ke.tile=H,t.push(Ke)}}},ys.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ys.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ys.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=en(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ys.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ys.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],P=t[b];if(S&&P&&Object.keys(P).length!==0){y.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=o&&o.style&&o.style.getLayer(p);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}}},ys.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ys.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Hi.now()},ys.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ys.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Hi.now()+t},ys.prototype.setDependencies=function(t,o){for(var u={},p=0,y=o;p<y.length;p+=1)u[y[p]]=!0;this.dependencies[t]=u},ys.prototype.hasDependency=function(t,o){for(var u=0,p=t;u<p.length;u+=1){var y=this.dependencies[p[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var Rf=se.performance,Gd=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Rf.mark(this._marks.start)};Gd.prototype.finish=function(){Rf.mark(this._marks.end);var t=Rf.getEntriesByName(this._marks.measure);return t.length===0&&(Rf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Rf.getEntriesByName(this._marks.measure),Rf.clearMarks(this._marks.start),Rf.clearMarks(this._marks.end),Rf.clearMeasures(this._marks.measure)),t},g.Actor=ma,g.AlphaImage=hu,g.CanonicalTileID=ah,g.CollisionBoxArray=h,g.Color=zi,g.DEMData=Kc,g.DataConstantProperty=On,g.DictionaryCoder=Uh,g.EXTENT=8192,g.ErrorEvent=Ge,g.EvaluationParameters=Ii,g.Event=Pe,g.Evented=ot,g.FeatureIndex=Sc,g.FillBucket=eu,g.FillExtrusionBucket=cl,g.ImageAtlas=xr,g.ImagePosition=ht,g.LineBucket=va,g.LngLat=fa,g.LngLatBounds=Da,g.MercatorCoordinate=Ec,g.ONE_EM=24,g.OverscaledTileID=es,g.Point=ue,g.Point$1=ue,g.Properties=Ko,g.Protobuf=ih,g.RGBAImage=bo,g.RequestManager=Ri,g.RequestPerformance=Gd,g.ResourceType=nn,g.SegmentVector=fe,g.SourceFeatureState=oh,g.StructArrayLayout1ui2=Ih,g.StructArrayLayout2f1f2i16=Tl,g.StructArrayLayout2i4=al,g.StructArrayLayout3ui6=Ml,g.StructArrayLayout4i8=Ks,g.SymbolBucket=Fe,g.Texture=pn,g.Tile=ys,g.Transitionable=oo,g.Uniform1f=Dr,g.Uniform1i=mr,g.Uniform2f=sr,g.Uniform3f=Qr,g.Uniform4f=Rn,g.UniformColor=kn,g.UniformMatrix4f=Ai,g.UnwrappedTileID=Zd,g.ValidationError=De,g.WritingMode=Nr,g.ZoomHistory=Wf,g.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},g.addDynamicAttributes=Ze,g.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var p=t.length,y=new Array(t.length),b=null;t.forEach(function(S,P){o(S,function(k,z){k&&(b=k),y[P]=z,--p==0&&u(b,y)})})},g.bezier=Le,g.bindAll=er,g.browser=Hi,g.cacheEntryPossiblyAdded=function(t){++li>wr&&(t.getActor().send("enforceCacheSizeLimit",or),li=0)},g.clamp=Ht,g.clearTileCache=function(t){var o=se.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},g.clipLine=vo,g.clone=function(t){var o=new ea(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},g.clone$1=rt,g.clone$2=function(t){var o=new ea(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},g.collisionCircleLayout=zd,g.config=Zn,g.create=function(){var t=new ea(16);return ea!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},g.create$1=function(){var t=new ea(9);return ea!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},g.create$2=function(){var t=new ea(4);return ea!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},g.createCommonjsModule=ve,g.createExpression=Ou,g.createLayout=ka,g.createStyleLayer=function(t){return t.type==="custom"?new Br(t):new rn[t.type](t)},g.cross=function(t,o,u){var p=o[0],y=o[1],b=o[2],S=u[0],P=u[1],k=u[2];return t[0]=y*k-b*P,t[1]=b*S-p*k,t[2]=p*P-y*S,t},g.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!t(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},g.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},g.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},g.ease=ut,g.emitValidationErrors=cc,g.endsWith=q,g.enforceCacheSizeLimit=function(t){I(),Wi&&Wi.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-t;p++)o.delete(u[p])})})},g.evaluateSizeForFeature=Jn,g.evaluateSizeForZoom=fi,g.evaluateVariableOffset=zl,g.evented=Yf,g.extend=Pt,g.featureFilter=zc,g.filterObject=xt,g.fromRotation=function(t,o){var u=Math.sin(o),p=Math.cos(o);return t[0]=p,t[1]=u,t[2]=0,t[3]=-u,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},g.getAnchorAlignment=Jr,g.getAnchorJustification=we,g.getArrayBuffer=wa,g.getImage=$,g.getJSON=function(t,o){return ha(Pt(t,{type:"json"}),o)},g.getRTLTextPluginStatus=Mh,g.getReferrer=Ti,g.getVideo=function(t,o){var u,p,y=se.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=se.document.createElement("source");u=t[b],p=void 0,(p=se.document.createElement("a")).href=u,(p.protocol!==se.document.location.protocol||p.host!==se.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},g.identity=Uo,g.invert=function(t,o){var u=o[0],p=o[1],y=o[2],b=o[3],S=o[4],P=o[5],k=o[6],z=o[7],j=o[8],H=o[9],ee=o[10],ne=o[11],Me=o[12],Oe=o[13],Ke=o[14],je=o[15],He=u*P-p*S,tt=u*k-y*S,Gt=u*z-b*S,Yt=p*k-y*P,hr=p*z-b*P,Rr=y*z-b*k,$r=j*Oe-H*Me,zn=j*Ke-ee*Me,dn=j*je-ne*Me,Vn=H*Ke-ee*Oe,mn=H*je-ne*Oe,Li=ee*je-ne*Ke,ai=He*Li-tt*mn+Gt*Vn+Yt*dn-hr*zn+Rr*$r;return ai?(t[0]=(P*Li-k*mn+z*Vn)*(ai=1/ai),t[1]=(y*mn-p*Li-b*Vn)*ai,t[2]=(Oe*Rr-Ke*hr+je*Yt)*ai,t[3]=(ee*hr-H*Rr-ne*Yt)*ai,t[4]=(k*dn-S*Li-z*zn)*ai,t[5]=(u*Li-y*dn+b*zn)*ai,t[6]=(Ke*Gt-Me*Rr-je*tt)*ai,t[7]=(j*Rr-ee*Gt+ne*tt)*ai,t[8]=(S*mn-P*dn+z*$r)*ai,t[9]=(p*dn-u*mn-b*$r)*ai,t[10]=(Me*hr-Oe*Gt+je*He)*ai,t[11]=(H*Gt-j*hr-ne*He)*ai,t[12]=(P*zn-S*Vn-k*$r)*ai,t[13]=(u*Vn-p*zn+y*$r)*ai,t[14]=(Oe*tt-Me*Yt-Ke*He)*ai,t[15]=(j*Yt-H*tt+ee*He)*ai,t):null},g.isChar=qr,g.isMapboxURL=bi,g.keysDifference=function(t,o){var u=[];for(var p in t)p in o||u.push(p);return u},g.makeRequest=ha,g.mapObject=Qt,g.mercatorXfromLng=hl,g.mercatorYfromLat=Tu,g.mercatorZfromAltitude=_p,g.mul=gc,g.multiply=ms,g.mvt=mu,g.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},g.normalize=function(t,o){var u=o[0],p=o[1],y=o[2],b=u*u+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},g.number=ia,g.offscreenCanvasSupported=Wn,g.ortho=function(t,o,u,p,y,b,S){var P=1/(o-u),k=1/(p-y),z=1/(b-S);return t[0]=-2*P,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*P,t[13]=(y+p)*k,t[14]=(S+b)*z,t[15]=1,t},g.parseGlyphPBF=function(t){return new ih(t).readFields(Ir,[])},g.pbf=ih,g.performSymbolLayout=function(t,o,u,p,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var P=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var j=t.textSizeData,H=j.maxZoom;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Ii(j.minZoom),S),k["text-size"].possiblyEvaluate(new Ii(H),S)]}if(t.iconSizeData.kind==="composite"){var ee=t.iconSizeData,ne=ee.maxZoom;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Ii(ee.minZoom),S),k["icon-size"].possiblyEvaluate(new Ii(ne),S)]}z.layoutTextSize=k["text-size"].possiblyEvaluate(new Ii(t.zoom+1),S),z.layoutIconSize=k["icon-size"].possiblyEvaluate(new Ii(t.zoom+1),S),z.textMaxSize=k["text-size"].possiblyEvaluate(new Ii(18));for(var Me=24*P.get("text-line-height"),Oe=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Ke=P.get("text-keep-upright"),je=P.get("text-size"),He=function(){var Yt=Gt[tt],hr=P.get("text-font").evaluate(Yt,{},S).join(","),Rr=je.evaluate(Yt,{},S),$r=z.layoutTextSize.evaluate(Yt,{},S),zn=z.layoutIconSize.evaluate(Yt,{},S),dn={horizontal:{},vertical:void 0},Vn=Yt.text,mn=[0,0];if(Vn){var Li=Vn.toString(),ai=24*P.get("text-letter-spacing").evaluate(Yt,{},S),Mn=function(Ki){for(var Na=0,Ia=Ki;Na<Ia.length;Na+=1)if(sa=Ia[Na].charCodeAt(0),qr.Arabic(sa)||qr["Arabic Supplement"](sa)||qr["Arabic Extended-A"](sa)||qr["Arabic Presentation Forms-A"](sa)||qr["Arabic Presentation Forms-B"](sa))return!1;var sa;return!0}(Li)?ai:0,ji=P.get("text-anchor").evaluate(Yt,{},S),Ci=P.get("text-variable-anchor");if(!Ci){var ta=P.get("text-radial-offset").evaluate(Yt,{},S);mn=ta?zl(ji,[24*ta,Co]):P.get("text-offset").evaluate(Yt,{},S).map(function(Ki){return 24*Ki})}var Gn=Oe?"center":P.get("text-justify").evaluate(Yt,{},S),ga=P.get("symbol-placement"),uo=ga==="point"?24*P.get("text-max-width").evaluate(Yt,{},S):0,Lo=function(){t.allowVerticalPlacement&&df(Li)&&(dn.vertical=Kr(Vn,o,u,y,hr,uo,Me,ji,"left",Mn,mn,Nr.vertical,!0,ga,$r,Rr))};if(!Oe&&Ci){for(var Ao=Gn==="auto"?Ci.map(function(Ki){return we(Ki)}):[Gn],lo=!1,ko=0;ko<Ao.length;ko++){var _s=Ao[ko];if(!dn.horizontal[_s])if(lo)dn.horizontal[_s]=dn.horizontal[0];else{var xs=Kr(Vn,o,u,y,hr,uo,Me,"center",_s,Mn,mn,Nr.horizontal,!1,ga,$r,Rr);xs&&(dn.horizontal[_s]=xs,lo=xs.positionedLines.length===1)}}Lo()}else{Gn==="auto"&&(Gn=we(ji));var ru=Kr(Vn,o,u,y,hr,uo,Me,ji,Gn,Mn,mn,Nr.horizontal,!1,ga,$r,Rr);ru&&(dn.horizontal[Gn]=ru),Lo(),df(Li)&&Oe&&Ke&&(dn.vertical=Kr(Vn,o,u,y,hr,uo,Me,ji,Gn,Mn,mn,Nr.vertical,!1,ga,$r,Rr))}}var Ts=void 0,nu=!1;if(Yt.icon&&Yt.icon.name){var mo=p[Yt.icon.name];mo&&(Ts=function(Ki,Na,Ia){var sa=Jr(Ia),gu=Na[0]-Ki.displaySize[0]*sa.horizontalAlign,Gs=Na[1]-Ki.displaySize[1]*sa.verticalAlign;return{image:Ki,top:Gs,bottom:Gs+Ki.displaySize[1],left:gu,right:gu+Ki.displaySize[0]}}(y[Yt.icon.name],P.get("icon-offset").evaluate(Yt,{},S),P.get("icon-anchor").evaluate(Yt,{},S)),nu=mo.sdf,t.sdfIcons===void 0?t.sdfIcons=mo.sdf:t.sdfIcons!==mo.sdf&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(mo.pixelRatio!==t.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var Ms=At(dn.horizontal)||dn.vertical;t.iconsInText=!!Ms&&Ms.iconsInText,(Ms||Ts)&&function(Ki,Na,Ia,sa,gu,Gs,io,ts,Hs,ya,$c){var pl=Gs.textMaxSize.evaluate(Na,{});pl===void 0&&(pl=io);var Ul,Do=Ki.layers[0].layout,Jl=Do.get("icon-offset").evaluate(Na,{},$c),dl=At(Ia.horizontal),vl=io/24,ml=Ki.tilePixelRatio*vl,sh=Ki.tilePixelRatio*pl/24,Cc=Ki.tilePixelRatio*ts,uh=Ki.tilePixelRatio*Do.get("symbol-spacing"),Zh=Do.get("text-padding")*Ki.tilePixelRatio,lh=Do.get("icon-padding")*Ki.tilePixelRatio,bp=Do.get("text-max-angle")/180*Math.PI,ad=Do.get("text-rotation-alignment")==="map"&&Do.get("symbol-placement")!=="point",od=Do.get("icon-rotation-alignment")==="map"&&Do.get("symbol-placement")!=="point",gl=Do.get("symbol-placement"),bs=uh/2,ch=Do.get("icon-text-fit");sa&&ch!=="none"&&(Ki.allowVerticalPlacement&&Ia.vertical&&(Ul=ii(sa,Ia.vertical,ch,Do.get("icon-text-fit-padding"),Jl,vl)),dl&&(sa=ii(sa,dl,ch,Do.get("icon-text-fit-padding"),Jl,vl)));var Qc=function(Lv,Hh){Hh.x<0||Hh.x>=8192||Hh.y<0||Hh.y>=8192||function(wo,Uu,k0,Df,hd,Wd,Pp,ec,Ip,Jc,Op,Rp,pd,kv,Lp,Xd,Dv,dh,Fv,Ac,Zu,dd,Bv,ju,Nv){var Yd,Ff,Bf,vh,mh,ef=wo.addToLineVertexArray(Uu,k0),D0=0,zv=0,Uv=0,qd=0,Kd=-1,vd=-1,wc={},$d=Ae(""),md=0,gd=0;if(ec._unevaluatedLayout.getValue("text-radial-offset")===void 0?(md=(Yd=ec.layout.get("text-offset").evaluate(Zu,{},ju).map(function(Xh){return 24*Xh}))[0],gd=Yd[1]):(md=24*ec.layout.get("text-radial-offset").evaluate(Zu,{},ju),gd=Co),wo.allowVerticalPlacement&&Df.vertical){var Qd=ec.layout.get("text-rotate").evaluate(Zu,{},ju)+90;vh=new Vo(Ip,Uu,Jc,Op,Rp,Df.vertical,pd,kv,Lp,Qd),Pp&&(mh=new Vo(Ip,Uu,Jc,Op,Rp,Pp,Dv,dh,Lp,Qd))}if(hd){var yd=ec.layout.get("icon-rotate").evaluate(Zu,{}),Jd=ec.layout.get("icon-text-fit")!=="none",ev=Qo(hd,yd,Bv,Jd),_d=Pp?Qo(Pp,yd,Bv,Jd):void 0;Bf=new Vo(Ip,Uu,Jc,Op,Rp,hd,Dv,dh,!1,yd),D0=4*ev.length;var tv=wo.iconSizeData,Wh=null;tv.kind==="source"?(Wh=[128*ec.layout.get("icon-size").evaluate(Zu,{})])[0]>32640&&et(wo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):tv.kind==="composite"&&((Wh=[128*dd.compositeIconSizes[0].evaluate(Zu,{},ju),128*dd.compositeIconSizes[1].evaluate(Zu,{},ju)])[0]>32640||Wh[1]>32640)&&et(wo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),wo.addSymbols(wo.icon,ev,Wh,Ac,Fv,Zu,!1,Uu,ef.lineStartIndex,ef.lineLength,-1,ju),Kd=wo.icon.placedSymbolArray.length-1,_d&&(zv=4*_d.length,wo.addSymbols(wo.icon,_d,Wh,Ac,Fv,Zu,Nr.vertical,Uu,ef.lineStartIndex,ef.lineLength,-1,ju),vd=wo.icon.placedSymbolArray.length-1)}for(var rv in Df.horizontal){var kp=Df.horizontal[rv];if(!Ff){$d=Ae(kp.text);var Zv=ec.layout.get("text-rotate").evaluate(Zu,{},ju);Ff=new Vo(Ip,Uu,Jc,Op,Rp,kp,pd,kv,Lp,Zv)}var nv=kp.positionedLines.length===1;if(Uv+=jt(wo,Uu,kp,Wd,ec,Lp,Zu,Xd,ef,Df.vertical?Nr.horizontal:Nr.horizontalOnly,nv?Object.keys(Df.horizontal):[rv],wc,Kd,dd,ju),nv)break}Df.vertical&&(qd+=jt(wo,Uu,Df.vertical,Wd,ec,Lp,Zu,Xd,ef,Nr.vertical,["vertical"],wc,vd,dd,ju));var jv=Ff?Ff.boxStartIndex:wo.collisionBoxArray.length,iu=Ff?Ff.boxEndIndex:wo.collisionBoxArray.length,Vv=vh?vh.boxStartIndex:wo.collisionBoxArray.length,Gv=vh?vh.boxEndIndex:wo.collisionBoxArray.length,Hv=Bf?Bf.boxStartIndex:wo.collisionBoxArray.length,Wv=Bf?Bf.boxEndIndex:wo.collisionBoxArray.length,Xv=mh?mh.boxStartIndex:wo.collisionBoxArray.length,Yv=mh?mh.boxEndIndex:wo.collisionBoxArray.length,tc=-1,Dp=function(Xh,av){return Xh&&Xh.circleDiameter?Math.max(Xh.circleDiameter,av):av};tc=Dp(Ff,tc),tc=Dp(vh,tc),tc=Dp(Bf,tc);var iv=(tc=Dp(mh,tc))>-1?1:0;iv&&(tc*=Nv/24),wo.glyphOffsetArray.length>=Fe.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zu.sortKey!==void 0&&wo.addToSortKeyRanges(wo.symbolInstances.length,Zu.sortKey),wo.symbolInstances.emplaceBack(Uu.x,Uu.y,wc.right>=0?wc.right:-1,wc.center>=0?wc.center:-1,wc.left>=0?wc.left:-1,wc.vertical||-1,Kd,vd,$d,jv,iu,Vv,Gv,Hv,Wv,Xv,Yv,Jc,Uv,qd,D0,zv,iv,0,pd,md,gd,tc)}(Ki,Hh,Lv,Ia,sa,gu,Ul,Ki.layers[0],Ki.collisionBoxArray,Na.index,Na.sourceLayerIndex,Ki.index,ml,Zh,ad,Hs,Cc,lh,od,Jl,Na,Gs,ya,$c,io)};if(gl==="line")for(var fh=0,jh=vo(Na.geometry,0,0,8192,8192);fh<jh.length;fh+=1)for(var Ep=jh[fh],Sp=0,Cp=jo(Ep,uh,bp,Ia.vertical||dl,sa,24,sh,Ki.overscaling,8192);Sp<Cp.length;Sp+=1){var sd=Cp[Sp];dl&&hn(Ki,dl.text,bs,sd)||Qc(Ep,sd)}else if(gl==="line-center")for(var Ap=0,wp=Na.geometry;Ap<wp.length;Ap+=1){var Tp=wp[Ap];if(Tp.length>1){var ud=Ga(Tp,bp,Ia.vertical||dl,sa,24,sh);ud&&Qc(Tp,ud)}}else if(Na.type==="Polygon")for(var W=0,Mp=Af(Na.geometry,0);W<Mp.length;W+=1){var hh=Mp[W],Vh=ri(hh,16);Qc(hh[0],new Wr(Vh.x,Vh.y,0))}else if(Na.type==="LineString")for(var Lf=0,Gh=Na.geometry;Lf<Gh.length;Lf+=1){var ph=Gh[Lf];Qc(ph,new Wr(ph[0].x,ph[0].y,0))}else if(Na.type==="Point")for(var ld=0,kf=Na.geometry;ld<kf.length;ld+=1)for(var cd=0,Hd=kf[ld];cd<Hd.length;cd+=1){var fd=Hd[cd];Qc([fd],new Wr(fd.x,fd.y,0))}}(t,Yt,dn,Ts,p,z,$r,zn,mn,nu,S)},tt=0,Gt=t.features;tt<Gt.length;tt+=1)He();b&&t.generateCollisionDebugBuffers()},g.perspective=function(t,o,u,p,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+p)*(b=1/(p-y)),t[14]=2*y*p*b):(t[10]=-1,t[14]=-2*p),t},g.pick=function(t,o){for(var u={},p=0;p<o.length;p++){var y=o[p];y in t&&(u[y]=t[y])}return u},g.plugin=Os,g.polygonIntersectsPolygon=Fu,g.postMapLoadEvent=Vt,g.postTurnstileEvent=Ua,g.potpack=Tr,g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.register=vn,g.registerForPluginStateChange=function(t){return t({pluginStatus:Is,pluginURL:_o}),Yf.on("pluginStateChange",t),t},g.renderColorRamp=Kf,g.rotate=function(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],P=Math.sin(u),k=Math.cos(u);return t[0]=p*k+b*P,t[1]=y*k+S*P,t[2]=p*-P+b*k,t[3]=y*-P+S*k,t},g.rotateX=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],P=o[6],k=o[7],z=o[8],j=o[9],H=o[10],ee=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*p,t[5]=S*y+j*p,t[6]=P*y+H*p,t[7]=k*y+ee*p,t[8]=z*y-b*p,t[9]=j*y-S*p,t[10]=H*y-P*p,t[11]=ee*y-k*p,t},g.rotateZ=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],P=o[2],k=o[3],z=o[4],j=o[5],H=o[6],ee=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*p,t[1]=S*y+j*p,t[2]=P*y+H*p,t[3]=k*y+ee*p,t[4]=z*y-b*p,t[5]=j*y-S*p,t[6]=H*y-P*p,t[7]=ee*y-k*p,t},g.scale=function(t,o,u){var p=u[0],y=u[1],b=u[2];return t[0]=o[0]*p,t[1]=o[1]*p,t[2]=o[2]*p,t[3]=o[3]*p,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},g.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},g.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},g.setCacheLimits=function(t,o){or=t,wr=o},g.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Is==="deferred"||Is==="loading"||Is==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");_o=Hi.resolveURL(t),Is="deferred",ku=o,da(),u||qs()},g.sphericalToCartesian=function(t){var o=t[0],u=t[1],p=t[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},g.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},g.styleSpec=he,g.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},g.symbolSize=Di,g.transformMat3=function(t,o,u){var p=o[0],y=o[1],b=o[2];return t[0]=p*u[0]+y*u[3]+b*u[6],t[1]=p*u[1]+y*u[4]+b*u[7],t[2]=p*u[2]+y*u[5]+b*u[8],t},g.transformMat4=Kl,g.translate=function(t,o,u){var p,y,b,S,P,k,z,j,H,ee,ne,Me,Oe=u[0],Ke=u[1],je=u[2];return o===t?(t[12]=o[0]*Oe+o[4]*Ke+o[8]*je+o[12],t[13]=o[1]*Oe+o[5]*Ke+o[9]*je+o[13],t[14]=o[2]*Oe+o[6]*Ke+o[10]*je+o[14],t[15]=o[3]*Oe+o[7]*Ke+o[11]*je+o[15]):(y=o[1],b=o[2],S=o[3],P=o[4],k=o[5],z=o[6],j=o[7],H=o[8],ee=o[9],ne=o[10],Me=o[11],t[0]=p=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=P,t[5]=k,t[6]=z,t[7]=j,t[8]=H,t[9]=ee,t[10]=ne,t[11]=Me,t[12]=p*Oe+P*Ke+H*je+o[12],t[13]=y*Oe+k*Ke+ee*je+o[13],t[14]=b*Oe+z*Ke+ne*je+o[14],t[15]=S*Oe+j*Ke+Me*je+o[15]),t},g.triggerPluginCompletionEvent=Th,g.uniqueId=kt,g.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},g.validateLight=ip,g.validateStyle=pf,g.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},g.vectorTile=mu,g.version="1.13.2",g.warnOnce=et,g.webpSupported=Hn,g.window=se,g.wrap=ur}),ye(["./shared"],function(g){"use strict";function ve(G){var $=typeof G;if($==="number"||$==="boolean"||$==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var re="[",ge=0,Pe=G;ge<Pe.length;ge+=1)re+=ve(Pe[ge])+",";return re+"]"}for(var Ge=Object.keys(G).sort(),ot="{",he=0;he<Ge.length;he++)ot+=JSON.stringify(Ge[he])+":"+ve(G[Ge[he]])+",";return ot+"}"}function V(G){for(var $="",re=0,ge=g.refProperties;re<ge.length;re+=1)$+="/"+ve(G[ge[re]]);return $}var ce=function(G){this.keyCache={},G&&this.replace(G)};ce.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},ce.prototype.update=function(G,$){for(var re=this,ge=0,Pe=G;ge<Pe.length;ge+=1){var Ge=Pe[ge];this._layerConfigs[Ge.id]=Ge;var ot=this._layers[Ge.id]=g.createStyleLayer(Ge);ot._featureFilter=g.featureFilter(ot.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var he=0,De=$;he<De.length;he+=1){var _t=De[he];delete this.keyCache[_t],delete this._layerConfigs[_t],delete this._layers[_t]}this.familiesBySource={};for(var vr=0,Bt=function(Zr,Hr){for(var oi={},tn=0;tn<Zr.length;tn++){var Si=Hr&&Hr[Zr[tn].id]||V(Zr[tn]);Hr&&(Hr[Zr[tn].id]=Si);var $i=oi[Si];$i||($i=oi[Si]=[]),$i.push(Zr[tn])}var yi=[];for(var Mi in oi)yi.push(oi[Mi]);return yi}(g.values(this._layerConfigs),this.keyCache);vr<Bt.length;vr+=1){var Ut=Bt[vr].map(function(Zr){return re._layers[Zr.id]}),gr=Ut[0];if(gr.visibility!=="none"){var _n=gr.source||"",ln=this.familiesBySource[_n];ln||(ln=this.familiesBySource[_n]={});var Lt=gr.sourceLayer||"_geojsonTileLayer",sn=ln[Lt];sn||(sn=ln[Lt]=[]),sn.push(Ut)}}};var ue=function(G){var $={},re=[];for(var ge in G){var Pe=G[ge],Ge=$[ge]={};for(var ot in Pe){var he=Pe[+ot];if(he&&he.bitmap.width!==0&&he.bitmap.height!==0){var De={x:0,y:0,w:he.bitmap.width+2,h:he.bitmap.height+2};re.push(De),Ge[ot]={rect:De,metrics:he.metrics}}}}var _t=g.potpack(re),vr=new g.AlphaImage({width:_t.w||1,height:_t.h||1});for(var Bt in G){var Ut=G[Bt];for(var gr in Ut){var _n=Ut[+gr];if(_n&&_n.bitmap.width!==0&&_n.bitmap.height!==0){var ln=$[Bt][gr].rect;g.AlphaImage.copy(_n.bitmap,vr,{x:0,y:0},{x:ln.x+1,y:ln.y+1},_n.bitmap)}}}this.image=vr,this.positions=$};g.register("GlyphAtlas",ue);var Ne=function(G){this.tileID=new g.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function se(G,$,re){for(var ge=new g.EvaluationParameters($),Pe=0,Ge=G;Pe<Ge.length;Pe+=1)Ge[Pe].recalculate(ge,re)}function at(G,$){var re=g.getArrayBuffer(G.request,function(ge,Pe,Ge,ot){ge?$(ge):Pe&&$(null,{vectorTile:new g.vectorTile.VectorTile(new g.pbf(Pe)),rawData:Pe,cacheControl:Ge,expires:ot})});return function(){re.cancel(),$()}}Ne.prototype.parse=function(G,$,re,ge,Pe){var Ge=this;this.status="parsing",this.data=G,this.collisionBoxArray=new g.CollisionBoxArray;var ot=new g.DictionaryCoder(Object.keys(G.layers).sort()),he=new g.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];var De,_t,vr,Bt,Ut={},gr={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},_n=$.familiesBySource[this.source];for(var ln in _n){var Lt=G.layers[ln];if(Lt){Lt.version===1&&g.warnOnce('Vector tile source "'+this.source+'" layer "'+ln+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var sn=ot.encode(ln),Zr=[],Hr=0;Hr<Lt.length;Hr++){var oi=Lt.feature(Hr),tn=he.getId(oi,ln);Zr.push({feature:oi,id:tn,index:Hr,sourceLayerIndex:sn})}for(var Si=0,$i=_n[ln];Si<$i.length;Si+=1){var yi=$i[Si],Mi=yi[0];Mi.minzoom&&this.zoom<Math.floor(Mi.minzoom)||Mi.maxzoom&&this.zoom>=Mi.maxzoom||Mi.visibility!=="none"&&(se(yi,this.zoom,re),(Ut[Mi.id]=Mi.createBucket({index:he.bucketLayerIDs.length,layers:yi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:sn,sourceID:this.source})).populate(Zr,gr,this.tileID.canonical),he.bucketLayerIDs.push(yi.map(function(na){return na.id})))}}}var xi=g.mapObject(gr.glyphDependencies,function(na){return Object.keys(na).map(Number)});Object.keys(xi).length?ge.send("getGlyphs",{uid:this.uid,stacks:xi},function(na,Pi){De||(De=na,_t=Pi,Ta.call(Ge))}):_t={};var ti=Object.keys(gr.iconDependencies);ti.length?ge.send("getImages",{icons:ti,source:this.source,tileID:this.tileID,type:"icons"},function(na,Pi){De||(De=na,vr=Pi,Ta.call(Ge))}):vr={};var Vi=Object.keys(gr.patternDependencies);function Ta(){if(De)return Pe(De);if(_t&&vr&&Bt){var na=new ue(_t),Pi=new g.ImageAtlas(vr,Bt);for(var zi in Ut){var Ra=Ut[zi];Ra instanceof g.SymbolBucket?(se(Ra.layers,this.zoom,re),g.performSymbolLayout(Ra,_t,na.positions,vr,Pi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ra.hasPattern&&(Ra instanceof g.LineBucket||Ra instanceof g.FillBucket||Ra instanceof g.FillExtrusionBucket)&&(se(Ra.layers,this.zoom,re),Ra.addFeatures(gr,this.tileID.canonical,Pi.patternPositions))}this.status="done",Pe(null,{buckets:g.values(Ut).filter(function(ou){return!ou.isEmpty()}),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:na.image,imageAtlas:Pi,glyphMap:this.returnDependencies?_t:null,iconMap:this.returnDependencies?vr:null,glyphPositions:this.returnDependencies?na.positions:null})}}Vi.length?ge.send("getImages",{icons:Vi,source:this.source,tileID:this.tileID,type:"patterns"},function(na,Pi){De||(De=na,Bt=Pi,Ta.call(Ge))}):Bt={},Ta.call(this)};var Le=function(G,$,re,ge){this.actor=G,this.layerIndex=$,this.availableImages=re,this.loadVectorData=ge||at,this.loading={},this.loaded={}};Le.prototype.loadTile=function(G,$){var re=this,ge=G.uid;this.loading||(this.loading={});var Pe=!!(G&&G.request&&G.request.collectResourceTiming)&&new g.RequestPerformance(G.request),Ge=this.loading[ge]=new Ne(G);Ge.abort=this.loadVectorData(G,function(ot,he){if(delete re.loading[ge],ot||!he)return Ge.status="done",re.loaded[ge]=Ge,$(ot);var De=he.rawData,_t={};he.expires&&(_t.expires=he.expires),he.cacheControl&&(_t.cacheControl=he.cacheControl);var vr={};if(Pe){var Bt=Pe.finish();Bt&&(vr.resourceTiming=JSON.parse(JSON.stringify(Bt)))}Ge.vectorTile=he.vectorTile,Ge.parse(he.vectorTile,re.layerIndex,re.availableImages,re.actor,function(Ut,gr){if(Ut||!gr)return $(Ut);$(null,g.extend({rawTileData:De.slice(0)},gr,_t,vr))}),re.loaded=re.loaded||{},re.loaded[ge]=Ge})},Le.prototype.reloadTile=function(G,$){var re=this,ge=this.loaded,Pe=G.uid,Ge=this;if(ge&&ge[Pe]){var ot=ge[Pe];ot.showCollisionBoxes=G.showCollisionBoxes;var he=function(De,_t){var vr=ot.reloadCallback;vr&&(delete ot.reloadCallback,ot.parse(ot.vectorTile,Ge.layerIndex,re.availableImages,Ge.actor,vr)),$(De,_t)};ot.status==="parsing"?ot.reloadCallback=he:ot.status==="done"&&(ot.vectorTile?ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}},Le.prototype.abortTile=function(G,$){var re=this.loading,ge=G.uid;re&&re[ge]&&re[ge].abort&&(re[ge].abort(),delete re[ge]),$()},Le.prototype.removeTile=function(G,$){var re=this.loaded,ge=G.uid;re&&re[ge]&&delete re[ge],$()};var ut=g.window.ImageBitmap,Ht=function(){this.loaded={}};function ur(G,$){if(G.length!==0){Pt(G[0],$);for(var re=1;re<G.length;re++)Pt(G[re],!$)}}function Pt(G,$){for(var re=0,ge=0,Pe=G.length,Ge=Pe-1;ge<Pe;Ge=ge++)re+=(G[ge][0]-G[Ge][0])*(G[Ge][1]+G[ge][1]);re>=0!=!!$&&G.reverse()}Ht.prototype.loadTile=function(G,$){var re=G.uid,ge=G.encoding,Pe=G.rawImageData,Ge=ut&&Pe instanceof ut?this.getImageData(Pe):Pe,ot=new g.DEMData(re,Ge,ge);this.loaded=this.loaded||{},this.loaded[re]=ot,$(null,ot)},Ht.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new g.RGBAImage({width:$.width,height:$.height},$.data)},Ht.prototype.removeTile=function(G){var $=this.loaded,re=G.uid;$&&$[re]&&delete $[re]};var Jt=g.vectorTile.VectorTileFeature.prototype.toGeoJSON,kt=function(G){this._feature=G,this.extent=g.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};kt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],$=0,re=this._feature.geometry;$<re.length;$+=1){var ge=re[$];G.push([new g.Point$1(ge[0],ge[1])])}return G}for(var Pe=[],Ge=0,ot=this._feature.geometry;Ge<ot.length;Ge+=1){for(var he=[],De=0,_t=ot[Ge];De<_t.length;De+=1){var vr=_t[De];he.push(new g.Point$1(vr[0],vr[1]))}Pe.push(he)}return Pe},kt.prototype.toGeoJSON=function(G,$,re){return Jt.call(this,G,$,re)};var pt=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=G.length,this._features=G};pt.prototype.feature=function(G){return new kt(this._features[G])};var gt=g.vectorTile.VectorTileFeature,er=q;function q(G,$){this.options=$||{},this.features=G,this.length=G.length}function Qt(G,$){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=$||4096}q.prototype.feature=function(G){return new Qt(this.features[G],this.options.extent)},Qt.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var $=0;$<G.length;$++){for(var re=G[$],ge=[],Pe=0;Pe<re.length;Pe++)ge.push(new g.Point$1(re[Pe][0],re[Pe][1]));this.geometry.push(ge)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,$=1/0,re=-1/0,ge=1/0,Pe=-1/0,Ge=0;Ge<G.length;Ge++)for(var ot=G[Ge],he=0;he<ot.length;he++){var De=ot[he];$=Math.min($,De.x),re=Math.max(re,De.x),ge=Math.min(ge,De.y),Pe=Math.max(Pe,De.y)}return[$,ge,re,Pe]},Qt.prototype.toGeoJSON=gt.prototype.toGeoJSON;var xt=wt,rt=er;function wt(G){var $=new g.pbf;return function(re,ge){for(var Pe in re.layers)ge.writeMessage(3,et,re.layers[Pe])}(G,$),$.finish()}function et(G,$){var re;$.writeVarintField(15,G.version||1),$.writeStringField(1,G.name||""),$.writeVarintField(5,G.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<G.length;re++)ge.feature=G.feature(re),$.writeMessage(2,$t,ge);var Pe=ge.keys;for(re=0;re<Pe.length;re++)$.writeStringField(3,Pe[re]);var Ge=ge.values;for(re=0;re<Ge.length;re++)$.writeMessage(4,qe,Ge[re])}function $t(G,$){var re=G.feature;re.id!==void 0&&$.writeVarintField(1,re.id),$.writeMessage(2,Sr,G),$.writeVarintField(3,re.type),$.writeMessage(4,Te,re)}function Sr(G,$){var re=G.feature,ge=G.keys,Pe=G.values,Ge=G.keycache,ot=G.valuecache;for(var he in re.properties){var De=Ge[he];De===void 0&&(ge.push(he),Ge[he]=De=ge.length-1),$.writeVarint(De);var _t=re.properties[he],vr=typeof _t;vr!=="string"&&vr!=="boolean"&&vr!=="number"&&(_t=JSON.stringify(_t));var Bt=vr+":"+_t,Ut=ot[Bt];Ut===void 0&&(Pe.push(_t),ot[Bt]=Ut=Pe.length-1),$.writeVarint(Ut)}}function kr(G,$){return($<<3)+(7&G)}function en(G){return G<<1^G>>31}function Te(G,$){for(var re=G.loadGeometry(),ge=G.type,Pe=0,Ge=0,ot=re.length,he=0;he<ot;he++){var De=re[he],_t=1;ge===1&&(_t=De.length),$.writeVarint(kr(1,_t));for(var vr=ge===3?De.length-1:De.length,Bt=0;Bt<vr;Bt++){Bt===1&&ge!==1&&$.writeVarint(kr(2,vr-1));var Ut=De[Bt].x-Pe,gr=De[Bt].y-Ge;$.writeVarint(en(Ut)),$.writeVarint(en(gr)),Pe+=Ut,Ge+=gr}ge===3&&$.writeVarint(kr(7,1))}}function qe(G,$){var re=typeof G;re==="string"?$.writeStringField(1,G):re==="boolean"?$.writeBooleanField(7,G):re==="number"&&(G%1!=0?$.writeDoubleField(3,G):G<0?$.writeSVarintField(6,G):$.writeVarintField(5,G))}function ke(G,$,re,ge){Mt(G,re,ge),Mt($,2*re,2*ge),Mt($,2*re+1,2*ge+1)}function Mt(G,$,re){var ge=G[$];G[$]=G[re],G[re]=ge}function yt(G,$,re,ge){var Pe=G-re,Ge=$-ge;return Pe*Pe+Ge*Ge}xt.fromVectorTileJs=wt,xt.fromGeojsonVt=function(G,$){$=$||{};var re={};for(var ge in G)re[ge]=new er(G[ge].features,$),re[ge].name=ge,re[ge].version=$.version,re[ge].extent=$.extent;return wt({layers:re})},xt.GeoJSONWrapper=rt;var Zt=function(G){return G[0]},qt=function(G){return G[1]},Cr=function(G,$,re,ge,Pe){$===void 0&&($=Zt),re===void 0&&(re=qt),ge===void 0&&(ge=64),Pe===void 0&&(Pe=Float64Array),this.nodeSize=ge,this.points=G;for(var Ge=G.length<65536?Uint16Array:Uint32Array,ot=this.ids=new Ge(G.length),he=this.coords=new Pe(2*G.length),De=0;De<G.length;De++)ot[De]=De,he[2*De]=$(G[De]),he[2*De+1]=re(G[De]);(function _t(vr,Bt,Ut,gr,_n,ln){if(!(_n-gr<=Ut)){var Lt=gr+_n>>1;(function sn(Zr,Hr,oi,tn,Si,$i){for(;Si>tn;){if(Si-tn>600){var yi=Si-tn+1,Mi=oi-tn+1,xi=Math.log(yi),ti=.5*Math.exp(2*xi/3),Vi=.5*Math.sqrt(xi*ti*(yi-ti)/yi)*(Mi-yi/2<0?-1:1);sn(Zr,Hr,oi,Math.max(tn,Math.floor(oi-Mi*ti/yi+Vi)),Math.min(Si,Math.floor(oi+(yi-Mi)*ti/yi+Vi)),$i)}var Ta=Hr[2*oi+$i],na=tn,Pi=Si;for(ke(Zr,Hr,tn,oi),Hr[2*Si+$i]>Ta&&ke(Zr,Hr,tn,Si);na<Pi;){for(ke(Zr,Hr,na,Pi),na++,Pi--;Hr[2*na+$i]<Ta;)na++;for(;Hr[2*Pi+$i]>Ta;)Pi--}Hr[2*tn+$i]===Ta?ke(Zr,Hr,tn,Pi):ke(Zr,Hr,++Pi,Si),Pi<=oi&&(tn=Pi+1),oi<=Pi&&(Si=Pi-1)}})(vr,Bt,Lt,gr,_n,ln%2),_t(vr,Bt,Ut,gr,Lt-1,ln+1),_t(vr,Bt,Ut,Lt+1,_n,ln+1)}})(ot,he,ge,0,ot.length-1,0)};Cr.prototype.range=function(G,$,re,ge){return function(Pe,Ge,ot,he,De,_t,vr){for(var Bt,Ut,gr=[0,Pe.length-1,0],_n=[];gr.length;){var ln=gr.pop(),Lt=gr.pop(),sn=gr.pop();if(Lt-sn<=vr)for(var Zr=sn;Zr<=Lt;Zr++)Ut=Ge[2*Zr+1],(Bt=Ge[2*Zr])>=ot&&Bt<=De&&Ut>=he&&Ut<=_t&&_n.push(Pe[Zr]);else{var Hr=Math.floor((sn+Lt)/2);Ut=Ge[2*Hr+1],(Bt=Ge[2*Hr])>=ot&&Bt<=De&&Ut>=he&&Ut<=_t&&_n.push(Pe[Hr]);var oi=(ln+1)%2;(ln===0?ot<=Bt:he<=Ut)&&(gr.push(sn),gr.push(Hr-1),gr.push(oi)),(ln===0?De>=Bt:_t>=Ut)&&(gr.push(Hr+1),gr.push(Lt),gr.push(oi))}}return _n}(this.ids,this.coords,G,$,re,ge,this.nodeSize)},Cr.prototype.within=function(G,$,re){return function(ge,Pe,Ge,ot,he,De){for(var _t=[0,ge.length-1,0],vr=[],Bt=he*he;_t.length;){var Ut=_t.pop(),gr=_t.pop(),_n=_t.pop();if(gr-_n<=De)for(var ln=_n;ln<=gr;ln++)yt(Pe[2*ln],Pe[2*ln+1],Ge,ot)<=Bt&&vr.push(ge[ln]);else{var Lt=Math.floor((_n+gr)/2),sn=Pe[2*Lt],Zr=Pe[2*Lt+1];yt(sn,Zr,Ge,ot)<=Bt&&vr.push(ge[Lt]);var Hr=(Ut+1)%2;(Ut===0?Ge-he<=sn:ot-he<=Zr)&&(_t.push(_n),_t.push(Lt-1),_t.push(Hr)),(Ut===0?Ge+he>=sn:ot+he>=Zr)&&(_t.push(Lt+1),_t.push(gr),_t.push(Hr))}}return vr}(this.ids,this.coords,G,$,re,this.nodeSize)};var qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},fn=function(G){this.options=ra(Object.create(qn),G),this.trees=new Array(this.options.maxZoom+1)};function Hi(G,$,re,ge,Pe){return{x:G,y:$,zoom:1/0,id:re,parentId:-1,numPoints:ge,properties:Pe}}function Zn(G,$){var re=G.geometry.coordinates,ge=re[1];return{x:Kn(re[0]),y:ui(ge),zoom:1/0,index:$,parentId:-1}}function Hn(G){return{type:"Feature",id:G.id,properties:pi(G),geometry:{type:"Point",coordinates:[(ge=G.x,360*(ge-.5)),($=G.y,re=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(re))/Math.PI-90)]}};var $,re,ge}function pi(G){var $=G.numPoints,re=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return ra(ra({},G.properties),{cluster:!0,cluster_id:G.id,point_count:$,point_count_abbreviated:re})}function Kn(G){return G/360+.5}function ui(G){var $=Math.sin(G*Math.PI/180),re=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return re<0?0:re>1?1:re}function ra(G,$){for(var re in $)G[re]=$[re];return G}function Ri(G){return G.x}function bi(G){return G.y}function Ni(G,$,re,ge,Pe,Ge){var ot=Pe-re,he=Ge-ge;if(ot!==0||he!==0){var De=((G-re)*ot+($-ge)*he)/(ot*ot+he*he);De>1?(re=Pe,ge=Ge):De>0&&(re+=ot*De,ge+=he*De)}return(ot=G-re)*ot+(he=$-ge)*he}function aa(G,$,re,ge){var Pe={id:G===void 0?null:G,type:$,geometry:re,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var ot=Ge.geometry,he=Ge.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")Ei(Ge,ot);else if(he==="Polygon"||he==="MultiLineString")for(var De=0;De<ot.length;De++)Ei(Ge,ot[De]);else if(he==="MultiPolygon")for(De=0;De<ot.length;De++)for(var _t=0;_t<ot[De].length;_t++)Ei(Ge,ot[De][_t])}(Pe),Pe}function Ei(G,$){for(var re=0;re<$.length;re+=3)G.minX=Math.min(G.minX,$[re]),G.minY=Math.min(G.minY,$[re+1]),G.maxX=Math.max(G.maxX,$[re]),G.maxY=Math.max(G.maxY,$[re+1])}function _a(G,$,re,ge){if($.geometry){var Pe=$.geometry.coordinates,Ge=$.geometry.type,ot=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),he=[],De=$.id;if(re.promoteId?De=$.properties[re.promoteId]:re.generateId&&(De=ge||0),Ge==="Point")An(Pe,he);else if(Ge==="MultiPoint")for(var _t=0;_t<Pe.length;_t++)An(Pe[_t],he);else if(Ge==="LineString")_i(Pe,he,ot,!1);else if(Ge==="MultiLineString"){if(re.lineMetrics){for(_t=0;_t<Pe.length;_t++)_i(Pe[_t],he=[],ot,!1),G.push(aa(De,"LineString",he,$.properties));return}Bi(Pe,he,ot,!1)}else if(Ge==="Polygon")Bi(Pe,he,ot,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(_t=0;_t<$.geometry.geometries.length;_t++)_a(G,{id:De,geometry:$.geometry.geometries[_t],properties:$.properties},re,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_t=0;_t<Pe.length;_t++){var vr=[];Bi(Pe[_t],vr,ot,!0),he.push(vr)}}G.push(aa(De,Ge,he,$.properties))}}function An(G,$){$.push(Wi(G[0])),$.push(za(G[1])),$.push(0)}function _i(G,$,re,ge){for(var Pe,Ge,ot=0,he=0;he<G.length;he++){var De=Wi(G[he][0]),_t=za(G[he][1]);$.push(De),$.push(_t),$.push(0),he>0&&(ot+=ge?(Pe*_t-De*Ge)/2:Math.sqrt(Math.pow(De-Pe,2)+Math.pow(_t-Ge,2))),Pe=De,Ge=_t}var vr=$.length-3;$[2]=1,function Bt(Ut,gr,_n,ln){for(var Lt,sn=ln,Zr=_n-gr>>1,Hr=_n-gr,oi=Ut[gr],tn=Ut[gr+1],Si=Ut[_n],$i=Ut[_n+1],yi=gr+3;yi<_n;yi+=3){var Mi=Ni(Ut[yi],Ut[yi+1],oi,tn,Si,$i);if(Mi>sn)Lt=yi,sn=Mi;else if(Mi===sn){var xi=Math.abs(yi-Zr);xi<Hr&&(Lt=yi,Hr=xi)}}sn>ln&&(Lt-gr>3&&Bt(Ut,gr,Lt,ln),Ut[Lt+2]=sn,_n-Lt>3&&Bt(Ut,Lt,_n,ln))}($,0,vr,re),$[vr+2]=1,$.size=Math.abs(ot),$.start=0,$.end=$.size}function Bi(G,$,re,ge){for(var Pe=0;Pe<G.length;Pe++){var Ge=[];_i(G[Pe],Ge,re,ge),$.push(Ge)}}function Wi(G){return G/360+.5}function za(G){var $=Math.sin(G*Math.PI/180),re=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return re<0?0:re>1?1:re}function de(G,$,re,ge,Pe,Ge,ot,he){if(ge/=$,Ge>=(re/=$)&&ot<ge)return G;if(ot<re||Ge>=ge)return null;for(var De=[],_t=0;_t<G.length;_t++){var vr=G[_t],Bt=vr.geometry,Ut=vr.type,gr=Pe===0?vr.minX:vr.minY,_n=Pe===0?vr.maxX:vr.maxY;if(gr>=re&&_n<ge)De.push(vr);else if(!(_n<re||gr>=ge)){var ln=[];if(Ut==="Point"||Ut==="MultiPoint")Nn(Bt,ln,re,ge,Pe);else if(Ut==="LineString")Ua(Bt,ln,re,ge,Pe,!1,he.lineMetrics);else if(Ut==="MultiLineString")Vt(Bt,ln,re,ge,Pe,!1);else if(Ut==="Polygon")Vt(Bt,ln,re,ge,Pe,!0);else if(Ut==="MultiPolygon")for(var Lt=0;Lt<Bt.length;Lt++){var sn=[];Vt(Bt[Lt],sn,re,ge,Pe,!0),sn.length&&ln.push(sn)}if(ln.length){if(he.lineMetrics&&Ut==="LineString"){for(Lt=0;Lt<ln.length;Lt++)De.push(aa(vr.id,Ut,ln[Lt],vr.tags));continue}Ut!=="LineString"&&Ut!=="MultiLineString"||(ln.length===1?(Ut="LineString",ln=ln[0]):Ut="MultiLineString"),Ut!=="Point"&&Ut!=="MultiPoint"||(Ut=ln.length===3?"Point":"MultiPoint"),De.push(aa(vr.id,Ut,ln,vr.tags))}}}return De.length?De:null}function Nn(G,$,re,ge,Pe){for(var Ge=0;Ge<G.length;Ge+=3){var ot=G[Ge+Pe];ot>=re&&ot<=ge&&($.push(G[Ge]),$.push(G[Ge+1]),$.push(G[Ge+2]))}}function Ua(G,$,re,ge,Pe,Ge,ot){for(var he,De,_t=ls(G),vr=Pe===0?wr:I,Bt=G.start,Ut=0;Ut<G.length-3;Ut+=3){var gr=G[Ut],_n=G[Ut+1],ln=G[Ut+2],Lt=G[Ut+3],sn=G[Ut+4],Zr=Pe===0?gr:_n,Hr=Pe===0?Lt:sn,oi=!1;ot&&(he=Math.sqrt(Math.pow(gr-Lt,2)+Math.pow(_n-sn,2))),Zr<re?Hr>re&&(De=vr(_t,gr,_n,Lt,sn,re),ot&&(_t.start=Bt+he*De)):Zr>ge?Hr<ge&&(De=vr(_t,gr,_n,Lt,sn,ge),ot&&(_t.start=Bt+he*De)):or(_t,gr,_n,ln),Hr<re&&Zr>=re&&(De=vr(_t,gr,_n,Lt,sn,re),oi=!0),Hr>ge&&Zr<=ge&&(De=vr(_t,gr,_n,Lt,sn,ge),oi=!0),!Ge&&oi&&(ot&&(_t.end=Bt+he*De),$.push(_t),_t=ls(G)),ot&&(Bt+=he)}var tn=G.length-3;gr=G[tn],_n=G[tn+1],ln=G[tn+2],(Zr=Pe===0?gr:_n)>=re&&Zr<=ge&&or(_t,gr,_n,ln),tn=_t.length-3,Ge&&tn>=3&&(_t[tn]!==_t[0]||_t[tn+1]!==_t[1])&&or(_t,_t[0],_t[1],_t[2]),_t.length&&$.push(_t)}function ls(G){var $=[];return $.size=G.size,$.start=G.start,$.end=G.end,$}function Vt(G,$,re,ge,Pe,Ge){for(var ot=0;ot<G.length;ot++)Ua(G[ot],$,re,ge,Pe,Ge,!1)}function or(G,$,re,ge){G.push($),G.push(re),G.push(ge)}function wr(G,$,re,ge,Pe,Ge){var ot=(Ge-$)/(ge-$);return G.push(Ge),G.push(re+(Pe-re)*ot),G.push(1),ot}function I(G,$,re,ge,Pe,Ge){var ot=(Ge-re)/(Pe-re);return G.push($+(ge-$)*ot),G.push(Ge),G.push(1),ot}function ir(G,$){for(var re=[],ge=0;ge<G.length;ge++){var Pe,Ge=G[ge],ot=Ge.type;if(ot==="Point"||ot==="MultiPoint"||ot==="LineString")Pe=Dn(Ge.geometry,$);else if(ot==="MultiLineString"||ot==="Polygon"){Pe=[];for(var he=0;he<Ge.geometry.length;he++)Pe.push(Dn(Ge.geometry[he],$))}else if(ot==="MultiPolygon")for(Pe=[],he=0;he<Ge.geometry.length;he++){for(var De=[],_t=0;_t<Ge.geometry[he].length;_t++)De.push(Dn(Ge.geometry[he][_t],$));Pe.push(De)}re.push(aa(Ge.id,ot,Pe,Ge.tags))}return re}function Dn(G,$){var re=[];re.size=G.size,G.start!==void 0&&(re.start=G.start,re.end=G.end);for(var ge=0;ge<G.length;ge+=3)re.push(G[ge]+$,G[ge+1],G[ge+2]);return re}function li(G,$){if(G.transformed)return G;var re,ge,Pe,Ge=1<<G.z,ot=G.x,he=G.y;for(re=0;re<G.features.length;re++){var De=G.features[re],_t=De.geometry,vr=De.type;if(De.geometry=[],vr===1)for(ge=0;ge<_t.length;ge+=2)De.geometry.push(Wn(_t[ge],_t[ge+1],$,Ge,ot,he));else for(ge=0;ge<_t.length;ge++){var Bt=[];for(Pe=0;Pe<_t[ge].length;Pe+=2)Bt.push(Wn(_t[ge][Pe],_t[ge][Pe+1],$,Ge,ot,he));De.geometry.push(Bt)}}return G.transformed=!0,G}function Wn(G,$,re,ge,Pe,Ge){return[Math.round(re*(G*ge-Pe)),Math.round(re*($*ge-Ge))]}function nn(G,$,re,ge,Pe){for(var Ge=$===Pe.maxZoom?0:Pe.tolerance/((1<<$)*Pe.extent),ot={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:ge,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<G.length;he++){ot.numFeatures++,wi(ot,G[he],Ge,Pe);var De=G[he].minX,_t=G[he].minY,vr=G[he].maxX,Bt=G[he].maxY;De<ot.minX&&(ot.minX=De),_t<ot.minY&&(ot.minY=_t),vr>ot.maxX&&(ot.maxX=vr),Bt>ot.maxY&&(ot.maxY=Bt)}return ot}function wi(G,$,re,ge){var Pe=$.geometry,Ge=$.type,ot=[];if(Ge==="Point"||Ge==="MultiPoint")for(var he=0;he<Pe.length;he+=3)ot.push(Pe[he]),ot.push(Pe[he+1]),G.numPoints++,G.numSimplified++;else if(Ge==="LineString")Ti(ot,Pe,G,re,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(he=0;he<Pe.length;he++)Ti(ot,Pe[he],G,re,Ge==="Polygon",he===0);else if(Ge==="MultiPolygon")for(var De=0;De<Pe.length;De++){var _t=Pe[De];for(he=0;he<_t.length;he++)Ti(ot,_t[he],G,re,!0,he===0)}if(ot.length){var vr=$.tags||null;if(Ge==="LineString"&&ge.lineMetrics){for(var Bt in vr={},$.tags)vr[Bt]=$.tags[Bt];vr.mapbox_clip_start=Pe.start/Pe.size,vr.mapbox_clip_end=Pe.end/Pe.size}var Ut={geometry:ot,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:vr};$.id!==null&&(Ut.id=$.id),G.features.push(Ut)}}function Ti(G,$,re,ge,Pe,Ge){var ot=ge*ge;if(ge>0&&$.size<(Pe?ot:ge))re.numPoints+=$.length/3;else{for(var he=[],De=0;De<$.length;De+=3)(ge===0||$[De+2]>ot)&&(re.numSimplified++,he.push($[De]),he.push($[De+1])),re.numPoints++;Pe&&function(_t,vr){for(var Bt=0,Ut=0,gr=_t.length,_n=gr-2;Ut<gr;_n=Ut,Ut+=2)Bt+=(_t[Ut]-_t[_n])*(_t[Ut+1]+_t[_n+1]);if(Bt>0===vr)for(Ut=0,gr=_t.length;Ut<gr/2;Ut+=2){var ln=_t[Ut],Lt=_t[Ut+1];_t[Ut]=_t[gr-2-Ut],_t[Ut+1]=_t[gr-1-Ut],_t[gr-2-Ut]=ln,_t[gr-1-Ut]=Lt}}(he,Ge),G.push(he)}}function Wa(G,$){var re=($=this.options=function(Pe,Ge){for(var ot in Ge)Pe[ot]=Ge[ot];return Pe}(Object.create(this.options),$)).debug;if(re&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Pe,Ge){var ot=[];if(Pe.type==="FeatureCollection")for(var he=0;he<Pe.features.length;he++)_a(ot,Pe.features[he],Ge,he);else _a(ot,Pe.type==="Feature"?Pe:{geometry:Pe},Ge);return ot}(G,$);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Pe,Ge){var ot=Ge.buffer/Ge.extent,he=Pe,De=de(Pe,1,-1-ot,ot,0,-1,2,Ge),_t=de(Pe,1,1-ot,2+ot,0,-1,2,Ge);return(De||_t)&&(he=de(Pe,1,-ot,1+ot,0,-1,2,Ge)||[],De&&(he=ir(De,1).concat(he)),_t&&(he=he.concat(ir(_t,-1)))),he}(ge,$)).length&&this.splitTile(ge,0,0,0),re&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function cs(G,$,re){return 32*((1<<G)*re+$)+G}function ha(G,$){var re=G.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var ge=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!ge)return $(null,null);var Pe=new pt(ge.features),Ge=xt(Pe);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),$(null,{vectorTile:Pe,rawData:Ge.buffer})}fn.prototype.load=function(G){var $=this.options,re=$.log,ge=$.minZoom,Pe=$.maxZoom,Ge=$.nodeSize;re&&console.time("total time");var ot="prepare "+G.length+" points";re&&console.time(ot),this.points=G;for(var he=[],De=0;De<G.length;De++)G[De].geometry&&he.push(Zn(G[De],De));this.trees[Pe+1]=new Cr(he,Ri,bi,Ge,Float32Array),re&&console.timeEnd(ot);for(var _t=Pe;_t>=ge;_t--){var vr=+Date.now();he=this._cluster(he,_t),this.trees[_t]=new Cr(he,Ri,bi,Ge,Float32Array),re&&console.log("z%d: %d clusters in %dms",_t,he.length,+Date.now()-vr)}return re&&console.timeEnd("total time"),this},fn.prototype.getClusters=function(G,$){var re=((G[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,G[1])),Pe=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)re=-180,Pe=180;else if(re>Pe){var ot=this.getClusters([re,ge,180,Ge],$),he=this.getClusters([-180,ge,Pe,Ge],$);return ot.concat(he)}for(var De=this.trees[this._limitZoom($)],_t=[],vr=0,Bt=De.range(Kn(re),ui(Ge),Kn(Pe),ui(ge));vr<Bt.length;vr+=1){var Ut=De.points[Bt[vr]];_t.push(Ut.numPoints?Hn(Ut):this.points[Ut.index])}return _t},fn.prototype.getChildren=function(G){var $=this._getOriginId(G),re=this._getOriginZoom(G),ge="No cluster with the specified id.",Pe=this.trees[re];if(!Pe)throw new Error(ge);var Ge=Pe.points[$];if(!Ge)throw new Error(ge);for(var ot=this.options.radius/(this.options.extent*Math.pow(2,re-1)),he=[],De=0,_t=Pe.within(Ge.x,Ge.y,ot);De<_t.length;De+=1){var vr=Pe.points[_t[De]];vr.parentId===G&&he.push(vr.numPoints?Hn(vr):this.points[vr.index])}if(he.length===0)throw new Error(ge);return he},fn.prototype.getLeaves=function(G,$,re){var ge=[];return this._appendLeaves(ge,G,$=$||10,re=re||0,0),ge},fn.prototype.getTile=function(G,$,re){var ge=this.trees[this._limitZoom(G)],Pe=Math.pow(2,G),Ge=this.options,ot=Ge.radius/Ge.extent,he=(re-ot)/Pe,De=(re+1+ot)/Pe,_t={features:[]};return this._addTileFeatures(ge.range(($-ot)/Pe,he,($+1+ot)/Pe,De),ge.points,$,re,Pe,_t),$===0&&this._addTileFeatures(ge.range(1-ot/Pe,he,1,De),ge.points,Pe,re,Pe,_t),$===Pe-1&&this._addTileFeatures(ge.range(0,he,ot/Pe,De),ge.points,-1,re,Pe,_t),_t.features.length?_t:null},fn.prototype.getClusterExpansionZoom=function(G){for(var $=this._getOriginZoom(G)-1;$<=this.options.maxZoom;){var re=this.getChildren(G);if($++,re.length!==1)break;G=re[0].properties.cluster_id}return $},fn.prototype._appendLeaves=function(G,$,re,ge,Pe){for(var Ge=0,ot=this.getChildren($);Ge<ot.length;Ge+=1){var he=ot[Ge],De=he.properties;if(De&&De.cluster?Pe+De.point_count<=ge?Pe+=De.point_count:Pe=this._appendLeaves(G,De.cluster_id,re,ge,Pe):Pe<ge?Pe++:G.push(he),G.length===re)break}return Pe},fn.prototype._addTileFeatures=function(G,$,re,ge,Pe,Ge){for(var ot=0,he=G;ot<he.length;ot+=1){var De=$[he[ot]],_t=De.numPoints,vr={type:1,geometry:[[Math.round(this.options.extent*(De.x*Pe-re)),Math.round(this.options.extent*(De.y*Pe-ge))]],tags:_t?pi(De):this.points[De.index].properties},Bt=void 0;_t?Bt=De.id:this.options.generateId?Bt=De.index:this.points[De.index].id&&(Bt=this.points[De.index].id),Bt!==void 0&&(vr.id=Bt),Ge.features.push(vr)}},fn.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},fn.prototype._cluster=function(G,$){for(var re=[],ge=this.options,Pe=ge.reduce,Ge=ge.minPoints,ot=ge.radius/(ge.extent*Math.pow(2,$)),he=0;he<G.length;he++){var De=G[he];if(!(De.zoom<=$)){De.zoom=$;for(var _t=this.trees[$+1],vr=_t.within(De.x,De.y,ot),Bt=De.numPoints||1,Ut=Bt,gr=0,_n=vr;gr<_n.length;gr+=1){var ln=_t.points[_n[gr]];ln.zoom>$&&(Ut+=ln.numPoints||1)}if(Ut>=Ge){for(var Lt=De.x*Bt,sn=De.y*Bt,Zr=Pe&&Bt>1?this._map(De,!0):null,Hr=(he<<5)+($+1)+this.points.length,oi=0,tn=vr;oi<tn.length;oi+=1){var Si=_t.points[tn[oi]];if(!(Si.zoom<=$)){Si.zoom=$;var $i=Si.numPoints||1;Lt+=Si.x*$i,sn+=Si.y*$i,Si.parentId=Hr,Pe&&(Zr||(Zr=this._map(De,!0)),Pe(Zr,this._map(Si)))}}De.parentId=Hr,re.push(Hi(Lt/Ut,sn/Ut,Hr,Ut,Zr))}else if(re.push(De),Ut>1)for(var yi=0,Mi=vr;yi<Mi.length;yi+=1){var xi=_t.points[Mi[yi]];xi.zoom<=$||(xi.zoom=$,re.push(xi))}}}return re},fn.prototype._getOriginId=function(G){return G-this.points.length>>5},fn.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},fn.prototype._map=function(G,$){if(G.numPoints)return $?ra({},G.properties):G.properties;var re=this.points[G.index].properties,ge=this.options.map(re);return $&&ge===re?ra({},ge):ge},Wa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wa.prototype.splitTile=function(G,$,re,ge,Pe,Ge,ot){for(var he=[G,$,re,ge],De=this.options,_t=De.debug;he.length;){ge=he.pop(),re=he.pop(),$=he.pop(),G=he.pop();var vr=1<<$,Bt=cs($,re,ge),Ut=this.tiles[Bt];if(!Ut&&(_t>1&&console.time("creation"),Ut=this.tiles[Bt]=nn(G,$,re,ge,De),this.tileCoords.push({z:$,x:re,y:ge}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,re,ge,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));var gr="z"+$;this.stats[gr]=(this.stats[gr]||0)+1,this.total++}if(Ut.source=G,Pe){if($===De.maxZoom||$===Pe)continue;var _n=1<<Pe-$;if(re!==Math.floor(Ge/_n)||ge!==Math.floor(ot/_n))continue}else if($===De.indexMaxZoom||Ut.numPoints<=De.indexMaxPoints)continue;if(Ut.source=null,G.length!==0){_t>1&&console.time("clipping");var ln,Lt,sn,Zr,Hr,oi,tn=.5*De.buffer/De.extent,Si=.5-tn,$i=.5+tn,yi=1+tn;ln=Lt=sn=Zr=null,Hr=de(G,vr,re-tn,re+$i,0,Ut.minX,Ut.maxX,De),oi=de(G,vr,re+Si,re+yi,0,Ut.minX,Ut.maxX,De),G=null,Hr&&(ln=de(Hr,vr,ge-tn,ge+$i,1,Ut.minY,Ut.maxY,De),Lt=de(Hr,vr,ge+Si,ge+yi,1,Ut.minY,Ut.maxY,De),Hr=null),oi&&(sn=de(oi,vr,ge-tn,ge+$i,1,Ut.minY,Ut.maxY,De),Zr=de(oi,vr,ge+Si,ge+yi,1,Ut.minY,Ut.maxY,De),oi=null),_t>1&&console.timeEnd("clipping"),he.push(ln||[],$+1,2*re,2*ge),he.push(Lt||[],$+1,2*re,2*ge+1),he.push(sn||[],$+1,2*re+1,2*ge),he.push(Zr||[],$+1,2*re+1,2*ge+1)}}},Wa.prototype.getTile=function(G,$,re){var ge=this.options,Pe=ge.extent,Ge=ge.debug;if(G<0||G>24)return null;var ot=1<<G,he=cs(G,$=($%ot+ot)%ot,re);if(this.tiles[he])return li(this.tiles[he],Pe);Ge>1&&console.log("drilling down to z%d-%d-%d",G,$,re);for(var De,_t=G,vr=$,Bt=re;!De&&_t>0;)_t--,vr=Math.floor(vr/2),Bt=Math.floor(Bt/2),De=this.tiles[cs(_t,vr,Bt)];return De&&De.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",_t,vr,Bt),Ge>1&&console.time("drilling down"),this.splitTile(De.source,_t,vr,Bt,G,$,re),Ge>1&&console.timeEnd("drilling down"),this.tiles[he]?li(this.tiles[he],Pe):null):null};var wa=function(G){function $(re,ge,Pe,Ge){G.call(this,re,ge,Pe,ha),Ge&&(this.loadGeoJSON=Ge)}return G&&($.__proto__=G),($.prototype=Object.create(G&&G.prototype)).constructor=$,$.prototype.loadData=function(re,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=re,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var re=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Pe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Pe&&Pe.request&&Pe.request.collectResourceTiming)&&new g.RequestPerformance(Pe.request);this.loadGeoJSON(Pe,function(ot,he){if(ot||!he)return ge(ot);if(typeof he!="object")return ge(new Error("Input data given to '"+Pe.source+"' is not a valid GeoJSON object."));(function Ut(gr,_n){var ln,Lt=gr&&gr.type;if(Lt==="FeatureCollection")for(ln=0;ln<gr.features.length;ln++)Ut(gr.features[ln],_n);else if(Lt==="GeometryCollection")for(ln=0;ln<gr.geometries.length;ln++)Ut(gr.geometries[ln],_n);else if(Lt==="Feature")Ut(gr.geometry,_n);else if(Lt==="Polygon")ur(gr.coordinates,_n);else if(Lt==="MultiPolygon")for(ln=0;ln<gr.coordinates.length;ln++)ur(gr.coordinates[ln],_n);return gr})(he,!0);try{if(Pe.filter){var De=g.createExpression(Pe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(function(Ut){return Ut.key+": "+Ut.message}).join(", "));var _t=he.features.filter(function(Ut){return De.value.evaluate({zoom:0},Ut)});he={type:"FeatureCollection",features:_t}}re._geoJSONIndex=Pe.cluster?new fn(function(Ut){var gr=Ut.superclusterOptions,_n=Ut.clusterProperties;if(!_n||!gr)return gr;for(var ln={},Lt={},sn={accumulated:null,zoom:0},Zr={properties:null},Hr=Object.keys(_n),oi=0,tn=Hr;oi<tn.length;oi+=1){var Si=tn[oi],$i=_n[Si],yi=$i[0],Mi=g.createExpression($i[1]),xi=g.createExpression(typeof yi=="string"?[yi,["accumulated"],["get",Si]]:yi);ln[Si]=Mi.value,Lt[Si]=xi.value}return gr.map=function(ti){Zr.properties=ti;for(var Vi={},Ta=0,na=Hr;Ta<na.length;Ta+=1){var Pi=na[Ta];Vi[Pi]=ln[Pi].evaluate(sn,Zr)}return Vi},gr.reduce=function(ti,Vi){Zr.properties=Vi;for(var Ta=0,na=Hr;Ta<na.length;Ta+=1){var Pi=na[Ta];sn.accumulated=ti[Pi],ti[Pi]=Lt[Pi].evaluate(sn,Zr)}},gr}(Pe)).load(he.features):function(Ut,gr){return new Wa(Ut,gr)}(he,Pe.geojsonVtOptions)}catch(Ut){return ge(Ut)}re.loaded={};var vr={};if(Ge){var Bt=Ge.finish();Bt&&(vr.resourceTiming={},vr.resourceTiming[Pe.source]=JSON.parse(JSON.stringify(Bt)))}ge(null,vr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(re,ge){var Pe=this.loaded;return Pe&&Pe[re.uid]?G.prototype.reloadTile.call(this,re,ge):this.loadTile(re,ge)},$.prototype.loadGeoJSON=function(re,ge){if(re.request)g.getJSON(re.request,ge);else{if(typeof re.data!="string")return ge(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(re.data))}catch(Pe){return ge(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(re,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},$.prototype.getClusterExpansionZoom=function(re,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Pe){ge(Pe)}},$.prototype.getClusterChildren=function(re,ge){try{ge(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Pe){ge(Pe)}},$.prototype.getClusterLeaves=function(re,ge){try{ge(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Pe){ge(Pe)}},$}(Le),Ea=function(G){var $=this;this.self=G,this.actor=new g.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Le,geojson:wa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(re,ge){if($.workerSourceTypes[re])throw new Error('Worker source with name "'+re+'" already registered.');$.workerSourceTypes[re]=ge},this.self.registerRTLTextPlugin=function(re){if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=re.applyArabicShaping,g.plugin.processBidirectionalText=re.processBidirectionalText,g.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}};return Ea.prototype.setReferrer=function(G,$){this.referrer=$},Ea.prototype.setImages=function(G,$,re){for(var ge in this.availableImages[G]=$,this.workerSources[G]){var Pe=this.workerSources[G][ge];for(var Ge in Pe)Pe[Ge].availableImages=$}re()},Ea.prototype.setLayers=function(G,$,re){this.getLayerIndex(G).replace($),re()},Ea.prototype.updateLayers=function(G,$,re){this.getLayerIndex(G).update($.layers,$.removedIds),re()},Ea.prototype.loadTile=function(G,$,re){this.getWorkerSource(G,$.type,$.source).loadTile($,re)},Ea.prototype.loadDEMTile=function(G,$,re){this.getDEMWorkerSource(G,$.source).loadTile($,re)},Ea.prototype.reloadTile=function(G,$,re){this.getWorkerSource(G,$.type,$.source).reloadTile($,re)},Ea.prototype.abortTile=function(G,$,re){this.getWorkerSource(G,$.type,$.source).abortTile($,re)},Ea.prototype.removeTile=function(G,$,re){this.getWorkerSource(G,$.type,$.source).removeTile($,re)},Ea.prototype.removeDEMTile=function(G,$){this.getDEMWorkerSource(G,$.source).removeTile($)},Ea.prototype.removeSource=function(G,$,re){if(this.workerSources[G]&&this.workerSources[G][$.type]&&this.workerSources[G][$.type][$.source]){var ge=this.workerSources[G][$.type][$.source];delete this.workerSources[G][$.type][$.source],ge.removeSource!==void 0?ge.removeSource($,re):re()}},Ea.prototype.loadWorkerSource=function(G,$,re){try{this.self.importScripts($.url),re()}catch(ge){re(ge.toString())}},Ea.prototype.syncRTLPluginState=function(G,$,re){try{g.plugin.setState($);var ge=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Pe=g.plugin.isParsed();re(Pe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Pe)}}catch(Ge){re(Ge.toString())}},Ea.prototype.getAvailableImages=function(G){var $=this.availableImages[G];return $||($=[]),$},Ea.prototype.getLayerIndex=function(G){var $=this.layerIndexes[G];return $||($=this.layerIndexes[G]=new ce),$},Ea.prototype.getWorkerSource=function(G,$,re){var ge=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][$]||(this.workerSources[G][$]={}),this.workerSources[G][$][re]||(this.workerSources[G][$][re]=new this.workerSourceTypes[$]({send:function(Pe,Ge,ot){ge.actor.send(Pe,Ge,ot,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][$][re]},Ea.prototype.getDEMWorkerSource=function(G,$){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][$]||(this.demWorkerSources[G][$]=new Ht),this.demWorkerSources[G][$]},Ea.prototype.enforceCacheSizeLimit=function(G,$){g.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ea(self)),Ea}),ye(["./shared"],function(g){"use strict";var ve=g.createCommonjsModule(function(l){function h(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,L,U=new Blob([""],{type:"text/javascript"}),Y=URL.createObjectURL(U);try{L=new Worker(Y),M=!0}catch(oe){M=!1}return L&&L.terminate(),URL.revokeObjectURL(Y),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var L=M.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===M.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(M){var L=function(Y){var oe=document.createElement("canvas"),fe=Object.create(h.webGLContextAttributes);return fe.failIfMajorPerformanceCaveat=Y,oe.probablySupportsContext?oe.probablySupportsContext("webgl",fe)||oe.probablySupportsContext("experimental-webgl",fe):oe.supportsContext?oe.supportsContext("webgl",fe)||oe.supportsContext("experimental-webgl",fe):oe.getContext("webgl",fe)||oe.getContext("experimental-webgl",fe)}(M);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=c);var d={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),V={create:function(l,h,c){var d=g.window.document.createElement(l);return h!==void 0&&(d.className=h),c&&c.appendChild(d),d},createNS:function(l,h){return g.window.document.createElementNS(l,h)}},ce=g.window.document&&g.window.document.documentElement.style;function ue(l){if(!ce)return l[0];for(var h=0;h<l.length;h++)if(l[h]in ce)return l[h];return l[0]}var Ne,se=ue(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);V.disableDrag=function(){ce&&se&&(Ne=ce[se],ce[se]="none")},V.enableDrag=function(){ce&&se&&(ce[se]=Ne)};var at=ue(["transform","WebkitTransform"]);V.setTransform=function(l,h){l.style[at]=h};var Le=!1;try{var ut=Object.defineProperty({},"passive",{get:function(){Le=!0}});g.window.addEventListener("test",ut,ut),g.window.removeEventListener("test",ut,ut)}catch(l){Le=!1}V.addEventListener=function(l,h,c,d){d===void 0&&(d={}),l.addEventListener(h,c,"passive"in d&&Le?d:d.capture)},V.removeEventListener=function(l,h,c,d){d===void 0&&(d={}),l.removeEventListener(h,c,"passive"in d&&Le?d:d.capture)};var Ht=function(l){l.preventDefault(),l.stopPropagation(),g.window.removeEventListener("click",Ht,!0)};function ur(l){var h=l.userImage;return!!(h&&h.render&&h.render())&&(l.data.replace(new Uint8Array(h.data.buffer)),!0)}V.suppressClick=function(){g.window.addEventListener("click",Ht,!0),g.window.setTimeout(function(){g.window.removeEventListener("click",Ht,!0)},0)},V.mousePos=function(l,h){var c=l.getBoundingClientRect();return new g.Point(h.clientX-c.left-l.clientLeft,h.clientY-c.top-l.clientTop)},V.touchPos=function(l,h){for(var c=l.getBoundingClientRect(),d=[],E=0;E<h.length;E++)d.push(new g.Point(h[E].clientX-c.left-l.clientLeft,h[E].clientY-c.top-l.clientTop));return d},V.mouseButton=function(l){return g.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&g.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},V.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Pt=function(l){function h(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},h.prototype.getImage=function(c){return this.images[c]},h.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},h.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},h.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,M=c;w<M.length;w+=1){var L=M[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},h.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},h.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},h.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,M=c;w<M.length;w+=1)this.images[M[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},h.prototype._notify=function(c,d){for(var E={},w=0,M=c;w<M.length;w+=1){var L=M[w];this.images[L]||this.fire(new g.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:g.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},h.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},h.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},M=new g.ImagePosition(w,E);this.patterns[c]={bin:w,position:M}}return this._updatePatternAtlas(),this.patterns[c].position},h.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new g.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=g.potpack(c),w=E.w,M=E.h,L=this.atlasImage;for(var U in L.resize({width:w||1,height:M||1}),this.patterns){var Y=this.patterns[U].bin,oe=Y.x+1,fe=Y.y+1,pe=this.images[U].data,Re=pe.width,Ie=pe.height;g.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe,y:fe},{width:Re,height:Ie}),g.RGBAImage.copy(pe,L,{x:0,y:Ie-1},{x:oe,y:fe-1},{width:Re,height:1}),g.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe,y:fe+Ie},{width:Re,height:1}),g.RGBAImage.copy(pe,L,{x:Re-1,y:0},{x:oe-1,y:fe},{width:1,height:Ie}),g.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe+Re,y:fe},{width:1,height:Ie})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var M=this.images[w];ur(M)&&this.updateImage(w,M)}}},h}(g.Evented),Jt=gt,kt=gt,pt=1e20;function gt(l,h,c,d,E,w){this.fontSize=l||24,this.buffer=h===void 0?3:h,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function er(l,h,c,d,E,w,M){for(var L=0;L<h;L++){for(var U=0;U<c;U++)d[U]=l[U*h+L];for(q(d,E,w,M,c),U=0;U<c;U++)l[U*h+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<h;L++)d[L]=l[U*h+L];for(q(d,E,w,M,h),L=0;L<h;L++)l[U*h+L]=Math.sqrt(E[L])}}function q(l,h,c,d,E){c[0]=0,d[0]=-pt,d[1]=+pt;for(var w=1,M=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[M]]+c[M]*c[M]))/(2*w-2*c[M]);L<=d[M];)M--,L=(l[w]+w*w-(l[c[M]]+c[M]*c[M]))/(2*w-2*c[M]);c[++M]=w,d[M]=L,d[M+1]=+pt}for(w=0,M=0;w<E;w++){for(;d[M+1]<w;)M++;h[w]=(w-c[M])*(w-c[M])+l[c[M]]}}gt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=h.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?pt:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?pt:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(er(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),er(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Jt.default=kt;var Qt=function(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}};Qt.prototype.setURL=function(l){this.url=l},Qt.prototype.getGlyphs=function(l,h){var c=this,d=[];for(var E in l)for(var w=0,M=l[E];w<M.length;w+=1)d.push({stack:E,id:M[w]});g.asyncAll(d,function(L,U){var Y=L.stack,oe=L.id,fe=c.entries[Y];fe||(fe=c.entries[Y]={glyphs:{},requests:{},ranges:{}});var pe=fe.glyphs[oe];if(pe===void 0){if(pe=c._tinySDF(fe,Y,oe))return fe.glyphs[oe]=pe,void U(null,{stack:Y,id:oe,glyph:pe});var Re=Math.floor(oe/256);if(256*Re>65535)U(new Error("glyphs > 65535 not supported"));else if(fe.ranges[Re])U(null,{stack:Y,id:oe,glyph:pe});else{var Ie=fe.requests[Re];Ie||(Ie=fe.requests[Re]=[],Qt.loadGlyphRange(Y,Re,c.url,c.requestManager,function(Xe,Ae){if(Ae){for(var Ye in Ae)c._doesCharSupportLocalGlyph(+Ye)||(fe.glyphs[+Ye]=Ae[+Ye]);fe.ranges[Re]=!0}for(var it=0,Et=Ie;it<Et.length;it+=1)(0,Et[it])(Xe,Ae);delete fe.requests[Re]})),Ie.push(function(Xe,Ae){Xe?U(Xe):Ae&&U(null,{stack:Y,id:oe,glyph:Ae[oe]||null})})}}else U(null,{stack:Y,id:oe,glyph:pe})},function(L,U){if(L)h(L);else if(U){for(var Y={},oe=0,fe=U;oe<fe.length;oe+=1){var pe=fe[oe],Re=pe.stack,Ie=pe.id,Xe=pe.glyph;(Y[Re]||(Y[Re]={}))[Ie]=Xe&&{id:Xe.id,bitmap:Xe.bitmap.clone(),metrics:Xe.metrics}}h(null,Y)}})},Qt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(g.isChar["CJK Unified Ideographs"](l)||g.isChar["Hangul Syllables"](l)||g.isChar.Hiragana(l)||g.isChar.Katakana(l))},Qt.prototype._tinySDF=function(l,h,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(h)?w="900":/medium/i.test(h)?w="500":/light/i.test(h)&&(w="200"),E=l.tinySDF=new Qt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new g.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Qt.loadGlyphRange=function(l,h,c,d,E){var w=256*h,M=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+M),g.ResourceType.Glyphs);g.getArrayBuffer(L,function(U,Y){if(U)E(U);else if(Y){for(var oe={},fe=0,pe=g.parseGlyphPBF(Y);fe<pe.length;fe+=1){var Re=pe[fe];oe[Re.id]=Re}E(null,oe)}})},Qt.TinySDF=Jt;var xt=function(){this.specification=g.styleSpec.light.position};xt.prototype.possiblyEvaluate=function(l,h){return g.sphericalToCartesian(l.expression.evaluate(h))},xt.prototype.interpolate=function(l,h,c){return{x:g.number(l.x,h.x,c),y:g.number(l.y,h.y,c),z:g.number(l.z,h.z,c)}};var rt=new g.Properties({anchor:new g.DataConstantProperty(g.styleSpec.light.anchor),position:new xt,color:new g.DataConstantProperty(g.styleSpec.light.color),intensity:new g.DataConstantProperty(g.styleSpec.light.intensity)}),wt=function(l){function h(c){l.call(this),this._transitionable=new g.Transitionable(rt),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(g.validateLight,c,d))for(var E in c){var w=c[E];g.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},h.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},h.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&g.emitValidationErrors(this,c.call(g.validateStyle,g.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:g.styleSpec})))},h}(g.Evented),et=function(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};et.prototype.getDash=function(l,h){var c=l.join(",")+String(h);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,h)),this.dashEntry[c]},et.prototype.getDashRanges=function(l,h,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,M=!0;d.push({left:E,right:w,isDash:M,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var Y=l[U];d.push({left:E=L*c,right:w=(L+=Y)*c,isDash:M=!M,zeroLength:Y===0})}return d},et.prototype.addRoundDash=function(l,h,c){for(var d=h/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),M=0,L=l[M],U=0;U<this.width;U++){U/L.right>1&&(L=l[++M]);var Y=Math.abs(U-L.left),oe=Math.abs(U-L.right),fe=Math.min(Y,oe),pe=void 0,Re=E/c*(d+1);if(L.isDash){var Ie=d-Math.abs(Re);pe=Math.sqrt(fe*fe+Ie*Ie)}else pe=d-Math.sqrt(fe*fe+Re*Re);this.data[w+U]=Math.max(0,Math.min(255,pe+128))}},et.prototype.addRegularDash=function(l){for(var h=l.length-1;h>=0;--h){var c=l[h],d=l[h+1];c.zeroLength?l.splice(h,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(h,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var M=this.width*this.nextRow,L=0,U=l[L],Y=0;Y<this.width;Y++){Y/U.right>1&&(U=l[++L]);var oe=Math.abs(Y-U.left),fe=Math.abs(Y-U.right),pe=Math.min(oe,fe);this.data[M+Y]=Math.max(0,Math.min(255,(U.isDash?pe:-pe)+128))}},et.prototype.addDash=function(l,h){var c=h?7:0,d=2*c+1;if(this.nextRow+d>this.height)return g.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var M=this.width/E,L=this.getDashRanges(l,this.width,M);h?this.addRoundDash(L,M,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},et.prototype.bind=function(l){var h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var $t=function l(h,c){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=g.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function Sr(l,h,c){var d=function(E,w){if(E)return c(E);if(w){var M=g.pick(g.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(M.vectorLayers=w.vector_layers,M.vectorLayerIds=M.vectorLayers.map(function(L){return L.id})),M.tiles=h.canonicalizeTileset(M,l.url),c(null,M)}};return l.url?g.getJSON(h.transformRequest(h.normalizeSourceURL(l.url),g.ResourceType.Source),d):g.browser.frame(function(){return d(null,l)})}$t.prototype.broadcast=function(l,h,c){g.asyncAll(this.actors,function(d,E){d.send(l,h,E)},c=c||function(){})},$t.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},$t.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},$t.Actor=g.Actor;var kr=function(l,h,c){this.bounds=g.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=c||24};kr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},kr.prototype.contains=function(l){var h=Math.pow(2,l.z),c=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*h),d=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*h),E=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*h),w=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*h);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var en=function(l){function h(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(d,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new g.ErrorEvent(d)):E&&(g.extend(c,E),E.bounds&&(c.tileBounds=new kr(E.bounds,c.minzoom,c.maxzoom)),g.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),g.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},h.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return g.extend({},this._options)},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,g.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,M.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,M.bind(this)))},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(g.Evented),Te=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},d),g.extend(this,g.pick(d,["url","scheme","tileSize"]))}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new g.ErrorEvent(d)):E&&(g.extend(c,E),E.bounds&&(c.tileBounds=new kr(E.bounds,c.minzoom,c.maxzoom)),g.postTurnstileEvent(E.tiles),g.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return g.extend({},this._options)},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=g.getImage(this.map._requestManager.transformRequest(w,g.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,Y=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new g.Texture(U,L,Y.RGBA,{useMipmap:!0}),c.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",g.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},h.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},h.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},h.prototype.hasTransition=function(){return!1},h}(g.Evented),qe=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(M,L){M&&(c.state="errored",d(M)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=g.getImage(this.map._requestManager.transformRequest(E,g.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=g.window.ImageBitmap&&L instanceof g.window.ImageBitmap&&g.offscreenCanvasSupported()?L:g.browser.getImageData(L,1),Y={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",Y,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},h.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,M=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,Y={};return Y[new g.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y).key]={backfilled:!1},Y[new g.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(Y[new g.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y-1).key]={backfilled:!1},Y[new g.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},Y[new g.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(Y[new g.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y+1).key]={backfilled:!1},Y[new g.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},Y[new g.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),Y},h.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},h}(Te),ke=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=g.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var M=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*M,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*M,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:g.EXTENT,radius:(d.clusterRadius||50)*M,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new g.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new g.Event("data",E))}})},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new g.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new g.Event("data",w))}}),this},h.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},h.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},h.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},h.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=g.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(g.browser.resolveURL(w),g.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(M,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(M))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):M?d(M):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},h.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return g.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(g.Evented),Mt=g.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),yt=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),function(w,M){E._loaded=!0,w?E.fire(new g.ErrorEvent(w)):M&&(E.image=M,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(g.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var L=1/0,U=1/0,Y=-1/0,oe=-1/0,fe=0,pe=M;fe<pe.length;fe+=1){var Re=pe[fe];L=Math.min(L,Re.x),U=Math.min(U,Re.y),Y=Math.max(Y,Re.x),oe=Math.max(oe,Re.y)}var Ie=Math.max(Y-L,oe-U),Xe=Math.max(0,Math.floor(-Math.log(Ie)/Math.LN2)),Ae=Math.pow(2,Xe);return new g.CanonicalTileID(Xe,Math.floor((L+Y)/2*Ae),Math.floor((U+oe)/2*Ae))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(M){return d.tileID.getTilePoint(M)._round()});return this._boundsArray=new g.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,g.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,g.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,g.EXTENT,g.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new g.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(g.Evented),Zt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],g.ResourceType.Source).url);g.getVideo(this.urls,function(M,L){c._loaded=!0,M?c.fire(new g.ErrorEvent(M)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new g.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(yt),qt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(L){return typeof L!="number"})})||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof g.window.HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof g.window.HTMLCanvasElement?this.options.canvas:g.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new g.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},h}(yt),Cr={vector:en,raster:Te,"raster-dem":qe,geojson:ke,video:Zt,image:yt,canvas:qt};function qn(l,h){var c=g.identity([]);return g.translate(c,c,[1,1,0]),g.scale(c,c,[.5*l.width,.5*l.height,1]),g.multiply(c,c,l.calculatePosMatrix(h.toUnwrapped()))}function fn(l,h,c,d,E,w){var M=function(Xe,Ae,Ye){if(Xe)for(var it=0,Et=Xe;it<Et.length;it+=1){var Xt=Ae[Et[it]];if(Xt&&Xt.source===Ye&&Xt.type==="fill-extrusion")return!0}else for(var Nt in Ae){var tr=Ae[Nt];if(tr.source===Ye&&tr.type==="fill-extrusion")return!0}return!1}(E&&E.layers,h,l.id),L=w.maxPitchScaleFactor(),U=l.tilesIn(d,L,M);U.sort(Hi);for(var Y=[],oe=0,fe=U;oe<fe.length;oe+=1){var pe=fe[oe];Y.push({wrappedTileID:pe.tileID.wrapped().key,queryResults:pe.tile.queryRenderedFeatures(h,c,l._state,pe.queryGeometry,pe.cameraQueryGeometry,pe.scale,E,w,L,qn(l.transform,pe.tileID))})}var Re=function(Xe){for(var Ae={},Ye={},it=0,Et=Xe;it<Et.length;it+=1){var Xt=Et[it],Nt=Xt.queryResults,tr=Xt.wrappedTileID,mr=Ye[tr]=Ye[tr]||{};for(var Dr in Nt)for(var sr=Nt[Dr],Qr=mr[Dr]=mr[Dr]||{},Rn=Ae[Dr]=Ae[Dr]||[],kn=0,Fn=sr;kn<Fn.length;kn+=1){var Ai=Fn[kn];Qr[Ai.featureIndex]||(Qr[Ai.featureIndex]=!0,Rn.push(Ai))}}return Ae}(Y);for(var Ie in Re)Re[Ie].forEach(function(Xe){var Ae=Xe.feature,Ye=l.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=Ye});return Re}function Hi(l,h){var c=l.tileID,d=h.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Zn=function(l,h){this.max=l,this.onRemove=h,this.reset()};Zn.prototype.reset=function(){for(var l in this.data)for(var h=0,c=this.data[l];h<c.length;h+=1){var d=c[h];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Zn.prototype.add=function(l,h,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:h,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},Zn.prototype.has=function(l){return l.wrapped().key in this.data},Zn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Zn.prototype._getAndRemoveByKey=function(l){var h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value},Zn.prototype.getByKey=function(l){var h=this.data[l];return h?h[0].value:null},Zn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Zn.prototype.remove=function(l,h){if(!this.has(l))return this;var c=l.wrapped().key,d=h===void 0?0:this.data[c].indexOf(h),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Zn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},Zn.prototype.filter=function(l){var h=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||h.push(w)}for(var M=0,L=h;M<L.length;M+=1){var U=L[M];this.remove(U.value.tileID,U)}};var Hn=function(l,h,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Hn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Hn.prototype.updateData=function(l){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Hn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var pi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Kn=function(l,h,c,d){this.length=h.length,this.attributes=c,this.itemSize=h.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Kn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Kn.prototype.updateData=function(l){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)},Kn.prototype.enableAttributes=function(l,h){for(var c=0;c<this.attributes.length;c++){var d=h.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Kn.prototype.setVertexAttribPointers=function(l,h,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=h.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[pi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Kn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ui=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ui.prototype.get=function(){return this.current},ui.prototype.set=function(l){},ui.prototype.getDefault=function(){return this.default},ui.prototype.setDefault=function(){this.set(this.default)};var ra=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return g.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(ui),Ri=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},h}(ui),bi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},h}(ui),Ni=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(ui),aa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},h}(ui),Ei=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},h}(ui),_a=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},h}(ui),An=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},h}(ui),_i=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},h}(ui),Bi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},h}(ui),Wi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},h}(ui),za=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},h}(ui),de=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},h}(ui),Nn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},h}(ui),Ua=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return g.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(ui),ls=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},h}(ui),Vt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},h}(ui),or=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},h}(ui),wr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},h}(ui),I=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},h}(ui),ir=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},h}(ui),Dn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(ui),li=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},h}(ui),Wn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(ui),nn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},h}(ui),wi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},h}(ui),Ti=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},h}(ui),Wa=function(l){function h(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},h}(ui),cs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},h}(ui),ha=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},h}(ui),wa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},h}(ui),Ea=function(l){function h(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(ui),G=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},h}(Ea),$=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(Ea),re=function(l,h,c,d){this.context=l,this.width=h,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new G(l,E),d&&(this.depthAttachment=new $(l,E))};re.prototype.destroy=function(){var l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,h,c){this.func=l,this.mask=h,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Pe=function(l,h,c,d,E,w){this.test=l,this.ref=h,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Pe.disabled=new Pe({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,h,c){this.blendFunction=l,this.blendColor=h,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],g.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,g.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],g.Color.transparent,[!0,!0,!0,!0]);var ot=function(l,h,c){this.enable=l,this.mode=h,this.frontFace=c};ot.disabled=new ot(!1,1029,2305),ot.backCCW=new ot(!0,1029,2305);var he=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ra(this),this.clearDepth=new Ri(this),this.clearStencil=new bi(this),this.colorMask=new Ni(this),this.depthMask=new aa(this),this.stencilMask=new Ei(this),this.stencilFunc=new _a(this),this.stencilOp=new An(this),this.stencilTest=new _i(this),this.depthRange=new Bi(this),this.depthTest=new Wi(this),this.depthFunc=new za(this),this.blend=new de(this),this.blendFunc=new Nn(this),this.blendColor=new Ua(this),this.blendEquation=new ls(this),this.cullFace=new Vt(this),this.cullFaceSide=new or(this),this.frontFace=new wr(this),this.program=new I(this),this.activeTexture=new ir(this),this.viewport=new Dn(this),this.bindFramebuffer=new li(this),this.bindRenderbuffer=new Wn(this),this.bindTexture=new nn(this),this.bindVertexBuffer=new wi(this),this.bindElementBuffer=new Ti(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wa(this),this.pixelStoreUnpack=new cs(this),this.pixelStoreUnpackPremultiplyAlpha=new ha(this),this.pixelStoreUnpackFlipY=new wa(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};he.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},he.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},he.prototype.createIndexBuffer=function(l,h){return new Hn(this,l,h)},he.prototype.createVertexBuffer=function(l,h,c){return new Kn(this,l,h,c)},he.prototype.createRenderbuffer=function(l,h,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,h,c),this.bindRenderbuffer.set(null),E},he.prototype.createFramebuffer=function(l,h,c){return new re(this,l,h,c)},he.prototype.clear=function(l){var h=l.color,c=l.depth,d=this.gl,E=0;h&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},he.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},he.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},he.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},he.prototype.setColorMode=function(l){g.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},he.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var De=function(l){function h(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(M,L,U,Y){var oe=new Cr[L.type](M,L,U,Y);if(oe.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+oe.id);return g.bindAll(["load","abort","unload","serialize","prepare"],oe),oe}(c,d,E,this),this._tiles={},this._cache=new Zn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new g.SourceFeatureState}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},h.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},h.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},h.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return g.values(this._tiles).map(function(c){return c.tileID}).sort(_t).map(function(c){return c.key})},h.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(M,L){var U=M.tileID,Y=L.tileID,oe=new g.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),fe=new g.Point(Y.canonical.x,Y.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-Y.overscaledZ||fe.y-oe.y||fe.x-oe.x}).map(function(M){return M.tileID.key}):E.map(function(M){return M.tileID}).sort(_t).map(function(M){return M.key})},h.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},h.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},h.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},h.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new g.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=g.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new g.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},h.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var M=this.getTileByID(w);L(c,M),L(M,c)}}function L(U,Y){U.needsHillshadePrepare=!0;var oe=Y.tileID.canonical.x-U.tileID.canonical.x,fe=Y.tileID.canonical.y-U.tileID.canonical.y,pe=Math.pow(2,U.tileID.canonical.z),Re=Y.tileID.key;oe===0&&fe===0||Math.abs(fe)>1||(Math.abs(oe)>1&&(Math.abs(oe+pe)===1?oe+=pe:Math.abs(oe-pe)===1&&(oe-=pe)),Y.dem&&U.dem&&(U.dem.backfillBorder(Y.dem,oe,fe),U.neighboringTiles&&U.neighboringTiles[Re]&&(U.neighboringTiles[Re].backfilled=!0)))}},h.prototype.getTile=function(c){return this.getTileByID(c.key)},h.prototype.getTileByID=function(c){return this._tiles[c]},h.prototype._retainLoadedChildren=function(c,d,E,w){for(var M in this._tiles){var L=this._tiles[M];if(!(w[M]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var Y=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[Y.key])&&L.hasData()&&(U=Y)}for(var oe=U;oe.overscaledZ>d;)if(c[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){w[U.key]=U;break}}}},h.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var M=c.scaledTo(w),L=this._getLoadedTile(M);if(L)return L}},h.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},h.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(M)},h.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var M=this._tiles[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),E[M.tileID.key]=M}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},h.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(mr){return new g.OverscaledTileID(mr.canonical.z,mr.wrap,mr.canonical.z,mr.canonical.x,mr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(mr){return d._source.hasTile(mr)}))):E=[];var w=c.coveringZoomLevel(this._source),M=Math.max(w-h.maxOverzooming,this._source.minzoom),L=Math.max(w+h.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,w);if(vr(this._source.type)){for(var Y={},oe={},fe=0,pe=Object.keys(U);fe<pe.length;fe+=1){var Re=pe[fe],Ie=U[Re],Xe=this._tiles[Re];if(Xe&&!(Xe.fadeEndTime&&Xe.fadeEndTime<=g.browser.now())){var Ae=this.findLoadedParent(Ie,M);Ae&&(this._addTile(Ae.tileID),Y[Ae.tileID.key]=Ae.tileID),oe[Re]=Ie}}for(var Ye in this._retainLoadedChildren(oe,w,L,U),Y)U[Ye]||(this._coveredTiles[Ye]=!0,U[Ye]=Y[Ye])}for(var it in U)this._tiles[it].clearFadeHold();for(var Et=0,Xt=g.keysDifference(this._tiles,U);Et<Xt.length;Et+=1){var Nt=Xt[Et],tr=this._tiles[Nt];tr.hasSymbolBuckets&&!tr.holdingForFade()?tr.setHoldDuration(this.map._fadeDuration):tr.hasSymbolBuckets&&!tr.symbolFadeFinished()||this._removeTile(Nt)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},h.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},M=Math.max(d-h.maxOverzooming,this._source.minzoom),L=Math.max(d+h.maxUnderzooming,this._source.minzoom),U={},Y=0,oe=c;Y<oe.length;Y+=1){var fe=oe[Y],pe=this._addTile(fe);E[fe.key]=fe,pe.hasData()||d<this._source.maxzoom&&(U[fe.key]=fe)}this._retainLoadedChildren(U,d,L,E);for(var Re=0,Ie=c;Re<Ie.length;Re+=1){var Xe=Ie[Re],Ae=this._tiles[Xe.key];if(!Ae.hasData()){if(d+1>this._source.maxzoom){var Ye=Xe.children(this._source.maxzoom)[0],it=this.getTile(Ye);if(it&&it.hasData()){E[Ye.key]=Ye;continue}}else{var Et=Xe.children(this._source.maxzoom);if(E[Et[0].key]&&E[Et[1].key]&&E[Et[2].key]&&E[Et[3].key])continue}for(var Xt=Ae.wasRequested(),Nt=Xe.overscaledZ-1;Nt>=M;--Nt){var tr=Xe.scaledTo(Nt);if(w[tr.key]||(w[tr.key]=!0,!(Ae=this.getTile(tr))&&Xt&&(Ae=this._addTile(tr)),Ae&&(E[tr.key]=tr,Xt=Ae.wasRequested(),Ae.hasData())))break}}}return E},h.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var M=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(M))break;w=M}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},h.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new g.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new g.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},h.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},h.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},h.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},h.prototype.tilesIn=function(c,d,E){var w=this,M=[],L=this.transform;if(!L)return M;for(var U=E?L.getCameraQueryGeometry(c):c,Y=c.map(function(Nt){return L.pointCoordinate(Nt)}),oe=U.map(function(Nt){return L.pointCoordinate(Nt)}),fe=this.getIds(),pe=1/0,Re=1/0,Ie=-1/0,Xe=-1/0,Ae=0,Ye=oe;Ae<Ye.length;Ae+=1){var it=Ye[Ae];pe=Math.min(pe,it.x),Re=Math.min(Re,it.y),Ie=Math.max(Ie,it.x),Xe=Math.max(Xe,it.y)}for(var Et=function(Nt){var tr=w._tiles[fe[Nt]];if(!tr.holdingForFade()){var mr=tr.tileID,Dr=Math.pow(2,L.zoom-tr.tileID.overscaledZ),sr=d*tr.queryPadding*g.EXTENT/tr.tileSize/Dr,Qr=[mr.getTilePoint(new g.MercatorCoordinate(pe,Re)),mr.getTilePoint(new g.MercatorCoordinate(Ie,Xe))];if(Qr[0].x-sr<g.EXTENT&&Qr[0].y-sr<g.EXTENT&&Qr[1].x+sr>=0&&Qr[1].y+sr>=0){var Rn=Y.map(function(Fn){return mr.getTilePoint(Fn)}),kn=oe.map(function(Fn){return mr.getTilePoint(Fn)});M.push({tile:tr,tileID:mr,queryGeometry:Rn,cameraQueryGeometry:kn,scale:Dr})}}},Xt=0;Xt<fe.length;Xt++)Et(Xt);return M},h.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),w=0,M=E;w<M.length;w+=1){var L=M[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(vr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=g.browser.now())return!0}return!1},h.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},h.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},h.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},h.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},h.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},h}(g.Evented);function _t(l,h){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*h.wrap)-+(h.wrap<0);return l.overscaledZ-h.overscaledZ||d-c||h.canonical.y-l.canonical.y||h.canonical.x-l.canonical.x}function vr(l){return l==="raster"||l==="image"||l==="video"}function Bt(){return new g.window.Worker(Yl.workerUrl)}De.maxOverzooming=10,De.maxUnderzooming=3;var Ut="mapboxgl_preloaded_worker_pool",gr=function(){this.active={}};gr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<gr.workerCount;)this.workers.push(new Bt);return this.active[l]=!0,this.workers.slice()},gr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},gr.prototype.isPreloaded=function(){return!!this.active[Ut]},gr.prototype.numActive=function(){return Object.keys(this.active).length};var _n,ln=Math.floor(g.browser.hardwareConcurrency/2);function Lt(){return _n||(_n=new gr),_n}function sn(l,h){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return g.refProperties.forEach(function(E){E in h&&(c[E]=h[E])}),c}function Zr(l){l=l.slice();for(var h=Object.create(null),c=0;c<l.length;c++)h[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=sn(l[d],h[l[d].ref]));return l}gr.workerCount=Math.max(Math.min(ln,6),1);var Hr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function oi(l,h,c){c.push({command:Hr.addSource,args:[l,h[l]]})}function tn(l,h,c){h.push({command:Hr.removeSource,args:[l]}),c[l]=!0}function Si(l,h,c,d){tn(l,c,d),oi(l,h,c)}function $i(l,h,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!g.deepEqual(l[c][d],h[c][d]))return!1;for(d in h[c])if(h[c].hasOwnProperty(d)&&d!=="data"&&!g.deepEqual(l[c][d],h[c][d]))return!1;return!0}function yi(l,h,c,d,E,w){var M;for(M in h=h||{},l=l||{})l.hasOwnProperty(M)&&(g.deepEqual(l[M],h[M])||c.push({command:w,args:[d,M,h[M],E]}));for(M in h)h.hasOwnProperty(M)&&!l.hasOwnProperty(M)&&(g.deepEqual(l[M],h[M])||c.push({command:w,args:[d,M,h[M],E]}))}function Mi(l){return l.id}function xi(l,h){return l[h.id]=h,l}var ti=function(l,h){this.reset(l,h)};ti.prototype.reset=function(l,h){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ti.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=g.clamp(l,0,1);for(var h=1,c=this._distances[h],d=l*this.paddedLength+this.padding;c<d&&h<this._distances.length;)c=this._distances[++h];var E=h-1,w=this._distances[E],M=c-w,L=M>0?(d-w)/M:0;return this.points[E].mult(1-L).add(this.points[h].mult(L))};var Vi=function(l,h,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(h/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function Ta(l,h,c,d,E){var w=g.create();return h?(g.scale(w,w,[1/E,1/E,1]),c||g.rotateZ(w,w,d.angle)):g.multiply(w,d.labelPlaneMatrix,l),w}function na(l,h,c,d,E){if(h){var w=g.clone(l);return g.scale(w,w,[E,E,1]),c||g.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Pi(l,h){var c=[l.x,l.y,0,1];La(c,c,h);var d=c[3];return{point:new g.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function zi(l,h){return .5+l/h*.5}function Ra(l,h){var c=l[0]/l[3],d=l[1]/l[3];return c>=-h[0]&&c<=h[0]&&d>=-h[1]&&d<=h[1]}function ou(l,h,c,d,E,w,M,L){var U=d?l.textSizeData:l.iconSizeData,Y=g.evaluateSizeForZoom(U,c.transform.zoom),oe=[256/c.width*2+1,256/c.height*2+1],fe=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;fe.clear();for(var pe=l.lineVertexArray,Re=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Ie=c.transform.width/c.transform.height,Xe=!1,Ae=0;Ae<Re.length;Ae++){var Ye=Re.get(Ae);if(Ye.hidden||Ye.writingMode===g.WritingMode.vertical&&!Xe)fo(Ye.numGlyphs,fe);else{Xe=!1;var it=[Ye.anchorX,Ye.anchorY,0,1];if(g.transformMat4(it,it,h),Ra(it,oe)){var Et=zi(c.transform.cameraToCenterDistance,it[3]),Xt=g.evaluateSizeForFeature(U,Y,Ye),Nt=M?Xt/Et:Xt*Et,tr=new g.Point(Ye.anchorX,Ye.anchorY),mr=Pi(tr,E).point,Dr={},sr=Es(Ye,Nt,!1,L,h,E,w,l.glyphOffsetArray,pe,fe,mr,tr,Dr,Ie);Xe=sr.useVertical,(sr.notEnoughRoom||Xe||sr.needsFlipping&&Es(Ye,Nt,!0,L,h,E,w,l.glyphOffsetArray,pe,fe,mr,tr,Dr,Ie).notEnoughRoom)&&fo(Ye.numGlyphs,fe)}else fo(Ye.numGlyphs,fe)}}d?l.text.dynamicLayoutVertexBuffer.updateData(fe):l.icon.dynamicLayoutVertexBuffer.updateData(fe)}function Sa(l,h,c,d,E,w,M,L,U,Y,oe){var fe=L.glyphStartIndex+L.numGlyphs,pe=L.lineStartIndex,Re=L.lineStartIndex+L.lineLength,Ie=h.getoffsetX(L.glyphStartIndex),Xe=h.getoffsetX(fe-1),Ae=Ji(l*Ie,c,d,E,w,M,L.segment,pe,Re,U,Y,oe);if(!Ae)return null;var Ye=Ji(l*Xe,c,d,E,w,M,L.segment,pe,Re,U,Y,oe);return Ye?{first:Ae,last:Ye}:null}function Ca(l,h,c,d){return l===g.WritingMode.horizontal&&Math.abs(c.y-h.y)>Math.abs(c.x-h.x)*d?{useVertical:!0}:(l===g.WritingMode.vertical?h.y<c.y:h.x>c.x)?{needsFlipping:!0}:null}function Es(l,h,c,d,E,w,M,L,U,Y,oe,fe,pe,Re){var Ie,Xe=h/24,Ae=l.lineOffsetX*Xe,Ye=l.lineOffsetY*Xe;if(l.numGlyphs>1){var it=l.glyphStartIndex+l.numGlyphs,Et=l.lineStartIndex,Xt=l.lineStartIndex+l.lineLength,Nt=Sa(Xe,L,Ae,Ye,c,oe,fe,l,U,w,pe);if(!Nt)return{notEnoughRoom:!0};var tr=Pi(Nt.first.point,M).point,mr=Pi(Nt.last.point,M).point;if(d&&!c){var Dr=Ca(l.writingMode,tr,mr,Re);if(Dr)return Dr}Ie=[Nt.first];for(var sr=l.glyphStartIndex+1;sr<it-1;sr++)Ie.push(Ji(Xe*L.getoffsetX(sr),Ae,Ye,c,oe,fe,l.segment,Et,Xt,U,w,pe));Ie.push(Nt.last)}else{if(d&&!c){var Qr=Pi(fe,E).point,Rn=l.lineStartIndex+l.segment+1,kn=new g.Point(U.getx(Rn),U.gety(Rn)),Fn=Pi(kn,E),Ai=Fn.signedDistanceFromCamera>0?Fn.point:fs(fe,kn,Qr,1,E),un=Ca(l.writingMode,Qr,Ai,Re);if(un)return un}var Sn=Ji(Xe*L.getoffsetX(l.glyphStartIndex),Ae,Ye,c,oe,fe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,pe);if(!Sn)return{notEnoughRoom:!0};Ie=[Sn]}for(var Qn=0,Xn=Ie;Qn<Xn.length;Qn+=1){var Yn=Xn[Qn];g.addDynamicAttributes(Y,Yn.point,Yn.angle)}return{}}function fs(l,h,c,d,E){var w=Pi(l.add(l.sub(h)._unit()),E).point,M=c.sub(w);return c.add(M._mult(d/M.mag()))}function Ji(l,h,c,d,E,w,M,L,U,Y,oe,fe){var pe=d?l-h:l+h,Re=pe>0?1:-1,Ie=0;d&&(Re*=-1,Ie=Math.PI),Re<0&&(Ie+=Math.PI);for(var Xe=Re>0?L+M:L+M+1,Ae=E,Ye=E,it=0,Et=0,Xt=Math.abs(pe),Nt=[];it+Et<=Xt;){if((Xe+=Re)<L||Xe>=U)return null;if(Ye=Ae,Nt.push(Ae),(Ae=fe[Xe])===void 0){var tr=new g.Point(Y.getx(Xe),Y.gety(Xe)),mr=Pi(tr,oe);if(mr.signedDistanceFromCamera>0)Ae=fe[Xe]=mr.point;else{var Dr=Xe-Re;Ae=fs(it===0?w:new g.Point(Y.getx(Dr),Y.gety(Dr)),tr,Ye,Xt-it+1,oe)}}it+=Et,Et=Ye.dist(Ae)}var sr=(Xt-it)/Et,Qr=Ae.sub(Ye),Rn=Qr.mult(sr)._add(Ye);Rn._add(Qr._unit()._perp()._mult(c*Re));var kn=Ie+Math.atan2(Ae.y-Ye.y,Ae.x-Ye.x);return Nt.push(Rn),{point:Rn,angle:kn,path:Nt}}Vi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Vi.prototype.insert=function(l,h,c,d,E){this._forEachCell(h,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Vi.prototype.insertCircle=function(l,h,c,d){this._forEachCell(h-d,c-d,h+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(c),this.circles.push(d)},Vi.prototype._insertBoxCell=function(l,h,c,d,E,w){this.boxCells[E].push(w)},Vi.prototype._insertCircleCell=function(l,h,c,d,E,w){this.circleCells[E].push(w)},Vi.prototype._query=function(l,h,c,d,E,w){if(c<0||l>this.width||d<0||h>this.height)return!E&&[];var M=[];if(l<=0&&h<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)M.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var Y=this.circles[3*U],oe=this.circles[3*U+1],fe=this.circles[3*U+2];M.push({key:this.circleKeys[U],x1:Y-fe,y1:oe-fe,x2:Y+fe,y2:oe+fe})}return w?M.filter(w):M}return this._forEachCell(l,h,c,d,this._queryCell,M,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?M.length>0:M},Vi.prototype._queryCircle=function(l,h,c,d,E){var w=l-c,M=l+c,L=h-c,U=h+c;if(M<0||w>this.width||U<0||L>this.height)return!d&&[];var Y=[];return this._forEachCell(w,L,M,U,this._queryCellCircle,Y,{hitTest:d,circle:{x:l,y:h,radius:c},seenUids:{box:{},circle:{}}},E),d?Y.length>0:Y},Vi.prototype.query=function(l,h,c,d,E){return this._query(l,h,c,d,!1,E)},Vi.prototype.hitTest=function(l,h,c,d,E){return this._query(l,h,c,d,!0,E)},Vi.prototype.hitTestCircle=function(l,h,c,d){return this._queryCircle(l,h,c,!0,d)},Vi.prototype._queryCell=function(l,h,c,d,E,w,M,L){var U=M.seenUids,Y=this.boxCells[E];if(Y!==null)for(var oe=this.bboxes,fe=0,pe=Y;fe<pe.length;fe+=1){var Re=pe[fe];if(!U.box[Re]){U.box[Re]=!0;var Ie=4*Re;if(l<=oe[Ie+2]&&h<=oe[Ie+3]&&c>=oe[Ie+0]&&d>=oe[Ie+1]&&(!L||L(this.boxKeys[Re]))){if(M.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Re],x1:oe[Ie],y1:oe[Ie+1],x2:oe[Ie+2],y2:oe[Ie+3]})}}}var Xe=this.circleCells[E];if(Xe!==null)for(var Ae=this.circles,Ye=0,it=Xe;Ye<it.length;Ye+=1){var Et=it[Ye];if(!U.circle[Et]){U.circle[Et]=!0;var Xt=3*Et;if(this._circleAndRectCollide(Ae[Xt],Ae[Xt+1],Ae[Xt+2],l,h,c,d)&&(!L||L(this.circleKeys[Et]))){if(M.hitTest)return w.push(!0),!0;var Nt=Ae[Xt],tr=Ae[Xt+1],mr=Ae[Xt+2];w.push({key:this.circleKeys[Et],x1:Nt-mr,y1:tr-mr,x2:Nt+mr,y2:tr+mr})}}}},Vi.prototype._queryCellCircle=function(l,h,c,d,E,w,M,L){var U=M.circle,Y=M.seenUids,oe=this.boxCells[E];if(oe!==null)for(var fe=this.bboxes,pe=0,Re=oe;pe<Re.length;pe+=1){var Ie=Re[pe];if(!Y.box[Ie]){Y.box[Ie]=!0;var Xe=4*Ie;if(this._circleAndRectCollide(U.x,U.y,U.radius,fe[Xe+0],fe[Xe+1],fe[Xe+2],fe[Xe+3])&&(!L||L(this.boxKeys[Ie])))return w.push(!0),!0}}var Ae=this.circleCells[E];if(Ae!==null)for(var Ye=this.circles,it=0,Et=Ae;it<Et.length;it+=1){var Xt=Et[it];if(!Y.circle[Xt]){Y.circle[Xt]=!0;var Nt=3*Xt;if(this._circlesCollide(Ye[Nt],Ye[Nt+1],Ye[Nt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Xt])))return w.push(!0),!0}}},Vi.prototype._forEachCell=function(l,h,c,d,E,w,M,L){for(var U=this._convertToXCellCoord(l),Y=this._convertToYCellCoord(h),oe=this._convertToXCellCoord(c),fe=this._convertToYCellCoord(d),pe=U;pe<=oe;pe++)for(var Re=Y;Re<=fe;Re++)if(E.call(this,l,h,c,d,this.xCellCount*Re+pe,w,M,L))return},Vi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Vi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Vi.prototype._circlesCollide=function(l,h,c,d,E,w){var M=d-l,L=E-h,U=c+w;return U*U>M*M+L*L},Vi.prototype._circleAndRectCollide=function(l,h,c,d,E,w,M){var L=(w-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var Y=(M-E)/2,oe=Math.abs(h-(E+Y));if(oe>Y+c)return!1;if(U<=L||oe<=Y)return!0;var fe=U-L,pe=oe-Y;return fe*fe+pe*pe<=c*c};var Xu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fo(l,h){for(var c=0;c<l;c++){var d=h.length;h.resize(d+4),h.float32.set(Xu,3*d)}}function La(l,h,c){var d=h[0],E=h[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var $a=function(l,h,c){h===void 0&&(h=new Vi(l.width+200,l.height+200,25)),c===void 0&&(c=new Vi(l.width+200,l.height+200,25)),this.transform=l,this.grid=h,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Xi(l,h,c){return h*(g.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}$a.prototype.placeCollisionBox=function(l,h,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),M=c*w.perspectiveRatio,L=l.x1*M+w.point.x,U=l.y1*M+w.point.y,Y=l.x2*M+w.point.x,oe=l.y2*M+w.point.y;return!this.isInsideGrid(L,U,Y,oe)||!h&&this.grid.hitTest(L,U,Y,oe,E)?{box:[],offscreen:!1}:{box:[L,U,Y,oe],offscreen:this.isOffscreen(L,U,Y,oe)}},$a.prototype.placeCollisionCircles=function(l,h,c,d,E,w,M,L,U,Y,oe,fe,pe){var Re=[],Ie=new g.Point(h.anchorX,h.anchorY),Xe=Pi(Ie,w),Ae=zi(this.transform.cameraToCenterDistance,Xe.signedDistanceFromCamera),Ye=(Y?E/Ae:E*Ae)/g.ONE_EM,it=Pi(Ie,M).point,Et=Sa(Ye,d,h.lineOffsetX*Ye,h.lineOffsetY*Ye,!1,it,Ie,h,c,M,{}),Xt=!1,Nt=!1,tr=!0;if(Et){for(var mr=.5*fe*Ae+pe,Dr=new g.Point(-100,-100),sr=new g.Point(this.screenRightBoundary,this.screenBottomBoundary),Qr=new ti,Rn=Et.first,kn=Et.last,Fn=[],Ai=Rn.path.length-1;Ai>=1;Ai--)Fn.push(Rn.path[Ai]);for(var un=1;un<kn.path.length;un++)Fn.push(kn.path[un]);var Sn=2.5*mr;if(L){var Qn=Fn.map(function(As){return Pi(As,L)});Fn=Qn.some(function(As){return As.signedDistanceFromCamera<=0})?[]:Qn.map(function(As){return As.point})}var Xn=[];if(Fn.length>0){for(var Yn=Fn[0].clone(),di=Fn[0].clone(),jn=1;jn<Fn.length;jn++)Yn.x=Math.min(Yn.x,Fn[jn].x),Yn.y=Math.min(Yn.y,Fn[jn].y),di.x=Math.max(di.x,Fn[jn].x),di.y=Math.max(di.y,Fn[jn].y);Xn=Yn.x>=Dr.x&&di.x<=sr.x&&Yn.y>=Dr.y&&di.y<=sr.y?[Fn]:di.x<Dr.x||Yn.x>sr.x||di.y<Dr.y||Yn.y>sr.y?[]:g.clipLine([Fn],Dr.x,Dr.y,sr.x,sr.y)}for(var Tn=0,qi=Xn;Tn<qi.length;Tn+=1){var Ya;Qr.reset(qi[Tn],.25*mr),Ya=Qr.length<=.5*mr?1:Math.ceil(Qr.paddedLength/Sn)+1;for(var ni=0;ni<Ya;ni++){var zo=ni/Math.max(Ya-1,1),Va=Qr.lerp(zo),to=Va.x+100,is=Va.y+100;Re.push(to,is,mr,0);var vs=to-mr,Fu=is-mr,as=to+mr,Vs=is+mr;if(tr=tr&&this.isOffscreen(vs,Fu,as,Vs),Nt=Nt||this.isInsideGrid(vs,Fu,as,Vs),!l&&this.grid.hitTestCircle(to,is,mr,oe)&&(Xt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Xt}}}}return{circles:!U&&Xt||!Nt?[]:Re,offscreen:tr,collisionDetected:Xt}},$a.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],c=1/0,d=1/0,E=-1/0,w=-1/0,M=0,L=l;M<L.length;M+=1){var U=L[M],Y=new g.Point(U.x+100,U.y+100);c=Math.min(c,Y.x),d=Math.min(d,Y.y),E=Math.max(E,Y.x),w=Math.max(w,Y.y),h.push(Y)}for(var oe={},fe={},pe=0,Re=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));pe<Re.length;pe+=1){var Ie=Re[pe],Xe=Ie.key;if(oe[Xe.bucketInstanceId]===void 0&&(oe[Xe.bucketInstanceId]={}),!oe[Xe.bucketInstanceId][Xe.featureIndex]){var Ae=[new g.Point(Ie.x1,Ie.y1),new g.Point(Ie.x2,Ie.y1),new g.Point(Ie.x2,Ie.y2),new g.Point(Ie.x1,Ie.y2)];g.polygonIntersectsPolygon(h,Ae)&&(oe[Xe.bucketInstanceId][Xe.featureIndex]=!0,fe[Xe.bucketInstanceId]===void 0&&(fe[Xe.bucketInstanceId]=[]),fe[Xe.bucketInstanceId].push(Xe.featureIndex))}}return fe},$a.prototype.insertCollisionBox=function(l,h,c,d,E){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},$a.prototype.insertCollisionCircles=function(l,h,c,d,E){for(var w=h?this.ignoredGrid:this.grid,M={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(M,l[L],l[L+1],l[L+2])},$a.prototype.projectAndGetPerspectiveRatio=function(l,h,c){var d=[h,c,0,1];return La(d,d,l),{point:new g.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},$a.prototype.isOffscreen=function(l,h,c,d){return c<100||l>=this.screenRightBoundary||d<100||h>this.screenBottomBoundary},$a.prototype.isInsideGrid=function(l,h,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&h<this.gridBottomBoundary},$a.prototype.getViewportMatrix=function(){var l=g.identity([]);return g.translate(l,l,[-100,-100,0]),l};var Ho=function(l,h,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):d&&c?1:0,this.placed=c};Ho.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Wo=function(l,h,c,d,E){this.text=new Ho(l?l.text:null,h,c,E),this.icon=new Ho(l?l.icon:null,h,d,E)};Wo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Yu=function(l,h,c){this.text=l,this.icon=h,this.skipFade=c},go=function(){this.invProjMatrix=g.create(),this.viewportMatrix=g.create(),this.circles=[]},Xo=function(l,h,c,d,E){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},pa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function ho(l,h,c,d,E){var w=g.getAnchorAlignment(l),M=-(w.horizontalAlign-.5)*h,L=-(w.verticalAlign-.5)*c,U=g.evaluateVariableOffset(l,d);return new g.Point(M+U[0]*E,L+U[1]*E)}function Yo(l,h,c,d,E,w){var M=l.x1,L=l.x2,U=l.y1,Y=l.y2,oe=l.anchorPointX,fe=l.anchorPointY,pe=new g.Point(h,c);return d&&pe._rotate(E?w:-w),{x1:M+pe.x,y1:U+pe.y,x2:L+pe.x,y2:Y+pe.y,anchorPointX:oe,anchorPointY:fe}}pa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:function(c){return c.collisionGroupID===h}}}return this.collisionGroups[l]};var Qa=function(l,h,c,d){this.transform=l.clone(),this.collisionIndex=new $a(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new pa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function su(l,h,c,d,E){l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0)}Qa.prototype.getBucketParts=function(l,h,c,d){var E=c.getBucket(h),w=c.latestFeatureIndex;if(E&&w&&h.id===E.layerIds[0]){var M=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),Y=c.tileSize/g.EXTENT,oe=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),fe=L.get("text-pitch-alignment")==="map",pe=L.get("text-rotation-alignment")==="map",Re=Xi(c,1,this.transform.zoom),Ie=Ta(oe,fe,pe,this.transform,Re),Xe=null;if(fe){var Ae=na(oe,fe,pe,this.transform,Re);Xe=g.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[E.bucketInstanceId]=new Xo(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var Ye={bucket:E,layout:L,posMatrix:oe,textLabelPlaneMatrix:Ie,labelToScreenMatrix:Xe,scale:U,textPixelRatio:Y,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var it=0,Et=E.sortKeyRanges;it<Et.length;it+=1){var Xt=Et[it];l.push({sortKey:Xt.sortKey,symbolInstanceStart:Xt.symbolInstanceStart,symbolInstanceEnd:Xt.symbolInstanceEnd,parameters:Ye})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ye})}},Qa.prototype.attemptAnchorPlacement=function(l,h,c,d,E,w,M,L,U,Y,oe,fe,pe,Re,Ie){var Xe,Ae=[fe.textOffset0,fe.textOffset1],Ye=ho(l,c,d,Ae,E),it=this.collisionIndex.placeCollisionBox(Yo(h,Ye.x,Ye.y,w,M,this.transform.angle),oe,L,U,Y.predicate);if(!Ie||this.collisionIndex.placeCollisionBox(Yo(Ie,Ye.x,Ye.y,w,M,this.transform.angle),oe,L,U,Y.predicate).box.length!==0)return it.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),this.variableOffsets[fe.crossTileID]={textOffset:Ae,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:Xe},this.markUsedJustification(pe,l,fe,Re),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Re,fe),this.placedOrientations[fe.crossTileID]=Re),{shift:Ye,placedGlyphBoxes:it}):void 0},Qa.prototype.placeLayerBucketPart=function(l,h,c){var d=this,E=l.parameters,w=E.bucket,M=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,Y=E.labelToScreenMatrix,oe=E.textPixelRatio,fe=E.holdingForFade,pe=E.collisionBoxArray,Re=E.partiallyEvaluatedTextSize,Ie=E.collisionGroup,Xe=M.get("text-optional"),Ae=M.get("icon-optional"),Ye=M.get("text-allow-overlap"),it=M.get("icon-allow-overlap"),Et=M.get("text-rotation-alignment")==="map",Xt=M.get("text-pitch-alignment")==="map",Nt=M.get("icon-text-fit")!=="none",tr=M.get("symbol-z-order")==="viewport-y",mr=Ye&&(it||!w.hasIconData()||Ae),Dr=it&&(Ye||!w.hasTextData()||Xe);!w.collisionArrays&&pe&&w.deserializeCollisionBoxes(pe);var sr=function(un,Sn){if(!h[un.crossTileID])if(fe)d.placements[un.crossTileID]=new Yu(!1,!1,!1);else{var Qn,Xn=!1,Yn=!1,di=!0,jn=null,Tn={box:null,offscreen:null},qi={box:null,offscreen:null},Ya=null,ni=null,zo=0,Va=0,to=0;Sn.textFeatureIndex?zo=Sn.textFeatureIndex:un.useRuntimeCollisionCircles&&(zo=un.featureIndex),Sn.verticalTextFeatureIndex&&(Va=Sn.verticalTextFeatureIndex);var is=Sn.textBox;if(is){var vs=function(ea){var Uo=g.WritingMode.horizontal;if(w.allowVerticalPlacement&&!ea&&d.prevPlacement){var ms=d.prevPlacement.placedOrientations[un.crossTileID];ms&&(d.placedOrientations[un.crossTileID]=ms,d.markUsedOrientation(w,Uo=ms,un))}return Uo},Fu=function(ea,Uo){if(w.allowVerticalPlacement&&un.numVerticalGlyphVertices>0&&Sn.verticalTextBox)for(var ms=0,zu=w.writingModes;ms<zu.length&&(zu[ms]===g.WritingMode.vertical?(Tn=Uo(),qi=Tn):Tn=ea(),!(Tn&&Tn.box&&Tn.box.length));ms+=1);else Tn=ea()};if(M.get("text-variable-anchor")){var as=M.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[un.crossTileID]){var Vs=d.prevPlacement.variableOffsets[un.crossTileID];as.indexOf(Vs.anchor)>0&&(as=as.filter(function(ea){return ea!==Vs.anchor})).unshift(Vs.anchor)}var As=function(ea,Uo,ms){for(var zu=ea.x2-ea.x1,gc=ea.y2-ea.y1,Kl=un.textBoxScale,xf=Nt&&!it?Uo:null,Qs={box:[],offscreen:!1},yc=Ye?2*as.length:as.length,Js=0;Js<yc;++Js){var Ol=d.attemptAnchorPlacement(as[Js%as.length],ea,zu,gc,Kl,Et,Xt,oe,L,Ie,Js>=as.length,un,w,ms,xf);if(Ol&&(Qs=Ol.placedGlyphBoxes)&&Qs.box&&Qs.box.length){Xn=!0,jn=Ol.shift;break}}return Qs};Fu(function(){return As(is,Sn.iconBox,g.WritingMode.horizontal)},function(){var ea=Sn.verticalTextBox;return w.allowVerticalPlacement&&!(Tn&&Tn.box&&Tn.box.length)&&un.numVerticalGlyphVertices>0&&ea?As(ea,Sn.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null}}),Tn&&(Xn=Tn.box,di=Tn.offscreen);var Vc=vs(Tn&&Tn.box);if(!Xn&&d.prevPlacement){var Pl=d.prevPlacement.variableOffsets[un.crossTileID];Pl&&(d.variableOffsets[un.crossTileID]=Pl,d.markUsedJustification(w,Pl.anchor,un,Vc))}}else{var Bu=function(ea,Uo){var ms=d.collisionIndex.placeCollisionBox(ea,Ye,oe,L,Ie.predicate);return ms&&ms.box&&ms.box.length&&(d.markUsedOrientation(w,Uo,un),d.placedOrientations[un.crossTileID]=Uo),ms};Fu(function(){return Bu(is,g.WritingMode.horizontal)},function(){var ea=Sn.verticalTextBox;return w.allowVerticalPlacement&&un.numVerticalGlyphVertices>0&&ea?Bu(ea,g.WritingMode.vertical):{box:null,offscreen:null}}),vs(Tn&&Tn.box&&Tn.box.length)}}if(Xn=(Qn=Tn)&&Qn.box&&Qn.box.length>0,di=Qn&&Qn.offscreen,un.useRuntimeCollisionCircles){var ql=w.text.placedSymbolArray.get(un.centerJustifiedTextSymbolIndex),mc=g.evaluateSizeForFeature(w.textSizeData,Re,ql),$s=M.get("text-padding");Ya=d.collisionIndex.placeCollisionCircles(Ye,ql,w.lineVertexArray,w.glyphOffsetArray,mc,L,U,Y,c,Xt,Ie.predicate,un.collisionCircleDiameter,$s),Xn=Ye||Ya.circles.length>0&&!Ya.collisionDetected,di=di&&Ya.offscreen}if(Sn.iconFeatureIndex&&(to=Sn.iconFeatureIndex),Sn.iconBox){var Il=function(ea){var Uo=Nt&&jn?Yo(ea,jn.x,jn.y,Et,Xt,d.transform.angle):ea;return d.collisionIndex.placeCollisionBox(Uo,it,oe,L,Ie.predicate)};Yn=qi&&qi.box&&qi.box.length&&Sn.verticalIconBox?(ni=Il(Sn.verticalIconBox)).box.length>0:(ni=Il(Sn.iconBox)).box.length>0,di=di&&ni.offscreen}var wu=Xe||un.numHorizontalGlyphVertices===0&&un.numVerticalGlyphVertices===0,xo=Ae||un.numIconVertices===0;if(wu||xo?xo?wu||(Yn=Yn&&Xn):Xn=Yn&&Xn:Yn=Xn=Yn&&Xn,Xn&&Qn&&Qn.box&&d.collisionIndex.insertCollisionBox(Qn.box,M.get("text-ignore-placement"),w.bucketInstanceId,qi&&qi.box&&Va?Va:zo,Ie.ID),Yn&&ni&&d.collisionIndex.insertCollisionBox(ni.box,M.get("icon-ignore-placement"),w.bucketInstanceId,to,Ie.ID),Ya&&(Xn&&d.collisionIndex.insertCollisionCircles(Ya.circles,M.get("text-ignore-placement"),w.bucketInstanceId,zo,Ie.ID),c)){var Nu=w.bucketInstanceId,ul=d.collisionCircleArrays[Nu];ul===void 0&&(ul=d.collisionCircleArrays[Nu]=new go);for(var $o=0;$o<Ya.circles.length;$o+=4)ul.circles.push(Ya.circles[$o+0]),ul.circles.push(Ya.circles[$o+1]),ul.circles.push(Ya.circles[$o+2]),ul.circles.push(Ya.collisionDetected?1:0)}d.placements[un.crossTileID]=new Yu(Xn||mr,Yn||Dr,di||w.justReloaded),h[un.crossTileID]=!0}};if(tr)for(var Qr=w.getSortedSymbolIndexes(this.transform.angle),Rn=Qr.length-1;Rn>=0;--Rn){var kn=Qr[Rn];sr(w.symbolInstances.get(kn),w.collisionArrays[kn])}else for(var Fn=l.symbolInstanceStart;Fn<l.symbolInstanceEnd;Fn++)sr(w.symbolInstances.get(Fn),w.collisionArrays[Fn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Ai=this.collisionCircleArrays[w.bucketInstanceId];g.invert(Ai.invProjMatrix,L),Ai.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Qa.prototype.markUsedJustification=function(l,h,c,d){var E;E=d===g.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(h)];for(var w=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<M.length;w+=1){var L=M[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},Qa.prototype.markUsedOrientation=function(l,h,c){for(var d=h===g.WritingMode.horizontal||h===g.WritingMode.horizontalOnly?h:0,E=h===g.WritingMode.vertical?h:0,w=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<M.length;w+=1)l.text.placedSymbolArray.get(M[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Qa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,c=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var d=h?h.symbolFadeChange(l):1,E=h?h.opacities:{},w=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],Y=E[L];Y?(this.opacities[L]=new Wo(Y,d,U.text,U.icon),c=c||U.text!==Y.text.placed||U.icon!==Y.icon.placed):(this.opacities[L]=new Wo(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var oe in E){var fe=E[oe];if(!this.opacities[oe]){var pe=new Wo(fe,d,!1,!1);pe.isHidden()||(this.opacities[oe]=pe,c=c||fe.text.placed||fe.icon.placed)}}for(var Re in w)this.variableOffsets[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.variableOffsets[Re]=w[Re]);for(var Ie in M)this.placedOrientations[Ie]||!this.opacities[Ie]||this.opacities[Ie].isHidden()||(this.placedOrientations[Ie]=M[Ie]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)},Qa.prototype.updateLayerOpacities=function(l,h){for(var c={},d=0,E=h;d<E.length;d+=1){var w=E[d],M=w.getBucket(l);M&&w.latestFeatureIndex&&l.id===M.layerIds[0]&&this.updateBucketOpacities(M,c,w.collisionBoxArray)}},Qa.prototype.updateBucketOpacities=function(l,h,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new Wo(null,0,!1,!1,!0),M=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),Y=E.get("text-rotation-alignment")==="map",oe=E.get("text-pitch-alignment")==="map",fe=E.get("icon-text-fit")!=="none",pe=new Wo(null,0,M&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(M||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Re=function(Ye,it,Et){for(var Xt=0;Xt<it/4;Xt++)Ye.opacityVertexArray.emplaceBack(Et)},Ie=function(Ye){var it=l.symbolInstances.get(Ye),Et=it.numHorizontalGlyphVertices,Xt=it.numVerticalGlyphVertices,Nt=it.crossTileID,tr=d.opacities[Nt];h[Nt]?tr=w:tr||(d.opacities[Nt]=tr=pe),h[Nt]=!0;var mr=it.numIconVertices>0,Dr=d.placedOrientations[it.crossTileID],sr=Dr===g.WritingMode.vertical,Qr=Dr===g.WritingMode.horizontal||Dr===g.WritingMode.horizontalOnly;if(Et>0||Xt>0){var Rn=lt(tr.text);Re(l.text,Et,sr?Ct:Rn),Re(l.text,Xt,Qr?Ct:Rn);var kn=tr.text.isHidden();[it.rightJustifiedTextSymbolIndex,it.centerJustifiedTextSymbolIndex,it.leftJustifiedTextSymbolIndex].forEach(function(Tn){Tn>=0&&(l.text.placedSymbolArray.get(Tn).hidden=kn||sr?1:0)}),it.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(it.verticalPlacedTextSymbolIndex).hidden=kn||Qr?1:0);var Fn=d.variableOffsets[it.crossTileID];Fn&&d.markUsedJustification(l,Fn.anchor,it,Dr);var Ai=d.placedOrientations[it.crossTileID];Ai&&(d.markUsedJustification(l,"left",it,Ai),d.markUsedOrientation(l,Ai,it))}if(mr){var un=lt(tr.icon),Sn=!(fe&&it.verticalPlacedIconSymbolIndex&&sr);it.placedIconSymbolIndex>=0&&(Re(l.icon,it.numIconVertices,Sn?un:Ct),l.icon.placedSymbolArray.get(it.placedIconSymbolIndex).hidden=tr.icon.isHidden()),it.verticalPlacedIconSymbolIndex>=0&&(Re(l.icon,it.numVerticalIconVertices,Sn?Ct:un),l.icon.placedSymbolArray.get(it.verticalPlacedIconSymbolIndex).hidden=tr.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var Qn=l.collisionArrays[Ye];if(Qn){var Xn=new g.Point(0,0);if(Qn.textBox||Qn.verticalTextBox){var Yn=!0;if(U){var di=d.variableOffsets[Nt];di?(Xn=ho(di.anchor,di.width,di.height,di.textOffset,di.textBoxScale),Y&&Xn._rotate(oe?d.transform.angle:-d.transform.angle)):Yn=!1}Qn.textBox&&su(l.textCollisionBox.collisionVertexArray,tr.text.placed,!Yn||sr,Xn.x,Xn.y),Qn.verticalTextBox&&su(l.textCollisionBox.collisionVertexArray,tr.text.placed,!Yn||Qr,Xn.x,Xn.y)}var jn=Boolean(!Qr&&Qn.verticalIconBox);Qn.iconBox&&su(l.iconCollisionBox.collisionVertexArray,tr.icon.placed,jn,fe?Xn.x:0,fe?Xn.y:0),Qn.verticalIconBox&&su(l.iconCollisionBox.collisionVertexArray,tr.icon.placed,!jn,fe?Xn.x:0,fe?Xn.y:0)}}},Xe=0;Xe<l.symbolInstances.length;Xe++)Ie(Xe);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ae.invProjMatrix,l.placementViewportMatrix=Ae.viewportMatrix,l.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Qa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Qa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Qa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Qa.prototype.stillRecent=function(l,h){var c=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*c>l},Qa.prototype.setStale=function(){this.stale=!0};var Lc=Math.pow(2,25),Ds=Math.pow(2,24),Q=Math.pow(2,17),be=Math.pow(2,16),Je=Math.pow(2,9),Ft=Math.pow(2,8),Lr=Math.pow(2,1);function lt(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var h=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Lc+h*Ds+c*Q+h*be+c*Je+h*Ft+c*Lr+h}var Ct=0,Ja=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Ja.prototype.continuePlacement=function(l,h,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(h.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(M,L){return M.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Yi=function(l,h,c,d,E,w,M){this.placement=new Qa(l,E,w,M),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Yi.prototype.isDone=function(){return this._done},Yi.prototype.continuePlacement=function(l,h,c){for(var d=this,E=g.browser.now(),w=function(){var U=g.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var M=h[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=L)&&(!M.maxzoom||M.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new Ja(M)),this._inProgressLayer.continuePlacement(c[M.source],this.placement,this._showCollisionBoxes,M,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Yi.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Za=512/g.EXTENT/2,qo=function(l,h,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<h.length;d++){var E=h.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};qo.prototype.getScaledCoordinates=function(l,h){var c=Za/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*g.EXTENT+l.anchorX)*c),y:Math.floor((h.canonical.y*g.EXTENT+l.anchorY)*c)}},qo.prototype.findMatches=function(l,h,c){for(var d=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var M=this.indexedSymbolInstances[w.key];if(M)for(var L=this.getScaledCoordinates(w,h),U=0,Y=M;U<Y.length;U+=1){var oe=Y[U];if(Math.abs(oe.coord.x-L.x)<=d&&Math.abs(oe.coord.y-L.y)<=d&&!c[oe.crossTileID]){c[oe.crossTileID]=!0,w.crossTileID=oe.crossTileID;break}}}}};var Yr=function(){this.maxCrossTileID=0};Yr.prototype.generate=function(){return++this.maxCrossTileID};var jr=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};jr.prototype.handleWrapJump=function(l){var h=Math.round((l-this.lng)/360);if(h!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var M=d[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),E[M.tileID.key]=M}this.indexes[c]=E}this.lng=l},jr.prototype.addBucket=function(l,h,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<h.symbolInstances.length;d++)h.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var M=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in M){var U=M[L];U.tileID.isChildOf(l)&&U.findMatches(h.symbolInstances,l,E)}else{var Y=M[l.scaledTo(Number(w)).key];Y&&Y.findMatches(h.symbolInstances,l,E)}}for(var oe=0;oe<h.symbolInstances.length;oe++){var fe=h.symbolInstances.get(oe);fe.crossTileID||(fe.crossTileID=c.generate(),E[fe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new qo(l,h.symbolInstances,h.bucketInstanceId),!0},jr.prototype.removeBucketCrossTileIDs=function(l,h){for(var c in h.indexedSymbolInstances)for(var d=0,E=h.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},jr.prototype.removeStaleBuckets=function(l){var h=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],h=!0)}return h};var It=function(){this.layerIndexes={},this.crossTileIDs=new Yr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};It.prototype.addLayer=function(l,h,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new jr);var E=!1,w={};d.handleWrapJump(c);for(var M=0,L=h;M<L.length;M+=1){var U=L[M],Y=U.getBucket(l);Y&&l.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,Y,this.crossTileIDs)&&(E=!0),w[Y.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},It.prototype.pruneUnusedLayers=function(l){var h={};for(var c in l.forEach(function(d){h[d]=!0}),this.layerIndexes)h[c]||delete this.layerIndexes[c]};var Fo=function(l,h){return g.emitValidationErrors(l,h&&h.filter(function(c){return c.identifier!=="source.canvas"}))},ae=g.pick(Hr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Xs=g.pick(Hr,["setCenter","setZoom","setBearing","setPitch"]),uu=function(){var l={},h=g.styleSpec.$version;for(var c in g.styleSpec.$root){var d,E=g.styleSpec.$root[c];E.required&&(d=c==="version"?h:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),hs=function(l){function h(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new $t(Lt(),this),this.imageManager=new Pt,this.imageManager.setEventedParent(this),this.glyphManager=new Qt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new et(256,512),this.crossTileSymbolIndex=new It,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());var w=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(M){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(L,U){if(g.triggerPluginCompletionEvent(L),U&&U.every(function(oe){return oe}))for(var Y in w.sourceCaches)w.sourceCaches[Y].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var L=E.sourceCaches[M.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var Y in E._layers){var oe=E._layers[Y];oe.source===U.id&&E._validateLayer(oe)}}}})}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new g.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!g.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var M=this.map._requestManager.transformRequest(c,g.ResourceType.Style);this._request=g.getJSON(M,function(L,U){E._request=null,L?E.fire(new g.ErrorEvent(L)):U&&E._load(U,w)})},h.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(uu,!1)},h.prototype._load=function(c,d){if(!d||!Fo(this,g.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Zr(this.stylesheet.layers);this._order=w.map(function(Y){return Y.id}),this._layers={},this._serializedLayers={};for(var M=0,L=w;M<L.length;M+=1){var U=L[M];(U=g.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new wt(this.stylesheet.light),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}},h.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,M){var L,U,Y,oe=g.browser.devicePixelRatio>1?"@2x":"",fe=g.getJSON(w.transformRequest(w.normalizeSpriteURL(E,oe,".json"),g.ResourceType.SpriteJSON),function(Ie,Xe){fe=null,Y||(Y=Ie,L=Xe,Re())}),pe=g.getImage(w.transformRequest(w.normalizeSpriteURL(E,oe,".png"),g.ResourceType.SpriteImage),function(Ie,Xe){pe=null,Y||(Y=Ie,U=Xe,Re())});function Re(){if(Y)M(Y);else if(L&&U){var Ie=g.browser.getImageData(U),Xe={};for(var Ae in L){var Ye=L[Ae],it=Ye.width,Et=Ye.height,Xt=Ye.x,Nt=Ye.y,tr=Ye.sdf,mr=Ye.pixelRatio,Dr=Ye.stretchX,sr=Ye.stretchY,Qr=Ye.content,Rn=new g.RGBAImage({width:it,height:Et});g.RGBAImage.copy(Ie,Rn,{x:Xt,y:Nt},{x:0,y:0},{width:it,height:Et}),Xe[Ae]={data:Rn,pixelRatio:mr,sdf:tr,stretchX:Dr,stretchY:sr,content:Qr}}M(null,Xe)}}return{cancel:function(){fe&&(fe.cancel(),fe=null),pe&&(pe.cancel(),pe=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new g.ErrorEvent(E));else if(w)for(var M in w)d.imageManager.addImage(M,w[M]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new g.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new g.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var M=this._layers[w[E]];M.type!=="custom"&&d.push(M.serialize())}return d},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var M in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[M];L==="reload"?this._reloadSource(M):L==="clear"&&this._clearSource(M)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var Y={};for(var oe in this.sourceCaches){var fe=this.sourceCaches[oe];Y[oe]=fe.used,fe.used=!1}for(var pe=0,Re=this._order;pe<Re.length;pe+=1){var Ie=this._layers[Re[pe]];Ie.recalculate(c,this._availableImages),!Ie.isHidden(c.zoom)&&Ie.source&&(this.sourceCaches[Ie.source].used=!0)}for(var Xe in Y){var Ae=this.sourceCaches[Xe];Y[Xe]!==Ae.used&&Ae.fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Xe}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new g.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},h.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(c){var d=this;if(this._checkLoaded(),Fo(this,g.validateStyle(c)))return!1;(c=g.clone$1(c)).layers=Zr(c.layers);var E=function(M,L){if(!M)return[{command:Hr.setStyle,args:[L]}];var U=[];try{if(!g.deepEqual(M.version,L.version))return[{command:Hr.setStyle,args:[L]}];g.deepEqual(M.center,L.center)||U.push({command:Hr.setCenter,args:[L.center]}),g.deepEqual(M.zoom,L.zoom)||U.push({command:Hr.setZoom,args:[L.zoom]}),g.deepEqual(M.bearing,L.bearing)||U.push({command:Hr.setBearing,args:[L.bearing]}),g.deepEqual(M.pitch,L.pitch)||U.push({command:Hr.setPitch,args:[L.pitch]}),g.deepEqual(M.sprite,L.sprite)||U.push({command:Hr.setSprite,args:[L.sprite]}),g.deepEqual(M.glyphs,L.glyphs)||U.push({command:Hr.setGlyphs,args:[L.glyphs]}),g.deepEqual(M.transition,L.transition)||U.push({command:Hr.setTransition,args:[L.transition]}),g.deepEqual(M.light,L.light)||U.push({command:Hr.setLight,args:[L.light]});var Y={},oe=[];(function(pe,Re,Ie,Xe){var Ae;for(Ae in Re=Re||{},pe=pe||{})pe.hasOwnProperty(Ae)&&(Re.hasOwnProperty(Ae)||tn(Ae,Ie,Xe));for(Ae in Re)Re.hasOwnProperty(Ae)&&(pe.hasOwnProperty(Ae)?g.deepEqual(pe[Ae],Re[Ae])||(pe[Ae].type==="geojson"&&Re[Ae].type==="geojson"&&$i(pe,Re,Ae)?Ie.push({command:Hr.setGeoJSONSourceData,args:[Ae,Re[Ae].data]}):Si(Ae,Re,Ie,Xe)):oi(Ae,Re,Ie))})(M.sources,L.sources,oe,Y);var fe=[];M.layers&&M.layers.forEach(function(pe){Y[pe.source]?U.push({command:Hr.removeLayer,args:[pe.id]}):fe.push(pe)}),U=U.concat(oe),function(pe,Re,Ie){Re=Re||[];var Xe,Ae,Ye,it,Et,Xt,Nt,tr=(pe=pe||[]).map(Mi),mr=Re.map(Mi),Dr=pe.reduce(xi,{}),sr=Re.reduce(xi,{}),Qr=tr.slice(),Rn=Object.create(null);for(Xe=0,Ae=0;Xe<tr.length;Xe++)sr.hasOwnProperty(Ye=tr[Xe])?Ae++:(Ie.push({command:Hr.removeLayer,args:[Ye]}),Qr.splice(Qr.indexOf(Ye,Ae),1));for(Xe=0,Ae=0;Xe<mr.length;Xe++)Qr[Qr.length-1-Xe]!==(Ye=mr[mr.length-1-Xe])&&(Dr.hasOwnProperty(Ye)?(Ie.push({command:Hr.removeLayer,args:[Ye]}),Qr.splice(Qr.lastIndexOf(Ye,Qr.length-Ae),1)):Ae++,Ie.push({command:Hr.addLayer,args:[sr[Ye],Xt=Qr[Qr.length-Xe]]}),Qr.splice(Qr.length-Xe,0,Ye),Rn[Ye]=!0);for(Xe=0;Xe<mr.length;Xe++)if(it=Dr[Ye=mr[Xe]],Et=sr[Ye],!Rn[Ye]&&!g.deepEqual(it,Et))if(g.deepEqual(it.source,Et.source)&&g.deepEqual(it["source-layer"],Et["source-layer"])&&g.deepEqual(it.type,Et.type)){for(Nt in yi(it.layout,Et.layout,Ie,Ye,null,Hr.setLayoutProperty),yi(it.paint,Et.paint,Ie,Ye,null,Hr.setPaintProperty),g.deepEqual(it.filter,Et.filter)||Ie.push({command:Hr.setFilter,args:[Ye,Et.filter]}),g.deepEqual(it.minzoom,Et.minzoom)&&g.deepEqual(it.maxzoom,Et.maxzoom)||Ie.push({command:Hr.setLayerZoomRange,args:[Ye,Et.minzoom,Et.maxzoom]}),it)it.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?yi(it[Nt],Et[Nt],Ie,Ye,Nt.slice(6),Hr.setPaintProperty):g.deepEqual(it[Nt],Et[Nt])||Ie.push({command:Hr.setLayerProperty,args:[Ye,Nt,Et[Nt]]}));for(Nt in Et)Et.hasOwnProperty(Nt)&&!it.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?yi(it[Nt],Et[Nt],Ie,Ye,Nt.slice(6),Hr.setPaintProperty):g.deepEqual(it[Nt],Et[Nt])||Ie.push({command:Hr.setLayerProperty,args:[Ye,Nt,Et[Nt]]}))}else Ie.push({command:Hr.removeLayer,args:[Ye]}),Xt=Qr[Qr.lastIndexOf(Ye)+1],Ie.push({command:Hr.addLayer,args:[Et,Xt]})}(fe,L.layers,U)}catch(pe){console.warn("Unable to compute style diff:",pe),U=[{command:Hr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(M){return!(M.command in Xs)});if(E.length===0)return!1;var w=E.filter(function(M){return!(M.command in ae)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(M){return M.command}).join(", ")+".");return E.forEach(function(M){M.command!=="setTransition"&&d[M.command].apply(d,M.args)}),this.stylesheet=c,!0},h.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new g.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},h.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},h.prototype.getImage=function(c){return this.imageManager.getImage(c)},h.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new g.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},h.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(g.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var M=this.sourceCaches[c]=new De(c,d,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:M.serialize(),sourceId:c}}),M.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new g.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},h.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},h.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new g.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var M;if(c.type==="custom"){if(Fo(this,g.validateCustomStyleLayer(c)))return;M=g.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=g.clone$1(c),c=g.extend(c,{source:w})),this._validate(g.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;M=g.createStyleLayer(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[M.id]=M.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new g.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=M,this._removedLayers[w]&&M.source&&M.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},h.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new g.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(c){return this._layers[c]},h.prototype.hasLayer=function(c){return c in this._layers},h.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!g.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(g.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=g.clone$1(d),this._updateLayer(w)))}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(c){return g.clone$1(this.getLayer(c).filter)},h.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(c);M?g.deepEqual(M.getLayoutProperty(d),E)||(M.setLayoutProperty(d,E,w),this._updateLayer(M)):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(c);M?g.deepEqual(M.getPaintProperty(d),E)||(M.setPaintProperty(d,E,w)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},h.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,M=this.sourceCaches[E];if(M!==void 0){var L=M.getSource().type;L==="geojson"&&w?this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(w,c.id,d)):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var M=w.getSource().type,L=M==="vector"?c.sourceLayer:void 0;M!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:g.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},h.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Dr){return d._layers[Dr].type==="fill-extrusion"},w={},M=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){w[U]=L;for(var Y=0,oe=c;Y<oe.length;Y+=1){var fe=oe[Y][U];if(fe)for(var pe=0,Re=fe;pe<Re.length;pe+=1)M.push(Re[pe])}}}M.sort(function(Dr,sr){return sr.intersectionZ-Dr.intersectionZ});for(var Ie=[],Xe=this._order.length-1;Xe>=0;Xe--){var Ae=this._order[Xe];if(E(Ae))for(var Ye=M.length-1;Ye>=0;Ye--){var it=M[Ye].feature;if(w[it.layer.id]<Xe)break;Ie.push(it),M.pop()}else for(var Et=0,Xt=c;Et<Xt.length;Et+=1){var Nt=Xt[Et][Ae];if(Nt)for(var tr=0,mr=Nt;tr<mr.length;tr+=1)Ie.push(mr[tr].feature)}}return Ie},h.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(g.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,L=d.layers;M<L.length;M+=1){var U=L[M],Y=this._layers[U];if(!Y)return this.fire(new g.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[Y.source]=!0}}var oe=[];for(var fe in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[fe]||oe.push(fn(this.sourceCaches[fe],this._layers,this._serializedLayers,c,d,E));return this.placement&&oe.push(function(pe,Re,Ie,Xe,Ae,Ye,it){for(var Et={},Xt=Ye.queryRenderedSymbols(Xe),Nt=[],tr=0,mr=Object.keys(Xt).map(Number);tr<mr.length;tr+=1)Nt.push(it[mr[tr]]);Nt.sort(Hi);for(var Dr=function(){var Fn=Qr[sr],Ai=Fn.featureIndex.lookupSymbolFeatures(Xt[Fn.bucketInstanceId],Re,Fn.bucketIndex,Fn.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,pe);for(var un in Ai){var Sn=Et[un]=Et[un]||[],Qn=Ai[un];Qn.sort(function(di,jn){var Tn=Fn.featureSortOrder;if(Tn){var qi=Tn.indexOf(di.featureIndex);return Tn.indexOf(jn.featureIndex)-qi}return jn.featureIndex-di.featureIndex});for(var Xn=0,Yn=Qn;Xn<Yn.length;Xn+=1)Sn.push(Yn[Xn])}},sr=0,Qr=Nt;sr<Qr.length;sr+=1)Dr();var Rn=function(Fn){Et[Fn].forEach(function(Ai){var un=Ai.feature,Sn=Ie[pe[Fn].source].getFeatureState(un.layer["source-layer"],un.id);un.source=un.layer.source,un.layer["source-layer"]&&(un.sourceLayer=un.layer["source-layer"]),un.state=Sn})};for(var kn in Et)Rn(kn);return Et}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},h.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(g.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,M){for(var L=w.getRenderableIds().map(function(Re){return w.getTileByID(Re)}),U=[],Y={},oe=0;oe<L.length;oe++){var fe=L[oe],pe=fe.tileID.canonical.key;Y[pe]||(Y[pe]=!0,fe.querySourceFeatures(U,M))}return U}(E,d):[]},h.prototype.addSourceType=function(c,d,E){return h.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(h.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var M in c)if(!g.deepEqual(c[M],E[M])){w=!0;break}if(w){var L={now:g.browser.now(),transition:g.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},h.prototype._validate=function(c,d,E,w,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&Fo(this,c.call(g.validateStyle,g.extend({key:d,style:this.serialize(),value:E,styleSpec:g.styleSpec},w)))},h.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},h.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},h.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},h.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},h.prototype._updatePlacement=function(c,d,E,w,M){M===void 0&&(M=!1);for(var L=!1,U=!1,Y={},oe=0,fe=this._order;oe<fe.length;oe+=1){var pe=this._layers[fe[oe]];if(pe.type==="symbol"){if(!Y[pe.source]){var Re=this.sourceCaches[pe.source];Y[pe.source]=Re.getRenderableIds(!0).map(function(it){return Re.getTileByID(it)}).sort(function(it,Et){return Et.tileID.overscaledZ-it.tileID.overscaledZ||(it.tileID.isLessThan(Et.tileID)?-1:1)})}var Ie=this.crossTileSymbolIndex.addLayer(pe,Y[pe.source],c.center.lng);L=L||Ie}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.browser.now(),c.zoom))&&(this.pauseablePlacement=new Yi(c,this._order,M,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var Xe=0,Ae=this._order;Xe<Ae.length;Xe+=1){var Ye=this._layers[Ae[Xe]];Ye.type==="symbol"&&this.placement.updateLayerOpacities(Ye,Y[Ye.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},h.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},h.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},h.prototype.getResource=function(c,d,E){return g.makeRequest(d,E)},h}(g.Evented);hs.getSourceType=function(l){return Cr[l]},hs.setSourceType=function(l,h){Cr[l]=h},hs.registerForPluginStateChange=g.registerForPluginStateChange;var ia=g.createLayout([{name:"a_pos",type:"Int16",components:2}]),po=Ui(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),oc=Ui(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),kc=Ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),qu=Ui(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Dc=Ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),jl=Ui(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ku=Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),lu=Ui("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),$u=Ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=Ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),F=Ui(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),xe=Ui(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),We=Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),dt=Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),mt=Ui(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),fr=Ui(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),br=Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Pn=Ui(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ci=Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),ei=Ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Gi=Ui(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ua=Ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Aa=Ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ui(l,h){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=h.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,Y,oe,fe,pe){return L[pe]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
varying `+oe+" "+fe+" "+pe+`;
#else
uniform `+oe+" "+fe+" u_"+pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`}),vertexSource:h=h.replace(c,function(U,Y,oe,fe,pe){var Re=fe==="float"?"vec2":"vec4",Ie=pe.match(/color/)?"color":Re;return L[pe]?Y==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+oe+" "+Re+" a_"+pe+`;
varying `+oe+" "+fe+" "+pe+`;
#else
uniform `+oe+" "+fe+" u_"+pe+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = a_"+pe+`;
#else
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = unpack_mix_"+Ie+"(a_"+pe+", u_"+pe+`_t);
#else
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+oe+" "+Re+" a_"+pe+`;
#else
uniform `+oe+" "+fe+" u_"+pe+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+fe+" "+pe+" = a_"+pe+`;
#else
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+fe+" "+pe+" = unpack_mix_"+Ie+"(a_"+pe+", u_"+pe+`_t);
#else
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`}),staticAttributes:d,staticUniforms:M}}var Po=Object.freeze({__proto__:null,prelude:po,background:oc,backgroundPattern:kc,circle:qu,clippingMask:Dc,heatmap:jl,heatmapTexture:Ku,collisionBox:lu,collisionCircle:$u,debug:_,fill:T,fillOutline:F,fillOutlinePattern:R,fillPattern:K,fillExtrusion:xe,fillExtrusionPattern:We,hillshadePrepare:dt,hillshade:mt,line:fr,lineGradient:br,linePattern:Pn,lineSDF:ci,raster:ei,symbolIcon:Gi,symbolSDF:ua,symbolTextAndIcon:Aa}),Ss=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function xl(l){for(var h=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");h.push(d.pop())}return h}Ss.prototype.bind=function(l,h,c,d,E,w,M,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,Y=0;!U&&Y<d.length;Y++)this.boundPaintVertexBuffers[Y]!==d[Y]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),M&&M.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(h,c,d,E,w,M,L)},Ss.prototype.freshBind=function(l,h,c,d,E,w,M){var L,U=l.numAttributes,Y=this.context,oe=Y.gl;if(Y.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Y.extVertexArrayObject.createVertexArrayOES(),Y.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=M;else{L=Y.currentNumAttributes||0;for(var fe=U;fe<L;fe++)oe.disableVertexAttribArray(fe)}h.enableAttributes(oe,l);for(var pe=0,Re=c;pe<Re.length;pe+=1)Re[pe].enableAttributes(oe,l);w&&w.enableAttributes(oe,l),M&&M.enableAttributes(oe,l),h.bind(),h.setVertexAttribPointers(oe,l,E);for(var Ie=0,Xe=c;Ie<Xe.length;Ie+=1){var Ae=Xe[Ie];Ae.bind(),Ae.setVertexAttribPointers(oe,l,E)}w&&(w.bind(),w.setVertexAttribPointers(oe,l,E)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(oe,l,E)),Y.currentNumAttributes=U},Ss.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var rf=function(l,h,c,d,E,w){var M=l.gl;this.program=M.createProgram();for(var L=xl(c.staticAttributes),U=d?d.getBinderAttributes():[],Y=L.concat(U),oe=c.staticUniforms?xl(c.staticUniforms):[],fe=d?d.getBinderUniforms():[],pe=[],Re=0,Ie=oe.concat(fe);Re<Ie.length;Re+=1){var Xe=Ie[Re];pe.indexOf(Xe)<0&&pe.push(Xe)}var Ae=d?d.defines():[];w&&Ae.push("#define OVERDRAW_INSPECTOR;");var Ye=Ae.concat(po.fragmentSource,c.fragmentSource).join(`
`),it=Ae.concat(po.vertexSource,c.vertexSource).join(`
`),Et=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Et,Ye),M.compileShader(Et),M.attachShader(this.program,Et);var Xt=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Xt,it),M.compileShader(Xt),M.attachShader(this.program,Xt),this.attributes={};var Nt={};this.numAttributes=Y.length;for(var tr=0;tr<this.numAttributes;tr++)Y[tr]&&(M.bindAttribLocation(this.program,tr,Y[tr]),this.attributes[Y[tr]]=tr);M.linkProgram(this.program),M.deleteShader(Xt),M.deleteShader(Et);for(var mr=0;mr<pe.length;mr++){var Dr=pe[mr];if(Dr&&!Nt[Dr]){var sr=M.getUniformLocation(this.program,Dr);sr&&(Nt[Dr]=sr)}}this.fixedUniforms=E(l,Nt),this.binderUniforms=d?d.getUniforms(l,Nt):[]}}};function Qu(l,h,c){var d=1/Xi(c,1,h.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,h.transform.tileZoom)/E,M=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[M>>16,L>>16],u_pixel_coord_lower:[65535&M,65535&L]}}rf.prototype.draw=function(l,h,c,d,E,w,M,L,U,Y,oe,fe,pe,Re,Ie,Xe){var Ae,Ye=l.gl;if(!this.failedToCreate){for(var it in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[it].set(M[it]);Re&&Re.setUniforms(l,this.binderUniforms,fe,{zoom:pe});for(var Et=(Ae={},Ae[Ye.LINES]=2,Ae[Ye.TRIANGLES]=3,Ae[Ye.LINE_STRIP]=1,Ae)[h],Xt=0,Nt=oe.get();Xt<Nt.length;Xt+=1){var tr=Nt[Xt],mr=tr.vaos||(tr.vaos={});(mr[L]||(mr[L]=new Ss)).bind(l,this,U,Re?Re.getPaintVertexBuffers():[],Y,tr.vertexOffset,Ie,Xe),Ye.drawElements(h,tr.primitiveLength*Et,Ye.UNSIGNED_SHORT,tr.primitiveOffset*Et*2)}}};var Fc=function(l,h,c,d){var E=h.style.light,w=E.properties.get("position"),M=[w.x,w.y,w.z],L=g.create$1();E.properties.get("anchor")==="viewport"&&g.fromRotation(L,-h.transform.angle),g.transformMat3(M,M,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:M,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Iu=function(l,h,c,d,E,w,M){return g.extend(Fc(l,h,c,d),Qu(w,h,M),{u_height_factor:-Math.pow(2,E.overscaledZ)/M.tileSize/8})},_u=function(l){return{u_matrix:l}},yo=function(l,h,c,d){return g.extend(_u(l),Qu(c,h,d))},la=function(l,h){return{u_matrix:l,u_world:h}},bh=function(l,h,c,d,E){return g.extend(yo(l,h,c,d),{u_world:E})},Eh=function(l,h,c,d){var E,w,M=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=Xi(c,1,M.zoom);E=!0,w=[L,L]}else E=!1,w=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(h.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:g.browser.devicePixelRatio,u_extrude_scale:w}},ao=function(l,h,c){var d=Xi(c,1,h.zoom),E=Math.pow(2,h.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[h.pixelsToGLUnits[0]/(d*E),h.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Vf=function(l,h,c){return{u_matrix:l,u_inv_matrix:h,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},xu=function(l,h,c){return c===void 0&&(c=1),{u_matrix:l,u_color:h,u_overlay:0,u_overlay_scale:c}},Fs=function(l){return{u_matrix:l}},Bc=function(l,h,c,d){return{u_matrix:l,u_extrude_scale:Xi(h,1,c),u_intensity:d}},bl=function(l,h,c){var d=l.transform;return{u_matrix:Gf(l,h,c),u_ratio:1/Xi(h,1,d.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},xa=function(l,h,c,d){return g.extend(bl(l,h,c),{u_image:0,u_image_height:d})},Vl=function(l,h,c,d){var E=l.transform,w=rs(h,E);return{u_matrix:Gf(l,h,c),u_texsize:h.imageAtlasTexture.size,u_ratio:1/Xi(h,1,E.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},sc=function(l,h,c,d,E){var w=l.lineAtlas,M=rs(h,l.transform),L=c.layout.get("line-cap")==="round",U=w.getDash(d.from,L),Y=w.getDash(d.to,L),oe=U.width*E.fromScale,fe=Y.width*E.toScale;return g.extend(bl(l,h,c),{u_patternscale_a:[M/oe,-U.height/2],u_patternscale_b:[M/fe,-Y.height/2],u_sdfgamma:w.width/(256*Math.min(oe,fe)*g.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:Y.y,u_mix:E.t})};function rs(l,h){return 1/Xi(l,1,h.tileZoom)}function Gf(l,h,c){return l.translatePosMatrix(h.tileID.posMatrix,h,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Sh=function(l,h,c,d,E){return{u_matrix:l,u_tl_parent:h,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(M=E.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ch(E.paint.get("raster-hue-rotate"))};var w,M};function Ch(l){l*=Math.PI/180;var h=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*h-c+1)/3,(Math.sqrt(3)*h-c+1)/3]}var nf,El=function(l,h,c,d,E,w,M,L,U,Y){var oe=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:oe.width/oe.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:M,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:Y,u_texture:0}},Bo=function(l,h,c,d,E,w,M,L,U,Y,oe){var fe=E.transform;return g.extend(El(l,h,c,d,E,w,M,L,U,Y),{u_gamma_scale:d?Math.cos(fe._pitch)*fe.cameraToCenterDistance:1,u_device_pixel_ratio:g.browser.devicePixelRatio,u_is_halo:+oe})},Ou=function(l,h,c,d,E,w,M,L,U,Y){return g.extend(Bo(l,h,c,d,E,w,M,L,!0,U,!0),{u_texsize_icon:Y,u_texture_icon:1})},Ju=function(l,h,c){return{u_matrix:l,u_opacity:h,u_color:c}},No=function(l,h,c,d,E,w){return g.extend(function(M,L,U,Y){var oe=U.imageManager.getPattern(M.from.toString()),fe=U.imageManager.getPattern(M.to.toString()),pe=U.imageManager.getPixelSize(),Re=pe.width,Ie=pe.height,Xe=Math.pow(2,Y.tileID.overscaledZ),Ae=Y.tileSize*Math.pow(2,U.transform.tileZoom)/Xe,Ye=Ae*(Y.tileID.canonical.x+Y.tileID.wrap*Xe),it=Ae*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:fe.tl,u_pattern_br_b:fe.br,u_texsize:[Re,Ie],u_mix:L.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:fe.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Xi(Y,1,U.transform.tileZoom),u_pixel_coord_upper:[Ye>>16,it>>16],u_pixel_coord_lower:[65535&Ye,65535&it]}}(d,w,c,E),{u_matrix:l,u_opacity:h})},Gl={fillExtrusion:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_lightpos:new g.Uniform3f(l,h.u_lightpos),u_lightintensity:new g.Uniform1f(l,h.u_lightintensity),u_lightcolor:new g.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new g.Uniform1f(l,h.u_vertical_gradient),u_opacity:new g.Uniform1f(l,h.u_opacity)}},fillExtrusionPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_lightpos:new g.Uniform3f(l,h.u_lightpos),u_lightintensity:new g.Uniform1f(l,h.u_lightintensity),u_lightcolor:new g.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new g.Uniform1f(l,h.u_vertical_gradient),u_height_factor:new g.Uniform1f(l,h.u_height_factor),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade),u_opacity:new g.Uniform1f(l,h.u_opacity)}},fill:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},fillPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},fillOutline:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world)}},fillOutlinePattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world),u_image:new g.Uniform1i(l,h.u_image),u_texsize:new g.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},circle:function(l,h){return{u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_scale_with_map:new g.Uniform1i(l,h.u_scale_with_map),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_extrude_scale:new g.Uniform2f(l,h.u_extrude_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},collisionBox:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pixels_to_tile_units:new g.Uniform1f(l,h.u_pixels_to_tile_units),u_extrude_scale:new g.Uniform2f(l,h.u_extrude_scale),u_overscale_factor:new g.Uniform1f(l,h.u_overscale_factor)}},collisionCircle:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_inv_matrix:new g.UniformMatrix4f(l,h.u_inv_matrix),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_viewport_size:new g.Uniform2f(l,h.u_viewport_size)}},debug:function(l,h){return{u_color:new g.UniformColor(l,h.u_color),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_overlay:new g.Uniform1i(l,h.u_overlay),u_overlay_scale:new g.Uniform1f(l,h.u_overlay_scale)}},clippingMask:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},heatmap:function(l,h){return{u_extrude_scale:new g.Uniform1f(l,h.u_extrude_scale),u_intensity:new g.Uniform1f(l,h.u_intensity),u_matrix:new g.UniformMatrix4f(l,h.u_matrix)}},heatmapTexture:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_world:new g.Uniform2f(l,h.u_world),u_image:new g.Uniform1i(l,h.u_image),u_color_ramp:new g.Uniform1i(l,h.u_color_ramp),u_opacity:new g.Uniform1f(l,h.u_opacity)}},hillshade:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_latrange:new g.Uniform2f(l,h.u_latrange),u_light:new g.Uniform2f(l,h.u_light),u_shadow:new g.UniformColor(l,h.u_shadow),u_highlight:new g.UniformColor(l,h.u_highlight),u_accent:new g.UniformColor(l,h.u_accent)}},hillshadePrepare:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_image:new g.Uniform1i(l,h.u_image),u_dimension:new g.Uniform2f(l,h.u_dimension),u_zoom:new g.Uniform1f(l,h.u_zoom),u_unpack:new g.Uniform4f(l,h.u_unpack)}},line:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels)}},lineGradient:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_image:new g.Uniform1i(l,h.u_image),u_image_height:new g.Uniform1f(l,h.u_image_height)}},linePattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_texsize:new g.Uniform2f(l,h.u_texsize),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_image:new g.Uniform1i(l,h.u_image),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_scale:new g.Uniform3f(l,h.u_scale),u_fade:new g.Uniform1f(l,h.u_fade)}},lineSDF:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_ratio:new g.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,h.u_units_to_pixels),u_patternscale_a:new g.Uniform2f(l,h.u_patternscale_a),u_patternscale_b:new g.Uniform2f(l,h.u_patternscale_b),u_sdfgamma:new g.Uniform1f(l,h.u_sdfgamma),u_image:new g.Uniform1i(l,h.u_image),u_tex_y_a:new g.Uniform1f(l,h.u_tex_y_a),u_tex_y_b:new g.Uniform1f(l,h.u_tex_y_b),u_mix:new g.Uniform1f(l,h.u_mix)}},raster:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_tl_parent:new g.Uniform2f(l,h.u_tl_parent),u_scale_parent:new g.Uniform1f(l,h.u_scale_parent),u_buffer_scale:new g.Uniform1f(l,h.u_buffer_scale),u_fade_t:new g.Uniform1f(l,h.u_fade_t),u_opacity:new g.Uniform1f(l,h.u_opacity),u_image0:new g.Uniform1i(l,h.u_image0),u_image1:new g.Uniform1i(l,h.u_image1),u_brightness_low:new g.Uniform1f(l,h.u_brightness_low),u_brightness_high:new g.Uniform1f(l,h.u_brightness_high),u_saturation_factor:new g.Uniform1f(l,h.u_saturation_factor),u_contrast_factor:new g.Uniform1f(l,h.u_contrast_factor),u_spin_weights:new g.Uniform3f(l,h.u_spin_weights)}},symbolIcon:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texture:new g.Uniform1i(l,h.u_texture)}},symbolSDF:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texture:new g.Uniform1i(l,h.u_texture),u_gamma_scale:new g.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(l,h.u_is_halo)}},symbolTextAndIcon:function(l,h){return{u_is_size_zoom_constant:new g.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,h.u_size_t),u_size:new g.Uniform1f(l,h.u_size),u_camera_to_center_distance:new g.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,h.u_pitch),u_rotate_symbol:new g.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,h.u_fade_change),u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new g.Uniform1i(l,h.u_is_text),u_pitch_with_map:new g.Uniform1i(l,h.u_pitch_with_map),u_texsize:new g.Uniform2f(l,h.u_texsize),u_texsize_icon:new g.Uniform2f(l,h.u_texsize_icon),u_texture:new g.Uniform1i(l,h.u_texture),u_texture_icon:new g.Uniform1i(l,h.u_texture_icon),u_gamma_scale:new g.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(l,h.u_is_halo)}},background:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_opacity:new g.Uniform1f(l,h.u_opacity),u_color:new g.UniformColor(l,h.u_color)}},backgroundPattern:function(l,h){return{u_matrix:new g.UniformMatrix4f(l,h.u_matrix),u_opacity:new g.Uniform1f(l,h.u_opacity),u_image:new g.Uniform1i(l,h.u_image),u_pattern_tl_a:new g.Uniform2f(l,h.u_pattern_tl_a),u_pattern_br_a:new g.Uniform2f(l,h.u_pattern_br_a),u_pattern_tl_b:new g.Uniform2f(l,h.u_pattern_tl_b),u_pattern_br_b:new g.Uniform2f(l,h.u_pattern_br_b),u_texsize:new g.Uniform2f(l,h.u_texsize),u_mix:new g.Uniform1f(l,h.u_mix),u_pattern_size_a:new g.Uniform2f(l,h.u_pattern_size_a),u_pattern_size_b:new g.Uniform2f(l,h.u_pattern_size_b),u_scale_a:new g.Uniform1f(l,h.u_scale_a),u_scale_b:new g.Uniform1f(l,h.u_scale_b),u_pixel_coord_upper:new g.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,h.u_pixel_coord_lower),u_tile_units_to_pixels:new g.Uniform1f(l,h.u_tile_units_to_pixels)}}};function el(l,h,c,d,E,w,M){for(var L=l.context,U=L.gl,Y=l.useProgram("collisionBox"),oe=[],fe=0,pe=0,Re=0;Re<d.length;Re++){var Ie=d[Re],Xe=h.getTile(Ie),Ae=Xe.getBucket(c);if(Ae){var Ye=Ie.posMatrix;E[0]===0&&E[1]===0||(Ye=l.translatePosMatrix(Ie.posMatrix,Xe,E,w));var it=M?Ae.textCollisionBox:Ae.iconCollisionBox,Et=Ae.collisionCircleArray;if(Et.length>0){var Xt=g.create(),Nt=Ye;g.mul(Xt,Ae.placementInvProjMatrix,l.transform.glCoordMatrix),g.mul(Xt,Xt,Ae.placementViewportMatrix),oe.push({circleArray:Et,circleOffset:pe,transform:Nt,invTransform:Xt}),pe=fe+=Et.length/4}it&&Y.draw(L,U.LINES,ge.disabled,Pe.disabled,l.colorModeForRenderPass(),ot.disabled,ao(Ye,l.transform,Xe),c.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,l.transform.zoom,null,null,it.collisionVertexBuffer)}}if(M&&oe.length){var tr=l.useProgram("collisionCircle"),mr=new g.StructArrayLayout2f1f2i16;mr.resize(4*fe),mr._trim();for(var Dr=0,sr=0,Qr=oe;sr<Qr.length;sr+=1)for(var Rn=Qr[sr],kn=0;kn<Rn.circleArray.length/4;kn++){var Fn=4*kn,Ai=Rn.circleArray[Fn+0],un=Rn.circleArray[Fn+1],Sn=Rn.circleArray[Fn+2],Qn=Rn.circleArray[Fn+3];mr.emplace(Dr++,Ai,un,Sn,Qn,0),mr.emplace(Dr++,Ai,un,Sn,Qn,1),mr.emplace(Dr++,Ai,un,Sn,Qn,2),mr.emplace(Dr++,Ai,un,Sn,Qn,3)}(!nf||nf.length<2*fe)&&(nf=function(Ya){var ni=2*Ya,zo=new g.StructArrayLayout3ui6;zo.resize(ni),zo._trim();for(var Va=0;Va<ni;Va++){var to=6*Va;zo.uint16[to+0]=4*Va+0,zo.uint16[to+1]=4*Va+1,zo.uint16[to+2]=4*Va+2,zo.uint16[to+3]=4*Va+2,zo.uint16[to+4]=4*Va+3,zo.uint16[to+5]=4*Va+0}return zo}(fe));for(var Xn=L.createIndexBuffer(nf,!0),Yn=L.createVertexBuffer(mr,g.collisionCircleLayout.members,!0),di=0,jn=oe;di<jn.length;di+=1){var Tn=jn[di],qi=Vf(Tn.transform,Tn.invTransform,l.transform);tr.draw(L,U.TRIANGLES,ge.disabled,Pe.disabled,l.colorModeForRenderPass(),ot.disabled,qi,c.id,Yn,Xn,g.SegmentVector.simpleSegment(0,2*Tn.circleOffset,Tn.circleArray.length,Tn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Yn.destroy(),Xn.destroy()}}var Ys=g.identity(new Float32Array(16));function af(l,h,c,d,E,w){var M=g.getAnchorAlignment(l),L=-(M.horizontalAlign-.5)*h,U=-(M.verticalAlign-.5)*c,Y=g.evaluateVariableOffset(l,d);return new g.Point((L/E+Y[0])*w,(U/E+Y[1])*w)}function of(l,h,c,d,E,w,M,L,U,Y,oe){var fe=l.text.placedSymbolArray,pe=l.text.dynamicLayoutVertexArray,Re=l.icon.dynamicLayoutVertexArray,Ie={};pe.clear();for(var Xe=0;Xe<fe.length;Xe++){var Ae=fe.get(Xe),Ye=Ae.hidden||!Ae.crossTileID||l.allowVerticalPlacement&&!Ae.placedOrientation?null:d[Ae.crossTileID];if(Ye){var it=new g.Point(Ae.anchorX,Ae.anchorY),Et=Pi(it,c?L:M),Xt=zi(w.cameraToCenterDistance,Et.signedDistanceFromCamera),Nt=E.evaluateSizeForFeature(l.textSizeData,Y,Ae)*Xt/g.ONE_EM;c&&(Nt*=l.tilePixelRatio/U);for(var tr=af(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textBoxScale,Nt),mr=c?Pi(it.add(tr),M).point:Et.point.add(h?tr.rotate(-w.angle):tr),Dr=l.allowVerticalPlacement&&Ae.placedOrientation===g.WritingMode.vertical?Math.PI/2:0,sr=0;sr<Ae.numGlyphs;sr++)g.addDynamicAttributes(pe,mr,Dr);oe&&Ae.associatedIconIndex>=0&&(Ie[Ae.associatedIconIndex]={shiftedAnchor:mr,angle:Dr})}else fo(Ae.numGlyphs,pe)}if(oe){Re.clear();for(var Qr=l.icon.placedSymbolArray,Rn=0;Rn<Qr.length;Rn++){var kn=Qr.get(Rn);if(kn.hidden)fo(kn.numGlyphs,Re);else{var Fn=Ie[Rn];if(Fn)for(var Ai=0;Ai<kn.numGlyphs;Ai++)g.addDynamicAttributes(Re,Fn.shiftedAnchor,Fn.angle);else fo(kn.numGlyphs,Re)}}l.icon.dynamicLayoutVertexBuffer.updateData(Re)}l.text.dynamicLayoutVertexBuffer.updateData(pe)}function sf(l,h,c){return c.iconsInText&&h?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function tl(l,h,c,d,E,w,M,L,U,Y,oe,fe){for(var pe=l.context,Re=pe.gl,Ie=l.transform,Xe=L==="map",Ae=U==="map",Ye=Xe&&c.layout.get("symbol-placement")!=="point",it=Xe&&!Ae&&!Ye,Et=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Xt=!1,Nt=l.depthModeForSublayer(0,ge.ReadOnly),tr=c.layout.get("text-variable-anchor"),mr=[],Dr=0,sr=d;Dr<sr.length;Dr+=1){var Qr=sr[Dr],Rn=h.getTile(Qr),kn=Rn.getBucket(c);if(kn){var Fn=E?kn.text:kn.icon;if(Fn&&Fn.segments.get().length){var Ai=Fn.programConfigurations.get(c.id),un=E||kn.sdfIcons,Sn=E?kn.textSizeData:kn.iconSizeData,Qn=Ae||Ie.pitch!==0,Xn=l.useProgram(sf(un,E,kn),Ai),Yn=g.evaluateSizeForZoom(Sn,Ie.zoom),di=void 0,jn=[0,0],Tn=void 0,qi=void 0,Ya=null,ni=void 0;if(E)Tn=Rn.glyphAtlasTexture,qi=Re.LINEAR,di=Rn.glyphAtlasTexture.size,kn.iconsInText&&(jn=Rn.imageAtlasTexture.size,Ya=Rn.imageAtlasTexture,ni=Qn||l.options.rotating||l.options.zooming||Sn.kind==="composite"||Sn.kind==="camera"?Re.LINEAR:Re.NEAREST);else{var zo=c.layout.get("icon-size").constantOr(0)!==1||kn.iconsNeedLinear;Tn=Rn.imageAtlasTexture,qi=un||l.options.rotating||l.options.zooming||zo||Qn?Re.LINEAR:Re.NEAREST,di=Rn.imageAtlasTexture.size}var Va=Xi(Rn,1,l.transform.zoom),to=Ta(Qr.posMatrix,Ae,Xe,l.transform,Va),is=na(Qr.posMatrix,Ae,Xe,l.transform,Va),vs=tr&&kn.hasTextData(),Fu=c.layout.get("icon-text-fit")!=="none"&&vs&&kn.hasIconData();Ye&&ou(kn,Qr.posMatrix,l,E,to,is,Ae,Y);var as=l.translatePosMatrix(Qr.posMatrix,Rn,w,M),Vs=Ye||E&&tr||Fu?Ys:to,As=l.translatePosMatrix(is,Rn,w,M,!0),Vc=un&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Pl={program:Xn,buffers:Fn,uniformValues:un?kn.iconsInText?Ou(Sn.kind,Yn,it,Ae,l,as,Vs,As,di,jn):Bo(Sn.kind,Yn,it,Ae,l,as,Vs,As,E,di,!0):El(Sn.kind,Yn,it,Ae,l,as,Vs,As,E,di),atlasTexture:Tn,atlasTextureIcon:Ya,atlasInterpolation:qi,atlasInterpolationIcon:ni,isSDF:un,hasHalo:Vc};if(Et&&kn.canOverlap){Xt=!0;for(var Bu=0,ql=Fn.segments.get();Bu<ql.length;Bu+=1){var mc=ql[Bu];mr.push({segments:new g.SegmentVector([mc]),sortKey:mc.sortKey,state:Pl})}}else mr.push({segments:Fn.segments,sortKey:0,state:Pl})}}}Xt&&mr.sort(function(ul,$o){return ul.sortKey-$o.sortKey});for(var $s=0,Il=mr;$s<Il.length;$s+=1){var wu=Il[$s],xo=wu.state;if(pe.activeTexture.set(Re.TEXTURE0),xo.atlasTexture.bind(xo.atlasInterpolation,Re.CLAMP_TO_EDGE),xo.atlasTextureIcon&&(pe.activeTexture.set(Re.TEXTURE1),xo.atlasTextureIcon&&xo.atlasTextureIcon.bind(xo.atlasInterpolationIcon,Re.CLAMP_TO_EDGE)),xo.isSDF){var Nu=xo.uniformValues;xo.hasHalo&&(Nu.u_is_halo=1,uc(xo.buffers,wu.segments,c,l,xo.program,Nt,oe,fe,Nu)),Nu.u_is_halo=0}uc(xo.buffers,wu.segments,c,l,xo.program,Nt,oe,fe,xo.uniformValues)}}function uc(l,h,c,d,E,w,M,L,U){var Y=d.context;E.draw(Y,Y.gl.TRIANGLES,w,M,L,ot.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,h,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Nc(l,h,c,d,E,w,M){var L,U,Y,oe,fe,pe=l.context.gl,Re=c.paint.get("fill-pattern"),Ie=Re&&Re.constantOr(1),Xe=c.getCrossfadeParameters();M?(U=Ie&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=pe.LINES):(U=Ie?"fillPattern":"fill",L=pe.TRIANGLES);for(var Ae=0,Ye=d;Ae<Ye.length;Ae+=1){var it=Ye[Ae],Et=h.getTile(it);if(!Ie||Et.patternsLoaded()){var Xt=Et.getBucket(c);if(Xt){var Nt=Xt.programConfigurations.get(c.id),tr=l.useProgram(U,Nt);Ie&&(l.context.activeTexture.set(pe.TEXTURE0),Et.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Nt.updatePaintBuffers(Xe));var mr=Re.constantOr(null);if(mr&&Et.imageAtlas){var Dr=Et.imageAtlas,sr=Dr.patternPositions[mr.to.toString()],Qr=Dr.patternPositions[mr.from.toString()];sr&&Qr&&Nt.setConstantPatternPositions(sr,Qr)}var Rn=l.translatePosMatrix(it.posMatrix,Et,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){oe=Xt.indexBuffer2,fe=Xt.segments2;var kn=[pe.drawingBufferWidth,pe.drawingBufferHeight];Y=U==="fillOutlinePattern"&&Ie?bh(Rn,l,Xe,Et,kn):la(Rn,kn)}else oe=Xt.indexBuffer,fe=Xt.segments,Y=Ie?yo(Rn,l,Xe,Et):_u(Rn);tr.draw(l.context,L,E,l.stencilModeForClipping(it),w,ot.disabled,Y,c.id,Xt.layoutVertexBuffer,oe,fe,c.paint,l.transform.zoom,Nt)}}}}function uf(l,h,c,d,E,w,M){for(var L=l.context,U=L.gl,Y=c.paint.get("fill-extrusion-pattern"),oe=Y.constantOr(1),fe=c.getCrossfadeParameters(),pe=c.paint.get("fill-extrusion-opacity"),Re=0,Ie=d;Re<Ie.length;Re+=1){var Xe=Ie[Re],Ae=h.getTile(Xe),Ye=Ae.getBucket(c);if(Ye){var it=Ye.programConfigurations.get(c.id),Et=l.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",it);oe&&(l.context.activeTexture.set(U.TEXTURE0),Ae.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),it.updatePaintBuffers(fe));var Xt=Y.constantOr(null);if(Xt&&Ae.imageAtlas){var Nt=Ae.imageAtlas,tr=Nt.patternPositions[Xt.to.toString()],mr=Nt.patternPositions[Xt.from.toString()];tr&&mr&&it.setConstantPatternPositions(tr,mr)}var Dr=l.translatePosMatrix(Xe.posMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),sr=c.paint.get("fill-extrusion-vertical-gradient"),Qr=oe?Iu(Dr,l,sr,pe,Xe,fe,Ae):Fc(Dr,l,sr,pe);Et.draw(L,L.gl.TRIANGLES,E,w,M,ot.backCCW,Qr,c.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,c.paint,l.transform.zoom,it)}}}function zc(l,h,c,d,E,w){var M=l.context,L=M.gl,U=h.fbo;if(U){var Y=l.useProgram("hillshade");M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var oe=function(fe,pe,Re){var Ie=Re.paint.get("hillshade-shadow-color"),Xe=Re.paint.get("hillshade-highlight-color"),Ae=Re.paint.get("hillshade-accent-color"),Ye=Re.paint.get("hillshade-illumination-direction")*(Math.PI/180);Re.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ye-=fe.transform.angle);var it,Et,Xt,Nt=!fe.options.moving;return{u_matrix:fe.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Nt),u_image:0,u_latrange:(it=pe.tileID,Et=Math.pow(2,it.canonical.z),Xt=it.canonical.y,[new g.MercatorCoordinate(0,Xt/Et).toLngLat().lat,new g.MercatorCoordinate(0,(Xt+1)/Et).toLngLat().lat]),u_light:[Re.paint.get("hillshade-exaggeration"),Ye],u_shadow:Ie,u_highlight:Xe,u_accent:Ae}}(l,h,c);Y.draw(M,L.TRIANGLES,d,E,w,ot.disabled,oe,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function Ah(l,h,c,d,E,w){var M=l.context,L=M.gl,U=h.dem;if(U&&U.data){var Y=U.dim,oe=U.stride,fe=U.getPixels();if(M.activeTexture.set(L.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||l.getTileTexture(oe),h.demTexture){var pe=h.demTexture;pe.update(fe,{premultiply:!1}),pe.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else h.demTexture=new g.Texture(M,fe,L.RGBA,{premultiply:!1}),h.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);M.activeTexture.set(L.TEXTURE0);var Re=h.fbo;if(!Re){var Ie=new g.Texture(M,{width:Y,height:Y,data:null},L.RGBA);Ie.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Re=h.fbo=M.createFramebuffer(Y,Y,!0)).colorAttachment.set(Ie.texture)}M.bindFramebuffer.set(Re.framebuffer),M.viewport.set([0,0,Y,Y]),l.useProgram("hillshadePrepare").draw(M,L.TRIANGLES,d,E,w,ot.disabled,function(Xe,Ae){var Ye=Ae.stride,it=g.create();return g.ortho(it,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate(it,it,[0,-g.EXTENT,0]),{u_matrix:it,u_image:1,u_dimension:[Ye,Ye],u_zoom:Xe.overscaledZ,u_unpack:Ae.getUnpackVector()}}(h.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function Uc(l,h,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var M=g.browser.now(),L=(M-l.timeAdded)/w,U=h?(M-h.timeAdded)/w:-1,Y=c.getSource(),oe=E.coveringZoomLevel({tileSize:Y.tileSize,roundZoom:Y.roundZoom}),fe=!h||Math.abs(h.tileID.overscaledZ-oe)>Math.abs(l.tileID.overscaledZ-oe),pe=fe&&l.refreshedUponExpiration?1:g.clamp(fe?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),h?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}var Sl=new g.Color(1,0,0,1),lf=new g.Color(0,1,0,1),cf=new g.Color(0,0,1,1),Ru=new g.Color(1,0,1,1),ff=new g.Color(0,1,1,1);function Hf(l,h,c,d){Hl(l,0,h+c/2,l.transform.width,c,d)}function wh(l,h,c,d){Hl(l,h-c/2,0,c,l.transform.height,d)}function Hl(l,h,c,d,E,w){var M=l.context,L=M.gl;L.enable(L.SCISSOR_TEST),L.scissor(h*g.browser.devicePixelRatio,c*g.browser.devicePixelRatio,d*g.browser.devicePixelRatio,E*g.browser.devicePixelRatio),M.clear({color:w}),L.disable(L.SCISSOR_TEST)}function np(l,h,c){var d=l.context,E=d.gl,w=c.posMatrix,M=l.useProgram("debug"),L=ge.disabled,U=Pe.disabled,Y=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),M.draw(d,E.LINE_STRIP,L,U,Y,ot.disabled,xu(w,g.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var oe=h.getTileByID(c.key).latestRawTileData,fe=Math.floor((oe&&oe.byteLength||0)/1024),pe=h.getTile(c).tileSize,Re=512/Math.min(pe,512)*(c.overscaledZ/l.transform.zoom)*.5,Ie=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ie+=" => "+c.overscaledZ),function(Xe,Ae){Xe.initDebugOverlayCanvas();var Ye=Xe.debugOverlayCanvas,it=Xe.context.gl,Et=Xe.debugOverlayCanvas.getContext("2d");Et.clearRect(0,0,Ye.width,Ye.height),Et.shadowColor="white",Et.shadowBlur=2,Et.lineWidth=1.5,Et.strokeStyle="white",Et.textBaseline="top",Et.font="bold 36px Open Sans, sans-serif",Et.fillText(Ae,5,5),Et.strokeText(Ae,5,5),Xe.debugOverlayTexture.update(Ye),Xe.debugOverlayTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE)}(l,Ie+" "+fe+"kb"),M.draw(d,E.TRIANGLES,L,U,Ge.alphaBlended,ot.disabled,xu(w,g.Color.transparent,Re),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var ns={symbol:function(l,h,c,d,E){if(l.renderPass==="translucent"){var w=Pe.disabled,M=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,Y,oe,fe,pe,Re){for(var Ie=U.transform,Xe=fe==="map",Ae=pe==="map",Ye=0,it=L;Ye<it.length;Ye+=1){var Et=it[Ye],Xt=oe.getTile(Et),Nt=Xt.getBucket(Y);if(Nt&&Nt.text&&Nt.text.segments.get().length){var tr=g.evaluateSizeForZoom(Nt.textSizeData,Ie.zoom),mr=Xi(Xt,1,U.transform.zoom),Dr=Ta(Et.posMatrix,Ae,Xe,U.transform,mr),sr=Y.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(tr){var Qr=Math.pow(2,Ie.zoom-Xt.tileID.overscaledZ);of(Nt,Xe,Ae,Re,g.symbolSize,Ie,Dr,Et.posMatrix,Qr,tr,sr)}}}}(d,l,c,h,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&tl(l,h,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,M),c.paint.get("text-opacity").constantOr(1)!==0&&tl(l,h,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,M),h.map.showCollisionBoxes&&(el(l,h,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),el(l,h,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&M.constantOr(1)!==0){for(var U=l.context,Y=U.gl,oe=l.depthModeForSublayer(0,ge.ReadOnly),fe=Pe.disabled,pe=l.colorModeForRenderPass(),Re=[],Ie=0;Ie<d.length;Ie++){var Xe=d[Ie],Ae=h.getTile(Xe),Ye=Ae.getBucket(c);if(Ye){var it=Ye.programConfigurations.get(c.id),Et={programConfiguration:it,program:l.useProgram("circle",it),layoutVertexBuffer:Ye.layoutVertexBuffer,indexBuffer:Ye.indexBuffer,uniformValues:Eh(l,Xe,Ae,c)};if(L)for(var Xt=0,Nt=Ye.segments.get();Xt<Nt.length;Xt+=1){var tr=Nt[Xt];Re.push({segments:new g.SegmentVector([tr]),sortKey:tr.sortKey,state:Et})}else Re.push({segments:Ye.segments,sortKey:0,state:Et})}}L&&Re.sort(function(Rn,kn){return Rn.sortKey-kn.sortKey});for(var mr=0,Dr=Re;mr<Dr.length;mr+=1){var sr=Dr[mr],Qr=sr.state;Qr.program.draw(U,Y.TRIANGLES,oe,fe,pe,ot.disabled,Qr.uniformValues,c.id,Qr.layoutVertexBuffer,Qr.indexBuffer,sr.segments,c.paint,l.transform.zoom,Qr.programConfiguration)}}}},heatmap:function(l,h,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,M=Pe.disabled,L=new Ge([w.ONE,w.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(Re,Ie,Xe){var Ae=Re.gl;Re.activeTexture.set(Ae.TEXTURE1),Re.viewport.set([0,0,Ie.width/4,Ie.height/4]);var Ye=Xe.heatmapFbo;if(Ye)Ae.bindTexture(Ae.TEXTURE_2D,Ye.colorAttachment.get()),Re.bindFramebuffer.set(Ye.framebuffer);else{var it=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,it),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),Ye=Xe.heatmapFbo=Re.createFramebuffer(Ie.width/4,Ie.height/4,!1),function(Et,Xt,Nt,tr){var mr=Et.gl;mr.texImage2D(mr.TEXTURE_2D,0,mr.RGBA,Xt.width/4,Xt.height/4,0,mr.RGBA,Et.extRenderToTextureHalfFloat?Et.extTextureHalfFloat.HALF_FLOAT_OES:mr.UNSIGNED_BYTE,null),tr.colorAttachment.set(Nt)}(Re,Ie,it,Ye)}})(E,l,c),E.clear({color:g.Color.transparent});for(var U=0;U<d.length;U++){var Y=d[U];if(!h.hasRenderableParent(Y)){var oe=h.getTile(Y),fe=oe.getBucket(c);if(fe){var pe=fe.programConfigurations.get(c.id);l.useProgram("heatmap",pe).draw(E,w.TRIANGLES,ge.disabled,M,L,ot.disabled,Bc(Y.posMatrix,oe,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,c.paint,l.transform.zoom,pe)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Re,Ie){var Xe=Re.context,Ae=Xe.gl,Ye=Ie.heatmapFbo;if(Ye){Xe.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,Ye.colorAttachment.get()),Xe.activeTexture.set(Ae.TEXTURE1);var it=Ie.colorRampTexture;it||(it=Ie.colorRampTexture=new g.Texture(Xe,Ie.colorRamp,Ae.RGBA)),it.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Re.useProgram("heatmapTexture").draw(Xe,Ae.TRIANGLES,ge.disabled,Pe.disabled,Re.colorModeForRenderPass(),ot.disabled,function(Et,Xt,Nt,tr){var mr=g.create();g.ortho(mr,0,Et.width,Et.height,0,0,1);var Dr=Et.context.gl;return{u_matrix:mr,u_world:[Dr.drawingBufferWidth,Dr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Xt.paint.get("heatmap-opacity")}}(Re,Ie),Ie.id,Re.viewportBuffer,Re.quadTriangleIndexBuffer,Re.viewportSegments,Ie.paint,Re.transform.zoom)}}(l,c))},line:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var M=l.depthModeForSublayer(0,ge.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),Y=c.paint.get("line-pattern"),oe=Y.constantOr(1),fe=c.paint.get("line-gradient"),pe=c.getCrossfadeParameters(),Re=oe?"linePattern":U?"lineSDF":fe?"lineGradient":"line",Ie=l.context,Xe=Ie.gl,Ae=!0,Ye=0,it=d;Ye<it.length;Ye+=1){var Et=it[Ye],Xt=h.getTile(Et);if(!oe||Xt.patternsLoaded()){var Nt=Xt.getBucket(c);if(Nt){var tr=Nt.programConfigurations.get(c.id),mr=l.context.program.get(),Dr=l.useProgram(Re,tr),sr=Ae||Dr.program!==mr,Qr=Y.constantOr(null);if(Qr&&Xt.imageAtlas){var Rn=Xt.imageAtlas,kn=Rn.patternPositions[Qr.to.toString()],Fn=Rn.patternPositions[Qr.from.toString()];kn&&Fn&&tr.setConstantPatternPositions(kn,Fn)}var Ai=oe?Vl(l,Xt,c,pe):U?sc(l,Xt,c,U,pe):fe?xa(l,Xt,c,Nt.lineClipsArray.length):bl(l,Xt,c);if(oe)Ie.activeTexture.set(Xe.TEXTURE0),Xt.imageAtlasTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),tr.updatePaintBuffers(pe);else if(U&&(sr||l.lineAtlas.dirty))Ie.activeTexture.set(Xe.TEXTURE0),l.lineAtlas.bind(Ie);else if(fe){var un=Nt.gradients[c.id],Sn=un.texture;if(c.gradientVersion!==un.version){var Qn=256;if(c.stepInterpolant){var Xn=h.getSource().maxzoom,Yn=Et.canonical.z===Xn?Math.ceil(1<<l.transform.maxZoom-Et.canonical.z):1;Qn=g.clamp(g.nextPowerOfTwo(Nt.maxLineLength/g.EXTENT*1024*Yn),256,Ie.maxTextureSize)}un.gradient=g.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Qn,image:un.gradient||void 0,clips:Nt.lineClipsArray}),un.texture?un.texture.update(un.gradient):un.texture=new g.Texture(Ie,un.gradient,Xe.RGBA),un.version=c.gradientVersion,Sn=un.texture}Ie.activeTexture.set(Xe.TEXTURE0),Sn.bind(c.stepInterpolant?Xe.NEAREST:Xe.LINEAR,Xe.CLAMP_TO_EDGE)}Dr.draw(Ie,Xe.TRIANGLES,M,l.stencilModeForClipping(Et),L,ot.disabled,Ai,c.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,c.paint,l.transform.zoom,tr,Nt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(l,h,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var M=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(g.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var Y=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Nc(l,h,c,d,Y,M,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var oe=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Nc(l,h,c,d,oe,M,!0)}}},"fill-extrusion":function(l,h,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))uf(l,h,c,d,w,Pe.disabled,Ge.disabled),uf(l,h,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var M=l.colorModeForRenderPass();uf(l,h,c,d,w,Pe.disabled,M)}}},hillshade:function(l,h,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,ge.ReadOnly),M=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],Y=0,oe=L[1];Y<oe.length;Y+=1){var fe=oe[Y],pe=h.getTile(fe);pe.needsHillshadePrepare&&l.renderPass==="offscreen"?Ah(l,pe,c,w,Pe.disabled,M):l.renderPass==="translucent"&&zc(l,pe,c,w,U[fe.overscaledZ],M)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,h,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,M=h.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),Y=M instanceof yt?[{},d]:l.stencilConfigForOverlap(d),oe=Y[0],fe=Y[1],pe=fe[fe.length-1].overscaledZ,Re=!l.options.moving,Ie=0,Xe=fe;Ie<Xe.length;Ie+=1){var Ae=Xe[Ie],Ye=l.depthModeForSublayer(Ae.overscaledZ-pe,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,w.LESS),it=h.getTile(Ae),Et=l.transform.calculatePosMatrix(Ae.toUnwrapped(),Re);it.registerFadeDuration(c.paint.get("raster-fade-duration"));var Xt=h.findLoadedParent(Ae,0),Nt=Uc(it,Xt,h,c,l.transform),tr=void 0,mr=void 0,Dr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),it.texture.bind(Dr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Xt?(Xt.texture.bind(Dr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),tr=Math.pow(2,Xt.tileID.overscaledZ-it.tileID.overscaledZ),mr=[it.tileID.canonical.x*tr%1,it.tileID.canonical.y*tr%1]):it.texture.bind(Dr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var sr=Sh(Et,mr||[0,0],tr||1,Nt,c);M instanceof yt?L.draw(E,w.TRIANGLES,Ye,Pe.disabled,U,ot.disabled,sr,c.id,M.boundsBuffer,l.quadTriangleIndexBuffer,M.boundsSegments):L.draw(E,w.TRIANGLES,Ye,oe[Ae.overscaledZ],U,ot.disabled,sr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,h,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,M=w.gl,L=l.transform,U=L.tileSize,Y=c.paint.get("background-pattern");if(!l.isPatternMissing(Y)){var oe=!Y&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===oe){var fe=Pe.disabled,pe=l.depthModeForSublayer(0,oe==="opaque"?ge.ReadWrite:ge.ReadOnly),Re=l.colorModeForRenderPass(),Ie=l.useProgram(Y?"backgroundPattern":"background"),Xe=L.coveringTiles({tileSize:U});Y&&(w.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context));for(var Ae=c.getCrossfadeParameters(),Ye=0,it=Xe;Ye<it.length;Ye+=1){var Et=it[Ye],Xt=l.transform.calculatePosMatrix(Et.toUnwrapped()),Nt=Y?No(Xt,E,l,Y,{tileID:Et,tileSize:U},Ae):Ju(Xt,E,d);Ie.draw(w,M.TRIANGLES,pe,fe,Re,ot.disabled,Nt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,h,c){for(var d=0;d<c.length;d++)np(l,h,c[d])},custom:function(l,h,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Pe.disabled);var M=E.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);d.setDepthMode(M),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},ja=function(l,h){this.context=new he(l),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=De.maxUnderzooming+De.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new It,this.gpuTimers={}};ja.prototype.resize=function(l,h){if(this.width=l*g.browser.devicePixelRatio,this.height=h*g.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},ja.prototype.setup=function(){var l=this.context,h=new g.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(g.EXTENT,0),h.emplaceBack(0,g.EXTENT),h.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(h,ia.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);var c=new g.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(g.EXTENT,0),c.emplaceBack(0,g.EXTENT),c.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ia.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);var d=new g.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(g.EXTENT,0,g.EXTENT,0),d.emplaceBack(0,g.EXTENT,0,g.EXTENT),d.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,Mt.members),this.rasterBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);var E=new g.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ia.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);var w=new g.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var M=new g.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(M),this.emptyTexture=new g.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Pe({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},ja.prototype.clearStencil=function(){var l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=g.create();g.ortho(c,0,this.width,this.height,0,0,1),g.scale(c,c,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,ge.disabled,this.stencilClearMode,Ge.disabled,ot.disabled,Fs(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ja.prototype._renderTileClippingMasks=function(l,h){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&h&&h.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+h.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(ge.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,M=h;w<M.length;w+=1){var L=M[w],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ge.disabled,new Pe({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),Ge.disabled,ot.disabled,Fs(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ja.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,h=this.context.gl;return new Pe({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)},ja.prototype.stencilModeForClipping=function(l){var h=this.context.gl;return new Pe({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)},ja.prototype.stencilConfigForOverlap=function(l){var h,c=this.context.gl,d=l.sort(function(U,Y){return Y.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var M={},L=0;L<w;L++)M[L+E]=new Pe({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[M,d]}return[(h={},h[E]=Pe.disabled,h),d]},ja.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new g.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},ja.prototype.depthModeForSublayer=function(l,h,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,h,[d,d])},ja.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ja.prototype.render=function(l,h){var c=this;this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(g.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var M=E[w];M.used&&M.prepare(this.context)}var L,U,Y={},oe={},fe={};for(var pe in E){var Re=E[pe];Y[pe]=Re.getVisibleCoordinates(),oe[pe]=Y[pe].slice().reverse(),fe[pe]=Re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ie=0;Ie<d.length;Ie++)if(this.style._layers[d[Ie]].is3D()){this.opaquePassCutoff=Ie;break}this.renderPass="offscreen";for(var Xe=0,Ae=d;Xe<Ae.length;Xe+=1){var Ye=this.style._layers[Ae[Xe]];if(Ye.hasOffscreenPass()&&!Ye.isHidden(this.transform.zoom)){var it=oe[Ye.source];(Ye.type==="custom"||it.length)&&this.renderLayer(this,E[Ye.source],Ye,it)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?g.Color.black:g.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var Et=this.style._layers[d[this.currentLayer]],Xt=E[Et.source],Nt=Y[Et.source];this._renderTileClippingMasks(Et,Nt),this.renderLayer(this,Xt,Et,Nt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var tr=this.style._layers[d[this.currentLayer]],mr=E[tr.source],Dr=(tr.type==="symbol"?fe:oe)[tr.source];this._renderTileClippingMasks(tr,Y[tr.source]),this.renderLayer(this,mr,tr,Dr)}this.options.showTileBoundaries&&(g.values(this.style._layers).forEach(function(sr){sr.source&&!sr.isHidden(c.transform.zoom)&&(sr.source!==(U&&U.id)&&(U=c.style.sourceCaches[sr.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&ns.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(sr){var Qr=sr.transform.padding;Hf(sr,sr.transform.height-(Qr.top||0),3,Sl),Hf(sr,Qr.bottom||0,3,lf),wh(sr,Qr.left||0,3,cf),wh(sr,sr.transform.width-(Qr.right||0),3,Ru);var Rn=sr.transform.centerPoint;(function(kn,Fn,Ai,un){Hl(kn,Fn-1,Ai-10,2,20,un),Hl(kn,Fn-10,Ai-1,20,2,un)})(sr,Rn.x,sr.transform.height-Rn.y,ff)}(this),this.context.setDefault()},ja.prototype.renderLayer=function(l,h,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),ns[c.type](l,h,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},ja.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var h=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),c.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,c.query)}},ja.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},ja.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},ja.prototype.queryGpuTimers=function(l){var h={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),h[c]=w}return h},ja.prototype.translatePosMatrix=function(l,h,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var M=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*M,c[0]*M+c[1]*L]}var U=[E?c[0]:Xi(h,c[0],this.transform.zoom),E?c[1]:Xi(h,c[1],this.transform.zoom),0],Y=new Float32Array(16);return g.translate(Y,l,U),Y},ja.prototype.saveTileTexture=function(l){var h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]},ja.prototype.getTileTexture=function(l){var h=this._tileTextures[l];return h&&h.length>0?h.pop():null},ja.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var h=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!h||!c},ja.prototype.useProgram=function(l,h){this.cache=this.cache||{};var c=""+l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new rf(this.context,l,Po[l],h,Gl[l],this._showOverdrawInspector)),this.cache[c]},ja.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ja.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},ja.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=g.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new g.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ja.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var lc=function(l,h){this.points=l,this.planes=h};lc.fromInvProjectionMatrix=function(l,h,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return g.transformMat4([],M,l)}).map(function(M){return g.scale$1([],M,1/M[3]/h*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var L=g.sub([],E[M[0]],E[M[1]]),U=g.sub([],E[M[2]],E[M[1]]),Y=g.normalize([],g.cross([],L,U)),oe=-g.dot(Y,E[M[1]]);return Y.concat(oe)});return new lc(E,w)};var Wl=function(l,h){this.min=l,this.max=h,this.center=g.scale$2([],g.add([],this.min,this.max),.5)};Wl.prototype.quadrant=function(l){for(var h=[l%2==0,l<2],c=g.clone$2(this.min),d=g.clone$2(this.max),E=0;E<h.length;E++)c[E]=h[E]?this.min[E]:this.center[E],d[E]=h[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new Wl(c,d)},Wl.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Wl.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Wl.prototype.intersects=function(l){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,M=0;M<h.length;M++)w+=g.dot$1(E,h[M])>=0;if(w===0)return 0;w!==h.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,Y=-Number.MAX_VALUE,oe=0;oe<l.points.length;oe++){var fe=l.points[oe][L]-this.min[L];U=Math.min(U,fe),Y=Math.max(Y,fe)}if(Y<0||U>this.max[L]-this.min[L])return 0}return 1};var cu=function(l,h,c,d){if(l===void 0&&(l=0),h===void 0&&(h=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(h)||h<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=c,this.right=d};cu.prototype.interpolate=function(l,h,c){return h.top!=null&&l.top!=null&&(this.top=g.number(l.top,h.top,c)),h.bottom!=null&&l.bottom!=null&&(this.bottom=g.number(l.bottom,h.bottom,c)),h.left!=null&&l.left!=null&&(this.left=g.number(l.left,h.left,c)),h.right!=null&&l.right!=null&&(this.right=g.number(l.right,h.right,c)),this},cu.prototype.getCenter=function(l,h){var c=g.clamp((this.left+l-this.right)/2,0,l),d=g.clamp((this.top+h-this.bottom)/2,0,h);return new g.Point(c,d)},cu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},cu.prototype.clone=function(){return new cu(this.top,this.bottom,this.left,this.right)},cu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ki=function(l,h,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new cu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ki.prototype.clone=function(){var l=new ki(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new g.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(l){var h=-g.wrap(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=g.create$2(),g.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(l){var h=g.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(l){var h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ki.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},ki.prototype.interpolatePadding=function(l,h,c){this._unmodified=!1,this._edgeInsets.interpolate(l,h,c),this._constrain(),this._calcMatrices()},ki.prototype.coveringZoomLevel=function(l){var h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)},ki.prototype.getVisibleUnwrappedCoordinates=function(l){var h=[new g.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new g.Point(0,0)),d=this.pointCoordinate(new g.Point(this.width,0)),E=this.pointCoordinate(new g.Point(this.width,this.height)),w=this.pointCoordinate(new g.Point(0,this.height)),M=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),U=M-1;U<=L+1;U++)U!==0&&h.push(new g.UnwrappedTileID(U,l));return h},ki.prototype.coveringTiles=function(l){var h=this.coveringZoomLevel(l),c=h;if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);var d=g.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,h),w=[E*d.x,E*d.y,0],M=lc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=h);var U=function(sr){return{aabb:new Wl([sr*E,0,0],[(sr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:sr,fullyVisible:!1}},Y=[],oe=[],fe=h,pe=l.reparseOverscaled?c:h;if(this._renderWorldCopies)for(var Re=1;Re<=3;Re++)Y.push(U(-Re)),Y.push(U(Re));for(Y.push(U(0));Y.length>0;){var Ie=Y.pop(),Xe=Ie.x,Ae=Ie.y,Ye=Ie.fullyVisible;if(!Ye){var it=Ie.aabb.intersects(M);if(it===0)continue;Ye=it===2}var Et=Ie.aabb.distanceX(w),Xt=Ie.aabb.distanceY(w),Nt=Math.max(Math.abs(Et),Math.abs(Xt));if(Ie.zoom===fe||Nt>3+(1<<fe-Ie.zoom)-2&&Ie.zoom>=L)oe.push({tileID:new g.OverscaledTileID(Ie.zoom===fe?pe:Ie.zoom,Ie.wrap,Ie.zoom,Xe,Ae),distanceSq:g.sqrLen([w[0]-.5-Xe,w[1]-.5-Ae])});else for(var tr=0;tr<4;tr++){var mr=(Xe<<1)+tr%2,Dr=(Ae<<1)+(tr>>1);Y.push({aabb:Ie.aabb.quadrant(tr),zoom:Ie.zoom+1,x:mr,y:Dr,wrap:Ie.wrap,fullyVisible:Ye})}}return oe.sort(function(sr,Qr){return sr.distanceSq-Qr.distanceSq}).map(function(sr){return sr.tileID})},ki.prototype.resize=function(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},ki.prototype.zoomScale=function(l){return Math.pow(2,l)},ki.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},ki.prototype.project=function(l){var h=g.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.Point(g.mercatorXfromLng(l.lng)*this.worldSize,g.mercatorYfromLat(h)*this.worldSize)},ki.prototype.unproject=function(l){return new g.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},ki.prototype.setLocationAtPoint=function(l,h){var c=this.pointCoordinate(h),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new g.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},ki.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},ki.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},ki.prototype.locationCoordinate=function(l){return g.MercatorCoordinate.fromLngLat(l)},ki.prototype.coordinateLocation=function(l){return l.toLngLat()},ki.prototype.pointCoordinate=function(l){var h=[l.x,l.y,0,1],c=[l.x,l.y,1,1];g.transformMat4(h,h,this.pixelMatrixInverse),g.transformMat4(c,c,this.pixelMatrixInverse);var d=h[3],E=c[3],w=h[1]/d,M=c[1]/E,L=h[2]/d,U=c[2]/E,Y=L===U?0:(0-L)/(U-L);return new g.MercatorCoordinate(g.number(h[0]/d,c[0]/E,Y)/this.worldSize,g.number(w,M,Y)/this.worldSize)},ki.prototype.coordinatePoint=function(l){var h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix),new g.Point(h[0]/h[3],h[1]/h[3])},ki.prototype.getBounds=function(){return new g.LngLatBounds().extend(this.pointLocation(new g.Point(0,0))).extend(this.pointLocation(new g.Point(this.width,0))).extend(this.pointLocation(new g.Point(this.width,this.height))).extend(this.pointLocation(new g.Point(0,this.height)))},ki.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new g.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ki.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ki.prototype.calculatePosMatrix=function(l,h){h===void 0&&(h=!1);var c=l.key,d=h?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),M=E.x+Math.pow(2,E.z)*l.wrap,L=g.identity(new Float64Array(16));return g.translate(L,L,[M*w,E.y*w,0]),g.scale(L,L,[w/g.EXTENT,w/g.EXTENT,1]),g.multiply(L,h?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},ki.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ki.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,h,c,d,E=-90,w=90,M=-180,L=180,U=this.size,Y=this._unmodified;if(this.latRange){var oe=this.latRange;E=g.mercatorYfromLat(oe[1])*this.worldSize,l=(w=g.mercatorYfromLat(oe[0])*this.worldSize)-E<U.y?U.y/(w-E):0}if(this.lngRange){var fe=this.lngRange;M=g.mercatorXfromLng(fe[0])*this.worldSize,h=(L=g.mercatorXfromLng(fe[1])*this.worldSize)-M<U.x?U.x/(L-M):0}var pe=this.point,Re=Math.max(h||0,l||0);if(Re)return this.center=this.unproject(new g.Point(h?(L+M)/2:pe.x,l?(w+E)/2:pe.y)),this.zoom+=this.scaleZoom(Re),this._unmodified=Y,void(this._constraining=!1);if(this.latRange){var Ie=pe.y,Xe=U.y/2;Ie-Xe<E&&(d=E+Xe),Ie+Xe>w&&(d=w-Xe)}if(this.lngRange){var Ae=pe.x,Ye=U.x/2;Ae-Ye<M&&(c=M+Ye),Ae+Ye>L&&(c=L-Ye)}c===void 0&&d===void 0||(this.center=this.unproject(new g.Point(c!==void 0?c:pe.x,d!==void 0?d:pe.y))),this._unmodified=Y,this._constraining=!1}},ki.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(g.clamp(Math.PI-h-c,.01,Math.PI-.01)),E=this.point,w=E.x,M=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,Y=new Float64Array(16);g.perspective(Y,this._fov,this.width/this.height,U,L),Y[8]=2*-l.x/this.width,Y[9]=2*l.y/this.height,g.scale(Y,Y,[1,-1,1]),g.translate(Y,Y,[0,0,-this.cameraToCenterDistance]),g.rotateX(Y,Y,this._pitch),g.rotateZ(Y,Y,this.angle),g.translate(Y,Y,[-w,-M,0]),this.mercatorMatrix=g.scale([],Y,[this.worldSize,this.worldSize,this.worldSize]),g.scale(Y,Y,[1,1,g.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Y,this.invProjMatrix=g.invert([],this.projMatrix);var oe=this.width%2/2,fe=this.height%2/2,pe=Math.cos(this.angle),Re=Math.sin(this.angle),Ie=w-Math.round(w)+pe*oe+Re*fe,Xe=M-Math.round(M)+pe*fe+Re*oe,Ae=new Float64Array(Y);if(g.translate(Ae,Ae,[Ie>.5?Ie-1:Ie,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=Ae,Y=g.create(),g.scale(Y,Y,[this.width/2,-this.height/2,1]),g.translate(Y,Y,[1,-1,0]),this.labelPlaneMatrix=Y,Y=g.create(),g.scale(Y,Y,[1,-1,1]),g.translate(Y,Y,[-1,-1,0]),g.scale(Y,Y,[2/this.width,2/this.height,1]),this.glCoordMatrix=Y,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Y=g.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Y,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ki.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new g.Point(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},ki.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.Point(0,l))},ki.prototype.getCameraQueryGeometry=function(l){var h=this.getCameraPoint();if(l.length===1)return[l[0],h];for(var c=h.x,d=h.y,E=h.x,w=h.y,M=0,L=l;M<L.length;M+=1){var U=L[M];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),w=Math.max(w,U.y)}return[new g.Point(c,d),new g.Point(E,d),new g.Point(E,w),new g.Point(c,w),new g.Point(c,d)]},Object.defineProperties(ki.prototype,Ma);var Bs=function(l){var h,c,d,E;this._hashName=l&&encodeURIComponent(l),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(h(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Bs.prototype.addTo=function(l){return this._map=l,g.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Bs.prototype.remove=function(){return g.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Bs.prototype.getHashString=function(l){var h=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(h.lng*E)/E,M=Math.round(h.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),Y="";if(Y+=l?"/"+w+"/"+M+"/"+c:c+"/"+M+"/"+w,(L||U)&&(Y+="/"+Math.round(10*L)/10),U&&(Y+="/"+Math.round(U)),this._hashName){var oe=this._hashName,fe=!1,pe=g.window.location.hash.slice(1).split("&").map(function(Re){var Ie=Re.split("=")[0];return Ie===oe?(fe=!0,Ie+"="+Y):Re}).filter(function(Re){return Re});return fe||pe.push(oe+"="+Y),"#"+pe.join("&")}return"#"+Y},Bs.prototype._getCurrentHash=function(){var l,h=this,c=g.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===h._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Bs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:h,pitch:+(l[4]||0)}),!0}return!1},Bs.prototype._updateHashUnthrottled=function(){var l=g.window.location.href.replace(/(#.+)?$/,this.getHashString());try{g.window.history.replaceState(g.window.history.state,null,l)}catch(h){}};var hf={linearity:.3,easing:g.bezier(0,0,.3,1)},Cl=g.extend({deceleration:2500,maxSpeed:1400},hf),pf=g.extend({deceleration:20,maxSpeed:1400},hf),ip=g.extend({deceleration:1e3,maxSpeed:360},hf),ap=g.extend({deceleration:1e3,maxSpeed:90},hf),Zc=function(l){this._map=l,this.clear()};function cc(l,h){(!l.duration||l.duration<h.duration)&&(l.duration=h.duration,l.easing=h.easing)}function rl(l,h,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,M=g.clamp(l*E/(h/1e3),-d,d),L=Math.abs(M)/(w*E);return{easing:c.easing,duration:1e3*L,amount:M*(L/2)}}Zc.prototype.clear=function(){this._inertiaBuffer=[]},Zc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.browser.now(),settings:l})},Zc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,h=g.browser.now();l.length>0&&h-l[0].time>160;)l.shift()},Zc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new g.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;h.zoom+=E.zoomDelta||0,h.bearing+=E.bearingDelta||0,h.pitch+=E.pitchDelta||0,E.panDelta&&h.pan._add(E.panDelta),E.around&&(h.around=E.around),E.pinchAround&&(h.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(h.pan.mag()){var L=rl(h.pan.mag(),w,g.extend({},Cl,l||{}));M.offset=h.pan.mult(L.amount/h.pan.mag()),M.center=this._map.transform.center,cc(M,L)}if(h.zoom){var U=rl(h.zoom,w,pf);M.zoom=this._map.transform.zoom+U.amount,cc(M,U)}if(h.bearing){var Y=rl(h.bearing,w,ip);M.bearing=this._map.transform.bearing+g.clamp(Y.amount,-179,179),cc(M,Y)}if(h.pitch){var oe=rl(h.pitch,w,ap);M.pitch=this._map.transform.pitch+oe.amount,cc(M,oe)}if(M.zoom||M.bearing){var fe=h.pinchAround===void 0?h.around:h.pinchAround;M.around=fe?this._map.unproject(fe):this._map.getCenter()}return this.clear(),g.extend(M,{noMoveStart:!0})}};var Io=function(l){function h(d,E,w,M){M===void 0&&(M={});var L=V.mousePos(E.getCanvasContainer(),w),U=E.unproject(L);l.call(this,d,g.extend({point:L,lngLat:U,originalEvent:w},M)),this._defaultPrevented=!1,this.target=E}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),fc=function(l){function h(d,E,w){var M=d==="touchend"?w.changedTouches:w.touches,L=V.touchPos(E.getCanvasContainer(),M),U=L.map(function(fe){return E.unproject(fe)}),Y=L.reduce(function(fe,pe,Re,Ie){return fe.add(pe.div(Ie.length))},new g.Point(0,0)),oe=E.unproject(Y);l.call(this,d,{points:L,point:Y,lngLats:U,lngLat:oe,originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),hc=function(l){function h(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(g.Event),Xa=function(l,h){this._map=l,this._clickTolerance=h.clickTolerance};Xa.prototype.reset=function(){delete this._mousedownPos},Xa.prototype.wheel=function(l){return this._firePreventable(new hc(l.type,this._map,l))},Xa.prototype.mousedown=function(l,h){return this._mousedownPos=h,this._firePreventable(new Io(l.type,this._map,l))},Xa.prototype.mouseup=function(l){this._map.fire(new Io(l.type,this._map,l))},Xa.prototype.click=function(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Io(l.type,this._map,l))},Xa.prototype.dblclick=function(l){return this._firePreventable(new Io(l.type,this._map,l))},Xa.prototype.mouseover=function(l){this._map.fire(new Io(l.type,this._map,l))},Xa.prototype.mouseout=function(l){this._map.fire(new Io(l.type,this._map,l))},Xa.prototype.touchstart=function(l){return this._firePreventable(new fc(l.type,this._map,l))},Xa.prototype.touchmove=function(l){this._map.fire(new fc(l.type,this._map,l))},Xa.prototype.touchend=function(l){this._map.fire(new fc(l.type,this._map,l))},Xa.prototype.touchcancel=function(l){this._map.fire(new fc(l.type,this._map,l))},Xa.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Xa.prototype.isEnabled=function(){return!0},Xa.prototype.isActive=function(){return!1},Xa.prototype.enable=function(){},Xa.prototype.disable=function(){};var vn=function(l){this._map=l};vn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},vn.prototype.mousemove=function(l){this._map.fire(new Io(l.type,this._map,l))},vn.prototype.mousedown=function(){this._delayContextMenu=!0},vn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Io("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},vn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Io(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},vn.prototype.isEnabled=function(){return!0},vn.prototype.isActive=function(){return!1},vn.prototype.enable=function(){},vn.prototype.disable=function(){};var eo=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1};function nl(l,h){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=h[d];return c}eo.prototype.isEnabled=function(){return!!this._enabled},eo.prototype.isActive=function(){return!!this._active},eo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},eo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},eo.prototype.mousedown=function(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(V.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},eo.prototype.mousemoveWindow=function(l,h){if(this._active){var c=h;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=V.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),M=Math.min(d.y,c.y),L=Math.max(d.y,c.y);V.setTransform(this._box,"translate("+E+"px,"+M+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-M+"px"}}},eo.prototype.mouseupWindow=function(l,h){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=h;if(this.reset(),V.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},eo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},eo.prototype.blur=function(){this.reset()},eo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos},eo.prototype._fireEvent=function(l,h){return this._map.fire(new g.Event(l,{originalEvent:h}))};var il=function(l){this.reset(),this.numTouches=l.numTouches};il.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},il.prototype.touchstart=function(l,h,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new g.Point(0,0),w=0,M=d;w<M.length;w+=1)E._add(M[w]);return E.div(d.length)}(h),this.touches=nl(c,h)))},il.prototype.touchmove=function(l,h,c){if(!this.aborted&&this.centroid){var d=nl(c,h);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},il.prototype.touchend=function(l,h,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var bu=function(l){this.singleTap=new il(l),this.numTaps=l.numTaps,this.reset()};bu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},bu.prototype.touchstart=function(l,h,c){this.singleTap.touchstart(l,h,c)},bu.prototype.touchmove=function(l,h,c){this.singleTap.touchmove(l,h,c)},bu.prototype.touchend=function(l,h,c){var d=this.singleTap.touchend(l,h,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Ns=function(){this._zoomIn=new bu({numTouches:1,numTaps:2}),this._zoomOut=new bu({numTouches:2,numTaps:1}),this.reset()};Ns.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ns.prototype.touchstart=function(l,h,c){this._zoomIn.touchstart(l,h,c),this._zoomOut.touchstart(l,h,c)},Ns.prototype.touchmove=function(l,h,c){this._zoomIn.touchmove(l,h,c),this._zoomOut.touchmove(l,h,c)},Ns.prototype.touchend=function(l,h,c){var d=this,E=this._zoomIn.touchend(l,h,c),w=this._zoomOut.touchend(l,h,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(w)},{originalEvent:l})}}):void 0},Ns.prototype.touchcancel=function(){this.reset()},Ns.prototype.enable=function(){this._enabled=!0},Ns.prototype.disable=function(){this._enabled=!1,this.reset()},Ns.prototype.isEnabled=function(){return this._enabled},Ns.prototype.isActive=function(){return this._active};var Wf={0:1,2:2},qr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};qr.prototype.blur=function(){this.reset()},qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(l,h){return!1},qr.prototype._move=function(l,h){return{}},qr.prototype.mousedown=function(l,h){if(!this._lastPoint){var c=V.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=h,this._eventButton=c)}},qr.prototype.mousemoveWindow=function(l,h){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=Wf[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(c,h)}},qr.prototype.mouseupWindow=function(l){this._lastPoint&&V.mouseButton(l)===this._eventButton&&(this._moved&&V.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var df=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},h.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},h}(qr),Xf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(qr),Lu=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(qr),Ba=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ba.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new g.Point(0,0)},Ba.prototype.touchstart=function(l,h,c){return this._calculateTransform(l,h,c)},Ba.prototype.touchmove=function(l,h,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,h,c)},Ba.prototype.touchend=function(l,h,c){this._calculateTransform(l,h,c),this._active&&c.length<this._minTouches&&this.reset()},Ba.prototype.touchcancel=function(){this.reset()},Ba.prototype._calculateTransform=function(l,h,c){c.length>0&&(this._active=!0);var d=nl(c,h),E=new g.Point(0,0),w=new g.Point(0,0),M=0;for(var L in d){var U=d[L],Y=this._touches[L];Y&&(E._add(U),w._add(U.sub(Y)),M++,d[L]=U)}if(this._touches=d,!(M<this._minTouches)&&w.mag()){var oe=w.div(M);if(this._sum._add(oe),!(this._sum.mag()<this._clickTolerance))return{around:E.div(M),panDelta:oe}}},Ba.prototype.enable=function(){this._enabled=!0},Ba.prototype.disable=function(){this._enabled=!1,this.reset()},Ba.prototype.isEnabled=function(){return this._enabled},Ba.prototype.isActive=function(){return this._active};var zs=function(){this.reset()};function vf(l,h,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return h[d]}function ku(l,h){return Math.log(l/h)/Math.LN2}zs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},zs.prototype._start=function(l){},zs.prototype._move=function(l,h,c){return{}},zs.prototype.touchstart=function(l,h,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([h[0],h[1]]))},zs.prototype.touchmove=function(l,h,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=vf(c,h,d[0]),M=vf(c,h,E);if(w&&M){var L=this._aroundCenter?null:w.add(M).div(2);return this._move([w,M],L,l)}}},zs.prototype.touchend=function(l,h,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=vf(c,h,d[0]),M=vf(c,h,E);w&&M||(this._active&&V.suppressClick(),this.reset())}},zs.prototype.touchcancel=function(){this.reset()},zs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},zs.prototype.disable=function(){this._enabled=!1,this.reset()},zs.prototype.isEnabled=function(){return this._enabled},zs.prototype.isActive=function(){return this._active};var Is=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(ku(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ku(this._distance,E),pinchAround:d}},h}(zs);function _o(l,h){return 180*l.angleWith(h)/Math.PI}var Th=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_o(this._vector,E),pinchAround:d}},h.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=_o(c,this._startVector);return Math.abs(E)<d},h}(zs);function da(l){return Math.abs(l.y)>Math.abs(l.x)}var Yf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(c){this._lastPoints=c,da(c[0].sub(c[1]))&&(this._valid=!1)},h.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),M=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,M,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+M.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,M=d.mag()>=2;if(w||M){if(!w||!M)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return da(c)&&da(d)&&L}},h}(zs),Mh={panStep:100,bearingStep:15,pitchStep:10},qs=function(){var l=Mh;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Os(l){return l*(2-l)}qs.prototype.blur=function(){this.reset()},qs.prototype.reset=function(){this._active=!1},qs.prototype.keydown=function(l){var h=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,M=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),M=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*h._bearingStep,pitch:L.getPitch()+E*h._pitchStep,offset:[-w*h._panStep,-M*h._panStep],center:L.getCenter()},{originalEvent:l})}}}},qs.prototype.enable=function(){this._enabled=!0},qs.prototype.disable=function(){this._enabled=!1,this.reset()},qs.prototype.isEnabled=function(){return this._enabled},qs.prototype.isActive=function(){return this._active},qs.prototype.disableRotation=function(){this._rotationDisabled=!0},qs.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ii=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,g.bindAll(["_onTimeout"],this)};Ii.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ii.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ii.prototype.isEnabled=function(){return!!this._enabled},Ii.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ii.prototype.isZooming=function(){return!!this._zooming},Ii.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ii.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ii.prototype.wheel=function(l){if(this.isEnabled()){var h=l.deltaMode===g.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=g.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}},Ii.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ii.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=V.mousePos(this._el,l);this._around=g.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ii.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,M=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,L=this._startZoom,U=this._easing,Y=!1;if(this._type==="wheel"&&L&&U){var oe=Math.min((g.browser.now()-this._lastWheelEventTime)/200,1),fe=U(oe);w=g.number(L,M,fe),oe<1?this._frameId||(this._frameId=!0):Y=!0}else w=M,Y=!0;return this._active=!0,Y&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Y,zoomDelta:w-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ii.prototype._smoothOutEasing=function(l){var h=g.ease;if(this._prevEase){var c=this._prevEase,d=(g.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-w*w);h=g.bezier(w,M,.25,1)}return this._prevEase={start:g.browser.now(),duration:l,easing:h},h},Ii.prototype.blur=function(){this.reset()},Ii.prototype.reset=function(){this._active=!1};var Eu=function(l,h){this._clickZoom=l,this._tapZoom=h};Eu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Eu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Eu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Eu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ca=function(){this.reset()};ca.prototype.reset=function(){this._active=!1},ca.prototype.blur=function(){this.reset()},ca.prototype.dblclick=function(l,h){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(h)},{originalEvent:l})}}},ca.prototype.enable=function(){this._enabled=!0},ca.prototype.disable=function(){this._enabled=!1,this.reset()},ca.prototype.isEnabled=function(){return this._enabled},ca.prototype.isActive=function(){return this._active};var oo=function(){this._tap=new bu({numTouches:1,numTaps:1}),this.reset()};oo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},oo.prototype.touchstart=function(l,h,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=h[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,h,c))},oo.prototype.touchmove=function(l,h,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=h[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,h,c)},oo.prototype.touchend=function(l,h,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,h,c)&&(this._tapTime=l.timeStamp)},oo.prototype.touchcancel=function(){this.reset()},oo.prototype.enable=function(){this._enabled=!0},oo.prototype.disable=function(){this._enabled=!1,this.reset()},oo.prototype.isEnabled=function(){return this._enabled},oo.prototype.isActive=function(){return this._active};var Us=function(l,h,c){this._el=l,this._mousePan=h,this._touchPan=c};Us.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Us.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Us.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Us.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var fu=function(l,h,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=c};fu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},fu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},fu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},fu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Zs=function(l,h,c,d){this._el=l,this._touchZoom=h,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Zs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Zs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Zs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Zs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Zs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Zs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ps=function(l){return l.zoom||l.drag||l.pitch||l.rotate},js=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(g.Event);function On(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Cn=function(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zc(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),g.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[g.window.document,"mousemove",{capture:!0}],[g.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[g.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],M=w[0];V.addEventListener(M,w[1],M===g.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Cn.prototype.destroy=function(){for(var l=0,h=this._listeners;l<h.length;l+=1){var c=h[l],d=c[0];V.removeEventListener(d,c[1],d===g.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Cn.prototype._addDefaultHandlers=function(l){var h=this._map,c=h.getCanvasContainer();this._add("mapEvent",new Xa(h,l));var d=h.boxZoom=new eo(h,l);this._add("boxZoom",d);var E=new Ns,w=new ca;h.doubleClickZoom=new Eu(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var M=new oo;this._add("tapDragZoom",M);var L=h.touchPitch=new Yf;this._add("touchPitch",L);var U=new Xf(l),Y=new Lu(l);h.dragRotate=new fu(l,U,Y),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);var oe=new df(l),fe=new Ba(l);h.dragPan=new Us(c,oe,fe),this._add("mousePan",oe),this._add("touchPan",fe,["touchZoom","touchRotate"]);var pe=new Th,Re=new Is;h.touchZoomRotate=new Zs(c,Re,pe,M),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]);var Ie=h.scrollZoom=new Ii(h,this);this._add("scrollZoom",Ie,["mousePan"]);var Xe=h.keyboard=new qs;this._add("keyboard",Xe),this._add("blockableMapEvent",new vn(h));for(var Ae=0,Ye=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<Ye.length;Ae+=1){var it=Ye[Ae];l.interactive&&l[it]&&h[it].enable(l[it])}},Cn.prototype._add=function(l,h,c){this._handlers.push({handlerName:l,handler:h,allowed:c}),this._handlersById[l]=h},Cn.prototype.stop=function(l){if(!this._updatingCamera){for(var h=0,c=this._handlers;h<c.length;h+=1)c[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Cn.prototype.isActive=function(){for(var l=0,h=this._handlers;l<h.length;l+=1)if(h[l].handler.isActive())return!0;return!1},Cn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Cn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Cn.prototype.isMoving=function(){return Boolean(ps(this._eventsInProgress))||this.isZooming()},Cn.prototype._blockedByActive=function(l,h,c){for(var d in l)if(d!==c&&(!h||h.indexOf(d)<0))return!0;return!1},Cn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Cn.prototype._getMapTouches=function(l){for(var h=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&h.push(E)}return h},Cn.prototype.handleEvent=function(l,h){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},M=l.touches?this._getMapTouches(l.touches):void 0,L=M?V.touchPos(this._el,M):V.mousePos(this._el,l),U=0,Y=this._handlers;U<Y.length;U+=1){var oe=Y[U],fe=oe.handlerName,pe=oe.handler,Re=oe.allowed;if(pe.isEnabled()){var Ie=void 0;this._blockedByActive(w,Re,fe)?pe.reset():pe[h||l.type]&&(Ie=pe[h||l.type](l,L,M),this.mergeHandlerResult(d,E,Ie,fe,c),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||pe.isActive())&&(w[fe]=pe)}}var Xe={};for(var Ae in this._previousActiveHandlers)w[Ae]||(Xe[Ae]=c);this._previousActiveHandlers=w,(Object.keys(Xe).length||On(d))&&(this._changes.push([d,E,Xe]),this._triggerRenderFrame()),(Object.keys(w).length||On(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ye=d.cameraAnimation;Ye&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ye(this._map))},Cn.prototype.mergeHandlerResult=function(l,h,c,d,E){if(c){g.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(h.zoom=w),c.panDelta!==void 0&&(h.drag=w),c.pitchDelta!==void 0&&(h.pitch=w),c.bearingDelta!==void 0&&(h.rotate=w)}},Cn.prototype._applyChanges=function(){for(var l={},h={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],M=w[0],L=w[1],U=w[2];M.panDelta&&(l.panDelta=(l.panDelta||new g.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(l.around=M.around),M.pinchAround!==void 0&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),g.extend(h,L),g.extend(c,U)}this._updateMapTransform(l,h,c),this._changes=[]},Cn.prototype._updateMapTransform=function(l,h,c){var d=this._map,E=d.transform;if(!On(l))return this._fireEvents(h,c,!0);var w=l.panDelta,M=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,Y=l.around,oe=l.pinchAround;oe!==void 0&&(Y=oe),d._stop(!0),Y=Y||d.transform.centerPoint;var fe=E.pointLocation(w?Y.sub(w):Y);L&&(E.bearing+=L),U&&(E.pitch+=U),M&&(E.zoom+=M),E.setLocationAtPoint(fe,Y),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,c,!0)},Cn.prototype._fireEvents=function(l,h,c){var d=this,E=ps(this._eventsInProgress),w=ps(l),M={};for(var L in l)this._eventsInProgress[L]||(M[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&w&&this._fireEvent("movestart",w.originalEvent),M)this._fireEvent(U,M[U]);for(var Y in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(Y,l[Y].originalEvent);var oe,fe={};for(var pe in this._eventsInProgress){var Re=this._eventsInProgress[pe],Ie=Re.handlerName,Xe=Re.originalEvent;this._handlersById[Ie].isActive()||(delete this._eventsInProgress[pe],fe[pe+"end"]=oe=h[Ie]||Xe)}for(var Ae in fe)this._fireEvent(Ae,fe[Ae]);var Ye=ps(this._eventsInProgress);if(c&&(E||w)&&!Ye){this._updatingCamera=!0;var it=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Et=function(Xt){return Xt!==0&&-d._bearingSnap<Xt&&Xt<d._bearingSnap};it?(Et(it.bearing||this._map.getBearing())&&(it.bearing=0),this._map.easeTo(it,{originalEvent:oe})):(this._map.fire(new g.Event("moveend",{originalEvent:oe})),Et(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Cn.prototype._fireEvent=function(l,h){this._map.fire(new g.Event(l,h?{originalEvent:h}:{}))},Cn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete l._frameId,l.handleEvent(new js("renderFrame",{timeStamp:h})),l._applyChanges()})},Cn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var pc=function(l){function h(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCenter=function(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},h.prototype.panBy=function(c,d,E){return c=g.Point.convert(c).mult(-1),this.panTo(this.transform.center,g.extend({offset:c},d),E)},h.prototype.panTo=function(c,d,E){return this.easeTo(g.extend({center:c},d),E)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},h.prototype.zoomTo=function(c,d,E){return this.easeTo(g.extend({zoom:c},d),E)},h.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},h.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},h.prototype.rotateTo=function(c,d,E){return this.easeTo(g.extend({bearing:c},d),E)},h.prototype.resetNorth=function(c,d){return this.rotateTo(0,g.extend({duration:1e3},c),d),this},h.prototype.resetNorthPitch=function(c,d){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},c),d),this},h.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},h.prototype.cameraForBounds=function(c,d){c=g.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},h.prototype._cameraForBoxAndBearing=function(c,d,E,w){var M={top:0,bottom:0,right:0,left:0};if(typeof(w=g.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=g.extend(M,w.padding);var U=this.transform,Y=U.padding,oe=U.project(g.LngLat.convert(c)),fe=U.project(g.LngLat.convert(d)),pe=oe.rotate(-E*Math.PI/180),Re=fe.rotate(-E*Math.PI/180),Ie=new g.Point(Math.max(pe.x,Re.x),Math.max(pe.y,Re.y)),Xe=new g.Point(Math.min(pe.x,Re.x),Math.min(pe.y,Re.y)),Ae=Ie.sub(Xe),Ye=(U.width-(Y.left+Y.right+w.padding.left+w.padding.right))/Ae.x,it=(U.height-(Y.top+Y.bottom+w.padding.top+w.padding.bottom))/Ae.y;if(!(it<0||Ye<0)){var Et=Math.min(U.scaleZoom(U.scale*Math.min(Ye,it)),w.maxZoom),Xt=typeof w.offset.x=="number"?new g.Point(w.offset.x,w.offset.y):g.Point.convert(w.offset),Nt=new g.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),tr=Xt.add(Nt).mult(U.scale/U.zoomScale(Et));return{center:U.unproject(oe.add(fe).div(2).sub(tr)),zoom:Et,bearing:E}}g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},h.prototype.fitScreenCoordinates=function(c,d,E,w,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.Point.convert(c)),this.transform.pointLocation(g.Point.convert(d)),E,w),w,M)},h.prototype._fitInternal=function(c,d,E){return c?(delete(d=g.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},h.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,M=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=g.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(M=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new g.Event("movestart",d)).fire(new g.Event("move",d)),w&&this.fire(new g.Event("zoomstart",d)).fire(new g.Event("zoom",d)).fire(new g.Event("zoomend",d)),M&&this.fire(new g.Event("rotatestart",d)).fire(new g.Event("rotate",d)).fire(new g.Event("rotateend",d)),L&&this.fire(new g.Event("pitchstart",d)).fire(new g.Event("pitch",d)).fire(new g.Event("pitchend",d)),this.fire(new g.Event("moveend",d))},h.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=g.extend({offset:[0,0],duration:500,easing:g.ease},c)).animate===!1||!c.essential&&g.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,M=this.getZoom(),L=this.getBearing(),U=this.getPitch(),Y=this.getPadding(),oe="zoom"in c?+c.zoom:M,fe="bearing"in c?this._normalizeBearing(c.bearing,L):L,pe="pitch"in c?+c.pitch:U,Re="padding"in c?c.padding:w.padding,Ie=g.Point.convert(c.offset),Xe=w.centerPoint.add(Ie),Ae=w.pointLocation(Xe),Ye=g.LngLat.convert(c.center||Ae);this._normalizeCenter(Ye);var it,Et,Xt=w.project(Ae),Nt=w.project(Ye).sub(Xt),tr=w.zoomScale(oe-M);c.around&&(it=g.LngLat.convert(c.around),Et=w.locationPoint(it));var mr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==M,this._rotating=this._rotating||L!==fe,this._pitching=this._pitching||pe!==U,this._padding=!w.isPaddingEqual(Re),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,mr),this._ease(function(Dr){if(E._zooming&&(w.zoom=g.number(M,oe,Dr)),E._rotating&&(w.bearing=g.number(L,fe,Dr)),E._pitching&&(w.pitch=g.number(U,pe,Dr)),E._padding&&(w.interpolatePadding(Y,Re,Dr),Xe=w.centerPoint.add(Ie)),it)w.setLocationAtPoint(it,Et);else{var sr=w.zoomScale(w.zoom-M),Qr=oe>M?Math.min(2,tr):Math.max(.5,tr),Rn=Math.pow(Qr,1-Dr),kn=w.unproject(Xt.add(Nt.mult(Dr*Rn)).mult(sr));w.setLocationAtPoint(w.renderWorldCopies?kn.wrap():kn,Xe)}E._fireMoveEvents(d)},function(Dr){E._afterEase(d,Dr)},c),this},h.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new g.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new g.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new g.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new g.Event("pitchstart",c))},h.prototype._fireMoveEvents=function(c){this.fire(new g.Event("move",c)),this._zooming&&this.fire(new g.Event("zoom",c)),this._rotating&&this.fire(new g.Event("rotate",c)),this._pitching&&this.fire(new g.Event("pitch",c))},h.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new g.Event("zoomend",c)),w&&this.fire(new g.Event("rotateend",c)),M&&this.fire(new g.Event("pitchend",c)),this.fire(new g.Event("moveend",c))}},h.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&g.browser.prefersReducedMotion){var w=g.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},c);var M=this.transform,L=this.getZoom(),U=this.getBearing(),Y=this.getPitch(),oe=this.getPadding(),fe="zoom"in c?g.clamp(+c.zoom,M.minZoom,M.maxZoom):L,pe="bearing"in c?this._normalizeBearing(c.bearing,U):U,Re="pitch"in c?+c.pitch:Y,Ie="padding"in c?c.padding:M.padding,Xe=M.zoomScale(fe-L),Ae=g.Point.convert(c.offset),Ye=M.centerPoint.add(Ae),it=M.pointLocation(Ye),Et=g.LngLat.convert(c.center||it);this._normalizeCenter(Et);var Xt=M.project(it),Nt=M.project(Et).sub(Xt),tr=c.curve,mr=Math.max(M.width,M.height),Dr=mr/Xe,sr=Nt.mag();if("minZoom"in c){var Qr=g.clamp(Math.min(c.minZoom,L,fe),M.minZoom,M.maxZoom),Rn=mr/M.zoomScale(Qr-L);tr=Math.sqrt(Rn/sr*2)}var kn=tr*tr;function Fn(jn){var Tn=(Dr*Dr-mr*mr+(jn?-1:1)*kn*kn*sr*sr)/(2*(jn?Dr:mr)*kn*sr);return Math.log(Math.sqrt(Tn*Tn+1)-Tn)}function Ai(jn){return(Math.exp(jn)-Math.exp(-jn))/2}function un(jn){return(Math.exp(jn)+Math.exp(-jn))/2}var Sn=Fn(0),Qn=function(jn){return un(Sn)/un(Sn+tr*jn)},Xn=function(jn){return mr*((un(Sn)*(Ai(Tn=Sn+tr*jn)/un(Tn))-Ai(Sn))/kn)/sr;var Tn},Yn=(Fn(1)-Sn)/tr;if(Math.abs(sr)<1e-6||!isFinite(Yn)){if(Math.abs(mr-Dr)<1e-6)return this.easeTo(c,d);var di=Dr<mr?-1:1;Yn=Math.abs(Math.log(Dr/mr))/tr,Xn=function(){return 0},Qn=function(jn){return Math.exp(di*tr*jn)}}return c.duration="duration"in c?+c.duration:1e3*Yn/("screenSpeed"in c?+c.screenSpeed/tr:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==pe,this._pitching=Re!==Y,this._padding=!M.isPaddingEqual(Ie),this._prepareEase(d,!1),this._ease(function(jn){var Tn=jn*Yn,qi=1/Qn(Tn);M.zoom=jn===1?fe:L+M.scaleZoom(qi),E._rotating&&(M.bearing=g.number(U,pe,jn)),E._pitching&&(M.pitch=g.number(Y,Re,jn)),E._padding&&(M.interpolatePadding(oe,Ie,jn),Ye=M.centerPoint.add(Ae));var Ya=jn===1?Et:M.unproject(Xt.add(Nt.mult(Xn(Tn))).mult(qi));M.setLocationAtPoint(M.renderWorldCopies?Ya.wrap():Ya,Ye),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},h.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=g.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var c=Math.min((g.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(c,d){c=g.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},h.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},h}(g.Evented),ds=function(l){l===void 0&&(l={}),this.options=l,g.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ds.prototype.getDefaultPosition=function(){return"bottom-right"},ds.prototype.onAdd=function(l){var h=this.options&&this.options.compact;return this._map=l,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ds.prototype.onRemove=function(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ds.prototype._setElementTitle=function(l,h){var c=this._map._getUIString("AttributionControl."+h);l.title=c,l.setAttribute("aria-label",c)},ds.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ds.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||g.config.ACCESS_TOKEN}];if(l){var c=h.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<h.length-1?"&":"")),d},"?");l.href=g.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},ds.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ds.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,U){return L.length-U.length});var M=(l=l.filter(function(L,U){for(var Y=U+1;Y<l.length;Y++)if(l[Y].indexOf(L)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,l.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ds.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Su=function(){g.bindAll(["_updateLogo"],this),g.bindAll(["_updateCompact"],this)};Su.prototype.onAdd=function(l){this._map=l,this._container=V.create("div","mapboxgl-ctrl");var h=V.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Su.prototype.onRemove=function(){V.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Su.prototype.getDefaultPosition=function(){return"bottom-left"},Su.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Su.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var h in l)if(l[h].getSource().mapbox_logo)return!0;return!1}},Su.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var Ko=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ko.prototype.add=function(l){var h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h},Ko.prototype.remove=function(l){for(var h=this._currentlyRunning,c=0,d=h?this._queue.concat(h):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Ko.prototype.run=function(l){l===void 0&&(l=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=h;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ko.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ba={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},mf=g.window.HTMLImageElement,jc=g.window.HTMLElement,oa=g.window.ImageBitmap,ka={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},qf=function(l){function h(d){var E=this;if((d=g.extend({},ka,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new ki(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Ko,this._controls=[],this._mapId=g.uniqueId(),this._locale=g.extend({},ba,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new g.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=g.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof jc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),g.window!==void 0&&(g.window.addEventListener("online",this._onWindowOnline,!1),g.window.addEventListener("resize",this._onWindowResize,!1),g.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Cn(this,d),this._hash=d.hash&&new Bs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,g.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new ds({customAttribution:d.customAttribution})),this.addControl(new Su,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(M){E._update(M.dataType==="style"),E.fire(new g.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){E.fire(new g.Event(M.dataType+"dataloading",M))})}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var M=this._controlPositions[E];return E.indexOf("bottom")!==-1?M.insertBefore(w,M.firstChild):M.appendChild(w),this},h.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},h.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},h.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],M=E[1];if(w===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(w,M),this.transform.resize(w,M),this.painter.resize(w,M);var L=!this._moving;return L&&this.fire(new g.Event("movestart",d)).fire(new g.Event("move",d)),this.fire(new g.Event("resize",d)),L&&this.fire(new g.Event("moveend",d)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(g.LngLatBounds.convert(d)),this._update()},h.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},h.prototype.project=function(d){return this.transform.locationPoint(g.LngLat.convert(d))},h.prototype.unproject=function(d){return this.transform.pointLocation(g.Point.convert(d))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(d,E,w){var M,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:w,delegates:{mousemove:function(oe){var fe=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];fe.length?U||(U=!0,w.call(L,new Io(d,L,oe.originalEvent,{features:fe}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var Y=!1;return{layer:E,listener:w,delegates:{mousemove:function(oe){(L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[]).length?Y=!0:Y&&(Y=!1,w.call(L,new Io(d,L,oe.originalEvent)))},mouseout:function(oe){Y&&(Y=!1,w.call(L,new Io(d,L,oe.originalEvent)))}}}}return{layer:E,listener:w,delegates:(M={},M[d]=function(oe){var fe=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];fe.length&&(oe.features=fe,w.call(L,oe),delete oe.features)},M)}},h.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var M=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(M),M.delegates)this.on(L,M.delegates[L]);return this},h.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var M=this._createDelegatedListener(d,E,w);for(var L in M.delegates)this.once(L,M.delegates[L]);return this},h.prototype.off=function(d,E,w){var M=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],Y=0;Y<U.length;Y++){var oe=U[Y];if(oe.layer===E&&oe.listener===w){for(var fe in oe.delegates)M.off(fe,oe.delegates[fe]);return U.splice(Y,1),M}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof g.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof g.Point||typeof d[0]=="number")w=[g.Point.convert(d)];else{var M=g.Point.convert(d[0]),L=g.Point.convert(d[1]);w=[M,new g.Point(L.x,M.y),L,new g.Point(M.x,L.y),M]}return this.style.queryRenderedFeatures(w,E,this.transform)},h.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},h.prototype.setStyle=function(d,E){return(E=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},h.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},h.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new hs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new hs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var M=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(M,g.ResourceType.Style);g.getJSON(L,function(U,Y){U?w.fire(new g.ErrorEvent(U)):Y&&w._updateDiff(Y,E)})}else typeof d=="object"&&this._updateDiff(d,E)},h.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){g.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():g.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},h.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new g.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},h.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var M in w){var L=w[M];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},h.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},h.prototype.getSource=function(d){return this.style.getSource(d)},h.prototype.addImage=function(d,E,w){w===void 0&&(w={});var M=w.pixelRatio;M===void 0&&(M=1);var L=w.sdf;L===void 0&&(L=!1);var U=w.stretchX,Y=w.stretchY,oe=w.content;if(this._lazyInitEmptyStyle(),E instanceof mf||oa&&E instanceof oa){var fe=g.browser.getImageData(E);this.style.addImage(d,{data:new g.RGBAImage({width:fe.width,height:fe.height},fe.data),pixelRatio:M,stretchX:U,stretchY:Y,content:oe,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var pe=E;this.style.addImage(d,{data:new g.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:M,stretchX:U,stretchY:Y,content:oe,sdf:L,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,d)}},h.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=E instanceof mf||oa&&E instanceof oa?g.browser.getImageData(E):E,L=M.width,U=M.height,Y=M.data;return L===void 0||U===void 0?this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||U!==w.data.height?this.fire(new g.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(Y,!(E instanceof mf||oa&&E instanceof oa)),void this.style.updateImage(d,w))},h.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(d){this.style.removeImage(d)},h.prototype.loadImage=function(d,E){g.getImage(this._requestManager.transformRequest(d,g.ResourceType.Image),E)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},h.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},h.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},h.prototype.getLayer=function(d){return this.style.getLayer(d)},h.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},h.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},h.prototype.getFilter=function(d){return this.style.getFilter(d)},h.prototype.setPaintProperty=function(d,E,w,M){return M===void 0&&(M={}),this.style.setPaintProperty(d,E,w,M),this._update(!0)},h.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},h.prototype.setLayoutProperty=function(d,E,w,M){return M===void 0&&(M={}),this.style.setLayoutProperty(d,E,w,M),this._update(!0)},h.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},h.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},h.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},h.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},h.prototype._detectMissingCSS=function(){g.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&g.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=V.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=V.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=V.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var M=this._controlContainer=V.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=V.create("div","mapboxgl-ctrl-"+U,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(d,E){var w=g.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},h.prototype._setupPainter=function(){var d=g.extend({},ve.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new ja(E,this.transform),g.webpSupported.testSupport(E)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:d}))},h.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:d}))},h.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},h.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},h.prototype._render=function(d){var E,w=this,M=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),M=g.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Y=this.transform.zoom,oe=g.browser.now();this.style.zoomHistory.update(Y,oe);var fe=new g.EvaluationParameters(Y,{now:oe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=fe.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(U=!0,this._crossFadingFactor=pe),this.style.update(fe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Re=g.browser.now()-M;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var Ae=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new g.Event("gpu-timing-frame",{cpuTime:Re,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var Ie=this.painter.collectGpuTimers();setTimeout(function(){var Ae=w.painter.queryGpuTimers(Ie);w.fire(new g.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var Xe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Xe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.Event("idle")),!this._loaded||this._fullyLoaded||Xe||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),g.window!==void 0&&(g.window.removeEventListener("resize",this._onWindowResize,!1),g.window.removeEventListener("orientationchange",this._onWindowResize,!1),g.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),al(this._canvasContainer),al(this._controlContainer),al(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new g.Event("remove"))},h.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=g.browser.frame(function(E){d._frame=null,d._render(E)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},h.prototype._setCacheLimits=function(d,E){g.setCacheLimits(d,E)},c.version.get=function(){return g.version},Object.defineProperties(h.prototype,c),h}(pc);function al(l){l.parentNode&&l.parentNode.removeChild(l)}var Ks={showCompass:!0,showZoom:!0,visualizePitch:!1},Cu=function(l){var h=this;this.options=g.extend({},Ks,l),this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return h._map.zoomIn({},{originalEvent:c})}),V.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return h._map.zoomOut({},{originalEvent:c})}),V.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:c}):h._map.resetNorth({},{originalEvent:c})}),this._compassIcon=V.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Cu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),h=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Cu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Cu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Oo(this._map,this._compass,this.options.visualizePitch)),this._container},Cu.prototype.onRemove=function(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Cu.prototype._createButton=function(l,h){var c=V.create("button",l,this._container);return c.type="button",c.addEventListener("click",h),c},Cu.prototype._setButtonTitle=function(l,h){var c=this._map._getUIString("NavigationControl."+h);l.title=c,l.setAttribute("aria-label",c)};var Oo=function(l,h,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new Xf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new Lu({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),V.addEventListener(h,"mousedown",this.mousedown),V.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(h,"touchmove",this.touchmove),V.addEventListener(h,"touchend",this.touchend),V.addEventListener(h,"touchcancel",this.reset)};function ol(l,h,c){if(l=new g.LngLat(l.lng,l.lat),h){var d=new g.LngLat(l.lng-360,l.lat),E=new g.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(h);c.locationPoint(d).distSqr(h)<w?l=d:c.locationPoint(E).distSqr(h)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var M=c.locationPoint(l);if(M.x>=0&&M.y>=0&&M.x<=c.width&&M.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Oo.prototype.down=function(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),V.disableDrag()},Oo.prototype.move=function(l,h){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,h);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,h);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},Oo.prototype.off=function(){var l=this.element;V.removeEventListener(l,"mousedown",this.mousedown),V.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(l,"touchmove",this.touchmove),V.removeEventListener(l,"touchend",this.touchend),V.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Oo.prototype.offTemp=function(){V.enableDrag(),V.removeEventListener(g.window,"mousemove",this.mousemove),V.removeEventListener(g.window,"mouseup",this.mouseup)},Oo.prototype.mousedown=function(l){this.down(g.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),V.mousePos(this.element,l)),V.addEventListener(g.window,"mousemove",this.mousemove),V.addEventListener(g.window,"mouseup",this.mouseup)},Oo.prototype.mousemove=function(l){this.move(l,V.mousePos(this.element,l))},Oo.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Oo.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Oo.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Oo.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Oo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Au={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Al(l,h,c){var d=l.classList;for(var E in Au)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+h)}var sl,dc=function(l){function h(c,d){if(l.call(this),(c instanceof g.window.HTMLElement||d)&&(c=g.extend({element:c},d)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=g.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div"),this._element.setAttribute("aria-label","Map marker");var E=V.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=V.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var M=V.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var L=V.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<Y.length;U+=1){var oe=Y[U],fe=V.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",oe.rx),fe.setAttributeNS(null,"ry",oe.ry),L.appendChild(fe)}var pe=V.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"fill",this._color);var Re=V.createNS("http://www.w3.org/2000/svg","path");Re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),pe.appendChild(Re);var Ie=V.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"opacity","0.25"),Ie.setAttributeNS(null,"fill","#000000");var Xe=V.createNS("http://www.w3.org/2000/svg","path");Xe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ie.appendChild(Xe);var Ae=V.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var Ye=V.createNS("http://www.w3.org/2000/svg","g");Ye.setAttributeNS(null,"transform","translate(8.0, 8.0)");var it=V.createNS("http://www.w3.org/2000/svg","circle");it.setAttributeNS(null,"fill","#000000"),it.setAttributeNS(null,"opacity","0.25"),it.setAttributeNS(null,"cx","5.5"),it.setAttributeNS(null,"cy","5.5"),it.setAttributeNS(null,"r","5.4999962");var Et=V.createNS("http://www.w3.org/2000/svg","circle");Et.setAttributeNS(null,"fill","#FFFFFF"),Et.setAttributeNS(null,"cx","5.5"),Et.setAttributeNS(null,"cy","5.5"),Et.setAttributeNS(null,"r","5.4999962"),Ye.appendChild(it),Ye.appendChild(Et),M.appendChild(L),M.appendChild(pe),M.appendChild(Ie),M.appendChild(Ae),M.appendChild(Ye),E.appendChild(M),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=g.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Xt){Xt.preventDefault()}),this._element.addEventListener("mousedown",function(Xt){Xt.preventDefault()}),Al(this._element,this._anchor,"marker"),this._popup=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=g.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},h.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},h.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ol(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,Au[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(c){return this._offset=g.Point.convert(c),this._update(),this},h.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new g.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(g.Evented),gf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},wl=0,Tl=!1,Ph=function(l){function h(c){l.call(this),this.options=g.extend({},gf,c),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){var d;return this._map=c,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,sl!==void 0?d(sl):g.window.navigator.permissions!==void 0?g.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(sl=E.state!=="denied")}):d(sl=!!g.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,wl=0,Tl=!1},h.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",c)),this._finish()}},h.prototype._updateCamera=function(c){var d=new g.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),M=g.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),M,{geolocateSource:!0})},h.prototype._updateMarker=function(c){if(c){var d=new g.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),M=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Tl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",c)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=V.create("button","mapboxgl-ctrl-geolocate",this._container),V.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new dc(this._dotElement),this._circleElement=V.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||d._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new g.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wl--,Tl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++wl>1?(c={maximumAge:6e5,timeout:0},Tl=!0):(c=this.options.positionOptions,Tl=!1),this._geolocationWatchID=g.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else g.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(g.Evented),Ml={maxWidth:100,unit:"metric"},Xl=function(l){this.options=g.extend({},Ml,l),g.bindAll(["_onMove","setUnit"],this)};function yf(l,h,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),M=l.unproject([d,E]),L=w.distanceTo(M);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?Du(h,d,U/5280,l._getUIString("ScaleControl.Miles")):Du(h,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Du(h,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Du(h,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):Du(h,d,L,l._getUIString("ScaleControl.Meters"))}function Du(l,h,c,d){var E,w,M,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(M=(M=E/w)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(U){var Y=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*Y)/Y}(M)));l.style.width=h*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}Xl.prototype.getDefaultPosition=function(){return"bottom-left"},Xl.prototype._onMove=function(){yf(this._map,this._container,this.options)},Xl.prototype.onAdd=function(l){return this._map=l,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Xl.prototype.onRemove=function(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Xl.prototype.setUnit=function(l){this.options.unit=l,yf(this._map,this._container,this.options)};var Cs=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof g.window.HTMLElement?this._container=l.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in g.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in g.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in g.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in g.window.document&&(this._fullscreenchange="MSFullscreenChange")};Cs.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Cs.prototype.onRemove=function(){V.remove(this._controlContainer),this._map=null,g.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Cs.prototype._checkFullscreenSupport=function(){return!!(g.window.document.fullscreenEnabled||g.window.document.mozFullScreenEnabled||g.window.document.msFullscreenEnabled||g.window.document.webkitFullscreenEnabled)},Cs.prototype._setupUI=function(){var l=this._fullscreenButton=V.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),g.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Cs.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Cs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Cs.prototype._isFullscreen=function(){return this._fullscreen},Cs.prototype._changeIcon=function(){(g.window.document.fullscreenElement||g.window.document.mozFullScreenElement||g.window.document.webkitFullscreenElement||g.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Cs.prototype._onClickFullscreen=function(){this._isFullscreen()?g.window.document.exitFullscreen?g.window.document.exitFullscreen():g.window.document.mozCancelFullScreen?g.window.document.mozCancelFullScreen():g.window.document.msExitFullscreen?g.window.document.msExitFullscreen():g.window.document.webkitCancelFullScreen&&g.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var _f={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ih=function(l){function h(c){l.call(this),this.options=g.extend(Object.create(_f),c),g.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new g.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=g.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(c){return this.setDOMContent(g.window.document.createTextNode(c))},h.prototype.setHTML=function(c){var d,E=g.window.document.createDocumentFragment(),w=g.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},h.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},h.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},h.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},h.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=V.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(c){this._update(c.point)},h.prototype._onMouseMove=function(c){this._update(c.point)},h.prototype._onDrag=function(c){this._update(c.point)},h.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=V.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=V.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(fe){return d._container.classList.add(fe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ol(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,M=function fe(pe){if(pe){if(typeof pe=="number"){var Re=Math.round(Math.sqrt(.5*Math.pow(pe,2)));return{center:new g.Point(0,0),top:new g.Point(0,pe),"top-left":new g.Point(Re,Re),"top-right":new g.Point(-Re,Re),bottom:new g.Point(0,-pe),"bottom-left":new g.Point(Re,-Re),"bottom-right":new g.Point(-Re,-Re),left:new g.Point(pe,0),right:new g.Point(-pe,0)}}if(pe instanceof g.Point||Array.isArray(pe)){var Ie=g.Point.convert(pe);return{center:Ie,top:Ie,"top-left":Ie,"top-right":Ie,bottom:Ie,"bottom-left":Ie,"bottom-right":Ie,left:Ie,right:Ie}}return{center:g.Point.convert(pe.center||[0,0]),top:g.Point.convert(pe.top||[0,0]),"top-left":g.Point.convert(pe["top-left"]||[0,0]),"top-right":g.Point.convert(pe["top-right"]||[0,0]),bottom:g.Point.convert(pe.bottom||[0,0]),"bottom-left":g.Point.convert(pe["bottom-left"]||[0,0]),"bottom-right":g.Point.convert(pe["bottom-right"]||[0,0]),left:g.Point.convert(pe.left||[0,0]),right:g.Point.convert(pe.right||[0,0])}}return fe(new g.Point(0,0))}(this.options.offset);if(!w){var L,U=this._container.offsetWidth,Y=this._container.offsetHeight;L=E.y+M.bottom.y<Y?["top"]:E.y>this._map.transform.height-Y?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var oe=E.add(M[w]).round();V.setTransform(this._container,Au[w]+" translate("+oe.x+"px,"+oe.y+"px)"),Al(this._container,w,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(vc);c&&c.focus()}},h.prototype._onClose=function(){this.remove()},h}(g.Evented),Yl={version:g.version,supported:ve,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:qf,NavigationControl:Cu,GeolocateControl:Ph,AttributionControl:ds,ScaleControl:Xl,FullscreenControl:Cs,Popup:Ih,Marker:dc,Style:hs,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.Point,MercatorCoordinate:g.MercatorCoordinate,Evented:g.Evented,config:g.config,prewarm:function(){Lt().acquire(Ut)},clearPrewarmedResources:function(){var l=_n;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ut),_n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return g.config.ACCESS_TOKEN},set accessToken(l){g.config.ACCESS_TOKEN=l},get baseApiUrl(){return g.config.API_URL},set baseApiUrl(l){g.config.API_URL=l},get workerCount(){return gr.workerCount},set workerCount(l){gr.workerCount=l},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){g.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){g.clearTileCache(l)},workerUrl:""};return Yl}),le})},28660:function(Ot,J,N){var le=N(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ye;(function(g){(function(ve){var V=typeof N.g=="object"?N.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=ue(g);typeof V.Reflect=="undefined"?V.Reflect=g:ce=ue(V.Reflect,ce),ve(ce);function ue(Ne,se){return function(at,Le){typeof Ne[at]!="function"&&Object.defineProperty(Ne,at,{configurable:!0,writable:!0,value:Le}),se&&se(at,Le)}}})(function(ve){var V=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",ue=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ne=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",se=typeof Object.create=="function",at={__proto__:[]}instanceof Array,Le=!se&&!at,ut={create:se?function(){return ls(Object.create(null))}:at?function(){return ls({__proto__:null})}:function(){return ls({})},has:Le?function(Vt,or){return V.call(Vt,or)}:function(Vt,or){return or in Vt},get:Le?function(Vt,or){return V.call(Vt,or)?Vt[or]:void 0}:function(Vt,or){return Vt[or]}},Ht=Object.getPrototypeOf(Function),ur=typeof le=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Pt=!ur&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:de(),Jt=!ur&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Nn(),kt=!ur&&typeof WeakMap=="function"?WeakMap:Ua(),pt=new kt;function gt(Vt,or,wr,I){if(fn(wr)){if(!bi(Vt))throw new TypeError;if(!aa(or))throw new TypeError;return kr(Vt,or)}else{if(!bi(Vt))throw new TypeError;if(!Hn(or))throw new TypeError;if(!Hn(I)&&!fn(I)&&!Hi(I))throw new TypeError;return Hi(I)&&(I=void 0),wr=Ri(wr),en(Vt,or,wr,I)}}ve("decorate",gt);function er(Vt,or){function wr(I,ir){if(!Hn(I))throw new TypeError;if(!fn(ir)&&!Ei(ir))throw new TypeError;Zt(Vt,or,I,ir)}return wr}ve("metadata",er);function q(Vt,or,wr,I){if(!Hn(wr))throw new TypeError;return fn(I)||(I=Ri(I)),Zt(Vt,or,wr,I)}ve("defineMetadata",q);function Qt(Vt,or,wr){if(!Hn(or))throw new TypeError;return fn(wr)||(wr=Ri(wr)),qe(Vt,or,wr)}ve("hasMetadata",Qt);function xt(Vt,or,wr){if(!Hn(or))throw new TypeError;return fn(wr)||(wr=Ri(wr)),ke(Vt,or,wr)}ve("hasOwnMetadata",xt);function rt(Vt,or,wr){if(!Hn(or))throw new TypeError;return fn(wr)||(wr=Ri(wr)),Mt(Vt,or,wr)}ve("getMetadata",rt);function wt(Vt,or,wr){if(!Hn(or))throw new TypeError;return fn(wr)||(wr=Ri(wr)),yt(Vt,or,wr)}ve("getOwnMetadata",wt);function et(Vt,or){if(!Hn(Vt))throw new TypeError;return fn(or)||(or=Ri(or)),qt(Vt,or)}ve("getMetadataKeys",et);function $t(Vt,or){if(!Hn(Vt))throw new TypeError;return fn(or)||(or=Ri(or)),Cr(Vt,or)}ve("getOwnMetadataKeys",$t);function Sr(Vt,or,wr){if(!Hn(or))throw new TypeError;fn(wr)||(wr=Ri(wr));var I=Te(or,wr,!1);if(fn(I)||!I.delete(Vt))return!1;if(I.size>0)return!0;var ir=pt.get(or);return ir.delete(wr),ir.size>0||pt.delete(or),!0}ve("deleteMetadata",Sr);function kr(Vt,or){for(var wr=Vt.length-1;wr>=0;--wr){var I=Vt[wr],ir=I(or);if(!fn(ir)&&!Hi(ir)){if(!aa(ir))throw new TypeError;or=ir}}return or}function en(Vt,or,wr,I){for(var ir=Vt.length-1;ir>=0;--ir){var Dn=Vt[ir],li=Dn(or,wr,I);if(!fn(li)&&!Hi(li)){if(!Hn(li))throw new TypeError;I=li}}return I}function Te(Vt,or,wr){var I=pt.get(Vt);if(fn(I)){if(!wr)return;I=new Pt,pt.set(Vt,I)}var ir=I.get(or);if(fn(ir)){if(!wr)return;ir=new Pt,I.set(or,ir)}return ir}function qe(Vt,or,wr){var I=ke(Vt,or,wr);if(I)return!0;var ir=za(or);return Hi(ir)?!1:qe(Vt,ir,wr)}function ke(Vt,or,wr){var I=Te(or,wr,!1);return fn(I)?!1:ui(I.has(Vt))}function Mt(Vt,or,wr){var I=ke(Vt,or,wr);if(I)return yt(Vt,or,wr);var ir=za(or);if(!Hi(ir))return Mt(Vt,ir,wr)}function yt(Vt,or,wr){var I=Te(or,wr,!1);if(!fn(I))return I.get(Vt)}function Zt(Vt,or,wr,I){var ir=Te(wr,I,!0);ir.set(Vt,or)}function qt(Vt,or){var wr=Cr(Vt,or),I=za(Vt);if(I===null)return wr;var ir=qt(I,or);if(ir.length<=0)return wr;if(wr.length<=0)return ir;for(var Dn=new Jt,li=[],Wn=0,nn=wr;Wn<nn.length;Wn++){var wi=nn[Wn],Ti=Dn.has(wi);Ti||(Dn.add(wi),li.push(wi))}for(var Wa=0,cs=ir;Wa<cs.length;Wa++){var wi=cs[Wa],Ti=Dn.has(wi);Ti||(Dn.add(wi),li.push(wi))}return li}function Cr(Vt,or){var wr=[],I=Te(Vt,or,!1);if(fn(I))return wr;for(var ir=I.keys(),Dn=An(ir),li=0;;){var Wn=Bi(Dn);if(!Wn)return wr.length=li,wr;var nn=_i(Wn);try{wr[li]=nn}catch(wi){try{Wi(Dn)}finally{throw wi}}li++}}function qn(Vt){if(Vt===null)return 1;switch(typeof Vt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Vt===null?1:6;default:return 6}}function fn(Vt){return Vt===void 0}function Hi(Vt){return Vt===null}function Zn(Vt){return typeof Vt=="symbol"}function Hn(Vt){return typeof Vt=="object"?Vt!==null:typeof Vt=="function"}function pi(Vt,or){switch(qn(Vt)){case 0:return Vt;case 1:return Vt;case 2:return Vt;case 3:return Vt;case 4:return Vt;case 5:return Vt}var wr=or===3?"string":or===5?"number":"default",I=_a(Vt,ue);if(I!==void 0){var ir=I.call(Vt,wr);if(Hn(ir))throw new TypeError;return ir}return Kn(Vt,wr==="default"?"number":wr)}function Kn(Vt,or){if(or==="string"){var wr=Vt.toString;if(Ni(wr)){var I=wr.call(Vt);if(!Hn(I))return I}var ir=Vt.valueOf;if(Ni(ir)){var I=ir.call(Vt);if(!Hn(I))return I}}else{var ir=Vt.valueOf;if(Ni(ir)){var I=ir.call(Vt);if(!Hn(I))return I}var Dn=Vt.toString;if(Ni(Dn)){var I=Dn.call(Vt);if(!Hn(I))return I}}throw new TypeError}function ui(Vt){return!!Vt}function ra(Vt){return""+Vt}function Ri(Vt){var or=pi(Vt,3);return Zn(or)?or:ra(or)}function bi(Vt){return Array.isArray?Array.isArray(Vt):Vt instanceof Object?Vt instanceof Array:Object.prototype.toString.call(Vt)==="[object Array]"}function Ni(Vt){return typeof Vt=="function"}function aa(Vt){return typeof Vt=="function"}function Ei(Vt){switch(qn(Vt)){case 3:return!0;case 4:return!0;default:return!1}}function _a(Vt,or){var wr=Vt[or];if(wr!=null){if(!Ni(wr))throw new TypeError;return wr}}function An(Vt){var or=_a(Vt,Ne);if(!Ni(or))throw new TypeError;var wr=or.call(Vt);if(!Hn(wr))throw new TypeError;return wr}function _i(Vt){return Vt.value}function Bi(Vt){var or=Vt.next();return or.done?!1:or}function Wi(Vt){var or=Vt.return;or&&or.call(Vt)}function za(Vt){var or=Object.getPrototypeOf(Vt);if(typeof Vt!="function"||Vt===Ht||or!==Ht)return or;var wr=Vt.prototype,I=wr&&Object.getPrototypeOf(wr);if(I==null||I===Object.prototype)return or;var ir=I.constructor;return typeof ir!="function"||ir===Vt?or:ir}function de(){var Vt={},or=[],wr=function(){function li(Wn,nn,wi){this._index=0,this._keys=Wn,this._values=nn,this._selector=wi}return li.prototype["@@iterator"]=function(){return this},li.prototype[Ne]=function(){return this},li.prototype.next=function(){var Wn=this._index;if(Wn>=0&&Wn<this._keys.length){var nn=this._selector(this._keys[Wn],this._values[Wn]);return Wn+1>=this._keys.length?(this._index=-1,this._keys=or,this._values=or):this._index++,{value:nn,done:!1}}return{value:void 0,done:!0}},li.prototype.throw=function(Wn){throw this._index>=0&&(this._index=-1,this._keys=or,this._values=or),Wn},li.prototype.return=function(Wn){return this._index>=0&&(this._index=-1,this._keys=or,this._values=or),{value:Wn,done:!0}},li}();return function(){function li(){this._keys=[],this._values=[],this._cacheKey=Vt,this._cacheIndex=-2}return Object.defineProperty(li.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),li.prototype.has=function(Wn){return this._find(Wn,!1)>=0},li.prototype.get=function(Wn){var nn=this._find(Wn,!1);return nn>=0?this._values[nn]:void 0},li.prototype.set=function(Wn,nn){var wi=this._find(Wn,!0);return this._values[wi]=nn,this},li.prototype.delete=function(Wn){var nn=this._find(Wn,!1);if(nn>=0){for(var wi=this._keys.length,Ti=nn+1;Ti<wi;Ti++)this._keys[Ti-1]=this._keys[Ti],this._values[Ti-1]=this._values[Ti];return this._keys.length--,this._values.length--,Wn===this._cacheKey&&(this._cacheKey=Vt,this._cacheIndex=-2),!0}return!1},li.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Vt,this._cacheIndex=-2},li.prototype.keys=function(){return new wr(this._keys,this._values,I)},li.prototype.values=function(){return new wr(this._keys,this._values,ir)},li.prototype.entries=function(){return new wr(this._keys,this._values,Dn)},li.prototype["@@iterator"]=function(){return this.entries()},li.prototype[Ne]=function(){return this.entries()},li.prototype._find=function(Wn,nn){return this._cacheKey!==Wn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Wn)),this._cacheIndex<0&&nn&&(this._cacheIndex=this._keys.length,this._keys.push(Wn),this._values.push(void 0)),this._cacheIndex},li}();function I(li,Wn){return li}function ir(li,Wn){return Wn}function Dn(li,Wn){return[li,Wn]}}function Nn(){return function(){function Vt(){this._map=new Pt}return Object.defineProperty(Vt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Vt.prototype.has=function(or){return this._map.has(or)},Vt.prototype.add=function(or){return this._map.set(or,or),this},Vt.prototype.delete=function(or){return this._map.delete(or)},Vt.prototype.clear=function(){this._map.clear()},Vt.prototype.keys=function(){return this._map.keys()},Vt.prototype.values=function(){return this._map.values()},Vt.prototype.entries=function(){return this._map.entries()},Vt.prototype["@@iterator"]=function(){return this.keys()},Vt.prototype[Ne]=function(){return this.keys()},Vt}()}function Ua(){var Vt=16,or=ut.create(),wr=I();return function(){function nn(){this._key=I()}return nn.prototype.has=function(wi){var Ti=ir(wi,!1);return Ti!==void 0?ut.has(Ti,this._key):!1},nn.prototype.get=function(wi){var Ti=ir(wi,!1);return Ti!==void 0?ut.get(Ti,this._key):void 0},nn.prototype.set=function(wi,Ti){var Wa=ir(wi,!0);return Wa[this._key]=Ti,this},nn.prototype.delete=function(wi){var Ti=ir(wi,!1);return Ti!==void 0?delete Ti[this._key]:!1},nn.prototype.clear=function(){this._key=I()},nn}();function I(){var nn;do nn="@@WeakMap@@"+Wn();while(ut.has(or,nn));return or[nn]=!0,nn}function ir(nn,wi){if(!V.call(nn,wr)){if(!wi)return;Object.defineProperty(nn,wr,{value:ut.create()})}return nn[wr]}function Dn(nn,wi){for(var Ti=0;Ti<wi;++Ti)nn[Ti]=Math.random()*255|0;return nn}function li(nn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(nn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(nn)):Dn(new Uint8Array(nn),nn):Dn(new Array(nn),nn)}function Wn(){var nn=li(Vt);nn[6]=nn[6]&79|64,nn[8]=nn[8]&191|128;for(var wi="",Ti=0;Ti<Vt;++Ti){var Wa=nn[Ti];(Ti===4||Ti===6||Ti===8)&&(wi+="-"),Wa<16&&(wi+="0"),wi+=Wa.toString(16).toLowerCase()}return wi}}function ls(Vt){return Vt.__=void 0,delete Vt.__,Vt}})})(ye||(ye={}))},69848:function(Ot){(function(J,N){Ot.exports=N()})(this,function(){"use strict";function J(xt,rt,wt,et,$t,Sr){if(!($t-et<=wt)){var kr=et+$t>>1;N(xt,rt,kr,et,$t,Sr%2),J(xt,rt,wt,et,kr-1,Sr+1),J(xt,rt,wt,kr+1,$t,Sr+1)}}function N(xt,rt,wt,et,$t,Sr){for(;$t>et;){if($t-et>600){var kr=$t-et+1,en=wt-et+1,Te=Math.log(kr),qe=.5*Math.exp(2*Te/3),ke=.5*Math.sqrt(Te*qe*(kr-qe)/kr)*(en-kr/2<0?-1:1),Mt=Math.max(et,Math.floor(wt-en*qe/kr+ke)),yt=Math.min($t,Math.floor(wt+(kr-en)*qe/kr+ke));N(xt,rt,wt,Mt,yt,Sr)}var Zt=rt[2*wt+Sr],qt=et,Cr=$t;for(le(xt,rt,et,wt),rt[2*$t+Sr]>Zt&&le(xt,rt,et,$t);qt<Cr;){for(le(xt,rt,qt,Cr),qt++,Cr--;rt[2*qt+Sr]<Zt;)qt++;for(;rt[2*Cr+Sr]>Zt;)Cr--}rt[2*et+Sr]===Zt?le(xt,rt,et,Cr):(Cr++,le(xt,rt,Cr,$t)),Cr<=wt&&(et=Cr+1),wt<=Cr&&($t=Cr-1)}}function le(xt,rt,wt,et){ye(xt,wt,et),ye(rt,2*wt,2*et),ye(rt,2*wt+1,2*et+1)}function ye(xt,rt,wt){var et=xt[rt];xt[rt]=xt[wt],xt[wt]=et}function g(xt,rt,wt,et,$t,Sr,kr){for(var en=[0,xt.length-1,0],Te=[],qe,ke;en.length;){var Mt=en.pop(),yt=en.pop(),Zt=en.pop();if(yt-Zt<=kr){for(var qt=Zt;qt<=yt;qt++)qe=rt[2*qt],ke=rt[2*qt+1],qe>=wt&&qe<=$t&&ke>=et&&ke<=Sr&&Te.push(xt[qt]);continue}var Cr=Math.floor((Zt+yt)/2);qe=rt[2*Cr],ke=rt[2*Cr+1],qe>=wt&&qe<=$t&&ke>=et&&ke<=Sr&&Te.push(xt[Cr]);var qn=(Mt+1)%2;(Mt===0?wt<=qe:et<=ke)&&(en.push(Zt),en.push(Cr-1),en.push(qn)),(Mt===0?$t>=qe:Sr>=ke)&&(en.push(Cr+1),en.push(yt),en.push(qn))}return Te}function ve(xt,rt,wt,et,$t,Sr){for(var kr=[0,xt.length-1,0],en=[],Te=$t*$t;kr.length;){var qe=kr.pop(),ke=kr.pop(),Mt=kr.pop();if(ke-Mt<=Sr){for(var yt=Mt;yt<=ke;yt++)V(rt[2*yt],rt[2*yt+1],wt,et)<=Te&&en.push(xt[yt]);continue}var Zt=Math.floor((Mt+ke)/2),qt=rt[2*Zt],Cr=rt[2*Zt+1];V(qt,Cr,wt,et)<=Te&&en.push(xt[Zt]);var qn=(qe+1)%2;(qe===0?wt-$t<=qt:et-$t<=Cr)&&(kr.push(Mt),kr.push(Zt-1),kr.push(qn)),(qe===0?wt+$t>=qt:et+$t>=Cr)&&(kr.push(Zt+1),kr.push(ke),kr.push(qn))}return en}function V(xt,rt,wt,et){var $t=xt-wt,Sr=rt-et;return $t*$t+Sr*Sr}var ce=function(xt){return xt[0]},ue=function(xt){return xt[1]},Ne=function(rt,wt,et,$t,Sr){wt===void 0&&(wt=ce),et===void 0&&(et=ue),$t===void 0&&($t=64),Sr===void 0&&(Sr=Float64Array),this.nodeSize=$t,this.points=rt;for(var kr=rt.length<65536?Uint16Array:Uint32Array,en=this.ids=new kr(rt.length),Te=this.coords=new Sr(rt.length*2),qe=0;qe<rt.length;qe++)en[qe]=qe,Te[2*qe]=wt(rt[qe]),Te[2*qe+1]=et(rt[qe]);J(en,Te,$t,0,en.length-1,0)};Ne.prototype.range=function(rt,wt,et,$t){return g(this.ids,this.coords,rt,wt,et,$t,this.nodeSize)},Ne.prototype.within=function(rt,wt,et){return ve(this.ids,this.coords,rt,wt,et,this.nodeSize)};var se={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(xt){return xt}},at=Math.fround||function(xt){return function(rt){return xt[0]=+rt,xt[0]}}(new Float32Array(1)),Le=function(rt){this.options=er(Object.create(se),rt),this.trees=new Array(this.options.maxZoom+1)};Le.prototype.load=function(rt){var wt=this.options,et=wt.log,$t=wt.minZoom,Sr=wt.maxZoom,kr=wt.nodeSize;et&&console.time("total time");var en="prepare "+rt.length+" points";et&&console.time(en),this.points=rt;for(var Te=[],qe=0;qe<rt.length;qe++)!rt[qe].geometry||Te.push(Ht(rt[qe],qe));this.trees[Sr+1]=new Ne(Te,q,Qt,kr,Float32Array),et&&console.timeEnd(en);for(var ke=Sr;ke>=$t;ke--){var Mt=+Date.now();Te=this._cluster(Te,ke),this.trees[ke]=new Ne(Te,q,Qt,kr,Float32Array),et&&console.log("z%d: %d clusters in %dms",ke,Te.length,+Date.now()-Mt)}return et&&console.timeEnd("total time"),this},Le.prototype.getClusters=function(rt,wt){var et=((rt[0]+180)%360+360)%360-180,$t=Math.max(-90,Math.min(90,rt[1])),Sr=rt[2]===180?180:((rt[2]+180)%360+360)%360-180,kr=Math.max(-90,Math.min(90,rt[3]));if(rt[2]-rt[0]>=360)et=-180,Sr=180;else if(et>Sr){var en=this.getClusters([et,$t,180,kr],wt),Te=this.getClusters([-180,$t,Sr,kr],wt);return en.concat(Te)}for(var qe=this.trees[this._limitZoom(wt)],ke=qe.range(Jt(et),kt(kr),Jt(Sr),kt($t)),Mt=[],yt=0,Zt=ke;yt<Zt.length;yt+=1){var qt=Zt[yt],Cr=qe.points[qt];Mt.push(Cr.numPoints?ur(Cr):this.points[Cr.index])}return Mt},Le.prototype.getChildren=function(rt){var wt=this._getOriginId(rt),et=this._getOriginZoom(rt),$t="No cluster with the specified id.",Sr=this.trees[et];if(!Sr)throw new Error($t);var kr=Sr.points[wt];if(!kr)throw new Error($t);for(var en=this.options.radius/(this.options.extent*Math.pow(2,et-1)),Te=Sr.within(kr.x,kr.y,en),qe=[],ke=0,Mt=Te;ke<Mt.length;ke+=1){var yt=Mt[ke],Zt=Sr.points[yt];Zt.parentId===rt&&qe.push(Zt.numPoints?ur(Zt):this.points[Zt.index])}if(qe.length===0)throw new Error($t);return qe},Le.prototype.getLeaves=function(rt,wt,et){wt=wt||10,et=et||0;var $t=[];return this._appendLeaves($t,rt,wt,et,0),$t},Le.prototype.getTile=function(rt,wt,et){var $t=this.trees[this._limitZoom(rt)],Sr=Math.pow(2,rt),kr=this.options,en=kr.extent,Te=kr.radius,qe=Te/en,ke=(et-qe)/Sr,Mt=(et+1+qe)/Sr,yt={features:[]};return this._addTileFeatures($t.range((wt-qe)/Sr,ke,(wt+1+qe)/Sr,Mt),$t.points,wt,et,Sr,yt),wt===0&&this._addTileFeatures($t.range(1-qe/Sr,ke,1,Mt),$t.points,Sr,et,Sr,yt),wt===Sr-1&&this._addTileFeatures($t.range(0,ke,qe/Sr,Mt),$t.points,-1,et,Sr,yt),yt.features.length?yt:null},Le.prototype.getClusterExpansionZoom=function(rt){for(var wt=this._getOriginZoom(rt)-1;wt<=this.options.maxZoom;){var et=this.getChildren(rt);if(wt++,et.length!==1)break;rt=et[0].properties.cluster_id}return wt},Le.prototype._appendLeaves=function(rt,wt,et,$t,Sr){for(var kr=this.getChildren(wt),en=0,Te=kr;en<Te.length;en+=1){var qe=Te[en],ke=qe.properties;if(ke&&ke.cluster?Sr+ke.point_count<=$t?Sr+=ke.point_count:Sr=this._appendLeaves(rt,ke.cluster_id,et,$t,Sr):Sr<$t?Sr++:rt.push(qe),rt.length===et)break}return Sr},Le.prototype._addTileFeatures=function(rt,wt,et,$t,Sr,kr){for(var en=0,Te=rt;en<Te.length;en+=1){var qe=Te[en],ke=wt[qe],Mt=ke.numPoints,yt=void 0,Zt=void 0,qt=void 0;if(Mt)yt=Pt(ke),Zt=ke.x,qt=ke.y;else{var Cr=this.points[ke.index];yt=Cr.properties,Zt=Jt(Cr.geometry.coordinates[0]),qt=kt(Cr.geometry.coordinates[1])}var qn={type:1,geometry:[[Math.round(this.options.extent*(Zt*Sr-et)),Math.round(this.options.extent*(qt*Sr-$t))]],tags:yt},fn=void 0;Mt?fn=ke.id:this.options.generateId?fn=ke.index:this.points[ke.index].id&&(fn=this.points[ke.index].id),fn!==void 0&&(qn.id=fn),kr.features.push(qn)}},Le.prototype._limitZoom=function(rt){return Math.max(this.options.minZoom,Math.min(Math.floor(+rt),this.options.maxZoom+1))},Le.prototype._cluster=function(rt,wt){for(var et=[],$t=this.options,Sr=$t.radius,kr=$t.extent,en=$t.reduce,Te=$t.minPoints,qe=Sr/(kr*Math.pow(2,wt)),ke=0;ke<rt.length;ke++){var Mt=rt[ke];if(!(Mt.zoom<=wt)){Mt.zoom=wt;for(var yt=this.trees[wt+1],Zt=yt.within(Mt.x,Mt.y,qe),qt=Mt.numPoints||1,Cr=qt,qn=0,fn=Zt;qn<fn.length;qn+=1){var Hi=fn[qn],Zn=yt.points[Hi];Zn.zoom>wt&&(Cr+=Zn.numPoints||1)}if(Cr>qt&&Cr>=Te){for(var Hn=Mt.x*qt,pi=Mt.y*qt,Kn=en&&qt>1?this._map(Mt,!0):null,ui=(ke<<5)+(wt+1)+this.points.length,ra=0,Ri=Zt;ra<Ri.length;ra+=1){var bi=Ri[ra],Ni=yt.points[bi];if(!(Ni.zoom<=wt)){Ni.zoom=wt;var aa=Ni.numPoints||1;Hn+=Ni.x*aa,pi+=Ni.y*aa,Ni.parentId=ui,en&&(Kn||(Kn=this._map(Mt,!0)),en(Kn,this._map(Ni)))}}Mt.parentId=ui,et.push(ut(Hn/Cr,pi/Cr,ui,Cr,Kn))}else if(et.push(Mt),Cr>1)for(var Ei=0,_a=Zt;Ei<_a.length;Ei+=1){var An=_a[Ei],_i=yt.points[An];_i.zoom<=wt||(_i.zoom=wt,et.push(_i))}}}return et},Le.prototype._getOriginId=function(rt){return rt-this.points.length>>5},Le.prototype._getOriginZoom=function(rt){return(rt-this.points.length)%32},Le.prototype._map=function(rt,wt){if(rt.numPoints)return wt?er({},rt.properties):rt.properties;var et=this.points[rt.index].properties,$t=this.options.map(et);return wt&&$t===et?er({},$t):$t};function ut(xt,rt,wt,et,$t){return{x:at(xt),y:at(rt),zoom:Infinity,id:wt,parentId:-1,numPoints:et,properties:$t}}function Ht(xt,rt){var wt=xt.geometry.coordinates,et=wt[0],$t=wt[1];return{x:at(Jt(et)),y:at(kt($t)),zoom:Infinity,index:rt,parentId:-1}}function ur(xt){return{type:"Feature",id:xt.id,properties:Pt(xt),geometry:{type:"Point",coordinates:[pt(xt.x),gt(xt.y)]}}}function Pt(xt){var rt=xt.numPoints,wt=rt>=1e4?Math.round(rt/1e3)+"k":rt>=1e3?Math.round(rt/100)/10+"k":rt;return er(er({},xt.properties),{cluster:!0,cluster_id:xt.id,point_count:rt,point_count_abbreviated:wt})}function Jt(xt){return xt/360+.5}function kt(xt){var rt=Math.sin(xt*Math.PI/180),wt=.5-.25*Math.log((1+rt)/(1-rt))/Math.PI;return wt<0?0:wt>1?1:wt}function pt(xt){return(xt-.5)*360}function gt(xt){var rt=(180-xt*360)*Math.PI/180;return 360*Math.atan(Math.exp(rt))/Math.PI-90}function er(xt,rt){for(var wt in rt)xt[wt]=rt[wt];return xt}function q(xt){return xt.x}function Qt(xt){return xt.y}return Le})},75752:function(Ot){Ot.exports.RADIUS=6378137,Ot.exports.FLATTENING=1/298.257223563,Ot.exports.POLAR_RADIUS=63567523142e-4}}]);
